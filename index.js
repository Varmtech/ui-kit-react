function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

function _interopNamespace(e) {
  if (e && e.__esModule) { return e; } else {
    var n = {};
    if (e) {
      Object.keys(e).forEach(function (k) {
        var d = Object.getOwnPropertyDescriptor(e, k);
        Object.defineProperty(n, k, d.get ? d : {
          enumerable: true,
          get: function () {
            return e[k];
          }
        });
      });
    }
    n['default'] = e;
    return n;
  }
}

var React = require('react');
var React__default = _interopDefault(React);
var reactRedux = require('react-redux');
var createSagaMiddleware = require('redux-saga');
var createSagaMiddleware__default = _interopDefault(createSagaMiddleware);
var redux = require('redux');
var styled = require('styled-components');
var styled__default = _interopDefault(styled);
var FileSaver = _interopDefault(require('file-saver'));
var effects = require('redux-saga/effects');
var uuid = require('uuid');
var LinkifyIt = _interopDefault(require('linkify-it'));
var Cropper = _interopDefault(require('react-easy-crop'));
var Carousel = _interopDefault(require('react-elastic-carousel'));
var reactCircularProgressbar = require('react-circular-progressbar');
var lexical = require('lexical');
var LexicalComposerContext = require('@lexical/react/LexicalComposerContext');
var LexicalComposer = require('@lexical/react/LexicalComposer');
var LexicalContentEditable = require('@lexical/react/LexicalContentEditable');
var LexicalRichTextPlugin = require('@lexical/react/LexicalRichTextPlugin');
var LexicalErrorBoundary = _interopDefault(require('@lexical/react/LexicalErrorBoundary'));
var LexicalOnChangePlugin = require('@lexical/react/LexicalOnChangePlugin');
var ReactDOM = require('react-dom');
var LexicalTypeaheadMenuPlugin = require('@lexical/react/LexicalTypeaheadMenuPlugin');
var offset = require('@lexical/offset');

/** A function that accepts a potential "extra argument" value to be injected later,
 * and returns an instance of the thunk middleware that uses that value
 */
function createThunkMiddleware(extraArgument) {
  // Standard Redux middleware definition pattern:
  // See: https://redux.js.org/tutorials/fundamentals/part-4-store#writing-custom-middleware
  var middleware = function middleware(_ref) {
    var dispatch = _ref.dispatch,
        getState = _ref.getState;
    return function (next) {
      return function (action) {
        // The thunk middleware looks for any functions that were passed to `store.dispatch`.
        // If this "action" is really a function, call it and return the result.
        if (typeof action === 'function') {
          // Inject the store's `dispatch` and `getState` methods, as well as any "extra arg"
          return action(dispatch, getState, extraArgument);
        } // Otherwise, pass the action down the middleware chain as usual


        return next(action);
      };
    };
  };

  return middleware;
}

var thunk = createThunkMiddleware(); // Attach the factory function so users can create a customized version
// with whatever "extra arg" they want to inject into their thunks

thunk.withExtraArgument = createThunkMiddleware;

var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArray = (undefined && undefined.__spreadArray) || function (to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
};
var __defProp = Object.defineProperty;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = function (obj, key, value) { return key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value: value }) : obj[key] = value; };
var __spreadValues = function (a, b) {
    for (var prop in b || (b = {}))
        if (__hasOwnProp.call(b, prop))
            __defNormalProp(a, prop, b[prop]);
    if (__getOwnPropSymbols)
        for (var _i = 0, _c = __getOwnPropSymbols(b); _i < _c.length; _i++) {
            var prop = _c[_i];
            if (__propIsEnum.call(b, prop))
                __defNormalProp(a, prop, b[prop]);
        }
    return a;
};
var composeWithDevTools = typeof window !== "undefined" && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ : function () {
    if (arguments.length === 0)
        return void 0;
    if (typeof arguments[0] === "object")
        return redux.compose;
    return redux.compose.apply(null, arguments);
};
// src/isPlainObject.ts
function isPlainObject(value) {
    if (typeof value !== "object" || value === null)
        return false;
    var proto = Object.getPrototypeOf(value);
    if (proto === null)
        return true;
    var baseProto = proto;
    while (Object.getPrototypeOf(baseProto) !== null) {
        baseProto = Object.getPrototypeOf(baseProto);
    }
    return proto === baseProto;
}
function getTimeMeasureUtils(maxDelay, fnName) {
    var elapsed = 0;
    return {
        measureTime: function (fn) {
            var started = Date.now();
            try {
                return fn();
            }
            finally {
                var finished = Date.now();
                elapsed += finished - started;
            }
        },
        warnIfExceeded: function () {
            if (elapsed > maxDelay) {
                console.warn(fnName + " took " + elapsed + "ms, which is more than the warning threshold of " + maxDelay + "ms. \nIf your state or actions are very large, you may want to disable the middleware as it might cause too much of a slowdown in development mode. See https://redux-toolkit.js.org/api/getDefaultMiddleware for instructions.\nIt is disabled in production builds, so you don't need to worry about that.");
            }
        }
    };
}
var MiddlewareArray = /** @class */ (function (_super) {
    __extends(MiddlewareArray, _super);
    function MiddlewareArray() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var _this = _super.apply(this, args) || this;
        Object.setPrototypeOf(_this, MiddlewareArray.prototype);
        return _this;
    }
    Object.defineProperty(MiddlewareArray, Symbol.species, {
        get: function () {
            return MiddlewareArray;
        },
        enumerable: false,
        configurable: true
    });
    MiddlewareArray.prototype.concat = function () {
        var arr = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            arr[_i] = arguments[_i];
        }
        return _super.prototype.concat.apply(this, arr);
    };
    MiddlewareArray.prototype.prepend = function () {
        var arr = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            arr[_i] = arguments[_i];
        }
        if (arr.length === 1 && Array.isArray(arr[0])) {
            return new (MiddlewareArray.bind.apply(MiddlewareArray, __spreadArray([void 0], arr[0].concat(this))))();
        }
        return new (MiddlewareArray.bind.apply(MiddlewareArray, __spreadArray([void 0], arr.concat(this))))();
    };
    return MiddlewareArray;
}(Array));
// src/immutableStateInvariantMiddleware.ts
var isProduction = process.env.NODE_ENV === "production";
var prefix = "Invariant failed";
function invariant(condition, message) {
    if (condition) {
        return;
    }
    if (isProduction) {
        throw new Error(prefix);
    }
    throw new Error(prefix + ": " + (message || ""));
}
function stringify(obj, serializer, indent, decycler) {
    return JSON.stringify(obj, getSerialize(serializer, decycler), indent);
}
function getSerialize(serializer, decycler) {
    var stack = [], keys = [];
    if (!decycler)
        decycler = function (_, value) {
            if (stack[0] === value)
                return "[Circular ~]";
            return "[Circular ~." + keys.slice(0, stack.indexOf(value)).join(".") + "]";
        };
    return function (key, value) {
        if (stack.length > 0) {
            var thisPos = stack.indexOf(this);
            ~thisPos ? stack.splice(thisPos + 1) : stack.push(this);
            ~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key);
            if (~stack.indexOf(value))
                value = decycler.call(this, key, value);
        }
        else
            stack.push(value);
        return serializer == null ? value : serializer.call(this, key, value);
    };
}
function isImmutableDefault(value) {
    return typeof value !== "object" || value == null || Object.isFrozen(value);
}
function trackForMutations(isImmutable, ignorePaths, obj) {
    var trackedProperties = trackProperties(isImmutable, ignorePaths, obj);
    return {
        detectMutations: function () {
            return detectMutations(isImmutable, ignorePaths, trackedProperties, obj);
        }
    };
}
function trackProperties(isImmutable, ignorePaths, obj, path) {
    if (ignorePaths === void 0) { ignorePaths = []; }
    if (path === void 0) { path = ""; }
    var tracked = { value: obj };
    if (!isImmutable(obj)) {
        tracked.children = {};
        for (var key in obj) {
            var childPath = path ? path + "." + key : key;
            if (ignorePaths.length && ignorePaths.indexOf(childPath) !== -1) {
                continue;
            }
            tracked.children[key] = trackProperties(isImmutable, ignorePaths, obj[key], childPath);
        }
    }
    return tracked;
}
function detectMutations(isImmutable, ignorePaths, trackedProperty, obj, sameParentRef, path) {
    if (ignorePaths === void 0) { ignorePaths = []; }
    if (sameParentRef === void 0) { sameParentRef = false; }
    if (path === void 0) { path = ""; }
    var prevObj = trackedProperty ? trackedProperty.value : void 0;
    var sameRef = prevObj === obj;
    if (sameParentRef && !sameRef && !Number.isNaN(obj)) {
        return { wasMutated: true, path: path };
    }
    if (isImmutable(prevObj) || isImmutable(obj)) {
        return { wasMutated: false };
    }
    var keysToDetect = {};
    for (var key in trackedProperty.children) {
        keysToDetect[key] = true;
    }
    for (var key in obj) {
        keysToDetect[key] = true;
    }
    for (var key in keysToDetect) {
        var childPath = path ? path + "." + key : key;
        if (ignorePaths.length && ignorePaths.indexOf(childPath) !== -1) {
            continue;
        }
        var result = detectMutations(isImmutable, ignorePaths, trackedProperty.children[key], obj[key], sameRef, childPath);
        if (result.wasMutated) {
            return result;
        }
    }
    return { wasMutated: false };
}
function createImmutableStateInvariantMiddleware(options) {
    if (options === void 0) { options = {}; }
    if (process.env.NODE_ENV === "production") {
        return function () { return function (next) { return function (action) { return next(action); }; }; };
    }
    var _c = options.isImmutable, isImmutable = _c === void 0 ? isImmutableDefault : _c, ignoredPaths = options.ignoredPaths, _d = options.warnAfter, warnAfter = _d === void 0 ? 32 : _d, ignore = options.ignore;
    ignoredPaths = ignoredPaths || ignore;
    var track = trackForMutations.bind(null, isImmutable, ignoredPaths);
    return function (_c) {
        var getState = _c.getState;
        var state = getState();
        var tracker = track(state);
        var result;
        return function (next) { return function (action) {
            var measureUtils = getTimeMeasureUtils(warnAfter, "ImmutableStateInvariantMiddleware");
            measureUtils.measureTime(function () {
                state = getState();
                result = tracker.detectMutations();
                tracker = track(state);
                invariant(!result.wasMutated, "A state mutation was detected between dispatches, in the path '" + (result.path || "") + "'.  This may cause incorrect behavior. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)");
            });
            var dispatchedAction = next(action);
            measureUtils.measureTime(function () {
                state = getState();
                result = tracker.detectMutations();
                tracker = track(state);
                result.wasMutated && invariant(!result.wasMutated, "A state mutation was detected inside a dispatch, in the path: " + (result.path || "") + ". Take a look at the reducer(s) handling the action " + stringify(action) + ". (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)");
            });
            measureUtils.warnIfExceeded();
            return dispatchedAction;
        }; };
    };
}
// src/serializableStateInvariantMiddleware.ts
function isPlain(val) {
    var type = typeof val;
    return val == null || type === "string" || type === "boolean" || type === "number" || Array.isArray(val) || isPlainObject(val);
}
function findNonSerializableValue(value, path, isSerializable, getEntries, ignoredPaths) {
    if (path === void 0) { path = ""; }
    if (isSerializable === void 0) { isSerializable = isPlain; }
    if (ignoredPaths === void 0) { ignoredPaths = []; }
    var foundNestedSerializable;
    if (!isSerializable(value)) {
        return {
            keyPath: path || "<root>",
            value: value
        };
    }
    if (typeof value !== "object" || value === null) {
        return false;
    }
    var entries = getEntries != null ? getEntries(value) : Object.entries(value);
    var hasIgnoredPaths = ignoredPaths.length > 0;
    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {
        var _c = entries_1[_i], key = _c[0], nestedValue = _c[1];
        var nestedPath = path ? path + "." + key : key;
        if (hasIgnoredPaths && ignoredPaths.indexOf(nestedPath) >= 0) {
            continue;
        }
        if (!isSerializable(nestedValue)) {
            return {
                keyPath: nestedPath,
                value: nestedValue
            };
        }
        if (typeof nestedValue === "object") {
            foundNestedSerializable = findNonSerializableValue(nestedValue, nestedPath, isSerializable, getEntries, ignoredPaths);
            if (foundNestedSerializable) {
                return foundNestedSerializable;
            }
        }
    }
    return false;
}
function createSerializableStateInvariantMiddleware(options) {
    if (options === void 0) { options = {}; }
    if (process.env.NODE_ENV === "production") {
        return function () { return function (next) { return function (action) { return next(action); }; }; };
    }
    var _c = options.isSerializable, isSerializable = _c === void 0 ? isPlain : _c, getEntries = options.getEntries, _d = options.ignoredActions, ignoredActions = _d === void 0 ? [] : _d, _e = options.ignoredActionPaths, ignoredActionPaths = _e === void 0 ? ["meta.arg", "meta.baseQueryMeta"] : _e, _f = options.ignoredPaths, ignoredPaths = _f === void 0 ? [] : _f, _g = options.warnAfter, warnAfter = _g === void 0 ? 32 : _g, _h = options.ignoreState, ignoreState = _h === void 0 ? false : _h, _j = options.ignoreActions, ignoreActions = _j === void 0 ? false : _j;
    return function (storeAPI) { return function (next) { return function (action) {
        var result = next(action);
        var measureUtils = getTimeMeasureUtils(warnAfter, "SerializableStateInvariantMiddleware");
        if (!ignoreActions && !(ignoredActions.length && ignoredActions.indexOf(action.type) !== -1)) {
            measureUtils.measureTime(function () {
                var foundActionNonSerializableValue = findNonSerializableValue(action, "", isSerializable, getEntries, ignoredActionPaths);
                if (foundActionNonSerializableValue) {
                    var keyPath = foundActionNonSerializableValue.keyPath, value = foundActionNonSerializableValue.value;
                    console.error("A non-serializable value was detected in an action, in the path: `" + keyPath + "`. Value:", value, "\nTake a look at the logic that dispatched this action: ", action, "\n(See https://redux.js.org/faq/actions#why-should-type-be-a-string-or-at-least-serializable-why-should-my-action-types-be-constants)", "\n(To allow non-serializable values see: https://redux-toolkit.js.org/usage/usage-guide#working-with-non-serializable-data)");
                }
            });
        }
        if (!ignoreState) {
            measureUtils.measureTime(function () {
                var state = storeAPI.getState();
                var foundStateNonSerializableValue = findNonSerializableValue(state, "", isSerializable, getEntries, ignoredPaths);
                if (foundStateNonSerializableValue) {
                    var keyPath = foundStateNonSerializableValue.keyPath, value = foundStateNonSerializableValue.value;
                    console.error("A non-serializable value was detected in the state, in the path: `" + keyPath + "`. Value:", value, "\nTake a look at the reducer(s) handling this action type: " + action.type + ".\n(See https://redux.js.org/faq/organizing-state#can-i-put-functions-promises-or-other-non-serializable-items-in-my-store-state)");
                }
            });
            measureUtils.warnIfExceeded();
        }
        return result;
    }; }; };
}
// src/getDefaultMiddleware.ts
function isBoolean(x) {
    return typeof x === "boolean";
}
function curryGetDefaultMiddleware() {
    return function curriedGetDefaultMiddleware(options) {
        return getDefaultMiddleware(options);
    };
}
function getDefaultMiddleware(options) {
    if (options === void 0) { options = {}; }
    var _c = options.thunk, thunk$1 = _c === void 0 ? true : _c, _d = options.immutableCheck, immutableCheck = _d === void 0 ? true : _d, _e = options.serializableCheck, serializableCheck = _e === void 0 ? true : _e;
    var middlewareArray = new MiddlewareArray();
    if (thunk$1) {
        if (isBoolean(thunk$1)) {
            middlewareArray.push(thunk);
        }
        else {
            middlewareArray.push(thunk.withExtraArgument(thunk$1.extraArgument));
        }
    }
    if (process.env.NODE_ENV !== "production") {
        if (immutableCheck) {
            var immutableOptions = {};
            if (!isBoolean(immutableCheck)) {
                immutableOptions = immutableCheck;
            }
            middlewareArray.unshift(createImmutableStateInvariantMiddleware(immutableOptions));
        }
        if (serializableCheck) {
            var serializableOptions = {};
            if (!isBoolean(serializableCheck)) {
                serializableOptions = serializableCheck;
            }
            middlewareArray.push(createSerializableStateInvariantMiddleware(serializableOptions));
        }
    }
    return middlewareArray;
}
// src/configureStore.ts
var IS_PRODUCTION = process.env.NODE_ENV === "production";
function configureStore(options) {
    var curriedGetDefaultMiddleware = curryGetDefaultMiddleware();
    var _c = options || {}, _d = _c.reducer, reducer = _d === void 0 ? void 0 : _d, _e = _c.middleware, middleware = _e === void 0 ? curriedGetDefaultMiddleware() : _e, _f = _c.devTools, devTools = _f === void 0 ? true : _f, _g = _c.preloadedState, preloadedState = _g === void 0 ? void 0 : _g, _h = _c.enhancers, enhancers = _h === void 0 ? void 0 : _h;
    var rootReducer;
    if (typeof reducer === "function") {
        rootReducer = reducer;
    }
    else if (isPlainObject(reducer)) {
        rootReducer = redux.combineReducers(reducer);
    }
    else {
        throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');
    }
    var finalMiddleware = middleware;
    if (typeof finalMiddleware === "function") {
        finalMiddleware = finalMiddleware(curriedGetDefaultMiddleware);
        if (!IS_PRODUCTION && !Array.isArray(finalMiddleware)) {
            throw new Error("when using a middleware builder function, an array of middleware must be returned");
        }
    }
    if (!IS_PRODUCTION && finalMiddleware.some(function (item) { return typeof item !== "function"; })) {
        throw new Error("each middleware provided to configureStore must be a function");
    }
    var middlewareEnhancer = redux.applyMiddleware.apply(void 0, finalMiddleware);
    var finalCompose = redux.compose;
    if (devTools) {
        finalCompose = composeWithDevTools(__spreadValues({
            trace: !IS_PRODUCTION
        }, typeof devTools === "object" && devTools));
    }
    var storeEnhancers = [middlewareEnhancer];
    if (Array.isArray(enhancers)) {
        storeEnhancers = __spreadArray([middlewareEnhancer], enhancers);
    }
    else if (typeof enhancers === "function") {
        storeEnhancers = enhancers(storeEnhancers);
    }
    var composedEnhancer = finalCompose.apply(void 0, storeEnhancers);
    return redux.createStore(rootReducer, preloadedState, composedEnhancer);
}

function _regeneratorRuntime() {
  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */

  _regeneratorRuntime = function () {
    return exports;
  };

  var exports = {},
      Op = Object.prototype,
      hasOwn = Op.hasOwnProperty,
      $Symbol = "function" == typeof Symbol ? Symbol : {},
      iteratorSymbol = $Symbol.iterator || "@@iterator",
      asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator",
      toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  function define(obj, key, value) {
    return Object.defineProperty(obj, key, {
      value: value,
      enumerable: !0,
      configurable: !0,
      writable: !0
    }), obj[key];
  }

  try {
    define({}, "");
  } catch (err) {
    define = function (obj, key, value) {
      return obj[key] = value;
    };
  }

  function wrap(innerFn, outerFn, self, tryLocsList) {
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,
        generator = Object.create(protoGenerator.prototype),
        context = new Context(tryLocsList || []);
    return generator._invoke = function (innerFn, self, context) {
      var state = "suspendedStart";
      return function (method, arg) {
        if ("executing" === state) throw new Error("Generator is already running");

        if ("completed" === state) {
          if ("throw" === method) throw arg;
          return doneResult();
        }

        for (context.method = method, context.arg = arg;;) {
          var delegate = context.delegate;

          if (delegate) {
            var delegateResult = maybeInvokeDelegate(delegate, context);

            if (delegateResult) {
              if (delegateResult === ContinueSentinel) continue;
              return delegateResult;
            }
          }

          if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) {
            if ("suspendedStart" === state) throw state = "completed", context.arg;
            context.dispatchException(context.arg);
          } else "return" === context.method && context.abrupt("return", context.arg);
          state = "executing";
          var record = tryCatch(innerFn, self, context);

          if ("normal" === record.type) {
            if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue;
            return {
              value: record.arg,
              done: context.done
            };
          }

          "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg);
        }
      };
    }(innerFn, self, context), generator;
  }

  function tryCatch(fn, obj, arg) {
    try {
      return {
        type: "normal",
        arg: fn.call(obj, arg)
      };
    } catch (err) {
      return {
        type: "throw",
        arg: err
      };
    }
  }

  exports.wrap = wrap;
  var ContinueSentinel = {};

  function Generator() {}

  function GeneratorFunction() {}

  function GeneratorFunctionPrototype() {}

  var IteratorPrototype = {};
  define(IteratorPrototype, iteratorSymbol, function () {
    return this;
  });
  var getProto = Object.getPrototypeOf,
      NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);
  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);

  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function (method) {
      define(prototype, method, function (arg) {
        return this._invoke(method, arg);
      });
    });
  }

  function AsyncIterator(generator, PromiseImpl) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);

      if ("throw" !== record.type) {
        var result = record.arg,
            value = result.value;
        return value && "object" == typeof value && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) {
          invoke("next", value, resolve, reject);
        }, function (err) {
          invoke("throw", err, resolve, reject);
        }) : PromiseImpl.resolve(value).then(function (unwrapped) {
          result.value = unwrapped, resolve(result);
        }, function (error) {
          return invoke("throw", error, resolve, reject);
        });
      }

      reject(record.arg);
    }

    var previousPromise;

    this._invoke = function (method, arg) {
      function callInvokeWithMethodAndArg() {
        return new PromiseImpl(function (resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
    };
  }

  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];

    if (undefined === method) {
      if (context.delegate = null, "throw" === context.method) {
        if (delegate.iterator.return && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method)) return ContinueSentinel;
        context.method = "throw", context.arg = new TypeError("The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);
    if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel;
    var info = record.arg;
    return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel);
  }

  function pushTryEntry(locs) {
    var entry = {
      tryLoc: locs[0]
    };
    1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal", delete record.arg, entry.completion = record;
  }

  function Context(tryLocsList) {
    this.tryEntries = [{
      tryLoc: "root"
    }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);
  }

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) return iteratorMethod.call(iterable);
      if ("function" == typeof iterable.next) return iterable;

      if (!isNaN(iterable.length)) {
        var i = -1,
            next = function next() {
          for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;

          return next.value = undefined, next.done = !0, next;
        };

        return next.next = next;
      }
    }

    return {
      next: doneResult
    };
  }

  function doneResult() {
    return {
      value: undefined,
      done: !0
    };
  }

  return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, "constructor", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) {
    var ctor = "function" == typeof genFun && genFun.constructor;
    return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name));
  }, exports.mark = function (genFun) {
    return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun;
  }, exports.awrap = function (arg) {
    return {
      __await: arg
    };
  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {
    return this;
  }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {
    void 0 === PromiseImpl && (PromiseImpl = Promise);
    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);
    return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {
      return result.done ? result.value : iter.next();
    });
  }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () {
    return this;
  }), define(Gp, "toString", function () {
    return "[object Generator]";
  }), exports.keys = function (object) {
    var keys = [];

    for (var key in object) keys.push(key);

    return keys.reverse(), function next() {
      for (; keys.length;) {
        var key = keys.pop();
        if (key in object) return next.value = key, next.done = !1, next;
      }

      return next.done = !0, next;
    };
  }, exports.values = values, Context.prototype = {
    constructor: Context,
    reset: function (skipTempReset) {
      if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);
    },
    stop: function () {
      this.done = !0;
      var rootRecord = this.tryEntries[0].completion;
      if ("throw" === rootRecord.type) throw rootRecord.arg;
      return this.rval;
    },
    dispatchException: function (exception) {
      if (this.done) throw exception;
      var context = this;

      function handle(loc, caught) {
        return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i],
            record = entry.completion;
        if ("root" === entry.tryLoc) return handle("end");

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc"),
              hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);
            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);
          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);
          } else {
            if (!hasFinally) throw new Error("try statement without catch or finally");
            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);
          }
        }
      }
    },
    abrupt: function (type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];

        if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);
      var record = finallyEntry ? finallyEntry.completion : {};
      return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);
    },
    complete: function (record, afterLoc) {
      if ("throw" === record.type) throw record.arg;
      return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;
    },
    finish: function (finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;
      }
    },
    catch: function (tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];

        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;

          if ("throw" === record.type) {
            var thrown = record.arg;
            resetTryEntry(entry);
          }

          return thrown;
        }
      }

      throw new Error("illegal catch attempt");
    },
    delegateYield: function (iterable, resultName, nextLoc) {
      return this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      }, "next" === this.method && (this.arg = undefined), ContinueSentinel;
    }
  }, exports;
}

function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}

function _extends() {
  _extends = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends.apply(this, arguments);
}

function _inherits(subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function");
  }

  subClass.prototype = Object.create(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      writable: true,
      configurable: true
    }
  });
  Object.defineProperty(subClass, "prototype", {
    writable: false
  });
  if (superClass) _setPrototypeOf(subClass, superClass);
}

function _getPrototypeOf(o) {
  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {
    return o.__proto__ || Object.getPrototypeOf(o);
  };
  return _getPrototypeOf(o);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };
  return _setPrototypeOf(o, p);
}

function _isNativeReflectConstruct() {
  if (typeof Reflect === "undefined" || !Reflect.construct) return false;
  if (Reflect.construct.sham) return false;
  if (typeof Proxy === "function") return true;

  try {
    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
    return true;
  } catch (e) {
    return false;
  }
}

function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return self;
}

function _possibleConstructorReturn(self, call) {
  if (call && (typeof call === "object" || typeof call === "function")) {
    return call;
  } else if (call !== void 0) {
    throw new TypeError("Derived constructors may only return object or undefined");
  }

  return _assertThisInitialized(self);
}

function _createSuper(Derived) {
  var hasNativeReflectConstruct = _isNativeReflectConstruct();

  return function _createSuperInternal() {
    var Super = _getPrototypeOf(Derived),
        result;

    if (hasNativeReflectConstruct) {
      var NewTarget = _getPrototypeOf(this).constructor;

      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return _possibleConstructorReturn(this, result);
  };
}

function _superPropBase(object, property) {
  while (!Object.prototype.hasOwnProperty.call(object, property)) {
    object = _getPrototypeOf(object);
    if (object === null) break;
  }

  return object;
}

function _get() {
  if (typeof Reflect !== "undefined" && Reflect.get) {
    _get = Reflect.get.bind();
  } else {
    _get = function _get(target, property, receiver) {
      var base = _superPropBase(target, property);

      if (!base) return;
      var desc = Object.getOwnPropertyDescriptor(base, property);

      if (desc.get) {
        return desc.get.call(arguments.length < 3 ? target : receiver);
      }

      return desc.value;
    };
  }

  return _get.apply(this, arguments);
}

function _taggedTemplateLiteralLoose(strings, raw) {
  if (!raw) {
    raw = strings.slice(0);
  }

  strings.raw = raw;
  return strings;
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

  return arr2;
}

function _createForOfIteratorHelperLoose(o, allowArrayLike) {
  var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
  if (it) return (it = it.call(o)).next.bind(it);

  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
    if (it) o = it;
    var i = 0;
    return function () {
      if (i >= o.length) return {
        done: true
      };
      return {
        done: false,
        value: o[i++]
      };
    };
  }

  throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

var CREATE_CHANNEL = 'CREATE_CHANNEL';
var GET_CHANNELS = 'GET_CHANNELS';
var SEARCH_CHANNELS = 'SEARCH_CHANNELS';
var SET_SEARCHED_CHANNELS = 'SET_SEARCHED_CHANNELS';
var SET_SEARCHED_CHANNELS_FOR_FORWARD = 'SET_SEARCHED_CHANNELS_FOR_FORWARD';
var SET_CLOSE_SEARCH_CHANNELS = 'SET_CLOSE_SEARCH_CHANNELS';
var GET_CHANNELS_FOR_FORWARD = 'GET_CHANNELS_FOR_FORWARD';
var SEARCH_CHANNELS_FOR_FORWARD = 'SEARCH_CHANNELS_FOR_FORWARD';
var LOAD_MORE_CHANNEL = 'LOAD_MORE_CHANNEL';
var LOAD_MORE_CHANNELS_FOR_FORWARD = 'LOAD_MORE_CHANNELS_FOR_FORWARD';
var ADD_CHANNEL = 'ADD_CHANNEL';
var ADD_CHANNELS = 'ADD_CHANNELS';
var ADD_CHANNELS_FOR_FORWARD = 'ADD_CHANNELS_FOR_FORWARD';
var SET_CHANNELS = 'SET_CHANNELS';
var SET_CHANNELS_FOR_FORWARD = 'SET_CHANNELS_FOR_FORWARD';
var DELETE_CHANNEL = 'DELETE_CHANNEL';
var BLOCK_CHANNEL = 'BLOCK_CHANNEL';
var SET_CHANNELS_LOADING_STATE = 'SET_CHANNELS_LOADING_STATE';
var CHANNELS_HAS_NEXT = 'CHANNELS_HAS_NEXT';
var SWITCH_CHANNEL = 'SWITCH_CHANNEL';
var SET_ACTIVE_CHANNEL = 'SET_ACTIVE_CHANNEL';
var UPDATE_CHANNEL = 'UPDATE_CHANNEL';
var UPDATE_CHANNEL_DATA = 'UPDATE_CHANNEL_DATA';
var UPDATE_SEARCHED_CHANNEL_DATA = 'UPDATE_SEARCHED_CHANNEL_DATA';
var REMOVE_CHANNEL = 'REMOVE_CHANNEL';
var REMOVE_CHANNEL_CACHES = 'REMOVE_CHANNEL_CACHES';
var UPDATE_CHANNEL_LAST_MESSAGE = 'UPDATE_CHANNEL_LAST_MESSAGE';
var UPDATE_CHANNEL_LAST_MESSAGE_STATUS = 'UPDATE_CHANNEL_LAST_MESSAGE_STATUS';
var MARK_MESSAGES_AS_READ = 'MARK_MESSAGES_AS_READ';
var MARK_MESSAGES_AS_DELIVERED = 'MARK_MESSAGES_AS_DELIVERED';
var SEND_TYPING = 'SEND_TYPING';
var SWITCH_TYPING_INDICATOR = 'SWITCH_TYPING_INDICATOR';
var JOIN_TO_CHANNEL = 'JOIN_TO_CHANNEL';
var SET_IS_DRAGGING = 'SET_IS_DRAGGING';
var SET_DRAGGED_ATTACHMENTS = 'SET_DRAGGED_ATTACHMENTS';
var WATCH_FOR_EVENTS = 'WATCH_FOR_EVENTS';
var SET_CHANNEL_TO_REMOVE = 'SET_CHANNEL_TO_REMOVE';
var SET_CHANNEL_TO_ADD = 'SET_CHANNEL_TO_ADD';
var SET_ADDED_TO_CHANNEL = 'SET_ADDED_TO_CHANNEL';
var SET_CHANNEL_TO_HIDE = 'SET_CHANNEL_TO_HIDE';
var SET_CHANNEL_TO_UNHIDE = 'SET_CHANNEL_TO_UNHIDE';
var TURN_OFF_NOTIFICATION = 'TURN_OFF_NOTIFICATION';
var TURN_ON_NOTIFICATION = 'TURN_ON_NOTIFICATION';
var MARK_CHANNEL_AS_READ = 'MARK_CHANNEL_AS_READ';
var MARK_CHANNEL_AS_UNREAD = 'MARK_CHANNEL_AS_UNREAD';
var CHANNEL_INFO_OPEN_CLOSE = 'CHANNEL_INFO_OPEN_CLOSE';
var LEAVE_CHANNEL = 'LEAVE_CHANNEL';
var TOGGLE_EDIT_CHANNEL = 'TOGGLE_EDIT_CHANNEL';
var UPDATE_USER_STATUS_ON_CHANNEL = 'UPDATE_USER_STATUS_ON_CHANNEL';
var SET_CHANNEL_LIST_WIDTH = 'SET_CHANNEL_LIST_WIDTH';
var CLEAR_HISTORY = 'CLEAR_HISTORY';
var DELETE_ALL_MESSAGES = 'DELETE_ALL_MESSAGES';
var DESTROY_SESSION = 'DESTROY_SESSION';
var SET_TAB_IS_ACTIVE = 'SET_TAB_IS_ACTIVE';
var SET_HIDE_CHANNEL_LIST = 'SET_HIDE_CHANNEL_LIST';
var DRAFT_IS_REMOVED = 'DRAFT_IS_REMOVED';
var CHANNEL_EVENT_TYPES = {
  CREATE: 'CREATE',
  JOIN: 'JOIN',
  LEAVE: 'LEAVE',
  BLOCK: 'BLOCK',
  UNBLOCK: 'UNBLOCK',
  ADD_MEMBERS: 'ADD_MEMBERS',
  KICK_MEMBERS: 'KICK_MEMBERS',
  BLOCK_MEMBERS: 'BLOCK_MEMBERS',
  UPDATE_CHANNEL: 'UPDATE_CHANNEL',
  MESSAGE: 'MESSAGE',
  DELETE: 'DELETE',
  DELETE_MESSAGE: 'DELETE_MESSAGE',
  REACTION_ADDED: 'REACTION_ADDED',
  REACTION_DELETED: 'REACTION_DELETED',
  EDIT_MESSAGE: 'EDIT_MESSAGE',
  START_TYPING: 'START_TYPING',
  STOP_TYPING: 'STOP_TYPING',
  MESSAGE_MARKERS_RECEIVED: 'MESSAGE_MARKERS_RECEIVED',
  UNREAD_MESSAGES_INFO: 'UNREAD_MESSAGES_INFO',
  HIDE: 'HIDE',
  UNHIDE: 'UNHIDE',
  MUTE: 'MUTE',
  UNMUTE: 'UNMUTE',
  CHANNEL_MARKED_AS_UNREAD: 'CHANNEL_MARKED_AS_UNREAD',
  CHANNEL_MARKED_AS_READ: 'CHANNEL_MARKED_AS_READ',
  CLEAR_HISTORY: 'CLEAR_HISTORY',
  CHANGE_ROLE: 'CHANGE_ROLE',
  CHANGE_OWNER: 'CHANGE_OWNER',
  MEMBER_BLOCKED: 'MEMBER_BLOCKED',
  MEMBER_UNBLOCKED: 'MEMBER_UNBLOCKED'
};

var MESSAGE_DELIVERY_STATUS = {
  PENDING: 'pending',
  SENT: 'sent',
  DELIVERED: 'received',
  READ: 'displayed'
};
var MESSAGE_STATUS = {
  UNMODIFIED: 'unmodified',
  EDIT: 'edited',
  DELETE: 'deleted',
  FAILED: 'failed'
};
var UPLOAD_STATE = {
  UPLOADING: 'uploading',
  PAUSED: 'paused',
  SUCCESS: 'success',
  FAIL: 'fail'
};
var LOADING_STATE = {
  LOADING: 1,
  LOADED: 2
};
var CHANNEL_TYPE = {
  GROUP: 'group',
  BROADCAST: 'broadcast',
  DIRECT: 'direct',
  PUBLIC: 'public',
  PRIVATE: 'private'
};
var USER_PRESENCE_STATUS = {
  OFFLINE: 'offline',
  ONLINE: 'online'
};
var USER_STATE = {
  ACTIVE: 'active',
  INACTIVE: 'inactive',
  DELETED: 'deleted'
};
var attachmentTypes = {
  image: 'image',
  video: 'video',
  audio: 'audio',
  file: 'file',
  link: 'link',
  voice: 'voice'
};
var channelDetailsTabs = {
  member: 'Members',
  media: 'Media',
  file: 'Files',
  link: 'Links',
  voice: 'Voice'
};
var DB_NAMES = {
  FILES_STORAGE: 'files-storage'
};
var DB_STORE_NAMES = {
  CHANNELS: 'channels',
  MESSAGES: 'messages',
  ATTACHMENTS: 'attachments'
};
var THEME = {
  DARK: 'dark',
  LIGHT: 'light'
};
var CHANNEL_GROUP_TYPES = {
  DIRECT_PRIVATE: 'chats_groups',
  PUBLIC: 'channels'
};

var SceytChatClient = {};
var setClient = function setClient(client) {
  SceytChatClient = client;
};
var getClient = function getClient() {
  return SceytChatClient;
};

var hideUserPresence;
var setHideUserPresence = function setHideUserPresence(callback) {
  hideUserPresence = callback;
};
var usersMap = {};
var updateUserOnMap = function updateUserOnMap(user) {
  usersMap[user.id] = user;
};
var setUserToMap = function setUserToMap(user) {
  usersMap[user.id] = user;
};
var deleteUserFromMap = function deleteUserFromMap(userId) {
  delete usersMap[userId];
};

var initialState = {
  channelsLoadingState: null,
  channelsForForwardLoadingState: null,
  usersLoadingState: null,
  channelsHasNext: true,
  channelsForForwardHasNext: true,
  channels: [],
  searchedChannels: {
    chats_groups: [],
    channels: [],
    contacts: []
  },
  searchedChannelsForForward: {
    chats_groups: [],
    channels: [],
    contacts: []
  },
  closeSearchChannel: false,
  channelsForForward: [],
  activeChannel: {},
  roles: [],
  users: [],
  errorNotification: '',
  notifications: [],
  typingIndicator: {},
  searchValue: '',
  addedChannel: null,
  addedToChannel: null,
  deletedChannel: null,
  hiddenChannel: null,
  visibleChannel: null,
  channelInfoIsOpen: false,
  channelEditMode: false,
  channelListWidth: 0,
  isDragging: false,
  tabIsActive: true,
  hideChannelList: false,
  draggedAttachments: [],
  draftIsRemoved: ''
};
var ChannelReducer = (function (state, _temp) {
  if (state === void 0) {
    state = initialState;
  }

  var _ref = _temp === void 0 ? {
    type: ''
  } : _temp,
      type = _ref.type,
      payload = _ref.payload;

  var newState = _extends({}, state);

  switch (type) {
    case GET_CHANNELS:
      {
        var search = payload.params.search;

        if (search === '' || search) {
          newState.searchValue = search;
        }

        return newState;
      }

    case SET_CHANNELS:
      {
        newState.channels = [].concat(payload.channels);
        return newState;
      }

    case SET_SEARCHED_CHANNELS:
      {
        newState.searchedChannels = payload.searchedChannels;
        return newState;
      }

    case SET_SEARCHED_CHANNELS_FOR_FORWARD:
      {
        newState.searchedChannelsForForward = payload.searchedChannels;
        return newState;
      }

    case SET_CLOSE_SEARCH_CHANNELS:
      {
        newState.closeSearchChannel = payload.close;
        return newState;
      }

    case SET_CHANNELS_FOR_FORWARD:
      {
        newState.channelsForForward = [].concat(payload.channels);
        return newState;
      }

    case ADD_CHANNEL:
      {
        if (!newState.channels.find(function (chan) {
          return chan.id === payload.channel.id;
        })) {
          newState.channels = [payload.channel].concat(newState.channels);
        }

        if (newState.hideChannelList && (!newState.activeChannel || !newState.activeChannel.id)) {
          newState.activeChannel = payload.channel;
        }

        return newState;
      }

    case ADD_CHANNELS:
      {
        newState.channels = [].concat(newState.channels, payload.channels);
        return newState;
      }

    case ADD_CHANNELS_FOR_FORWARD:
      {
        newState.channelsForForward = [].concat(newState.channelsForForward, payload.channels);
        return newState;
      }

    case REMOVE_CHANNEL:
      {
        var channelId = payload.channelId;
        var channelsCpy = newState.channels;
        newState.channels = channelsCpy.filter(function (chan) {
          return chan.id !== channelId;
        });
        return newState;
      }

    case SET_CHANNEL_TO_ADD:
      {
        var channel = payload.channel;
        newState.addedChannel = channel;
        return newState;
      }

    case SET_ADDED_TO_CHANNEL:
      {
        var _channel = payload.channel;
        newState.addedToChannel = _channel;
        return newState;
      }

    case SET_CHANNEL_TO_REMOVE:
      {
        var _channel2 = payload.channel;
        newState.deletedChannel = _channel2;
        return newState;
      }

    case SET_CHANNEL_TO_HIDE:
      {
        var _channel3 = payload.channel;
        newState.hiddenChannel = _channel3;
        return newState;
      }

    case SET_CHANNEL_TO_UNHIDE:
      {
        var _channel4 = payload.channel;
        newState.visibleChannel = _channel4;
        return newState;
      }

    case SET_CHANNELS_LOADING_STATE:
      {
        var _state = payload.state,
            forForward = payload.forForward;

        if (forForward) {
          newState.channelsForForwardLoadingState = _state;
        } else {
          newState.channelsLoadingState = _state;
        }

        return newState;
      }

    case CHANNELS_HAS_NEXT:
      {
        var hasNext = payload.hasNext,
            _forForward = payload.forForward;

        if (_forForward) {
          newState.channelsForForwardHasNext = hasNext;
        } else {
          newState.channelsHasNext = hasNext;
        }

        return newState;
      }

    case SET_ACTIVE_CHANNEL:
      {
        newState.activeChannel = payload.channel || {};

        if (payload.channel.type === CHANNEL_TYPE.DIRECT) {
          var ChatClient = getClient();
          var user = ChatClient.user;
          var directChannelUser = payload.channel.members.find(function (member) {
            return member.id !== user.id;
          });

          if (directChannelUser) {
            setUserToMap(directChannelUser);
          }
        }

        return newState;
      }

    case UPDATE_CHANNEL_DATA:
      {
        var config = payload.config,
            _channelId = payload.channelId,
            moveUp = payload.moveUp;

        if (moveUp) {
          var updateChannel;
          var updatedChannels = newState.channels.filter(function (chan) {
            if (chan.id === _channelId) {
              updateChannel = chan;
            }

            return chan.id !== _channelId;
          });

          if (updateChannel) {
            updateChannel = _extends({}, updateChannel, config);
            newState.channels = [updateChannel].concat(updatedChannels);
          }
        } else {
          newState.channels = newState.channels.map(function (channel) {
            if (channel.id === _channelId) {
              return _extends({}, channel, config);
            }

            return channel;
          });
        }

        if (newState.activeChannel.id === _channelId) {
          var activeChannelCopy = _extends({}, newState.activeChannel);

          newState.activeChannel = _extends({}, activeChannelCopy, config);
        }

        return newState;
      }

    case UPDATE_SEARCHED_CHANNEL_DATA:
      {
        var updateData = payload.updateData,
            groupName = payload.groupName,
            _channelId2 = payload.channelId;

        if (newState.searchedChannels[groupName] && newState.searchedChannels[groupName].length) {
          var _extends2;

          newState.searchedChannels = _extends({}, newState.searchedChannels, (_extends2 = {}, _extends2[groupName] = [].concat(newState.searchedChannels[groupName]).map(function (channel) {
            if (channel.id === _channelId2) {
              return _extends({}, channel, updateData);
            }

            return channel;
          }), _extends2));
        }

        return newState;
      }

    case UPDATE_USER_STATUS_ON_CHANNEL:
      {
        var usersMap = payload.usersMap;

        var _ChatClient = getClient();

        var _user = _ChatClient.user;

        var _updatedChannels = newState.channels.map(function (channel) {
          var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
          var directChannelUser = isDirectChannel && channel.members.find(function (member) {
            return member.id !== _user.id;
          });

          if (isDirectChannel && directChannelUser && usersMap[directChannelUser.id]) {
            var membersToUpdate = channel.members.map(function (member) {
              if (member.id === usersMap[directChannelUser.id].id) {
                return _extends({}, member, usersMap[directChannelUser.id]);
              } else {
                return member;
              }
            });
            return _extends({}, channel, {
              members: membersToUpdate
            });
          }

          return channel;
        });

        var activeChannelUser = newState.activeChannel.type === CHANNEL_TYPE.DIRECT && newState.activeChannel.members.find(function (member) {
          return member.id !== _user.id;
        });

        if (activeChannelUser && usersMap[activeChannelUser.id]) {
          newState.activeChannel = _extends({}, newState.activeChannel, {
            members: newState.activeChannel.members.map(function (member) {
              if (member.id !== _user.id) {
                return _extends({}, member, usersMap[activeChannelUser.id]);
              } else {
                return member;
              }
            })
          });
        }

        newState.channels = [].concat(_updatedChannels);
        return newState;
      }

    case UPDATE_CHANNEL_LAST_MESSAGE:
      {
        var _channel5 = payload.channel,
            message = payload.message;

        var _updateChannel = newState.channels.find(function (chan) {
          return chan.id === _channel5.id;
        });

        if (message.state === MESSAGE_STATUS.DELETE || message.state === MESSAGE_STATUS.EDIT) {
          var _updateChannel2;

          if (((_updateChannel2 = _updateChannel) === null || _updateChannel2 === void 0 ? void 0 : _updateChannel2.lastMessage.id) === message.id) {
            newState.channels = newState.channels.map(function (chan) {
              if (chan.id === _channel5.id) {
                return _extends({}, chan, {
                  lastMessage: message
                });
              }

              return chan;
            });
          }
        } else {
          var _updatedChannels2 = newState.channels.filter(function (chan) {
            return chan.id !== _channel5.id;
          });

          if (_updateChannel) {
            _updateChannel = _extends({}, _updateChannel, {
              lastMessage: message
            });
            newState.channels = [_updateChannel].concat(_updatedChannels2);
          }
        }

        return newState;
      }

    case UPDATE_CHANNEL_LAST_MESSAGE_STATUS:
      {
        var _channel6 = payload.channel,
            _message = payload.message;
        newState.channels = newState.channels.map(function (chan) {
          if (chan.id === _channel6.id) {
            return _extends({}, _channel6, {
              lastMessage: _extends({}, _channel6.lastMessage, {
                deliveryStatus: _message.deliveryStatus,
                userMarkers: _message.userMarkers,
                state: _message.state
              })
            });
          }

          return chan;
        });
        return newState;
      }

    case CHANNEL_INFO_OPEN_CLOSE:
      {
        newState.channelInfoIsOpen = payload.open;
        return newState;
      }

    case TOGGLE_EDIT_CHANNEL:
      {
        newState.channelEditMode = payload.state;
        return newState;
      }

    case SWITCH_TYPING_INDICATOR:
      {
        var typingState = payload.typingState,
            _channelId3 = payload.channelId,
            from = payload.from;

        if (typingState) {
          var _extends3;

          newState.typingIndicator = _extends({}, newState.typingIndicator, (_extends3 = {}, _extends3[_channelId3] = {
            from: from,
            typingState: typingState
          }, _extends3));
        } else {
          if (newState.typingIndicator[_channelId3]) {
            var copyData = _extends({}, newState.typingIndicator);

            delete copyData[_channelId3];
            newState.typingIndicator = copyData;
          }
        }

        return newState;
      }

    case SET_IS_DRAGGING:
      {
        var isDragging = payload.isDragging;
        newState.isDragging = isDragging;
        return newState;
      }

    case SET_DRAGGED_ATTACHMENTS:
      {
        var attachments = payload.attachments,
            _type = payload.type;

        if (attachments.length && attachments.length > 0) {
          newState.draggedAttachments = attachments.map(function (attachment) {
            return {
              data: attachment.data,
              name: attachment.name,
              type: attachment.type,
              attachmentType: _type
            };
          });
        } else {
          newState.draggedAttachments = [];
        }

        return newState;
      }

    case SET_CHANNEL_LIST_WIDTH:
      {
        var width = payload.width;
        newState.channelListWidth = width;
        return newState;
      }

    case SET_TAB_IS_ACTIVE:
      {
        var isActive = payload.isActive;
        newState.tabIsActive = isActive;
        return newState;
      }

    case SET_HIDE_CHANNEL_LIST:
      {
        var hide = payload.hide;
        newState.hideChannelList = hide;
        return newState;
      }

    case DRAFT_IS_REMOVED:
      {
        var _channelId4 = payload.channelId;
        newState.draftIsRemoved = _channelId4;
        return newState;
      }

    case DESTROY_SESSION:
      {
        newState = _extends({}, initialState, {
          channelListWidth: newState.channelListWidth
        });
        return newState;
      }

    default:
      return state;
  }
});

var ADD_MESSAGES = 'ADD_MESSAGES';
var SET_MESSAGES = 'SET_MESSAGES';
var ADD_MESSAGE = 'ADD_MESSAGE';
var UPDATE_MESSAGE = 'UPDATE_MESSAGE';
var UPDATE_MESSAGES_STATUS = 'UPDATE_MESSAGES_STATUS';
var GET_MESSAGES = 'GET_MESSAGES';
var SET_SCROLL_TO_MESSAGE = 'SET_SCROLL_TO_MESSAGE';
var SET_MESSAGES_LOADING_STATE = 'SET_MESSAGES_LOADING_STATE';
var LOAD_MORE_MESSAGES = 'LOAD_MORE_MESSAGES';
var SET_MESSAGES_HAS_NEXT = 'SET_MESSAGES_HAS_NEXT';
var SET_HAS_PREV_MESSAGES = 'SET_HAS_PREV_MESSAGES';
var CLEAR_MESSAGES = 'CLEAR_MESSAGES';
var SEND_MESSAGE = 'SEND_MESSAGE';
var SEND_TEXT_MESSAGE = 'SEND_TEXT_MESSAGE';
var FORWARD_MESSAGE = 'FORWARD_MESSAGE';
var EDIT_MESSAGE = 'EDIT_MESSAGE';
var SET_MESSAGE_TO_EDIT = 'SET_MESSAGE_TO_EDIT';
var SET_MESSAGE_FOR_REPLY = 'SET_MESSAGE_FOR_REPLY';
var SET_PLAYING_AUDIO_ID = 'SET_PLAYING_AUDIO_ID';
var ADD_SELECTED_MESSAGE = 'ADD_SELECTED_MESSAGE';
var REMOVE_SELECTED_MESSAGE = 'REMOVE_SELECTED_MESSAGE';
var CLEAR_SELECTED_MESSAGES = 'CLEAR_SELECTED_MESSAGES';
var DELETE_MESSAGE = 'DELETE_MESSAGE';
var DELETE_MESSAGE_FROM_LIST = 'DELETE_MESSAGE_FROM_LIST';
var RESEND_MESSAGE = 'RESEND_MESSAGE';
var UPDATE_UPLOAD_PROGRESS = 'UPDATE_UPLOAD_PROGRESS';
var REMOVE_UPLOAD_PROGRESS = 'REMOVE_UPLOAD_PROGRESS';
var UPLOAD_ATTACHMENT_COMPILATION = 'UPLOAD_ATTACHMENT_COMPILATION';
var GET_MESSAGES_ATTACHMENTS = 'GET_MESSAGES_ATTACHMENTS';
var SET_ATTACHMENTS = 'SET_ATTACHMENTS';
var SET_ATTACHMENTS_FOR_POPUP = 'SET_ATTACHMENTS_FOR_POPUP';
var EMPTY_CHANNEL_ATTACHMENTS = 'EMPTY_CHANNEL_ATTACHMENTS';
var LOAD_MORE_MESSAGES_ATTACHMENTS = 'LOAD_MORE_MESSAGES_ATTACHMENTS';
var ADD_ATTACHMENTS = 'ADD_ATTACHMENTS';
var ADD_ATTACHMENTS_FOR_POPUP = 'ADD_ATTACHMENTS_FOR_POPUP';
var SET_ATTACHMENTS_COMPLETE = 'SET_ATTACHMENTS_COMPLETE';
var SET_ATTACHMENTS_COMPLETE_FOR_POPUP = 'SET_ATTACHMENTS_COMPLETE_FOR_POPUP';
var PAUSE_ATTACHMENT_UPLOADING = 'PAUSE_ATTACHMENT_UPLOADING';
var RESUME_ATTACHMENT_UPLOADING = 'RESUME_ATTACHMENT_UPLOADING';
var GET_REACTIONS = 'GET_REACTIONS';
var LOAD_MORE_REACTIONS = 'LOAD_MORE_REACTIONS';
var SET_REACTIONS_LIST = 'SET_REACTIONS_LIST';
var ADD_REACTIONS_TO_LIST = 'ADD_REACTIONS_TO_LIST';
var DELETE_REACTION_FROM_LIST = 'DELETE_REACTION_FROM_LIST';
var ADD_REACTION_TO_LIST = 'ADD_REACTION_TO_LIST';
var SET_REACTIONS_LOADING_STATE = 'SET_REACTIONS_LOADING_STATE';
var SET_SEND_MESSAGE_INPUT_HEIGHT = 'SET_SEND_MESSAGE_INPUT_HEIGHT';
var ADD_REACTION_TO_MESSAGE = 'ADD_REACTION_TO_MESSAGE';
var DELETE_REACTION_FROM_MESSAGE = 'DELETE_REACTION_FROM_MESSAGE';
var ADD_REACTION = 'ADD_REACTION';
var DELETE_REACTION = 'DELETE_REACTION';
var SET_SCROLL_TO_NEW_MESSAGE = 'SET_SCROLL_TO_NEW_MESSAGE';
var SET_SHOW_SCROLL_TO_NEW_MESSAGE_BUTTON = 'SET_SHOW_SCROLL_TO_NEW_MESSAGE_BUTTON';
var SET_MESSAGE_MENU_OPENED = 'SET_MESSAGE_MENU_OPENED';
var queryDirection = {
  PREV: 'prev',
  NEXT: 'next',
  NEAR: 'near'
};

// A type of promise-like that resolves synchronously and supports only one observer

const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== "undefined" ? (Symbol.iterator || (Symbol.iterator = Symbol("Symbol.iterator"))) : "@@iterator";

const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== "undefined" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol("Symbol.asyncIterator"))) : "@@asyncIterator";

// Asynchronously call a function and send errors to recovery continuation
function _catch(body, recover) {
	try {
		var result = body();
	} catch(e) {
		return recover(e);
	}
	if (result && result.then) {
		return result.then(void 0, recover);
	}
	return result;
}

var _path;

function _extends$1() {
  _extends$1 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1.apply(this, arguments);
}

function SvgTicksRead(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1({
    width: 16,
    height: 16,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path || (_path = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.983 3.748a.842.842 0 010 1.19l-6.737 6.737a.842.842 0 01-1.19 0L.245 8.867a.842.842 0 111.192-1.191L3.65 9.889l6.141-6.141a.842.842 0 011.191 0zM15.753 3.748a.842.842 0 010 1.19l-6.736 6.737a.842.842 0 01-1.191-1.19l6.736-6.737a.842.842 0 011.191 0z",
    fill: "currentColor"
  })));
}

var _path$1;

function _extends$2() {
  _extends$2 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$2.apply(this, arguments);
}

function SvgTicksDelivered(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$2({
    width: 16,
    height: 16,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1 || (_path$1 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.983 3.748a.842.842 0 010 1.19l-6.737 6.737a.842.842 0 01-1.19 0L.245 8.867a.842.842 0 111.192-1.191L3.65 9.889l6.141-6.141a.842.842 0 011.191 0zM15.753 3.748a.842.842 0 010 1.19l-6.736 6.737a.842.842 0 01-1.191-1.19l6.736-6.737a.842.842 0 011.191 0z",
    fill: "CurrentColor"
  })));
}

var _path$2;

function _extends$3() {
  _extends$3 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$3.apply(this, arguments);
}

function SvgTicksSent(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$3({
    width: 16,
    height: 16,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$2 || (_path$2 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M13.65 4.234a.772.772 0 010 1.132l-6.737 6.4a.874.874 0 01-1.19 0l-2.81-2.669a.772.772 0 010-1.13.874.874 0 011.191 0l2.214 2.102 6.14-5.835a.874.874 0 011.192 0z",
    fill: "CurrentColor"
  })));
}

var _path$3;

function _extends$4() {
  _extends$4 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$4.apply(this, arguments);
}

function SvgPendingIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$4({
    width: 16,
    height: 16,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$3 || (_path$3 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8 3.734a4.267 4.267 0 100 8.533 4.267 4.267 0 000-8.533zM2.667 8a5.333 5.333 0 1110.666 0A5.333 5.333 0 012.667 8zM8 4.667c.295 0 .533.239.533.533v2.267H10.8a.533.533 0 010 1.067H8A.533.533 0 017.467 8V5.2c0-.294.239-.533.533-.533z",
    fill: "CurrentColor"
  })));
}

var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

function commonjsRequire () {
	throw new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');
}

var moment = createCommonjsModule(function (module, exports) {
(function (global, factory) {
     module.exports = factory() ;
}(commonjsGlobal, (function () {
    var hookCallback;

    function hooks() {
        return hookCallback.apply(null, arguments);
    }

    // This is done to register the method called with moment()
    // without creating circular dependencies.
    function setHookCallback(callback) {
        hookCallback = callback;
    }

    function isArray(input) {
        return (
            input instanceof Array ||
            Object.prototype.toString.call(input) === '[object Array]'
        );
    }

    function isObject(input) {
        // IE8 will treat undefined and null as object if it wasn't for
        // input != null
        return (
            input != null &&
            Object.prototype.toString.call(input) === '[object Object]'
        );
    }

    function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
    }

    function isObjectEmpty(obj) {
        if (Object.getOwnPropertyNames) {
            return Object.getOwnPropertyNames(obj).length === 0;
        } else {
            var k;
            for (k in obj) {
                if (hasOwnProp(obj, k)) {
                    return false;
                }
            }
            return true;
        }
    }

    function isUndefined(input) {
        return input === void 0;
    }

    function isNumber(input) {
        return (
            typeof input === 'number' ||
            Object.prototype.toString.call(input) === '[object Number]'
        );
    }

    function isDate(input) {
        return (
            input instanceof Date ||
            Object.prototype.toString.call(input) === '[object Date]'
        );
    }

    function map(arr, fn) {
        var res = [],
            i,
            arrLen = arr.length;
        for (i = 0; i < arrLen; ++i) {
            res.push(fn(arr[i], i));
        }
        return res;
    }

    function extend(a, b) {
        for (var i in b) {
            if (hasOwnProp(b, i)) {
                a[i] = b[i];
            }
        }

        if (hasOwnProp(b, 'toString')) {
            a.toString = b.toString;
        }

        if (hasOwnProp(b, 'valueOf')) {
            a.valueOf = b.valueOf;
        }

        return a;
    }

    function createUTC(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc();
    }

    function defaultParsingFlags() {
        // We need to deep clone this object.
        return {
            empty: false,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: false,
            invalidEra: null,
            invalidMonth: null,
            invalidFormat: false,
            userInvalidated: false,
            iso: false,
            parsedDateParts: [],
            era: null,
            meridiem: null,
            rfc2822: false,
            weekdayMismatch: false,
        };
    }

    function getParsingFlags(m) {
        if (m._pf == null) {
            m._pf = defaultParsingFlags();
        }
        return m._pf;
    }

    var some;
    if (Array.prototype.some) {
        some = Array.prototype.some;
    } else {
        some = function (fun) {
            var t = Object(this),
                len = t.length >>> 0,
                i;

            for (i = 0; i < len; i++) {
                if (i in t && fun.call(this, t[i], i, t)) {
                    return true;
                }
            }

            return false;
        };
    }

    function isValid(m) {
        if (m._isValid == null) {
            var flags = getParsingFlags(m),
                parsedParts = some.call(flags.parsedDateParts, function (i) {
                    return i != null;
                }),
                isNowValid =
                    !isNaN(m._d.getTime()) &&
                    flags.overflow < 0 &&
                    !flags.empty &&
                    !flags.invalidEra &&
                    !flags.invalidMonth &&
                    !flags.invalidWeekday &&
                    !flags.weekdayMismatch &&
                    !flags.nullInput &&
                    !flags.invalidFormat &&
                    !flags.userInvalidated &&
                    (!flags.meridiem || (flags.meridiem && parsedParts));

            if (m._strict) {
                isNowValid =
                    isNowValid &&
                    flags.charsLeftOver === 0 &&
                    flags.unusedTokens.length === 0 &&
                    flags.bigHour === undefined;
            }

            if (Object.isFrozen == null || !Object.isFrozen(m)) {
                m._isValid = isNowValid;
            } else {
                return isNowValid;
            }
        }
        return m._isValid;
    }

    function createInvalid(flags) {
        var m = createUTC(NaN);
        if (flags != null) {
            extend(getParsingFlags(m), flags);
        } else {
            getParsingFlags(m).userInvalidated = true;
        }

        return m;
    }

    // Plugins that add properties should also add the key here (null value),
    // so we can properly clone ourselves.
    var momentProperties = (hooks.momentProperties = []),
        updateInProgress = false;

    function copyConfig(to, from) {
        var i,
            prop,
            val,
            momentPropertiesLen = momentProperties.length;

        if (!isUndefined(from._isAMomentObject)) {
            to._isAMomentObject = from._isAMomentObject;
        }
        if (!isUndefined(from._i)) {
            to._i = from._i;
        }
        if (!isUndefined(from._f)) {
            to._f = from._f;
        }
        if (!isUndefined(from._l)) {
            to._l = from._l;
        }
        if (!isUndefined(from._strict)) {
            to._strict = from._strict;
        }
        if (!isUndefined(from._tzm)) {
            to._tzm = from._tzm;
        }
        if (!isUndefined(from._isUTC)) {
            to._isUTC = from._isUTC;
        }
        if (!isUndefined(from._offset)) {
            to._offset = from._offset;
        }
        if (!isUndefined(from._pf)) {
            to._pf = getParsingFlags(from);
        }
        if (!isUndefined(from._locale)) {
            to._locale = from._locale;
        }

        if (momentPropertiesLen > 0) {
            for (i = 0; i < momentPropertiesLen; i++) {
                prop = momentProperties[i];
                val = from[prop];
                if (!isUndefined(val)) {
                    to[prop] = val;
                }
            }
        }

        return to;
    }

    // Moment prototype object
    function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(config._d != null ? config._d.getTime() : NaN);
        if (!this.isValid()) {
            this._d = new Date(NaN);
        }
        // Prevent infinite loop in case updateOffset creates new moment
        // objects.
        if (updateInProgress === false) {
            updateInProgress = true;
            hooks.updateOffset(this);
            updateInProgress = false;
        }
    }

    function isMoment(obj) {
        return (
            obj instanceof Moment || (obj != null && obj._isAMomentObject != null)
        );
    }

    function warn(msg) {
        if (
            hooks.suppressDeprecationWarnings === false &&
            typeof console !== 'undefined' &&
            console.warn
        ) {
            console.warn('Deprecation warning: ' + msg);
        }
    }

    function deprecate(msg, fn) {
        var firstTime = true;

        return extend(function () {
            if (hooks.deprecationHandler != null) {
                hooks.deprecationHandler(null, msg);
            }
            if (firstTime) {
                var args = [],
                    arg,
                    i,
                    key,
                    argLen = arguments.length;
                for (i = 0; i < argLen; i++) {
                    arg = '';
                    if (typeof arguments[i] === 'object') {
                        arg += '\n[' + i + '] ';
                        for (key in arguments[0]) {
                            if (hasOwnProp(arguments[0], key)) {
                                arg += key + ': ' + arguments[0][key] + ', ';
                            }
                        }
                        arg = arg.slice(0, -2); // Remove trailing comma and space
                    } else {
                        arg = arguments[i];
                    }
                    args.push(arg);
                }
                warn(
                    msg +
                        '\nArguments: ' +
                        Array.prototype.slice.call(args).join('') +
                        '\n' +
                        new Error().stack
                );
                firstTime = false;
            }
            return fn.apply(this, arguments);
        }, fn);
    }

    var deprecations = {};

    function deprecateSimple(name, msg) {
        if (hooks.deprecationHandler != null) {
            hooks.deprecationHandler(name, msg);
        }
        if (!deprecations[name]) {
            warn(msg);
            deprecations[name] = true;
        }
    }

    hooks.suppressDeprecationWarnings = false;
    hooks.deprecationHandler = null;

    function isFunction(input) {
        return (
            (typeof Function !== 'undefined' && input instanceof Function) ||
            Object.prototype.toString.call(input) === '[object Function]'
        );
    }

    function set(config) {
        var prop, i;
        for (i in config) {
            if (hasOwnProp(config, i)) {
                prop = config[i];
                if (isFunction(prop)) {
                    this[i] = prop;
                } else {
                    this['_' + i] = prop;
                }
            }
        }
        this._config = config;
        // Lenient ordinal parsing accepts just a number in addition to
        // number + (possibly) stuff coming from _dayOfMonthOrdinalParse.
        // TODO: Remove "ordinalParse" fallback in next major release.
        this._dayOfMonthOrdinalParseLenient = new RegExp(
            (this._dayOfMonthOrdinalParse.source || this._ordinalParse.source) +
                '|' +
                /\d{1,2}/.source
        );
    }

    function mergeConfigs(parentConfig, childConfig) {
        var res = extend({}, parentConfig),
            prop;
        for (prop in childConfig) {
            if (hasOwnProp(childConfig, prop)) {
                if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {
                    res[prop] = {};
                    extend(res[prop], parentConfig[prop]);
                    extend(res[prop], childConfig[prop]);
                } else if (childConfig[prop] != null) {
                    res[prop] = childConfig[prop];
                } else {
                    delete res[prop];
                }
            }
        }
        for (prop in parentConfig) {
            if (
                hasOwnProp(parentConfig, prop) &&
                !hasOwnProp(childConfig, prop) &&
                isObject(parentConfig[prop])
            ) {
                // make sure changes to properties don't modify parent config
                res[prop] = extend({}, res[prop]);
            }
        }
        return res;
    }

    function Locale(config) {
        if (config != null) {
            this.set(config);
        }
    }

    var keys;

    if (Object.keys) {
        keys = Object.keys;
    } else {
        keys = function (obj) {
            var i,
                res = [];
            for (i in obj) {
                if (hasOwnProp(obj, i)) {
                    res.push(i);
                }
            }
            return res;
        };
    }

    var defaultCalendar = {
        sameDay: '[Today at] LT',
        nextDay: '[Tomorrow at] LT',
        nextWeek: 'dddd [at] LT',
        lastDay: '[Yesterday at] LT',
        lastWeek: '[Last] dddd [at] LT',
        sameElse: 'L',
    };

    function calendar(key, mom, now) {
        var output = this._calendar[key] || this._calendar['sameElse'];
        return isFunction(output) ? output.call(mom, now) : output;
    }

    function zeroFill(number, targetLength, forceSign) {
        var absNumber = '' + Math.abs(number),
            zerosToFill = targetLength - absNumber.length,
            sign = number >= 0;
        return (
            (sign ? (forceSign ? '+' : '') : '-') +
            Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) +
            absNumber
        );
    }

    var formattingTokens =
            /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,
        localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,
        formatFunctions = {},
        formatTokenFunctions = {};

    // token:    'M'
    // padded:   ['MM', 2]
    // ordinal:  'Mo'
    // callback: function () { this.month() + 1 }
    function addFormatToken(token, padded, ordinal, callback) {
        var func = callback;
        if (typeof callback === 'string') {
            func = function () {
                return this[callback]();
            };
        }
        if (token) {
            formatTokenFunctions[token] = func;
        }
        if (padded) {
            formatTokenFunctions[padded[0]] = function () {
                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
            };
        }
        if (ordinal) {
            formatTokenFunctions[ordinal] = function () {
                return this.localeData().ordinal(
                    func.apply(this, arguments),
                    token
                );
            };
        }
    }

    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, '');
        }
        return input.replace(/\\/g, '');
    }

    function makeFormatFunction(format) {
        var array = format.match(formattingTokens),
            i,
            length;

        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }

        return function (mom) {
            var output = '',
                i;
            for (i = 0; i < length; i++) {
                output += isFunction(array[i])
                    ? array[i].call(mom, format)
                    : array[i];
            }
            return output;
        };
    }

    // format date using native date object
    function formatMoment(m, format) {
        if (!m.isValid()) {
            return m.localeData().invalidDate();
        }

        format = expandFormat(format, m.localeData());
        formatFunctions[format] =
            formatFunctions[format] || makeFormatFunction(format);

        return formatFunctions[format](m);
    }

    function expandFormat(format, locale) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
            return locale.longDateFormat(input) || input;
        }

        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(
                localFormattingTokens,
                replaceLongDateFormatTokens
            );
            localFormattingTokens.lastIndex = 0;
            i -= 1;
        }

        return format;
    }

    var defaultLongDateFormat = {
        LTS: 'h:mm:ss A',
        LT: 'h:mm A',
        L: 'MM/DD/YYYY',
        LL: 'MMMM D, YYYY',
        LLL: 'MMMM D, YYYY h:mm A',
        LLLL: 'dddd, MMMM D, YYYY h:mm A',
    };

    function longDateFormat(key) {
        var format = this._longDateFormat[key],
            formatUpper = this._longDateFormat[key.toUpperCase()];

        if (format || !formatUpper) {
            return format;
        }

        this._longDateFormat[key] = formatUpper
            .match(formattingTokens)
            .map(function (tok) {
                if (
                    tok === 'MMMM' ||
                    tok === 'MM' ||
                    tok === 'DD' ||
                    tok === 'dddd'
                ) {
                    return tok.slice(1);
                }
                return tok;
            })
            .join('');

        return this._longDateFormat[key];
    }

    var defaultInvalidDate = 'Invalid date';

    function invalidDate() {
        return this._invalidDate;
    }

    var defaultOrdinal = '%d',
        defaultDayOfMonthOrdinalParse = /\d{1,2}/;

    function ordinal(number) {
        return this._ordinal.replace('%d', number);
    }

    var defaultRelativeTime = {
        future: 'in %s',
        past: '%s ago',
        s: 'a few seconds',
        ss: '%d seconds',
        m: 'a minute',
        mm: '%d minutes',
        h: 'an hour',
        hh: '%d hours',
        d: 'a day',
        dd: '%d days',
        w: 'a week',
        ww: '%d weeks',
        M: 'a month',
        MM: '%d months',
        y: 'a year',
        yy: '%d years',
    };

    function relativeTime(number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return isFunction(output)
            ? output(number, withoutSuffix, string, isFuture)
            : output.replace(/%d/i, number);
    }

    function pastFuture(diff, output) {
        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
        return isFunction(format) ? format(output) : format.replace(/%s/i, output);
    }

    var aliases = {};

    function addUnitAlias(unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
    }

    function normalizeUnits(units) {
        return typeof units === 'string'
            ? aliases[units] || aliases[units.toLowerCase()]
            : undefined;
    }

    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {},
            normalizedProp,
            prop;

        for (prop in inputObject) {
            if (hasOwnProp(inputObject, prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop];
                }
            }
        }

        return normalizedInput;
    }

    var priorities = {};

    function addUnitPriority(unit, priority) {
        priorities[unit] = priority;
    }

    function getPrioritizedUnits(unitsObj) {
        var units = [],
            u;
        for (u in unitsObj) {
            if (hasOwnProp(unitsObj, u)) {
                units.push({ unit: u, priority: priorities[u] });
            }
        }
        units.sort(function (a, b) {
            return a.priority - b.priority;
        });
        return units;
    }

    function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    function absFloor(number) {
        if (number < 0) {
            // -0 -> 0
            return Math.ceil(number) || 0;
        } else {
            return Math.floor(number);
        }
    }

    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion,
            value = 0;

        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            value = absFloor(coercedNumber);
        }

        return value;
    }

    function makeGetSet(unit, keepTime) {
        return function (value) {
            if (value != null) {
                set$1(this, unit, value);
                hooks.updateOffset(this, keepTime);
                return this;
            } else {
                return get(this, unit);
            }
        };
    }

    function get(mom, unit) {
        return mom.isValid()
            ? mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]()
            : NaN;
    }

    function set$1(mom, unit, value) {
        if (mom.isValid() && !isNaN(value)) {
            if (
                unit === 'FullYear' &&
                isLeapYear(mom.year()) &&
                mom.month() === 1 &&
                mom.date() === 29
            ) {
                value = toInt(value);
                mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](
                    value,
                    mom.month(),
                    daysInMonth(value, mom.month())
                );
            } else {
                mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
            }
        }
    }

    // MOMENTS

    function stringGet(units) {
        units = normalizeUnits(units);
        if (isFunction(this[units])) {
            return this[units]();
        }
        return this;
    }

    function stringSet(units, value) {
        if (typeof units === 'object') {
            units = normalizeObjectUnits(units);
            var prioritized = getPrioritizedUnits(units),
                i,
                prioritizedLen = prioritized.length;
            for (i = 0; i < prioritizedLen; i++) {
                this[prioritized[i].unit](units[prioritized[i].unit]);
            }
        } else {
            units = normalizeUnits(units);
            if (isFunction(this[units])) {
                return this[units](value);
            }
        }
        return this;
    }

    var match1 = /\d/, //       0 - 9
        match2 = /\d\d/, //      00 - 99
        match3 = /\d{3}/, //     000 - 999
        match4 = /\d{4}/, //    0000 - 9999
        match6 = /[+-]?\d{6}/, // -999999 - 999999
        match1to2 = /\d\d?/, //       0 - 99
        match3to4 = /\d\d\d\d?/, //     999 - 9999
        match5to6 = /\d\d\d\d\d\d?/, //   99999 - 999999
        match1to3 = /\d{1,3}/, //       0 - 999
        match1to4 = /\d{1,4}/, //       0 - 9999
        match1to6 = /[+-]?\d{1,6}/, // -999999 - 999999
        matchUnsigned = /\d+/, //       0 - inf
        matchSigned = /[+-]?\d+/, //    -inf - inf
        matchOffset = /Z|[+-]\d\d:?\d\d/gi, // +00:00 -00:00 +0000 -0000 or Z
        matchShortOffset = /Z|[+-]\d\d(?::?\d\d)?/gi, // +00 -00 +00:00 -00:00 +0000 -0000 or Z
        matchTimestamp = /[+-]?\d+(\.\d{1,3})?/, // 123456789 123456789.123
        // any word (or two) characters or numbers including two/three word month in arabic.
        // includes scottish gaelic two word and hyphenated months
        matchWord =
            /[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,
        regexes;

    regexes = {};

    function addRegexToken(token, regex, strictRegex) {
        regexes[token] = isFunction(regex)
            ? regex
            : function (isStrict, localeData) {
                  return isStrict && strictRegex ? strictRegex : regex;
              };
    }

    function getParseRegexForToken(token, config) {
        if (!hasOwnProp(regexes, token)) {
            return new RegExp(unescapeFormat(token));
        }

        return regexes[token](config._strict, config._locale);
    }

    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
    function unescapeFormat(s) {
        return regexEscape(
            s
                .replace('\\', '')
                .replace(
                    /\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,
                    function (matched, p1, p2, p3, p4) {
                        return p1 || p2 || p3 || p4;
                    }
                )
        );
    }

    function regexEscape(s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }

    var tokens = {};

    function addParseToken(token, callback) {
        var i,
            func = callback,
            tokenLen;
        if (typeof token === 'string') {
            token = [token];
        }
        if (isNumber(callback)) {
            func = function (input, array) {
                array[callback] = toInt(input);
            };
        }
        tokenLen = token.length;
        for (i = 0; i < tokenLen; i++) {
            tokens[token[i]] = func;
        }
    }

    function addWeekParseToken(token, callback) {
        addParseToken(token, function (input, array, config, token) {
            config._w = config._w || {};
            callback(input, config._w, config, token);
        });
    }

    function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
            tokens[token](input, config._a, config, token);
        }
    }

    var YEAR = 0,
        MONTH = 1,
        DATE = 2,
        HOUR = 3,
        MINUTE = 4,
        SECOND = 5,
        MILLISECOND = 6,
        WEEK = 7,
        WEEKDAY = 8;

    function mod(n, x) {
        return ((n % x) + x) % x;
    }

    var indexOf;

    if (Array.prototype.indexOf) {
        indexOf = Array.prototype.indexOf;
    } else {
        indexOf = function (o) {
            // I know
            var i;
            for (i = 0; i < this.length; ++i) {
                if (this[i] === o) {
                    return i;
                }
            }
            return -1;
        };
    }

    function daysInMonth(year, month) {
        if (isNaN(year) || isNaN(month)) {
            return NaN;
        }
        var modMonth = mod(month, 12);
        year += (month - modMonth) / 12;
        return modMonth === 1
            ? isLeapYear(year)
                ? 29
                : 28
            : 31 - ((modMonth % 7) % 2);
    }

    // FORMATTING

    addFormatToken('M', ['MM', 2], 'Mo', function () {
        return this.month() + 1;
    });

    addFormatToken('MMM', 0, 0, function (format) {
        return this.localeData().monthsShort(this, format);
    });

    addFormatToken('MMMM', 0, 0, function (format) {
        return this.localeData().months(this, format);
    });

    // ALIASES

    addUnitAlias('month', 'M');

    // PRIORITY

    addUnitPriority('month', 8);

    // PARSING

    addRegexToken('M', match1to2);
    addRegexToken('MM', match1to2, match2);
    addRegexToken('MMM', function (isStrict, locale) {
        return locale.monthsShortRegex(isStrict);
    });
    addRegexToken('MMMM', function (isStrict, locale) {
        return locale.monthsRegex(isStrict);
    });

    addParseToken(['M', 'MM'], function (input, array) {
        array[MONTH] = toInt(input) - 1;
    });

    addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict);
        // if we didn't find a month name, mark the date as invalid.
        if (month != null) {
            array[MONTH] = month;
        } else {
            getParsingFlags(config).invalidMonth = input;
        }
    });

    // LOCALES

    var defaultLocaleMonths =
            'January_February_March_April_May_June_July_August_September_October_November_December'.split(
                '_'
            ),
        defaultLocaleMonthsShort =
            'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
        MONTHS_IN_FORMAT = /D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,
        defaultMonthsShortRegex = matchWord,
        defaultMonthsRegex = matchWord;

    function localeMonths(m, format) {
        if (!m) {
            return isArray(this._months)
                ? this._months
                : this._months['standalone'];
        }
        return isArray(this._months)
            ? this._months[m.month()]
            : this._months[
                  (this._months.isFormat || MONTHS_IN_FORMAT).test(format)
                      ? 'format'
                      : 'standalone'
              ][m.month()];
    }

    function localeMonthsShort(m, format) {
        if (!m) {
            return isArray(this._monthsShort)
                ? this._monthsShort
                : this._monthsShort['standalone'];
        }
        return isArray(this._monthsShort)
            ? this._monthsShort[m.month()]
            : this._monthsShort[
                  MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'
              ][m.month()];
    }

    function handleStrictParse(monthName, format, strict) {
        var i,
            ii,
            mom,
            llc = monthName.toLocaleLowerCase();
        if (!this._monthsParse) {
            // this is not used
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
            for (i = 0; i < 12; ++i) {
                mom = createUTC([2000, i]);
                this._shortMonthsParse[i] = this.monthsShort(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();
            }
        }

        if (strict) {
            if (format === 'MMM') {
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null;
            }
        } else {
            if (format === 'MMM') {
                ii = indexOf.call(this._shortMonthsParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null;
            }
        }
    }

    function localeMonthsParse(monthName, format, strict) {
        var i, mom, regex;

        if (this._monthsParseExact) {
            return handleStrictParse.call(this, monthName, format, strict);
        }

        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
        }

        // TODO: add sorting
        // Sorting makes sure if one month (or abbr) is a prefix of another
        // see sorting in computeMonthsParse
        for (i = 0; i < 12; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, i]);
            if (strict && !this._longMonthsParse[i]) {
                this._longMonthsParse[i] = new RegExp(
                    '^' + this.months(mom, '').replace('.', '') + '$',
                    'i'
                );
                this._shortMonthsParse[i] = new RegExp(
                    '^' + this.monthsShort(mom, '').replace('.', '') + '$',
                    'i'
                );
            }
            if (!strict && !this._monthsParse[i]) {
                regex =
                    '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (
                strict &&
                format === 'MMMM' &&
                this._longMonthsParse[i].test(monthName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'MMM' &&
                this._shortMonthsParse[i].test(monthName)
            ) {
                return i;
            } else if (!strict && this._monthsParse[i].test(monthName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function setMonth(mom, value) {
        var dayOfMonth;

        if (!mom.isValid()) {
            // No op
            return mom;
        }

        if (typeof value === 'string') {
            if (/^\d+$/.test(value)) {
                value = toInt(value);
            } else {
                value = mom.localeData().monthsParse(value);
                // TODO: Another silent failure?
                if (!isNumber(value)) {
                    return mom;
                }
            }
        }

        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
        return mom;
    }

    function getSetMonth(value) {
        if (value != null) {
            setMonth(this, value);
            hooks.updateOffset(this, true);
            return this;
        } else {
            return get(this, 'Month');
        }
    }

    function getDaysInMonth() {
        return daysInMonth(this.year(), this.month());
    }

    function monthsShortRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, '_monthsRegex')) {
                computeMonthsParse.call(this);
            }
            if (isStrict) {
                return this._monthsShortStrictRegex;
            } else {
                return this._monthsShortRegex;
            }
        } else {
            if (!hasOwnProp(this, '_monthsShortRegex')) {
                this._monthsShortRegex = defaultMonthsShortRegex;
            }
            return this._monthsShortStrictRegex && isStrict
                ? this._monthsShortStrictRegex
                : this._monthsShortRegex;
        }
    }

    function monthsRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, '_monthsRegex')) {
                computeMonthsParse.call(this);
            }
            if (isStrict) {
                return this._monthsStrictRegex;
            } else {
                return this._monthsRegex;
            }
        } else {
            if (!hasOwnProp(this, '_monthsRegex')) {
                this._monthsRegex = defaultMonthsRegex;
            }
            return this._monthsStrictRegex && isStrict
                ? this._monthsStrictRegex
                : this._monthsRegex;
        }
    }

    function computeMonthsParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length;
        }

        var shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom;
        for (i = 0; i < 12; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, i]);
            shortPieces.push(this.monthsShort(mom, ''));
            longPieces.push(this.months(mom, ''));
            mixedPieces.push(this.months(mom, ''));
            mixedPieces.push(this.monthsShort(mom, ''));
        }
        // Sorting makes sure if one month (or abbr) is a prefix of another it
        // will match the longer piece.
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);
        for (i = 0; i < 12; i++) {
            shortPieces[i] = regexEscape(shortPieces[i]);
            longPieces[i] = regexEscape(longPieces[i]);
        }
        for (i = 0; i < 24; i++) {
            mixedPieces[i] = regexEscape(mixedPieces[i]);
        }

        this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._monthsShortRegex = this._monthsRegex;
        this._monthsStrictRegex = new RegExp(
            '^(' + longPieces.join('|') + ')',
            'i'
        );
        this._monthsShortStrictRegex = new RegExp(
            '^(' + shortPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    addFormatToken('Y', 0, 0, function () {
        var y = this.year();
        return y <= 9999 ? zeroFill(y, 4) : '+' + y;
    });

    addFormatToken(0, ['YY', 2], 0, function () {
        return this.year() % 100;
    });

    addFormatToken(0, ['YYYY', 4], 0, 'year');
    addFormatToken(0, ['YYYYY', 5], 0, 'year');
    addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');

    // ALIASES

    addUnitAlias('year', 'y');

    // PRIORITIES

    addUnitPriority('year', 1);

    // PARSING

    addRegexToken('Y', matchSigned);
    addRegexToken('YY', match1to2, match2);
    addRegexToken('YYYY', match1to4, match4);
    addRegexToken('YYYYY', match1to6, match6);
    addRegexToken('YYYYYY', match1to6, match6);

    addParseToken(['YYYYY', 'YYYYYY'], YEAR);
    addParseToken('YYYY', function (input, array) {
        array[YEAR] =
            input.length === 2 ? hooks.parseTwoDigitYear(input) : toInt(input);
    });
    addParseToken('YY', function (input, array) {
        array[YEAR] = hooks.parseTwoDigitYear(input);
    });
    addParseToken('Y', function (input, array) {
        array[YEAR] = parseInt(input, 10);
    });

    // HELPERS

    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
    }

    // HOOKS

    hooks.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
    };

    // MOMENTS

    var getSetYear = makeGetSet('FullYear', true);

    function getIsLeapYear() {
        return isLeapYear(this.year());
    }

    function createDate(y, m, d, h, M, s, ms) {
        // can't just apply() to create a date:
        // https://stackoverflow.com/q/181348
        var date;
        // the date constructor remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            date = new Date(y + 400, m, d, h, M, s, ms);
            if (isFinite(date.getFullYear())) {
                date.setFullYear(y);
            }
        } else {
            date = new Date(y, m, d, h, M, s, ms);
        }

        return date;
    }

    function createUTCDate(y) {
        var date, args;
        // the Date.UTC function remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            args = Array.prototype.slice.call(arguments);
            // preserve leap years using a full 400 year cycle, then reset
            args[0] = y + 400;
            date = new Date(Date.UTC.apply(null, args));
            if (isFinite(date.getUTCFullYear())) {
                date.setUTCFullYear(y);
            }
        } else {
            date = new Date(Date.UTC.apply(null, arguments));
        }

        return date;
    }

    // start-of-first-week - start-of-year
    function firstWeekOffset(year, dow, doy) {
        var // first-week day -- which january is always in the first week (4 for iso, 1 for other)
            fwd = 7 + dow - doy,
            // first-week day local weekday -- which local weekday is fwd
            fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;

        return -fwdlw + fwd - 1;
    }

    // https://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
    function dayOfYearFromWeeks(year, week, weekday, dow, doy) {
        var localWeekday = (7 + weekday - dow) % 7,
            weekOffset = firstWeekOffset(year, dow, doy),
            dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,
            resYear,
            resDayOfYear;

        if (dayOfYear <= 0) {
            resYear = year - 1;
            resDayOfYear = daysInYear(resYear) + dayOfYear;
        } else if (dayOfYear > daysInYear(year)) {
            resYear = year + 1;
            resDayOfYear = dayOfYear - daysInYear(year);
        } else {
            resYear = year;
            resDayOfYear = dayOfYear;
        }

        return {
            year: resYear,
            dayOfYear: resDayOfYear,
        };
    }

    function weekOfYear(mom, dow, doy) {
        var weekOffset = firstWeekOffset(mom.year(), dow, doy),
            week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,
            resWeek,
            resYear;

        if (week < 1) {
            resYear = mom.year() - 1;
            resWeek = week + weeksInYear(resYear, dow, doy);
        } else if (week > weeksInYear(mom.year(), dow, doy)) {
            resWeek = week - weeksInYear(mom.year(), dow, doy);
            resYear = mom.year() + 1;
        } else {
            resYear = mom.year();
            resWeek = week;
        }

        return {
            week: resWeek,
            year: resYear,
        };
    }

    function weeksInYear(year, dow, doy) {
        var weekOffset = firstWeekOffset(year, dow, doy),
            weekOffsetNext = firstWeekOffset(year + 1, dow, doy);
        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;
    }

    // FORMATTING

    addFormatToken('w', ['ww', 2], 'wo', 'week');
    addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');

    // ALIASES

    addUnitAlias('week', 'w');
    addUnitAlias('isoWeek', 'W');

    // PRIORITIES

    addUnitPriority('week', 5);
    addUnitPriority('isoWeek', 5);

    // PARSING

    addRegexToken('w', match1to2);
    addRegexToken('ww', match1to2, match2);
    addRegexToken('W', match1to2);
    addRegexToken('WW', match1to2, match2);

    addWeekParseToken(
        ['w', 'ww', 'W', 'WW'],
        function (input, week, config, token) {
            week[token.substr(0, 1)] = toInt(input);
        }
    );

    // HELPERS

    // LOCALES

    function localeWeek(mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week;
    }

    var defaultLocaleWeek = {
        dow: 0, // Sunday is the first day of the week.
        doy: 6, // The week that contains Jan 6th is the first week of the year.
    };

    function localeFirstDayOfWeek() {
        return this._week.dow;
    }

    function localeFirstDayOfYear() {
        return this._week.doy;
    }

    // MOMENTS

    function getSetWeek(input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    function getSetISOWeek(input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    // FORMATTING

    addFormatToken('d', 0, 'do', 'day');

    addFormatToken('dd', 0, 0, function (format) {
        return this.localeData().weekdaysMin(this, format);
    });

    addFormatToken('ddd', 0, 0, function (format) {
        return this.localeData().weekdaysShort(this, format);
    });

    addFormatToken('dddd', 0, 0, function (format) {
        return this.localeData().weekdays(this, format);
    });

    addFormatToken('e', 0, 0, 'weekday');
    addFormatToken('E', 0, 0, 'isoWeekday');

    // ALIASES

    addUnitAlias('day', 'd');
    addUnitAlias('weekday', 'e');
    addUnitAlias('isoWeekday', 'E');

    // PRIORITY
    addUnitPriority('day', 11);
    addUnitPriority('weekday', 11);
    addUnitPriority('isoWeekday', 11);

    // PARSING

    addRegexToken('d', match1to2);
    addRegexToken('e', match1to2);
    addRegexToken('E', match1to2);
    addRegexToken('dd', function (isStrict, locale) {
        return locale.weekdaysMinRegex(isStrict);
    });
    addRegexToken('ddd', function (isStrict, locale) {
        return locale.weekdaysShortRegex(isStrict);
    });
    addRegexToken('dddd', function (isStrict, locale) {
        return locale.weekdaysRegex(isStrict);
    });

    addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {
        var weekday = config._locale.weekdaysParse(input, token, config._strict);
        // if we didn't get a weekday name, mark the date as invalid
        if (weekday != null) {
            week.d = weekday;
        } else {
            getParsingFlags(config).invalidWeekday = input;
        }
    });

    addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {
        week[token] = toInt(input);
    });

    // HELPERS

    function parseWeekday(input, locale) {
        if (typeof input !== 'string') {
            return input;
        }

        if (!isNaN(input)) {
            return parseInt(input, 10);
        }

        input = locale.weekdaysParse(input);
        if (typeof input === 'number') {
            return input;
        }

        return null;
    }

    function parseIsoWeekday(input, locale) {
        if (typeof input === 'string') {
            return locale.weekdaysParse(input) % 7 || 7;
        }
        return isNaN(input) ? null : input;
    }

    // LOCALES
    function shiftWeekdays(ws, n) {
        return ws.slice(n, 7).concat(ws.slice(0, n));
    }

    var defaultLocaleWeekdays =
            'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
        defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
        defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
        defaultWeekdaysRegex = matchWord,
        defaultWeekdaysShortRegex = matchWord,
        defaultWeekdaysMinRegex = matchWord;

    function localeWeekdays(m, format) {
        var weekdays = isArray(this._weekdays)
            ? this._weekdays
            : this._weekdays[
                  m && m !== true && this._weekdays.isFormat.test(format)
                      ? 'format'
                      : 'standalone'
              ];
        return m === true
            ? shiftWeekdays(weekdays, this._week.dow)
            : m
            ? weekdays[m.day()]
            : weekdays;
    }

    function localeWeekdaysShort(m) {
        return m === true
            ? shiftWeekdays(this._weekdaysShort, this._week.dow)
            : m
            ? this._weekdaysShort[m.day()]
            : this._weekdaysShort;
    }

    function localeWeekdaysMin(m) {
        return m === true
            ? shiftWeekdays(this._weekdaysMin, this._week.dow)
            : m
            ? this._weekdaysMin[m.day()]
            : this._weekdaysMin;
    }

    function handleStrictParse$1(weekdayName, format, strict) {
        var i,
            ii,
            mom,
            llc = weekdayName.toLocaleLowerCase();
        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._minWeekdaysParse = [];

            for (i = 0; i < 7; ++i) {
                mom = createUTC([2000, 1]).day(i);
                this._minWeekdaysParse[i] = this.weekdaysMin(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._shortWeekdaysParse[i] = this.weekdaysShort(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();
            }
        }

        if (strict) {
            if (format === 'dddd') {
                ii = indexOf.call(this._weekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else if (format === 'ddd') {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            }
        } else {
            if (format === 'dddd') {
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else if (format === 'ddd') {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            }
        }
    }

    function localeWeekdaysParse(weekdayName, format, strict) {
        var i, mom, regex;

        if (this._weekdaysParseExact) {
            return handleStrictParse$1.call(this, weekdayName, format, strict);
        }

        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._minWeekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._fullWeekdaysParse = [];
        }

        for (i = 0; i < 7; i++) {
            // make the regex if we don't have it already

            mom = createUTC([2000, 1]).day(i);
            if (strict && !this._fullWeekdaysParse[i]) {
                this._fullWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdays(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
                this._shortWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdaysShort(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
                this._minWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdaysMin(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
            }
            if (!this._weekdaysParse[i]) {
                regex =
                    '^' +
                    this.weekdays(mom, '') +
                    '|^' +
                    this.weekdaysShort(mom, '') +
                    '|^' +
                    this.weekdaysMin(mom, '');
                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (
                strict &&
                format === 'dddd' &&
                this._fullWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'ddd' &&
                this._shortWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'dd' &&
                this._minWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function getSetDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        if (input != null) {
            input = parseWeekday(input, this.localeData());
            return this.add(input - day, 'd');
        } else {
            return day;
        }
    }

    function getSetLocaleDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, 'd');
    }

    function getSetISODayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }

        // behaves the same as moment#day except
        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
        // as a setter, sunday should belong to the previous week.

        if (input != null) {
            var weekday = parseIsoWeekday(input, this.localeData());
            return this.day(this.day() % 7 ? weekday : weekday - 7);
        } else {
            return this.day() || 7;
        }
    }

    function weekdaysRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysStrictRegex;
            } else {
                return this._weekdaysRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                this._weekdaysRegex = defaultWeekdaysRegex;
            }
            return this._weekdaysStrictRegex && isStrict
                ? this._weekdaysStrictRegex
                : this._weekdaysRegex;
        }
    }

    function weekdaysShortRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysShortStrictRegex;
            } else {
                return this._weekdaysShortRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysShortRegex')) {
                this._weekdaysShortRegex = defaultWeekdaysShortRegex;
            }
            return this._weekdaysShortStrictRegex && isStrict
                ? this._weekdaysShortStrictRegex
                : this._weekdaysShortRegex;
        }
    }

    function weekdaysMinRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysMinStrictRegex;
            } else {
                return this._weekdaysMinRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysMinRegex')) {
                this._weekdaysMinRegex = defaultWeekdaysMinRegex;
            }
            return this._weekdaysMinStrictRegex && isStrict
                ? this._weekdaysMinStrictRegex
                : this._weekdaysMinRegex;
        }
    }

    function computeWeekdaysParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length;
        }

        var minPieces = [],
            shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom,
            minp,
            shortp,
            longp;
        for (i = 0; i < 7; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, 1]).day(i);
            minp = regexEscape(this.weekdaysMin(mom, ''));
            shortp = regexEscape(this.weekdaysShort(mom, ''));
            longp = regexEscape(this.weekdays(mom, ''));
            minPieces.push(minp);
            shortPieces.push(shortp);
            longPieces.push(longp);
            mixedPieces.push(minp);
            mixedPieces.push(shortp);
            mixedPieces.push(longp);
        }
        // Sorting makes sure if one weekday (or abbr) is a prefix of another it
        // will match the longer piece.
        minPieces.sort(cmpLenRev);
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);

        this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._weekdaysShortRegex = this._weekdaysRegex;
        this._weekdaysMinRegex = this._weekdaysRegex;

        this._weekdaysStrictRegex = new RegExp(
            '^(' + longPieces.join('|') + ')',
            'i'
        );
        this._weekdaysShortStrictRegex = new RegExp(
            '^(' + shortPieces.join('|') + ')',
            'i'
        );
        this._weekdaysMinStrictRegex = new RegExp(
            '^(' + minPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    function hFormat() {
        return this.hours() % 12 || 12;
    }

    function kFormat() {
        return this.hours() || 24;
    }

    addFormatToken('H', ['HH', 2], 0, 'hour');
    addFormatToken('h', ['hh', 2], 0, hFormat);
    addFormatToken('k', ['kk', 2], 0, kFormat);

    addFormatToken('hmm', 0, 0, function () {
        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);
    });

    addFormatToken('hmmss', 0, 0, function () {
        return (
            '' +
            hFormat.apply(this) +
            zeroFill(this.minutes(), 2) +
            zeroFill(this.seconds(), 2)
        );
    });

    addFormatToken('Hmm', 0, 0, function () {
        return '' + this.hours() + zeroFill(this.minutes(), 2);
    });

    addFormatToken('Hmmss', 0, 0, function () {
        return (
            '' +
            this.hours() +
            zeroFill(this.minutes(), 2) +
            zeroFill(this.seconds(), 2)
        );
    });

    function meridiem(token, lowercase) {
        addFormatToken(token, 0, 0, function () {
            return this.localeData().meridiem(
                this.hours(),
                this.minutes(),
                lowercase
            );
        });
    }

    meridiem('a', true);
    meridiem('A', false);

    // ALIASES

    addUnitAlias('hour', 'h');

    // PRIORITY
    addUnitPriority('hour', 13);

    // PARSING

    function matchMeridiem(isStrict, locale) {
        return locale._meridiemParse;
    }

    addRegexToken('a', matchMeridiem);
    addRegexToken('A', matchMeridiem);
    addRegexToken('H', match1to2);
    addRegexToken('h', match1to2);
    addRegexToken('k', match1to2);
    addRegexToken('HH', match1to2, match2);
    addRegexToken('hh', match1to2, match2);
    addRegexToken('kk', match1to2, match2);

    addRegexToken('hmm', match3to4);
    addRegexToken('hmmss', match5to6);
    addRegexToken('Hmm', match3to4);
    addRegexToken('Hmmss', match5to6);

    addParseToken(['H', 'HH'], HOUR);
    addParseToken(['k', 'kk'], function (input, array, config) {
        var kInput = toInt(input);
        array[HOUR] = kInput === 24 ? 0 : kInput;
    });
    addParseToken(['a', 'A'], function (input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input;
    });
    addParseToken(['h', 'hh'], function (input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('hmmss', function (input, array, config) {
        var pos1 = input.length - 4,
            pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('Hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
    });
    addParseToken('Hmmss', function (input, array, config) {
        var pos1 = input.length - 4,
            pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
    });

    // LOCALES

    function localeIsPM(input) {
        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
        // Using charAt should be more compatible.
        return (input + '').toLowerCase().charAt(0) === 'p';
    }

    var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i,
        // Setting the hour should keep the time, because the user explicitly
        // specified which hour they want. So trying to maintain the same hour (in
        // a new timezone) makes sense. Adding/subtracting hours does not follow
        // this rule.
        getSetHour = makeGetSet('Hours', true);

    function localeMeridiem(hours, minutes, isLower) {
        if (hours > 11) {
            return isLower ? 'pm' : 'PM';
        } else {
            return isLower ? 'am' : 'AM';
        }
    }

    var baseConfig = {
        calendar: defaultCalendar,
        longDateFormat: defaultLongDateFormat,
        invalidDate: defaultInvalidDate,
        ordinal: defaultOrdinal,
        dayOfMonthOrdinalParse: defaultDayOfMonthOrdinalParse,
        relativeTime: defaultRelativeTime,

        months: defaultLocaleMonths,
        monthsShort: defaultLocaleMonthsShort,

        week: defaultLocaleWeek,

        weekdays: defaultLocaleWeekdays,
        weekdaysMin: defaultLocaleWeekdaysMin,
        weekdaysShort: defaultLocaleWeekdaysShort,

        meridiemParse: defaultLocaleMeridiemParse,
    };

    // internal storage for locale config files
    var locales = {},
        localeFamilies = {},
        globalLocale;

    function commonPrefix(arr1, arr2) {
        var i,
            minl = Math.min(arr1.length, arr2.length);
        for (i = 0; i < minl; i += 1) {
            if (arr1[i] !== arr2[i]) {
                return i;
            }
        }
        return minl;
    }

    function normalizeLocale(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
    }

    // pick the locale from the array
    // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
    // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
    function chooseLocale(names) {
        var i = 0,
            j,
            next,
            locale,
            split;

        while (i < names.length) {
            split = normalizeLocale(names[i]).split('-');
            j = split.length;
            next = normalizeLocale(names[i + 1]);
            next = next ? next.split('-') : null;
            while (j > 0) {
                locale = loadLocale(split.slice(0, j).join('-'));
                if (locale) {
                    return locale;
                }
                if (
                    next &&
                    next.length >= j &&
                    commonPrefix(split, next) >= j - 1
                ) {
                    //the next array item is better than a shallower substring of this one
                    break;
                }
                j--;
            }
            i++;
        }
        return globalLocale;
    }

    function isLocaleNameSane(name) {
        // Prevent names that look like filesystem paths, i.e contain '/' or '\'
        return name.match('^[^/\\\\]*$') != null;
    }

    function loadLocale(name) {
        var oldLocale = null,
            aliasedRequire;
        // TODO: Find a better way to register and load all the locales in Node
        if (
            locales[name] === undefined &&
            'object' !== 'undefined' &&
            module &&
            module.exports &&
            isLocaleNameSane(name)
        ) {
            try {
                oldLocale = globalLocale._abbr;
                aliasedRequire = commonjsRequire;
                aliasedRequire('./locale/' + name);
                getSetGlobalLocale(oldLocale);
            } catch (e) {
                // mark as not found to avoid repeating expensive file require call causing high CPU
                // when trying to find en-US, en_US, en-us for every format call
                locales[name] = null; // null means not found
            }
        }
        return locales[name];
    }

    // This function will load locale and then set the global locale.  If
    // no arguments are passed in, it will simply return the current global
    // locale key.
    function getSetGlobalLocale(key, values) {
        var data;
        if (key) {
            if (isUndefined(values)) {
                data = getLocale(key);
            } else {
                data = defineLocale(key, values);
            }

            if (data) {
                // moment.duration._locale = moment._locale = data;
                globalLocale = data;
            } else {
                if (typeof console !== 'undefined' && console.warn) {
                    //warn user if arguments are passed but the locale could not be set
                    console.warn(
                        'Locale ' + key + ' not found. Did you forget to load it?'
                    );
                }
            }
        }

        return globalLocale._abbr;
    }

    function defineLocale(name, config) {
        if (config !== null) {
            var locale,
                parentConfig = baseConfig;
            config.abbr = name;
            if (locales[name] != null) {
                deprecateSimple(
                    'defineLocaleOverride',
                    'use moment.updateLocale(localeName, config) to change ' +
                        'an existing locale. moment.defineLocale(localeName, ' +
                        'config) should only be used for creating a new locale ' +
                        'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.'
                );
                parentConfig = locales[name]._config;
            } else if (config.parentLocale != null) {
                if (locales[config.parentLocale] != null) {
                    parentConfig = locales[config.parentLocale]._config;
                } else {
                    locale = loadLocale(config.parentLocale);
                    if (locale != null) {
                        parentConfig = locale._config;
                    } else {
                        if (!localeFamilies[config.parentLocale]) {
                            localeFamilies[config.parentLocale] = [];
                        }
                        localeFamilies[config.parentLocale].push({
                            name: name,
                            config: config,
                        });
                        return null;
                    }
                }
            }
            locales[name] = new Locale(mergeConfigs(parentConfig, config));

            if (localeFamilies[name]) {
                localeFamilies[name].forEach(function (x) {
                    defineLocale(x.name, x.config);
                });
            }

            // backwards compat for now: also set the locale
            // make sure we set the locale AFTER all child locales have been
            // created, so we won't end up with the child locale set.
            getSetGlobalLocale(name);

            return locales[name];
        } else {
            // useful for testing
            delete locales[name];
            return null;
        }
    }

    function updateLocale(name, config) {
        if (config != null) {
            var locale,
                tmpLocale,
                parentConfig = baseConfig;

            if (locales[name] != null && locales[name].parentLocale != null) {
                // Update existing child locale in-place to avoid memory-leaks
                locales[name].set(mergeConfigs(locales[name]._config, config));
            } else {
                // MERGE
                tmpLocale = loadLocale(name);
                if (tmpLocale != null) {
                    parentConfig = tmpLocale._config;
                }
                config = mergeConfigs(parentConfig, config);
                if (tmpLocale == null) {
                    // updateLocale is called for creating a new locale
                    // Set abbr so it will have a name (getters return
                    // undefined otherwise).
                    config.abbr = name;
                }
                locale = new Locale(config);
                locale.parentLocale = locales[name];
                locales[name] = locale;
            }

            // backwards compat for now: also set the locale
            getSetGlobalLocale(name);
        } else {
            // pass null for config to unupdate, useful for tests
            if (locales[name] != null) {
                if (locales[name].parentLocale != null) {
                    locales[name] = locales[name].parentLocale;
                    if (name === getSetGlobalLocale()) {
                        getSetGlobalLocale(name);
                    }
                } else if (locales[name] != null) {
                    delete locales[name];
                }
            }
        }
        return locales[name];
    }

    // returns locale data
    function getLocale(key) {
        var locale;

        if (key && key._locale && key._locale._abbr) {
            key = key._locale._abbr;
        }

        if (!key) {
            return globalLocale;
        }

        if (!isArray(key)) {
            //short-circuit everything else
            locale = loadLocale(key);
            if (locale) {
                return locale;
            }
            key = [key];
        }

        return chooseLocale(key);
    }

    function listLocales() {
        return keys(locales);
    }

    function checkOverflow(m) {
        var overflow,
            a = m._a;

        if (a && getParsingFlags(m).overflow === -2) {
            overflow =
                a[MONTH] < 0 || a[MONTH] > 11
                    ? MONTH
                    : a[DATE] < 1 || a[DATE] > daysInMonth(a[YEAR], a[MONTH])
                    ? DATE
                    : a[HOUR] < 0 ||
                      a[HOUR] > 24 ||
                      (a[HOUR] === 24 &&
                          (a[MINUTE] !== 0 ||
                              a[SECOND] !== 0 ||
                              a[MILLISECOND] !== 0))
                    ? HOUR
                    : a[MINUTE] < 0 || a[MINUTE] > 59
                    ? MINUTE
                    : a[SECOND] < 0 || a[SECOND] > 59
                    ? SECOND
                    : a[MILLISECOND] < 0 || a[MILLISECOND] > 999
                    ? MILLISECOND
                    : -1;

            if (
                getParsingFlags(m)._overflowDayOfYear &&
                (overflow < YEAR || overflow > DATE)
            ) {
                overflow = DATE;
            }
            if (getParsingFlags(m)._overflowWeeks && overflow === -1) {
                overflow = WEEK;
            }
            if (getParsingFlags(m)._overflowWeekday && overflow === -1) {
                overflow = WEEKDAY;
            }

            getParsingFlags(m).overflow = overflow;
        }

        return m;
    }

    // iso 8601 regex
    // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)
    var extendedIsoRegex =
            /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
        basicIsoRegex =
            /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
        tzRegex = /Z|[+-]\d\d(?::?\d\d)?/,
        isoDates = [
            ['YYYYYY-MM-DD', /[+-]\d{6}-\d\d-\d\d/],
            ['YYYY-MM-DD', /\d{4}-\d\d-\d\d/],
            ['GGGG-[W]WW-E', /\d{4}-W\d\d-\d/],
            ['GGGG-[W]WW', /\d{4}-W\d\d/, false],
            ['YYYY-DDD', /\d{4}-\d{3}/],
            ['YYYY-MM', /\d{4}-\d\d/, false],
            ['YYYYYYMMDD', /[+-]\d{10}/],
            ['YYYYMMDD', /\d{8}/],
            ['GGGG[W]WWE', /\d{4}W\d{3}/],
            ['GGGG[W]WW', /\d{4}W\d{2}/, false],
            ['YYYYDDD', /\d{7}/],
            ['YYYYMM', /\d{6}/, false],
            ['YYYY', /\d{4}/, false],
        ],
        // iso time formats and regexes
        isoTimes = [
            ['HH:mm:ss.SSSS', /\d\d:\d\d:\d\d\.\d+/],
            ['HH:mm:ss,SSSS', /\d\d:\d\d:\d\d,\d+/],
            ['HH:mm:ss', /\d\d:\d\d:\d\d/],
            ['HH:mm', /\d\d:\d\d/],
            ['HHmmss.SSSS', /\d\d\d\d\d\d\.\d+/],
            ['HHmmss,SSSS', /\d\d\d\d\d\d,\d+/],
            ['HHmmss', /\d\d\d\d\d\d/],
            ['HHmm', /\d\d\d\d/],
            ['HH', /\d\d/],
        ],
        aspNetJsonRegex = /^\/?Date\((-?\d+)/i,
        // RFC 2822 regex: For details see https://tools.ietf.org/html/rfc2822#section-3.3
        rfc2822 =
            /^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,
        obsOffsets = {
            UT: 0,
            GMT: 0,
            EDT: -4 * 60,
            EST: -5 * 60,
            CDT: -5 * 60,
            CST: -6 * 60,
            MDT: -6 * 60,
            MST: -7 * 60,
            PDT: -7 * 60,
            PST: -8 * 60,
        };

    // date from iso format
    function configFromISO(config) {
        var i,
            l,
            string = config._i,
            match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),
            allowTime,
            dateFormat,
            timeFormat,
            tzFormat,
            isoDatesLen = isoDates.length,
            isoTimesLen = isoTimes.length;

        if (match) {
            getParsingFlags(config).iso = true;
            for (i = 0, l = isoDatesLen; i < l; i++) {
                if (isoDates[i][1].exec(match[1])) {
                    dateFormat = isoDates[i][0];
                    allowTime = isoDates[i][2] !== false;
                    break;
                }
            }
            if (dateFormat == null) {
                config._isValid = false;
                return;
            }
            if (match[3]) {
                for (i = 0, l = isoTimesLen; i < l; i++) {
                    if (isoTimes[i][1].exec(match[3])) {
                        // match[2] should be 'T' or space
                        timeFormat = (match[2] || ' ') + isoTimes[i][0];
                        break;
                    }
                }
                if (timeFormat == null) {
                    config._isValid = false;
                    return;
                }
            }
            if (!allowTime && timeFormat != null) {
                config._isValid = false;
                return;
            }
            if (match[4]) {
                if (tzRegex.exec(match[4])) {
                    tzFormat = 'Z';
                } else {
                    config._isValid = false;
                    return;
                }
            }
            config._f = dateFormat + (timeFormat || '') + (tzFormat || '');
            configFromStringAndFormat(config);
        } else {
            config._isValid = false;
        }
    }

    function extractFromRFC2822Strings(
        yearStr,
        monthStr,
        dayStr,
        hourStr,
        minuteStr,
        secondStr
    ) {
        var result = [
            untruncateYear(yearStr),
            defaultLocaleMonthsShort.indexOf(monthStr),
            parseInt(dayStr, 10),
            parseInt(hourStr, 10),
            parseInt(minuteStr, 10),
        ];

        if (secondStr) {
            result.push(parseInt(secondStr, 10));
        }

        return result;
    }

    function untruncateYear(yearStr) {
        var year = parseInt(yearStr, 10);
        if (year <= 49) {
            return 2000 + year;
        } else if (year <= 999) {
            return 1900 + year;
        }
        return year;
    }

    function preprocessRFC2822(s) {
        // Remove comments and folding whitespace and replace multiple-spaces with a single space
        return s
            .replace(/\([^()]*\)|[\n\t]/g, ' ')
            .replace(/(\s\s+)/g, ' ')
            .replace(/^\s\s*/, '')
            .replace(/\s\s*$/, '');
    }

    function checkWeekday(weekdayStr, parsedInput, config) {
        if (weekdayStr) {
            // TODO: Replace the vanilla JS Date object with an independent day-of-week check.
            var weekdayProvided = defaultLocaleWeekdaysShort.indexOf(weekdayStr),
                weekdayActual = new Date(
                    parsedInput[0],
                    parsedInput[1],
                    parsedInput[2]
                ).getDay();
            if (weekdayProvided !== weekdayActual) {
                getParsingFlags(config).weekdayMismatch = true;
                config._isValid = false;
                return false;
            }
        }
        return true;
    }

    function calculateOffset(obsOffset, militaryOffset, numOffset) {
        if (obsOffset) {
            return obsOffsets[obsOffset];
        } else if (militaryOffset) {
            // the only allowed military tz is Z
            return 0;
        } else {
            var hm = parseInt(numOffset, 10),
                m = hm % 100,
                h = (hm - m) / 100;
            return h * 60 + m;
        }
    }

    // date and time from ref 2822 format
    function configFromRFC2822(config) {
        var match = rfc2822.exec(preprocessRFC2822(config._i)),
            parsedArray;
        if (match) {
            parsedArray = extractFromRFC2822Strings(
                match[4],
                match[3],
                match[2],
                match[5],
                match[6],
                match[7]
            );
            if (!checkWeekday(match[1], parsedArray, config)) {
                return;
            }

            config._a = parsedArray;
            config._tzm = calculateOffset(match[8], match[9], match[10]);

            config._d = createUTCDate.apply(null, config._a);
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);

            getParsingFlags(config).rfc2822 = true;
        } else {
            config._isValid = false;
        }
    }

    // date from 1) ASP.NET, 2) ISO, 3) RFC 2822 formats, or 4) optional fallback if parsing isn't strict
    function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);
        if (matched !== null) {
            config._d = new Date(+matched[1]);
            return;
        }

        configFromISO(config);
        if (config._isValid === false) {
            delete config._isValid;
        } else {
            return;
        }

        configFromRFC2822(config);
        if (config._isValid === false) {
            delete config._isValid;
        } else {
            return;
        }

        if (config._strict) {
            config._isValid = false;
        } else {
            // Final attempt, use Input Fallback
            hooks.createFromInputFallback(config);
        }
    }

    hooks.createFromInputFallback = deprecate(
        'value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), ' +
            'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are ' +
            'discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.',
        function (config) {
            config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
        }
    );

    // Pick the first defined of two or three arguments.
    function defaults(a, b, c) {
        if (a != null) {
            return a;
        }
        if (b != null) {
            return b;
        }
        return c;
    }

    function currentDateArray(config) {
        // hooks is actually the exported moment object
        var nowValue = new Date(hooks.now());
        if (config._useUTC) {
            return [
                nowValue.getUTCFullYear(),
                nowValue.getUTCMonth(),
                nowValue.getUTCDate(),
            ];
        }
        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];
    }

    // convert an array to a date.
    // the array should mirror the parameters below
    // note: all values past the year are optional and will default to the lowest possible value.
    // [year, month, day , hour, minute, second, millisecond]
    function configFromArray(config) {
        var i,
            date,
            input = [],
            currentDate,
            expectedWeekday,
            yearToUse;

        if (config._d) {
            return;
        }

        currentDate = currentDateArray(config);

        //compute day of the year from weeks and weekdays
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            dayOfYearFromWeekInfo(config);
        }

        //if the day of the year is set, figure out what it is
        if (config._dayOfYear != null) {
            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);

            if (
                config._dayOfYear > daysInYear(yearToUse) ||
                config._dayOfYear === 0
            ) {
                getParsingFlags(config)._overflowDayOfYear = true;
            }

            date = createUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate();
        }

        // Default to current date.
        // * if no year, month, day of month are given, default to today
        // * if day of month is given, default month and year
        // * if month is given, default only year
        // * if year is given, don't default anything
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i];
        }

        // Zero out whatever was not defaulted, including time
        for (; i < 7; i++) {
            config._a[i] = input[i] =
                config._a[i] == null ? (i === 2 ? 1 : 0) : config._a[i];
        }

        // Check for 24:00:00.000
        if (
            config._a[HOUR] === 24 &&
            config._a[MINUTE] === 0 &&
            config._a[SECOND] === 0 &&
            config._a[MILLISECOND] === 0
        ) {
            config._nextDay = true;
            config._a[HOUR] = 0;
        }

        config._d = (config._useUTC ? createUTCDate : createDate).apply(
            null,
            input
        );
        expectedWeekday = config._useUTC
            ? config._d.getUTCDay()
            : config._d.getDay();

        // Apply timezone offset from input. The actual utcOffset can be changed
        // with parseZone.
        if (config._tzm != null) {
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
        }

        if (config._nextDay) {
            config._a[HOUR] = 24;
        }

        // check for mismatching day of week
        if (
            config._w &&
            typeof config._w.d !== 'undefined' &&
            config._w.d !== expectedWeekday
        ) {
            getParsingFlags(config).weekdayMismatch = true;
        }
    }

    function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow, curWeek;

        w = config._w;
        if (w.GG != null || w.W != null || w.E != null) {
            dow = 1;
            doy = 4;

            // TODO: We need to take the current isoWeekYear, but that depends on
            // how we interpret now (local, utc, fixed offset). So create
            // a now version of current config (take local/utc/offset flags, and
            // create now).
            weekYear = defaults(
                w.GG,
                config._a[YEAR],
                weekOfYear(createLocal(), 1, 4).year
            );
            week = defaults(w.W, 1);
            weekday = defaults(w.E, 1);
            if (weekday < 1 || weekday > 7) {
                weekdayOverflow = true;
            }
        } else {
            dow = config._locale._week.dow;
            doy = config._locale._week.doy;

            curWeek = weekOfYear(createLocal(), dow, doy);

            weekYear = defaults(w.gg, config._a[YEAR], curWeek.year);

            // Default to current week.
            week = defaults(w.w, curWeek.week);

            if (w.d != null) {
                // weekday -- low day numbers are considered next week
                weekday = w.d;
                if (weekday < 0 || weekday > 6) {
                    weekdayOverflow = true;
                }
            } else if (w.e != null) {
                // local weekday -- counting starts from beginning of week
                weekday = w.e + dow;
                if (w.e < 0 || w.e > 6) {
                    weekdayOverflow = true;
                }
            } else {
                // default to beginning of week
                weekday = dow;
            }
        }
        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {
            getParsingFlags(config)._overflowWeeks = true;
        } else if (weekdayOverflow != null) {
            getParsingFlags(config)._overflowWeekday = true;
        } else {
            temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);
            config._a[YEAR] = temp.year;
            config._dayOfYear = temp.dayOfYear;
        }
    }

    // constant that refers to the ISO standard
    hooks.ISO_8601 = function () {};

    // constant that refers to the RFC 2822 form
    hooks.RFC_2822 = function () {};

    // date from string and format string
    function configFromStringAndFormat(config) {
        // TODO: Move this to another part of the creation flow to prevent circular deps
        if (config._f === hooks.ISO_8601) {
            configFromISO(config);
            return;
        }
        if (config._f === hooks.RFC_2822) {
            configFromRFC2822(config);
            return;
        }
        config._a = [];
        getParsingFlags(config).empty = true;

        // This array is used to make a Date, either with `new Date` or `Date.UTC`
        var string = '' + config._i,
            i,
            parsedInput,
            tokens,
            token,
            skipped,
            stringLength = string.length,
            totalParsedInputLength = 0,
            era,
            tokenLen;

        tokens =
            expandFormat(config._f, config._locale).match(formattingTokens) || [];
        tokenLen = tokens.length;
        for (i = 0; i < tokenLen; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) ||
                [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    getParsingFlags(config).unusedInput.push(skipped);
                }
                string = string.slice(
                    string.indexOf(parsedInput) + parsedInput.length
                );
                totalParsedInputLength += parsedInput.length;
            }
            // don't parse if it's not a known token
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    getParsingFlags(config).empty = false;
                } else {
                    getParsingFlags(config).unusedTokens.push(token);
                }
                addTimeToArrayFromToken(token, parsedInput, config);
            } else if (config._strict && !parsedInput) {
                getParsingFlags(config).unusedTokens.push(token);
            }
        }

        // add remaining unparsed input length to the string
        getParsingFlags(config).charsLeftOver =
            stringLength - totalParsedInputLength;
        if (string.length > 0) {
            getParsingFlags(config).unusedInput.push(string);
        }

        // clear _12h flag if hour is <= 12
        if (
            config._a[HOUR] <= 12 &&
            getParsingFlags(config).bigHour === true &&
            config._a[HOUR] > 0
        ) {
            getParsingFlags(config).bigHour = undefined;
        }

        getParsingFlags(config).parsedDateParts = config._a.slice(0);
        getParsingFlags(config).meridiem = config._meridiem;
        // handle meridiem
        config._a[HOUR] = meridiemFixWrap(
            config._locale,
            config._a[HOUR],
            config._meridiem
        );

        // handle era
        era = getParsingFlags(config).era;
        if (era !== null) {
            config._a[YEAR] = config._locale.erasConvertYear(era, config._a[YEAR]);
        }

        configFromArray(config);
        checkOverflow(config);
    }

    function meridiemFixWrap(locale, hour, meridiem) {
        var isPm;

        if (meridiem == null) {
            // nothing to do
            return hour;
        }
        if (locale.meridiemHour != null) {
            return locale.meridiemHour(hour, meridiem);
        } else if (locale.isPM != null) {
            // Fallback
            isPm = locale.isPM(meridiem);
            if (isPm && hour < 12) {
                hour += 12;
            }
            if (!isPm && hour === 12) {
                hour = 0;
            }
            return hour;
        } else {
            // this is not supposed to happen
            return hour;
        }
    }

    // date from string and array of format strings
    function configFromStringAndArray(config) {
        var tempConfig,
            bestMoment,
            scoreToBeat,
            i,
            currentScore,
            validFormatFound,
            bestFormatIsValid = false,
            configfLen = config._f.length;

        if (configfLen === 0) {
            getParsingFlags(config).invalidFormat = true;
            config._d = new Date(NaN);
            return;
        }

        for (i = 0; i < configfLen; i++) {
            currentScore = 0;
            validFormatFound = false;
            tempConfig = copyConfig({}, config);
            if (config._useUTC != null) {
                tempConfig._useUTC = config._useUTC;
            }
            tempConfig._f = config._f[i];
            configFromStringAndFormat(tempConfig);

            if (isValid(tempConfig)) {
                validFormatFound = true;
            }

            // if there is any input that was not parsed add a penalty for that format
            currentScore += getParsingFlags(tempConfig).charsLeftOver;

            //or tokens
            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;

            getParsingFlags(tempConfig).score = currentScore;

            if (!bestFormatIsValid) {
                if (
                    scoreToBeat == null ||
                    currentScore < scoreToBeat ||
                    validFormatFound
                ) {
                    scoreToBeat = currentScore;
                    bestMoment = tempConfig;
                    if (validFormatFound) {
                        bestFormatIsValid = true;
                    }
                }
            } else {
                if (currentScore < scoreToBeat) {
                    scoreToBeat = currentScore;
                    bestMoment = tempConfig;
                }
            }
        }

        extend(config, bestMoment || tempConfig);
    }

    function configFromObject(config) {
        if (config._d) {
            return;
        }

        var i = normalizeObjectUnits(config._i),
            dayOrDate = i.day === undefined ? i.date : i.day;
        config._a = map(
            [i.year, i.month, dayOrDate, i.hour, i.minute, i.second, i.millisecond],
            function (obj) {
                return obj && parseInt(obj, 10);
            }
        );

        configFromArray(config);
    }

    function createFromConfig(config) {
        var res = new Moment(checkOverflow(prepareConfig(config)));
        if (res._nextDay) {
            // Adding is smart enough around DST
            res.add(1, 'd');
            res._nextDay = undefined;
        }

        return res;
    }

    function prepareConfig(config) {
        var input = config._i,
            format = config._f;

        config._locale = config._locale || getLocale(config._l);

        if (input === null || (format === undefined && input === '')) {
            return createInvalid({ nullInput: true });
        }

        if (typeof input === 'string') {
            config._i = input = config._locale.preparse(input);
        }

        if (isMoment(input)) {
            return new Moment(checkOverflow(input));
        } else if (isDate(input)) {
            config._d = input;
        } else if (isArray(format)) {
            configFromStringAndArray(config);
        } else if (format) {
            configFromStringAndFormat(config);
        } else {
            configFromInput(config);
        }

        if (!isValid(config)) {
            config._d = null;
        }

        return config;
    }

    function configFromInput(config) {
        var input = config._i;
        if (isUndefined(input)) {
            config._d = new Date(hooks.now());
        } else if (isDate(input)) {
            config._d = new Date(input.valueOf());
        } else if (typeof input === 'string') {
            configFromString(config);
        } else if (isArray(input)) {
            config._a = map(input.slice(0), function (obj) {
                return parseInt(obj, 10);
            });
            configFromArray(config);
        } else if (isObject(input)) {
            configFromObject(config);
        } else if (isNumber(input)) {
            // from milliseconds
            config._d = new Date(input);
        } else {
            hooks.createFromInputFallback(config);
        }
    }

    function createLocalOrUTC(input, format, locale, strict, isUTC) {
        var c = {};

        if (format === true || format === false) {
            strict = format;
            format = undefined;
        }

        if (locale === true || locale === false) {
            strict = locale;
            locale = undefined;
        }

        if (
            (isObject(input) && isObjectEmpty(input)) ||
            (isArray(input) && input.length === 0)
        ) {
            input = undefined;
        }
        // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423
        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;

        return createFromConfig(c);
    }

    function createLocal(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false);
    }

    var prototypeMin = deprecate(
            'moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/',
            function () {
                var other = createLocal.apply(null, arguments);
                if (this.isValid() && other.isValid()) {
                    return other < this ? this : other;
                } else {
                    return createInvalid();
                }
            }
        ),
        prototypeMax = deprecate(
            'moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/',
            function () {
                var other = createLocal.apply(null, arguments);
                if (this.isValid() && other.isValid()) {
                    return other > this ? this : other;
                } else {
                    return createInvalid();
                }
            }
        );

    // Pick a moment m from moments so that m[fn](other) is true for all
    // other. This relies on the function fn to be transitive.
    //
    // moments should either be an array of moment objects or an array, whose
    // first element is an array of moment objects.
    function pickBy(fn, moments) {
        var res, i;
        if (moments.length === 1 && isArray(moments[0])) {
            moments = moments[0];
        }
        if (!moments.length) {
            return createLocal();
        }
        res = moments[0];
        for (i = 1; i < moments.length; ++i) {
            if (!moments[i].isValid() || moments[i][fn](res)) {
                res = moments[i];
            }
        }
        return res;
    }

    // TODO: Use [].sort instead?
    function min() {
        var args = [].slice.call(arguments, 0);

        return pickBy('isBefore', args);
    }

    function max() {
        var args = [].slice.call(arguments, 0);

        return pickBy('isAfter', args);
    }

    var now = function () {
        return Date.now ? Date.now() : +new Date();
    };

    var ordering = [
        'year',
        'quarter',
        'month',
        'week',
        'day',
        'hour',
        'minute',
        'second',
        'millisecond',
    ];

    function isDurationValid(m) {
        var key,
            unitHasDecimal = false,
            i,
            orderLen = ordering.length;
        for (key in m) {
            if (
                hasOwnProp(m, key) &&
                !(
                    indexOf.call(ordering, key) !== -1 &&
                    (m[key] == null || !isNaN(m[key]))
                )
            ) {
                return false;
            }
        }

        for (i = 0; i < orderLen; ++i) {
            if (m[ordering[i]]) {
                if (unitHasDecimal) {
                    return false; // only allow non-integers for smallest unit
                }
                if (parseFloat(m[ordering[i]]) !== toInt(m[ordering[i]])) {
                    unitHasDecimal = true;
                }
            }
        }

        return true;
    }

    function isValid$1() {
        return this._isValid;
    }

    function createInvalid$1() {
        return createDuration(NaN);
    }

    function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration),
            years = normalizedInput.year || 0,
            quarters = normalizedInput.quarter || 0,
            months = normalizedInput.month || 0,
            weeks = normalizedInput.week || normalizedInput.isoWeek || 0,
            days = normalizedInput.day || 0,
            hours = normalizedInput.hour || 0,
            minutes = normalizedInput.minute || 0,
            seconds = normalizedInput.second || 0,
            milliseconds = normalizedInput.millisecond || 0;

        this._isValid = isDurationValid(normalizedInput);

        // representation for dateAddRemove
        this._milliseconds =
            +milliseconds +
            seconds * 1e3 + // 1000
            minutes * 6e4 + // 1000 * 60
            hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately
        this._days = +days + weeks * 7;
        // It is impossible to translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.
        this._months = +months + quarters * 3 + years * 12;

        this._data = {};

        this._locale = getLocale();

        this._bubble();
    }

    function isDuration(obj) {
        return obj instanceof Duration;
    }

    function absRound(number) {
        if (number < 0) {
            return Math.round(-1 * number) * -1;
        } else {
            return Math.round(number);
        }
    }

    // compare two arrays, return the number of differences
    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;
        for (i = 0; i < len; i++) {
            if (
                (dontConvert && array1[i] !== array2[i]) ||
                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))
            ) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }

    // FORMATTING

    function offset(token, separator) {
        addFormatToken(token, 0, 0, function () {
            var offset = this.utcOffset(),
                sign = '+';
            if (offset < 0) {
                offset = -offset;
                sign = '-';
            }
            return (
                sign +
                zeroFill(~~(offset / 60), 2) +
                separator +
                zeroFill(~~offset % 60, 2)
            );
        });
    }

    offset('Z', ':');
    offset('ZZ', '');

    // PARSING

    addRegexToken('Z', matchShortOffset);
    addRegexToken('ZZ', matchShortOffset);
    addParseToken(['Z', 'ZZ'], function (input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(matchShortOffset, input);
    });

    // HELPERS

    // timezone chunker
    // '+10:00' > ['10',  '00']
    // '-1530'  > ['-15', '30']
    var chunkOffset = /([\+\-]|\d\d)/gi;

    function offsetFromString(matcher, string) {
        var matches = (string || '').match(matcher),
            chunk,
            parts,
            minutes;

        if (matches === null) {
            return null;
        }

        chunk = matches[matches.length - 1] || [];
        parts = (chunk + '').match(chunkOffset) || ['-', 0, 0];
        minutes = +(parts[1] * 60) + toInt(parts[2]);

        return minutes === 0 ? 0 : parts[0] === '+' ? minutes : -minutes;
    }

    // Return a moment from input, that is local/utc/zone equivalent to model.
    function cloneWithOffset(input, model) {
        var res, diff;
        if (model._isUTC) {
            res = model.clone();
            diff =
                (isMoment(input) || isDate(input)
                    ? input.valueOf()
                    : createLocal(input).valueOf()) - res.valueOf();
            // Use low-level api, because this fn is low-level api.
            res._d.setTime(res._d.valueOf() + diff);
            hooks.updateOffset(res, false);
            return res;
        } else {
            return createLocal(input).local();
        }
    }

    function getDateOffset(m) {
        // On Firefox.24 Date#getTimezoneOffset returns a floating point.
        // https://github.com/moment/moment/pull/1871
        return -Math.round(m._d.getTimezoneOffset());
    }

    // HOOKS

    // This function will be called whenever a moment is mutated.
    // It is intended to keep the offset in sync with the timezone.
    hooks.updateOffset = function () {};

    // MOMENTS

    // keepLocalTime = true means only change the timezone, without
    // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->
    // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset
    // +0200, so we adjust the time as needed, to be valid.
    //
    // Keeping the time actually adds/subtracts (one hour)
    // from the actual represented time. That is why we call updateOffset
    // a second time. In case it wants us to change the offset again
    // _changeInProgress == true case, then we have to adjust, because
    // there is no such time in the given timezone.
    function getSetOffset(input, keepLocalTime, keepMinutes) {
        var offset = this._offset || 0,
            localAdjust;
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        if (input != null) {
            if (typeof input === 'string') {
                input = offsetFromString(matchShortOffset, input);
                if (input === null) {
                    return this;
                }
            } else if (Math.abs(input) < 16 && !keepMinutes) {
                input = input * 60;
            }
            if (!this._isUTC && keepLocalTime) {
                localAdjust = getDateOffset(this);
            }
            this._offset = input;
            this._isUTC = true;
            if (localAdjust != null) {
                this.add(localAdjust, 'm');
            }
            if (offset !== input) {
                if (!keepLocalTime || this._changeInProgress) {
                    addSubtract(
                        this,
                        createDuration(input - offset, 'm'),
                        1,
                        false
                    );
                } else if (!this._changeInProgress) {
                    this._changeInProgress = true;
                    hooks.updateOffset(this, true);
                    this._changeInProgress = null;
                }
            }
            return this;
        } else {
            return this._isUTC ? offset : getDateOffset(this);
        }
    }

    function getSetZone(input, keepLocalTime) {
        if (input != null) {
            if (typeof input !== 'string') {
                input = -input;
            }

            this.utcOffset(input, keepLocalTime);

            return this;
        } else {
            return -this.utcOffset();
        }
    }

    function setOffsetToUTC(keepLocalTime) {
        return this.utcOffset(0, keepLocalTime);
    }

    function setOffsetToLocal(keepLocalTime) {
        if (this._isUTC) {
            this.utcOffset(0, keepLocalTime);
            this._isUTC = false;

            if (keepLocalTime) {
                this.subtract(getDateOffset(this), 'm');
            }
        }
        return this;
    }

    function setOffsetToParsedOffset() {
        if (this._tzm != null) {
            this.utcOffset(this._tzm, false, true);
        } else if (typeof this._i === 'string') {
            var tZone = offsetFromString(matchOffset, this._i);
            if (tZone != null) {
                this.utcOffset(tZone);
            } else {
                this.utcOffset(0, true);
            }
        }
        return this;
    }

    function hasAlignedHourOffset(input) {
        if (!this.isValid()) {
            return false;
        }
        input = input ? createLocal(input).utcOffset() : 0;

        return (this.utcOffset() - input) % 60 === 0;
    }

    function isDaylightSavingTime() {
        return (
            this.utcOffset() > this.clone().month(0).utcOffset() ||
            this.utcOffset() > this.clone().month(5).utcOffset()
        );
    }

    function isDaylightSavingTimeShifted() {
        if (!isUndefined(this._isDSTShifted)) {
            return this._isDSTShifted;
        }

        var c = {},
            other;

        copyConfig(c, this);
        c = prepareConfig(c);

        if (c._a) {
            other = c._isUTC ? createUTC(c._a) : createLocal(c._a);
            this._isDSTShifted =
                this.isValid() && compareArrays(c._a, other.toArray()) > 0;
        } else {
            this._isDSTShifted = false;
        }

        return this._isDSTShifted;
    }

    function isLocal() {
        return this.isValid() ? !this._isUTC : false;
    }

    function isUtcOffset() {
        return this.isValid() ? this._isUTC : false;
    }

    function isUtc() {
        return this.isValid() ? this._isUTC && this._offset === 0 : false;
    }

    // ASP.NET json date format regex
    var aspNetRegex = /^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,
        // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
        // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
        // and further modified to allow for strings containing both week and day
        isoRegex =
            /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;

    function createDuration(input, key) {
        var duration = input,
            // matching against regexp is expensive, do it on demand
            match = null,
            sign,
            ret,
            diffRes;

        if (isDuration(input)) {
            duration = {
                ms: input._milliseconds,
                d: input._days,
                M: input._months,
            };
        } else if (isNumber(input) || !isNaN(+input)) {
            duration = {};
            if (key) {
                duration[key] = +input;
            } else {
                duration.milliseconds = +input;
            }
        } else if ((match = aspNetRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: 0,
                d: toInt(match[DATE]) * sign,
                h: toInt(match[HOUR]) * sign,
                m: toInt(match[MINUTE]) * sign,
                s: toInt(match[SECOND]) * sign,
                ms: toInt(absRound(match[MILLISECOND] * 1000)) * sign, // the millisecond decimal point is included in the match
            };
        } else if ((match = isoRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: parseIso(match[2], sign),
                M: parseIso(match[3], sign),
                w: parseIso(match[4], sign),
                d: parseIso(match[5], sign),
                h: parseIso(match[6], sign),
                m: parseIso(match[7], sign),
                s: parseIso(match[8], sign),
            };
        } else if (duration == null) {
            // checks for null or undefined
            duration = {};
        } else if (
            typeof duration === 'object' &&
            ('from' in duration || 'to' in duration)
        ) {
            diffRes = momentsDifference(
                createLocal(duration.from),
                createLocal(duration.to)
            );

            duration = {};
            duration.ms = diffRes.milliseconds;
            duration.M = diffRes.months;
        }

        ret = new Duration(duration);

        if (isDuration(input) && hasOwnProp(input, '_locale')) {
            ret._locale = input._locale;
        }

        if (isDuration(input) && hasOwnProp(input, '_isValid')) {
            ret._isValid = input._isValid;
        }

        return ret;
    }

    createDuration.fn = Duration.prototype;
    createDuration.invalid = createInvalid$1;

    function parseIso(inp, sign) {
        // We'd normally use ~~inp for this, but unfortunately it also
        // converts floats to ints.
        // inp may be undefined, so careful calling replace on it.
        var res = inp && parseFloat(inp.replace(',', '.'));
        // apply sign while we're at it
        return (isNaN(res) ? 0 : res) * sign;
    }

    function positiveMomentsDifference(base, other) {
        var res = {};

        res.months =
            other.month() - base.month() + (other.year() - base.year()) * 12;
        if (base.clone().add(res.months, 'M').isAfter(other)) {
            --res.months;
        }

        res.milliseconds = +other - +base.clone().add(res.months, 'M');

        return res;
    }

    function momentsDifference(base, other) {
        var res;
        if (!(base.isValid() && other.isValid())) {
            return { milliseconds: 0, months: 0 };
        }

        other = cloneWithOffset(other, base);
        if (base.isBefore(other)) {
            res = positiveMomentsDifference(base, other);
        } else {
            res = positiveMomentsDifference(other, base);
            res.milliseconds = -res.milliseconds;
            res.months = -res.months;
        }

        return res;
    }

    // TODO: remove 'name' arg after deprecation is removed
    function createAdder(direction, name) {
        return function (val, period) {
            var dur, tmp;
            //invert the arguments, but complain about it
            if (period !== null && !isNaN(+period)) {
                deprecateSimple(
                    name,
                    'moment().' +
                        name +
                        '(period, number) is deprecated. Please use moment().' +
                        name +
                        '(number, period). ' +
                        'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.'
                );
                tmp = val;
                val = period;
                period = tmp;
            }

            dur = createDuration(val, period);
            addSubtract(this, dur, direction);
            return this;
        };
    }

    function addSubtract(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds,
            days = absRound(duration._days),
            months = absRound(duration._months);

        if (!mom.isValid()) {
            // No op
            return;
        }

        updateOffset = updateOffset == null ? true : updateOffset;

        if (months) {
            setMonth(mom, get(mom, 'Month') + months * isAdding);
        }
        if (days) {
            set$1(mom, 'Date', get(mom, 'Date') + days * isAdding);
        }
        if (milliseconds) {
            mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);
        }
        if (updateOffset) {
            hooks.updateOffset(mom, days || months);
        }
    }

    var add = createAdder(1, 'add'),
        subtract = createAdder(-1, 'subtract');

    function isString(input) {
        return typeof input === 'string' || input instanceof String;
    }

    // type MomentInput = Moment | Date | string | number | (number | string)[] | MomentInputObject | void; // null | undefined
    function isMomentInput(input) {
        return (
            isMoment(input) ||
            isDate(input) ||
            isString(input) ||
            isNumber(input) ||
            isNumberOrStringArray(input) ||
            isMomentInputObject(input) ||
            input === null ||
            input === undefined
        );
    }

    function isMomentInputObject(input) {
        var objectTest = isObject(input) && !isObjectEmpty(input),
            propertyTest = false,
            properties = [
                'years',
                'year',
                'y',
                'months',
                'month',
                'M',
                'days',
                'day',
                'd',
                'dates',
                'date',
                'D',
                'hours',
                'hour',
                'h',
                'minutes',
                'minute',
                'm',
                'seconds',
                'second',
                's',
                'milliseconds',
                'millisecond',
                'ms',
            ],
            i,
            property,
            propertyLen = properties.length;

        for (i = 0; i < propertyLen; i += 1) {
            property = properties[i];
            propertyTest = propertyTest || hasOwnProp(input, property);
        }

        return objectTest && propertyTest;
    }

    function isNumberOrStringArray(input) {
        var arrayTest = isArray(input),
            dataTypeTest = false;
        if (arrayTest) {
            dataTypeTest =
                input.filter(function (item) {
                    return !isNumber(item) && isString(input);
                }).length === 0;
        }
        return arrayTest && dataTypeTest;
    }

    function isCalendarSpec(input) {
        var objectTest = isObject(input) && !isObjectEmpty(input),
            propertyTest = false,
            properties = [
                'sameDay',
                'nextDay',
                'lastDay',
                'nextWeek',
                'lastWeek',
                'sameElse',
            ],
            i,
            property;

        for (i = 0; i < properties.length; i += 1) {
            property = properties[i];
            propertyTest = propertyTest || hasOwnProp(input, property);
        }

        return objectTest && propertyTest;
    }

    function getCalendarFormat(myMoment, now) {
        var diff = myMoment.diff(now, 'days', true);
        return diff < -6
            ? 'sameElse'
            : diff < -1
            ? 'lastWeek'
            : diff < 0
            ? 'lastDay'
            : diff < 1
            ? 'sameDay'
            : diff < 2
            ? 'nextDay'
            : diff < 7
            ? 'nextWeek'
            : 'sameElse';
    }

    function calendar$1(time, formats) {
        // Support for single parameter, formats only overload to the calendar function
        if (arguments.length === 1) {
            if (!arguments[0]) {
                time = undefined;
                formats = undefined;
            } else if (isMomentInput(arguments[0])) {
                time = arguments[0];
                formats = undefined;
            } else if (isCalendarSpec(arguments[0])) {
                formats = arguments[0];
                time = undefined;
            }
        }
        // We want to compare the start of today, vs this.
        // Getting start-of-today depends on whether we're local/utc/offset or not.
        var now = time || createLocal(),
            sod = cloneWithOffset(now, this).startOf('day'),
            format = hooks.calendarFormat(this, sod) || 'sameElse',
            output =
                formats &&
                (isFunction(formats[format])
                    ? formats[format].call(this, now)
                    : formats[format]);

        return this.format(
            output || this.localeData().calendar(format, this, createLocal(now))
        );
    }

    function clone() {
        return new Moment(this);
    }

    function isAfter(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() > localInput.valueOf();
        } else {
            return localInput.valueOf() < this.clone().startOf(units).valueOf();
        }
    }

    function isBefore(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() < localInput.valueOf();
        } else {
            return this.clone().endOf(units).valueOf() < localInput.valueOf();
        }
    }

    function isBetween(from, to, units, inclusivity) {
        var localFrom = isMoment(from) ? from : createLocal(from),
            localTo = isMoment(to) ? to : createLocal(to);
        if (!(this.isValid() && localFrom.isValid() && localTo.isValid())) {
            return false;
        }
        inclusivity = inclusivity || '()';
        return (
            (inclusivity[0] === '('
                ? this.isAfter(localFrom, units)
                : !this.isBefore(localFrom, units)) &&
            (inclusivity[1] === ')'
                ? this.isBefore(localTo, units)
                : !this.isAfter(localTo, units))
        );
    }

    function isSame(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input),
            inputMs;
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() === localInput.valueOf();
        } else {
            inputMs = localInput.valueOf();
            return (
                this.clone().startOf(units).valueOf() <= inputMs &&
                inputMs <= this.clone().endOf(units).valueOf()
            );
        }
    }

    function isSameOrAfter(input, units) {
        return this.isSame(input, units) || this.isAfter(input, units);
    }

    function isSameOrBefore(input, units) {
        return this.isSame(input, units) || this.isBefore(input, units);
    }

    function diff(input, units, asFloat) {
        var that, zoneDelta, output;

        if (!this.isValid()) {
            return NaN;
        }

        that = cloneWithOffset(input, this);

        if (!that.isValid()) {
            return NaN;
        }

        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;

        units = normalizeUnits(units);

        switch (units) {
            case 'year':
                output = monthDiff(this, that) / 12;
                break;
            case 'month':
                output = monthDiff(this, that);
                break;
            case 'quarter':
                output = monthDiff(this, that) / 3;
                break;
            case 'second':
                output = (this - that) / 1e3;
                break; // 1000
            case 'minute':
                output = (this - that) / 6e4;
                break; // 1000 * 60
            case 'hour':
                output = (this - that) / 36e5;
                break; // 1000 * 60 * 60
            case 'day':
                output = (this - that - zoneDelta) / 864e5;
                break; // 1000 * 60 * 60 * 24, negate dst
            case 'week':
                output = (this - that - zoneDelta) / 6048e5;
                break; // 1000 * 60 * 60 * 24 * 7, negate dst
            default:
                output = this - that;
        }

        return asFloat ? output : absFloor(output);
    }

    function monthDiff(a, b) {
        if (a.date() < b.date()) {
            // end-of-month calculations work correct when the start month has more
            // days than the end month.
            return -monthDiff(b, a);
        }
        // difference in months
        var wholeMonthDiff = (b.year() - a.year()) * 12 + (b.month() - a.month()),
            // b is in (anchor - 1 month, anchor + 1 month)
            anchor = a.clone().add(wholeMonthDiff, 'months'),
            anchor2,
            adjust;

        if (b - anchor < 0) {
            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor - anchor2);
        } else {
            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor2 - anchor);
        }

        //check for negative zero, return zero if negative zero
        return -(wholeMonthDiff + adjust) || 0;
    }

    hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';
    hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';

    function toString() {
        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
    }

    function toISOString(keepOffset) {
        if (!this.isValid()) {
            return null;
        }
        var utc = keepOffset !== true,
            m = utc ? this.clone().utc() : this;
        if (m.year() < 0 || m.year() > 9999) {
            return formatMoment(
                m,
                utc
                    ? 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]'
                    : 'YYYYYY-MM-DD[T]HH:mm:ss.SSSZ'
            );
        }
        if (isFunction(Date.prototype.toISOString)) {
            // native implementation is ~50x faster, use it when we can
            if (utc) {
                return this.toDate().toISOString();
            } else {
                return new Date(this.valueOf() + this.utcOffset() * 60 * 1000)
                    .toISOString()
                    .replace('Z', formatMoment(m, 'Z'));
            }
        }
        return formatMoment(
            m,
            utc ? 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]' : 'YYYY-MM-DD[T]HH:mm:ss.SSSZ'
        );
    }

    /**
     * Return a human readable representation of a moment that can
     * also be evaluated to get a new moment which is the same
     *
     * @link https://nodejs.org/dist/latest/docs/api/util.html#util_custom_inspect_function_on_objects
     */
    function inspect() {
        if (!this.isValid()) {
            return 'moment.invalid(/* ' + this._i + ' */)';
        }
        var func = 'moment',
            zone = '',
            prefix,
            year,
            datetime,
            suffix;
        if (!this.isLocal()) {
            func = this.utcOffset() === 0 ? 'moment.utc' : 'moment.parseZone';
            zone = 'Z';
        }
        prefix = '[' + func + '("]';
        year = 0 <= this.year() && this.year() <= 9999 ? 'YYYY' : 'YYYYYY';
        datetime = '-MM-DD[T]HH:mm:ss.SSS';
        suffix = zone + '[")]';

        return this.format(prefix + year + datetime + suffix);
    }

    function format(inputString) {
        if (!inputString) {
            inputString = this.isUtc()
                ? hooks.defaultFormatUtc
                : hooks.defaultFormat;
        }
        var output = formatMoment(this, inputString);
        return this.localeData().postformat(output);
    }

    function from(time, withoutSuffix) {
        if (
            this.isValid() &&
            ((isMoment(time) && time.isValid()) || createLocal(time).isValid())
        ) {
            return createDuration({ to: this, from: time })
                .locale(this.locale())
                .humanize(!withoutSuffix);
        } else {
            return this.localeData().invalidDate();
        }
    }

    function fromNow(withoutSuffix) {
        return this.from(createLocal(), withoutSuffix);
    }

    function to(time, withoutSuffix) {
        if (
            this.isValid() &&
            ((isMoment(time) && time.isValid()) || createLocal(time).isValid())
        ) {
            return createDuration({ from: this, to: time })
                .locale(this.locale())
                .humanize(!withoutSuffix);
        } else {
            return this.localeData().invalidDate();
        }
    }

    function toNow(withoutSuffix) {
        return this.to(createLocal(), withoutSuffix);
    }

    // If passed a locale key, it will set the locale for this
    // instance.  Otherwise, it will return the locale configuration
    // variables for this instance.
    function locale(key) {
        var newLocaleData;

        if (key === undefined) {
            return this._locale._abbr;
        } else {
            newLocaleData = getLocale(key);
            if (newLocaleData != null) {
                this._locale = newLocaleData;
            }
            return this;
        }
    }

    var lang = deprecate(
        'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',
        function (key) {
            if (key === undefined) {
                return this.localeData();
            } else {
                return this.locale(key);
            }
        }
    );

    function localeData() {
        return this._locale;
    }

    var MS_PER_SECOND = 1000,
        MS_PER_MINUTE = 60 * MS_PER_SECOND,
        MS_PER_HOUR = 60 * MS_PER_MINUTE,
        MS_PER_400_YEARS = (365 * 400 + 97) * 24 * MS_PER_HOUR;

    // actual modulo - handles negative numbers (for dates before 1970):
    function mod$1(dividend, divisor) {
        return ((dividend % divisor) + divisor) % divisor;
    }

    function localStartOfDate(y, m, d) {
        // the date constructor remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            return new Date(y + 400, m, d) - MS_PER_400_YEARS;
        } else {
            return new Date(y, m, d).valueOf();
        }
    }

    function utcStartOfDate(y, m, d) {
        // Date.UTC remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            return Date.UTC(y + 400, m, d) - MS_PER_400_YEARS;
        } else {
            return Date.UTC(y, m, d);
        }
    }

    function startOf(units) {
        var time, startOfDate;
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond' || !this.isValid()) {
            return this;
        }

        startOfDate = this._isUTC ? utcStartOfDate : localStartOfDate;

        switch (units) {
            case 'year':
                time = startOfDate(this.year(), 0, 1);
                break;
            case 'quarter':
                time = startOfDate(
                    this.year(),
                    this.month() - (this.month() % 3),
                    1
                );
                break;
            case 'month':
                time = startOfDate(this.year(), this.month(), 1);
                break;
            case 'week':
                time = startOfDate(
                    this.year(),
                    this.month(),
                    this.date() - this.weekday()
                );
                break;
            case 'isoWeek':
                time = startOfDate(
                    this.year(),
                    this.month(),
                    this.date() - (this.isoWeekday() - 1)
                );
                break;
            case 'day':
            case 'date':
                time = startOfDate(this.year(), this.month(), this.date());
                break;
            case 'hour':
                time = this._d.valueOf();
                time -= mod$1(
                    time + (this._isUTC ? 0 : this.utcOffset() * MS_PER_MINUTE),
                    MS_PER_HOUR
                );
                break;
            case 'minute':
                time = this._d.valueOf();
                time -= mod$1(time, MS_PER_MINUTE);
                break;
            case 'second':
                time = this._d.valueOf();
                time -= mod$1(time, MS_PER_SECOND);
                break;
        }

        this._d.setTime(time);
        hooks.updateOffset(this, true);
        return this;
    }

    function endOf(units) {
        var time, startOfDate;
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond' || !this.isValid()) {
            return this;
        }

        startOfDate = this._isUTC ? utcStartOfDate : localStartOfDate;

        switch (units) {
            case 'year':
                time = startOfDate(this.year() + 1, 0, 1) - 1;
                break;
            case 'quarter':
                time =
                    startOfDate(
                        this.year(),
                        this.month() - (this.month() % 3) + 3,
                        1
                    ) - 1;
                break;
            case 'month':
                time = startOfDate(this.year(), this.month() + 1, 1) - 1;
                break;
            case 'week':
                time =
                    startOfDate(
                        this.year(),
                        this.month(),
                        this.date() - this.weekday() + 7
                    ) - 1;
                break;
            case 'isoWeek':
                time =
                    startOfDate(
                        this.year(),
                        this.month(),
                        this.date() - (this.isoWeekday() - 1) + 7
                    ) - 1;
                break;
            case 'day':
            case 'date':
                time = startOfDate(this.year(), this.month(), this.date() + 1) - 1;
                break;
            case 'hour':
                time = this._d.valueOf();
                time +=
                    MS_PER_HOUR -
                    mod$1(
                        time + (this._isUTC ? 0 : this.utcOffset() * MS_PER_MINUTE),
                        MS_PER_HOUR
                    ) -
                    1;
                break;
            case 'minute':
                time = this._d.valueOf();
                time += MS_PER_MINUTE - mod$1(time, MS_PER_MINUTE) - 1;
                break;
            case 'second':
                time = this._d.valueOf();
                time += MS_PER_SECOND - mod$1(time, MS_PER_SECOND) - 1;
                break;
        }

        this._d.setTime(time);
        hooks.updateOffset(this, true);
        return this;
    }

    function valueOf() {
        return this._d.valueOf() - (this._offset || 0) * 60000;
    }

    function unix() {
        return Math.floor(this.valueOf() / 1000);
    }

    function toDate() {
        return new Date(this.valueOf());
    }

    function toArray() {
        var m = this;
        return [
            m.year(),
            m.month(),
            m.date(),
            m.hour(),
            m.minute(),
            m.second(),
            m.millisecond(),
        ];
    }

    function toObject() {
        var m = this;
        return {
            years: m.year(),
            months: m.month(),
            date: m.date(),
            hours: m.hours(),
            minutes: m.minutes(),
            seconds: m.seconds(),
            milliseconds: m.milliseconds(),
        };
    }

    function toJSON() {
        // new Date(NaN).toJSON() === null
        return this.isValid() ? this.toISOString() : null;
    }

    function isValid$2() {
        return isValid(this);
    }

    function parsingFlags() {
        return extend({}, getParsingFlags(this));
    }

    function invalidAt() {
        return getParsingFlags(this).overflow;
    }

    function creationData() {
        return {
            input: this._i,
            format: this._f,
            locale: this._locale,
            isUTC: this._isUTC,
            strict: this._strict,
        };
    }

    addFormatToken('N', 0, 0, 'eraAbbr');
    addFormatToken('NN', 0, 0, 'eraAbbr');
    addFormatToken('NNN', 0, 0, 'eraAbbr');
    addFormatToken('NNNN', 0, 0, 'eraName');
    addFormatToken('NNNNN', 0, 0, 'eraNarrow');

    addFormatToken('y', ['y', 1], 'yo', 'eraYear');
    addFormatToken('y', ['yy', 2], 0, 'eraYear');
    addFormatToken('y', ['yyy', 3], 0, 'eraYear');
    addFormatToken('y', ['yyyy', 4], 0, 'eraYear');

    addRegexToken('N', matchEraAbbr);
    addRegexToken('NN', matchEraAbbr);
    addRegexToken('NNN', matchEraAbbr);
    addRegexToken('NNNN', matchEraName);
    addRegexToken('NNNNN', matchEraNarrow);

    addParseToken(
        ['N', 'NN', 'NNN', 'NNNN', 'NNNNN'],
        function (input, array, config, token) {
            var era = config._locale.erasParse(input, token, config._strict);
            if (era) {
                getParsingFlags(config).era = era;
            } else {
                getParsingFlags(config).invalidEra = input;
            }
        }
    );

    addRegexToken('y', matchUnsigned);
    addRegexToken('yy', matchUnsigned);
    addRegexToken('yyy', matchUnsigned);
    addRegexToken('yyyy', matchUnsigned);
    addRegexToken('yo', matchEraYearOrdinal);

    addParseToken(['y', 'yy', 'yyy', 'yyyy'], YEAR);
    addParseToken(['yo'], function (input, array, config, token) {
        var match;
        if (config._locale._eraYearOrdinalRegex) {
            match = input.match(config._locale._eraYearOrdinalRegex);
        }

        if (config._locale.eraYearOrdinalParse) {
            array[YEAR] = config._locale.eraYearOrdinalParse(input, match);
        } else {
            array[YEAR] = parseInt(input, 10);
        }
    });

    function localeEras(m, format) {
        var i,
            l,
            date,
            eras = this._eras || getLocale('en')._eras;
        for (i = 0, l = eras.length; i < l; ++i) {
            switch (typeof eras[i].since) {
                case 'string':
                    // truncate time
                    date = hooks(eras[i].since).startOf('day');
                    eras[i].since = date.valueOf();
                    break;
            }

            switch (typeof eras[i].until) {
                case 'undefined':
                    eras[i].until = +Infinity;
                    break;
                case 'string':
                    // truncate time
                    date = hooks(eras[i].until).startOf('day').valueOf();
                    eras[i].until = date.valueOf();
                    break;
            }
        }
        return eras;
    }

    function localeErasParse(eraName, format, strict) {
        var i,
            l,
            eras = this.eras(),
            name,
            abbr,
            narrow;
        eraName = eraName.toUpperCase();

        for (i = 0, l = eras.length; i < l; ++i) {
            name = eras[i].name.toUpperCase();
            abbr = eras[i].abbr.toUpperCase();
            narrow = eras[i].narrow.toUpperCase();

            if (strict) {
                switch (format) {
                    case 'N':
                    case 'NN':
                    case 'NNN':
                        if (abbr === eraName) {
                            return eras[i];
                        }
                        break;

                    case 'NNNN':
                        if (name === eraName) {
                            return eras[i];
                        }
                        break;

                    case 'NNNNN':
                        if (narrow === eraName) {
                            return eras[i];
                        }
                        break;
                }
            } else if ([name, abbr, narrow].indexOf(eraName) >= 0) {
                return eras[i];
            }
        }
    }

    function localeErasConvertYear(era, year) {
        var dir = era.since <= era.until ? +1 : -1;
        if (year === undefined) {
            return hooks(era.since).year();
        } else {
            return hooks(era.since).year() + (year - era.offset) * dir;
        }
    }

    function getEraName() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].name;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].name;
            }
        }

        return '';
    }

    function getEraNarrow() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].narrow;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].narrow;
            }
        }

        return '';
    }

    function getEraAbbr() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].abbr;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].abbr;
            }
        }

        return '';
    }

    function getEraYear() {
        var i,
            l,
            dir,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            dir = eras[i].since <= eras[i].until ? +1 : -1;

            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (
                (eras[i].since <= val && val <= eras[i].until) ||
                (eras[i].until <= val && val <= eras[i].since)
            ) {
                return (
                    (this.year() - hooks(eras[i].since).year()) * dir +
                    eras[i].offset
                );
            }
        }

        return this.year();
    }

    function erasNameRegex(isStrict) {
        if (!hasOwnProp(this, '_erasNameRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasNameRegex : this._erasRegex;
    }

    function erasAbbrRegex(isStrict) {
        if (!hasOwnProp(this, '_erasAbbrRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasAbbrRegex : this._erasRegex;
    }

    function erasNarrowRegex(isStrict) {
        if (!hasOwnProp(this, '_erasNarrowRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasNarrowRegex : this._erasRegex;
    }

    function matchEraAbbr(isStrict, locale) {
        return locale.erasAbbrRegex(isStrict);
    }

    function matchEraName(isStrict, locale) {
        return locale.erasNameRegex(isStrict);
    }

    function matchEraNarrow(isStrict, locale) {
        return locale.erasNarrowRegex(isStrict);
    }

    function matchEraYearOrdinal(isStrict, locale) {
        return locale._eraYearOrdinalRegex || matchUnsigned;
    }

    function computeErasParse() {
        var abbrPieces = [],
            namePieces = [],
            narrowPieces = [],
            mixedPieces = [],
            i,
            l,
            eras = this.eras();

        for (i = 0, l = eras.length; i < l; ++i) {
            namePieces.push(regexEscape(eras[i].name));
            abbrPieces.push(regexEscape(eras[i].abbr));
            narrowPieces.push(regexEscape(eras[i].narrow));

            mixedPieces.push(regexEscape(eras[i].name));
            mixedPieces.push(regexEscape(eras[i].abbr));
            mixedPieces.push(regexEscape(eras[i].narrow));
        }

        this._erasRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._erasNameRegex = new RegExp('^(' + namePieces.join('|') + ')', 'i');
        this._erasAbbrRegex = new RegExp('^(' + abbrPieces.join('|') + ')', 'i');
        this._erasNarrowRegex = new RegExp(
            '^(' + narrowPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    addFormatToken(0, ['gg', 2], 0, function () {
        return this.weekYear() % 100;
    });

    addFormatToken(0, ['GG', 2], 0, function () {
        return this.isoWeekYear() % 100;
    });

    function addWeekYearFormatToken(token, getter) {
        addFormatToken(0, [token, token.length], 0, getter);
    }

    addWeekYearFormatToken('gggg', 'weekYear');
    addWeekYearFormatToken('ggggg', 'weekYear');
    addWeekYearFormatToken('GGGG', 'isoWeekYear');
    addWeekYearFormatToken('GGGGG', 'isoWeekYear');

    // ALIASES

    addUnitAlias('weekYear', 'gg');
    addUnitAlias('isoWeekYear', 'GG');

    // PRIORITY

    addUnitPriority('weekYear', 1);
    addUnitPriority('isoWeekYear', 1);

    // PARSING

    addRegexToken('G', matchSigned);
    addRegexToken('g', matchSigned);
    addRegexToken('GG', match1to2, match2);
    addRegexToken('gg', match1to2, match2);
    addRegexToken('GGGG', match1to4, match4);
    addRegexToken('gggg', match1to4, match4);
    addRegexToken('GGGGG', match1to6, match6);
    addRegexToken('ggggg', match1to6, match6);

    addWeekParseToken(
        ['gggg', 'ggggg', 'GGGG', 'GGGGG'],
        function (input, week, config, token) {
            week[token.substr(0, 2)] = toInt(input);
        }
    );

    addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {
        week[token] = hooks.parseTwoDigitYear(input);
    });

    // MOMENTS

    function getSetWeekYear(input) {
        return getSetWeekYearHelper.call(
            this,
            input,
            this.week(),
            this.weekday(),
            this.localeData()._week.dow,
            this.localeData()._week.doy
        );
    }

    function getSetISOWeekYear(input) {
        return getSetWeekYearHelper.call(
            this,
            input,
            this.isoWeek(),
            this.isoWeekday(),
            1,
            4
        );
    }

    function getISOWeeksInYear() {
        return weeksInYear(this.year(), 1, 4);
    }

    function getISOWeeksInISOWeekYear() {
        return weeksInYear(this.isoWeekYear(), 1, 4);
    }

    function getWeeksInYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
    }

    function getWeeksInWeekYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.weekYear(), weekInfo.dow, weekInfo.doy);
    }

    function getSetWeekYearHelper(input, week, weekday, dow, doy) {
        var weeksTarget;
        if (input == null) {
            return weekOfYear(this, dow, doy).year;
        } else {
            weeksTarget = weeksInYear(input, dow, doy);
            if (week > weeksTarget) {
                week = weeksTarget;
            }
            return setWeekAll.call(this, input, week, weekday, dow, doy);
        }
    }

    function setWeekAll(weekYear, week, weekday, dow, doy) {
        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),
            date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);

        this.year(date.getUTCFullYear());
        this.month(date.getUTCMonth());
        this.date(date.getUTCDate());
        return this;
    }

    // FORMATTING

    addFormatToken('Q', 0, 'Qo', 'quarter');

    // ALIASES

    addUnitAlias('quarter', 'Q');

    // PRIORITY

    addUnitPriority('quarter', 7);

    // PARSING

    addRegexToken('Q', match1);
    addParseToken('Q', function (input, array) {
        array[MONTH] = (toInt(input) - 1) * 3;
    });

    // MOMENTS

    function getSetQuarter(input) {
        return input == null
            ? Math.ceil((this.month() + 1) / 3)
            : this.month((input - 1) * 3 + (this.month() % 3));
    }

    // FORMATTING

    addFormatToken('D', ['DD', 2], 'Do', 'date');

    // ALIASES

    addUnitAlias('date', 'D');

    // PRIORITY
    addUnitPriority('date', 9);

    // PARSING

    addRegexToken('D', match1to2);
    addRegexToken('DD', match1to2, match2);
    addRegexToken('Do', function (isStrict, locale) {
        // TODO: Remove "ordinalParse" fallback in next major release.
        return isStrict
            ? locale._dayOfMonthOrdinalParse || locale._ordinalParse
            : locale._dayOfMonthOrdinalParseLenient;
    });

    addParseToken(['D', 'DD'], DATE);
    addParseToken('Do', function (input, array) {
        array[DATE] = toInt(input.match(match1to2)[0]);
    });

    // MOMENTS

    var getSetDayOfMonth = makeGetSet('Date', true);

    // FORMATTING

    addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');

    // ALIASES

    addUnitAlias('dayOfYear', 'DDD');

    // PRIORITY
    addUnitPriority('dayOfYear', 4);

    // PARSING

    addRegexToken('DDD', match1to3);
    addRegexToken('DDDD', match3);
    addParseToken(['DDD', 'DDDD'], function (input, array, config) {
        config._dayOfYear = toInt(input);
    });

    // HELPERS

    // MOMENTS

    function getSetDayOfYear(input) {
        var dayOfYear =
            Math.round(
                (this.clone().startOf('day') - this.clone().startOf('year')) / 864e5
            ) + 1;
        return input == null ? dayOfYear : this.add(input - dayOfYear, 'd');
    }

    // FORMATTING

    addFormatToken('m', ['mm', 2], 0, 'minute');

    // ALIASES

    addUnitAlias('minute', 'm');

    // PRIORITY

    addUnitPriority('minute', 14);

    // PARSING

    addRegexToken('m', match1to2);
    addRegexToken('mm', match1to2, match2);
    addParseToken(['m', 'mm'], MINUTE);

    // MOMENTS

    var getSetMinute = makeGetSet('Minutes', false);

    // FORMATTING

    addFormatToken('s', ['ss', 2], 0, 'second');

    // ALIASES

    addUnitAlias('second', 's');

    // PRIORITY

    addUnitPriority('second', 15);

    // PARSING

    addRegexToken('s', match1to2);
    addRegexToken('ss', match1to2, match2);
    addParseToken(['s', 'ss'], SECOND);

    // MOMENTS

    var getSetSecond = makeGetSet('Seconds', false);

    // FORMATTING

    addFormatToken('S', 0, 0, function () {
        return ~~(this.millisecond() / 100);
    });

    addFormatToken(0, ['SS', 2], 0, function () {
        return ~~(this.millisecond() / 10);
    });

    addFormatToken(0, ['SSS', 3], 0, 'millisecond');
    addFormatToken(0, ['SSSS', 4], 0, function () {
        return this.millisecond() * 10;
    });
    addFormatToken(0, ['SSSSS', 5], 0, function () {
        return this.millisecond() * 100;
    });
    addFormatToken(0, ['SSSSSS', 6], 0, function () {
        return this.millisecond() * 1000;
    });
    addFormatToken(0, ['SSSSSSS', 7], 0, function () {
        return this.millisecond() * 10000;
    });
    addFormatToken(0, ['SSSSSSSS', 8], 0, function () {
        return this.millisecond() * 100000;
    });
    addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {
        return this.millisecond() * 1000000;
    });

    // ALIASES

    addUnitAlias('millisecond', 'ms');

    // PRIORITY

    addUnitPriority('millisecond', 16);

    // PARSING

    addRegexToken('S', match1to3, match1);
    addRegexToken('SS', match1to3, match2);
    addRegexToken('SSS', match1to3, match3);

    var token, getSetMillisecond;
    for (token = 'SSSS'; token.length <= 9; token += 'S') {
        addRegexToken(token, matchUnsigned);
    }

    function parseMs(input, array) {
        array[MILLISECOND] = toInt(('0.' + input) * 1000);
    }

    for (token = 'S'; token.length <= 9; token += 'S') {
        addParseToken(token, parseMs);
    }

    getSetMillisecond = makeGetSet('Milliseconds', false);

    // FORMATTING

    addFormatToken('z', 0, 0, 'zoneAbbr');
    addFormatToken('zz', 0, 0, 'zoneName');

    // MOMENTS

    function getZoneAbbr() {
        return this._isUTC ? 'UTC' : '';
    }

    function getZoneName() {
        return this._isUTC ? 'Coordinated Universal Time' : '';
    }

    var proto = Moment.prototype;

    proto.add = add;
    proto.calendar = calendar$1;
    proto.clone = clone;
    proto.diff = diff;
    proto.endOf = endOf;
    proto.format = format;
    proto.from = from;
    proto.fromNow = fromNow;
    proto.to = to;
    proto.toNow = toNow;
    proto.get = stringGet;
    proto.invalidAt = invalidAt;
    proto.isAfter = isAfter;
    proto.isBefore = isBefore;
    proto.isBetween = isBetween;
    proto.isSame = isSame;
    proto.isSameOrAfter = isSameOrAfter;
    proto.isSameOrBefore = isSameOrBefore;
    proto.isValid = isValid$2;
    proto.lang = lang;
    proto.locale = locale;
    proto.localeData = localeData;
    proto.max = prototypeMax;
    proto.min = prototypeMin;
    proto.parsingFlags = parsingFlags;
    proto.set = stringSet;
    proto.startOf = startOf;
    proto.subtract = subtract;
    proto.toArray = toArray;
    proto.toObject = toObject;
    proto.toDate = toDate;
    proto.toISOString = toISOString;
    proto.inspect = inspect;
    if (typeof Symbol !== 'undefined' && Symbol.for != null) {
        proto[Symbol.for('nodejs.util.inspect.custom')] = function () {
            return 'Moment<' + this.format() + '>';
        };
    }
    proto.toJSON = toJSON;
    proto.toString = toString;
    proto.unix = unix;
    proto.valueOf = valueOf;
    proto.creationData = creationData;
    proto.eraName = getEraName;
    proto.eraNarrow = getEraNarrow;
    proto.eraAbbr = getEraAbbr;
    proto.eraYear = getEraYear;
    proto.year = getSetYear;
    proto.isLeapYear = getIsLeapYear;
    proto.weekYear = getSetWeekYear;
    proto.isoWeekYear = getSetISOWeekYear;
    proto.quarter = proto.quarters = getSetQuarter;
    proto.month = getSetMonth;
    proto.daysInMonth = getDaysInMonth;
    proto.week = proto.weeks = getSetWeek;
    proto.isoWeek = proto.isoWeeks = getSetISOWeek;
    proto.weeksInYear = getWeeksInYear;
    proto.weeksInWeekYear = getWeeksInWeekYear;
    proto.isoWeeksInYear = getISOWeeksInYear;
    proto.isoWeeksInISOWeekYear = getISOWeeksInISOWeekYear;
    proto.date = getSetDayOfMonth;
    proto.day = proto.days = getSetDayOfWeek;
    proto.weekday = getSetLocaleDayOfWeek;
    proto.isoWeekday = getSetISODayOfWeek;
    proto.dayOfYear = getSetDayOfYear;
    proto.hour = proto.hours = getSetHour;
    proto.minute = proto.minutes = getSetMinute;
    proto.second = proto.seconds = getSetSecond;
    proto.millisecond = proto.milliseconds = getSetMillisecond;
    proto.utcOffset = getSetOffset;
    proto.utc = setOffsetToUTC;
    proto.local = setOffsetToLocal;
    proto.parseZone = setOffsetToParsedOffset;
    proto.hasAlignedHourOffset = hasAlignedHourOffset;
    proto.isDST = isDaylightSavingTime;
    proto.isLocal = isLocal;
    proto.isUtcOffset = isUtcOffset;
    proto.isUtc = isUtc;
    proto.isUTC = isUtc;
    proto.zoneAbbr = getZoneAbbr;
    proto.zoneName = getZoneName;
    proto.dates = deprecate(
        'dates accessor is deprecated. Use date instead.',
        getSetDayOfMonth
    );
    proto.months = deprecate(
        'months accessor is deprecated. Use month instead',
        getSetMonth
    );
    proto.years = deprecate(
        'years accessor is deprecated. Use year instead',
        getSetYear
    );
    proto.zone = deprecate(
        'moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/',
        getSetZone
    );
    proto.isDSTShifted = deprecate(
        'isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information',
        isDaylightSavingTimeShifted
    );

    function createUnix(input) {
        return createLocal(input * 1000);
    }

    function createInZone() {
        return createLocal.apply(null, arguments).parseZone();
    }

    function preParsePostFormat(string) {
        return string;
    }

    var proto$1 = Locale.prototype;

    proto$1.calendar = calendar;
    proto$1.longDateFormat = longDateFormat;
    proto$1.invalidDate = invalidDate;
    proto$1.ordinal = ordinal;
    proto$1.preparse = preParsePostFormat;
    proto$1.postformat = preParsePostFormat;
    proto$1.relativeTime = relativeTime;
    proto$1.pastFuture = pastFuture;
    proto$1.set = set;
    proto$1.eras = localeEras;
    proto$1.erasParse = localeErasParse;
    proto$1.erasConvertYear = localeErasConvertYear;
    proto$1.erasAbbrRegex = erasAbbrRegex;
    proto$1.erasNameRegex = erasNameRegex;
    proto$1.erasNarrowRegex = erasNarrowRegex;

    proto$1.months = localeMonths;
    proto$1.monthsShort = localeMonthsShort;
    proto$1.monthsParse = localeMonthsParse;
    proto$1.monthsRegex = monthsRegex;
    proto$1.monthsShortRegex = monthsShortRegex;
    proto$1.week = localeWeek;
    proto$1.firstDayOfYear = localeFirstDayOfYear;
    proto$1.firstDayOfWeek = localeFirstDayOfWeek;

    proto$1.weekdays = localeWeekdays;
    proto$1.weekdaysMin = localeWeekdaysMin;
    proto$1.weekdaysShort = localeWeekdaysShort;
    proto$1.weekdaysParse = localeWeekdaysParse;

    proto$1.weekdaysRegex = weekdaysRegex;
    proto$1.weekdaysShortRegex = weekdaysShortRegex;
    proto$1.weekdaysMinRegex = weekdaysMinRegex;

    proto$1.isPM = localeIsPM;
    proto$1.meridiem = localeMeridiem;

    function get$1(format, index, field, setter) {
        var locale = getLocale(),
            utc = createUTC().set(setter, index);
        return locale[field](utc, format);
    }

    function listMonthsImpl(format, index, field) {
        if (isNumber(format)) {
            index = format;
            format = undefined;
        }

        format = format || '';

        if (index != null) {
            return get$1(format, index, field, 'month');
        }

        var i,
            out = [];
        for (i = 0; i < 12; i++) {
            out[i] = get$1(format, i, field, 'month');
        }
        return out;
    }

    // ()
    // (5)
    // (fmt, 5)
    // (fmt)
    // (true)
    // (true, 5)
    // (true, fmt, 5)
    // (true, fmt)
    function listWeekdaysImpl(localeSorted, format, index, field) {
        if (typeof localeSorted === 'boolean') {
            if (isNumber(format)) {
                index = format;
                format = undefined;
            }

            format = format || '';
        } else {
            format = localeSorted;
            index = format;
            localeSorted = false;

            if (isNumber(format)) {
                index = format;
                format = undefined;
            }

            format = format || '';
        }

        var locale = getLocale(),
            shift = localeSorted ? locale._week.dow : 0,
            i,
            out = [];

        if (index != null) {
            return get$1(format, (index + shift) % 7, field, 'day');
        }

        for (i = 0; i < 7; i++) {
            out[i] = get$1(format, (i + shift) % 7, field, 'day');
        }
        return out;
    }

    function listMonths(format, index) {
        return listMonthsImpl(format, index, 'months');
    }

    function listMonthsShort(format, index) {
        return listMonthsImpl(format, index, 'monthsShort');
    }

    function listWeekdays(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdays');
    }

    function listWeekdaysShort(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');
    }

    function listWeekdaysMin(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');
    }

    getSetGlobalLocale('en', {
        eras: [
            {
                since: '0001-01-01',
                until: +Infinity,
                offset: 1,
                name: 'Anno Domini',
                narrow: 'AD',
                abbr: 'AD',
            },
            {
                since: '0000-12-31',
                until: -Infinity,
                offset: 1,
                name: 'Before Christ',
                narrow: 'BC',
                abbr: 'BC',
            },
        ],
        dayOfMonthOrdinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function (number) {
            var b = number % 10,
                output =
                    toInt((number % 100) / 10) === 1
                        ? 'th'
                        : b === 1
                        ? 'st'
                        : b === 2
                        ? 'nd'
                        : b === 3
                        ? 'rd'
                        : 'th';
            return number + output;
        },
    });

    // Side effect imports

    hooks.lang = deprecate(
        'moment.lang is deprecated. Use moment.locale instead.',
        getSetGlobalLocale
    );
    hooks.langData = deprecate(
        'moment.langData is deprecated. Use moment.localeData instead.',
        getLocale
    );

    var mathAbs = Math.abs;

    function abs() {
        var data = this._data;

        this._milliseconds = mathAbs(this._milliseconds);
        this._days = mathAbs(this._days);
        this._months = mathAbs(this._months);

        data.milliseconds = mathAbs(data.milliseconds);
        data.seconds = mathAbs(data.seconds);
        data.minutes = mathAbs(data.minutes);
        data.hours = mathAbs(data.hours);
        data.months = mathAbs(data.months);
        data.years = mathAbs(data.years);

        return this;
    }

    function addSubtract$1(duration, input, value, direction) {
        var other = createDuration(input, value);

        duration._milliseconds += direction * other._milliseconds;
        duration._days += direction * other._days;
        duration._months += direction * other._months;

        return duration._bubble();
    }

    // supports only 2.0-style add(1, 's') or add(duration)
    function add$1(input, value) {
        return addSubtract$1(this, input, value, 1);
    }

    // supports only 2.0-style subtract(1, 's') or subtract(duration)
    function subtract$1(input, value) {
        return addSubtract$1(this, input, value, -1);
    }

    function absCeil(number) {
        if (number < 0) {
            return Math.floor(number);
        } else {
            return Math.ceil(number);
        }
    }

    function bubble() {
        var milliseconds = this._milliseconds,
            days = this._days,
            months = this._months,
            data = this._data,
            seconds,
            minutes,
            hours,
            years,
            monthsFromDays;

        // if we have a mix of positive and negative values, bubble down first
        // check: https://github.com/moment/moment/issues/2166
        if (
            !(
                (milliseconds >= 0 && days >= 0 && months >= 0) ||
                (milliseconds <= 0 && days <= 0 && months <= 0)
            )
        ) {
            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
            days = 0;
            months = 0;
        }

        // The following code bubbles up values, see the tests for
        // examples of what that means.
        data.milliseconds = milliseconds % 1000;

        seconds = absFloor(milliseconds / 1000);
        data.seconds = seconds % 60;

        minutes = absFloor(seconds / 60);
        data.minutes = minutes % 60;

        hours = absFloor(minutes / 60);
        data.hours = hours % 24;

        days += absFloor(hours / 24);

        // convert days to months
        monthsFromDays = absFloor(daysToMonths(days));
        months += monthsFromDays;
        days -= absCeil(monthsToDays(monthsFromDays));

        // 12 months -> 1 year
        years = absFloor(months / 12);
        months %= 12;

        data.days = days;
        data.months = months;
        data.years = years;

        return this;
    }

    function daysToMonths(days) {
        // 400 years have 146097 days (taking into account leap year rules)
        // 400 years have 12 months === 4800
        return (days * 4800) / 146097;
    }

    function monthsToDays(months) {
        // the reverse of daysToMonths
        return (months * 146097) / 4800;
    }

    function as(units) {
        if (!this.isValid()) {
            return NaN;
        }
        var days,
            months,
            milliseconds = this._milliseconds;

        units = normalizeUnits(units);

        if (units === 'month' || units === 'quarter' || units === 'year') {
            days = this._days + milliseconds / 864e5;
            months = this._months + daysToMonths(days);
            switch (units) {
                case 'month':
                    return months;
                case 'quarter':
                    return months / 3;
                case 'year':
                    return months / 12;
            }
        } else {
            // handle milliseconds separately because of floating point math errors (issue #1867)
            days = this._days + Math.round(monthsToDays(this._months));
            switch (units) {
                case 'week':
                    return days / 7 + milliseconds / 6048e5;
                case 'day':
                    return days + milliseconds / 864e5;
                case 'hour':
                    return days * 24 + milliseconds / 36e5;
                case 'minute':
                    return days * 1440 + milliseconds / 6e4;
                case 'second':
                    return days * 86400 + milliseconds / 1000;
                // Math.floor prevents floating point math errors here
                case 'millisecond':
                    return Math.floor(days * 864e5) + milliseconds;
                default:
                    throw new Error('Unknown unit ' + units);
            }
        }
    }

    // TODO: Use this.as('ms')?
    function valueOf$1() {
        if (!this.isValid()) {
            return NaN;
        }
        return (
            this._milliseconds +
            this._days * 864e5 +
            (this._months % 12) * 2592e6 +
            toInt(this._months / 12) * 31536e6
        );
    }

    function makeAs(alias) {
        return function () {
            return this.as(alias);
        };
    }

    var asMilliseconds = makeAs('ms'),
        asSeconds = makeAs('s'),
        asMinutes = makeAs('m'),
        asHours = makeAs('h'),
        asDays = makeAs('d'),
        asWeeks = makeAs('w'),
        asMonths = makeAs('M'),
        asQuarters = makeAs('Q'),
        asYears = makeAs('y');

    function clone$1() {
        return createDuration(this);
    }

    function get$2(units) {
        units = normalizeUnits(units);
        return this.isValid() ? this[units + 's']() : NaN;
    }

    function makeGetter(name) {
        return function () {
            return this.isValid() ? this._data[name] : NaN;
        };
    }

    var milliseconds = makeGetter('milliseconds'),
        seconds = makeGetter('seconds'),
        minutes = makeGetter('minutes'),
        hours = makeGetter('hours'),
        days = makeGetter('days'),
        months = makeGetter('months'),
        years = makeGetter('years');

    function weeks() {
        return absFloor(this.days() / 7);
    }

    var round = Math.round,
        thresholds = {
            ss: 44, // a few seconds to seconds
            s: 45, // seconds to minute
            m: 45, // minutes to hour
            h: 22, // hours to day
            d: 26, // days to month/week
            w: null, // weeks to month
            M: 11, // months to year
        };

    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }

    function relativeTime$1(posNegDuration, withoutSuffix, thresholds, locale) {
        var duration = createDuration(posNegDuration).abs(),
            seconds = round(duration.as('s')),
            minutes = round(duration.as('m')),
            hours = round(duration.as('h')),
            days = round(duration.as('d')),
            months = round(duration.as('M')),
            weeks = round(duration.as('w')),
            years = round(duration.as('y')),
            a =
                (seconds <= thresholds.ss && ['s', seconds]) ||
                (seconds < thresholds.s && ['ss', seconds]) ||
                (minutes <= 1 && ['m']) ||
                (minutes < thresholds.m && ['mm', minutes]) ||
                (hours <= 1 && ['h']) ||
                (hours < thresholds.h && ['hh', hours]) ||
                (days <= 1 && ['d']) ||
                (days < thresholds.d && ['dd', days]);

        if (thresholds.w != null) {
            a =
                a ||
                (weeks <= 1 && ['w']) ||
                (weeks < thresholds.w && ['ww', weeks]);
        }
        a = a ||
            (months <= 1 && ['M']) ||
            (months < thresholds.M && ['MM', months]) ||
            (years <= 1 && ['y']) || ['yy', years];

        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a);
    }

    // This function allows you to set the rounding function for relative time strings
    function getSetRelativeTimeRounding(roundingFunction) {
        if (roundingFunction === undefined) {
            return round;
        }
        if (typeof roundingFunction === 'function') {
            round = roundingFunction;
            return true;
        }
        return false;
    }

    // This function allows you to set a threshold for relative time strings
    function getSetRelativeTimeThreshold(threshold, limit) {
        if (thresholds[threshold] === undefined) {
            return false;
        }
        if (limit === undefined) {
            return thresholds[threshold];
        }
        thresholds[threshold] = limit;
        if (threshold === 's') {
            thresholds.ss = limit - 1;
        }
        return true;
    }

    function humanize(argWithSuffix, argThresholds) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }

        var withSuffix = false,
            th = thresholds,
            locale,
            output;

        if (typeof argWithSuffix === 'object') {
            argThresholds = argWithSuffix;
            argWithSuffix = false;
        }
        if (typeof argWithSuffix === 'boolean') {
            withSuffix = argWithSuffix;
        }
        if (typeof argThresholds === 'object') {
            th = Object.assign({}, thresholds, argThresholds);
            if (argThresholds.s != null && argThresholds.ss == null) {
                th.ss = argThresholds.s - 1;
            }
        }

        locale = this.localeData();
        output = relativeTime$1(this, !withSuffix, th, locale);

        if (withSuffix) {
            output = locale.pastFuture(+this, output);
        }

        return locale.postformat(output);
    }

    var abs$1 = Math.abs;

    function sign(x) {
        return (x > 0) - (x < 0) || +x;
    }

    function toISOString$1() {
        // for ISO strings we do not use the normal bubbling rules:
        //  * milliseconds bubble up until they become hours
        //  * days do not bubble at all
        //  * months bubble up until they become years
        // This is because there is no context-free conversion between hours and days
        // (think of clock changes)
        // and also not between days and months (28-31 days per month)
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }

        var seconds = abs$1(this._milliseconds) / 1000,
            days = abs$1(this._days),
            months = abs$1(this._months),
            minutes,
            hours,
            years,
            s,
            total = this.asSeconds(),
            totalSign,
            ymSign,
            daysSign,
            hmsSign;

        if (!total) {
            // this is the same as C#'s (Noda) and python (isodate)...
            // but not other JS (goog.date)
            return 'P0D';
        }

        // 3600 seconds -> 60 minutes -> 1 hour
        minutes = absFloor(seconds / 60);
        hours = absFloor(minutes / 60);
        seconds %= 60;
        minutes %= 60;

        // 12 months -> 1 year
        years = absFloor(months / 12);
        months %= 12;

        // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
        s = seconds ? seconds.toFixed(3).replace(/\.?0+$/, '') : '';

        totalSign = total < 0 ? '-' : '';
        ymSign = sign(this._months) !== sign(total) ? '-' : '';
        daysSign = sign(this._days) !== sign(total) ? '-' : '';
        hmsSign = sign(this._milliseconds) !== sign(total) ? '-' : '';

        return (
            totalSign +
            'P' +
            (years ? ymSign + years + 'Y' : '') +
            (months ? ymSign + months + 'M' : '') +
            (days ? daysSign + days + 'D' : '') +
            (hours || minutes || seconds ? 'T' : '') +
            (hours ? hmsSign + hours + 'H' : '') +
            (minutes ? hmsSign + minutes + 'M' : '') +
            (seconds ? hmsSign + s + 'S' : '')
        );
    }

    var proto$2 = Duration.prototype;

    proto$2.isValid = isValid$1;
    proto$2.abs = abs;
    proto$2.add = add$1;
    proto$2.subtract = subtract$1;
    proto$2.as = as;
    proto$2.asMilliseconds = asMilliseconds;
    proto$2.asSeconds = asSeconds;
    proto$2.asMinutes = asMinutes;
    proto$2.asHours = asHours;
    proto$2.asDays = asDays;
    proto$2.asWeeks = asWeeks;
    proto$2.asMonths = asMonths;
    proto$2.asQuarters = asQuarters;
    proto$2.asYears = asYears;
    proto$2.valueOf = valueOf$1;
    proto$2._bubble = bubble;
    proto$2.clone = clone$1;
    proto$2.get = get$2;
    proto$2.milliseconds = milliseconds;
    proto$2.seconds = seconds;
    proto$2.minutes = minutes;
    proto$2.hours = hours;
    proto$2.days = days;
    proto$2.weeks = weeks;
    proto$2.months = months;
    proto$2.years = years;
    proto$2.humanize = humanize;
    proto$2.toISOString = toISOString$1;
    proto$2.toString = toISOString$1;
    proto$2.toJSON = toISOString$1;
    proto$2.locale = locale;
    proto$2.localeData = localeData;

    proto$2.toIsoString = deprecate(
        'toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)',
        toISOString$1
    );
    proto$2.lang = lang;

    // FORMATTING

    addFormatToken('X', 0, 0, 'unix');
    addFormatToken('x', 0, 0, 'valueOf');

    // PARSING

    addRegexToken('x', matchSigned);
    addRegexToken('X', matchTimestamp);
    addParseToken('X', function (input, array, config) {
        config._d = new Date(parseFloat(input) * 1000);
    });
    addParseToken('x', function (input, array, config) {
        config._d = new Date(toInt(input));
    });

    //! moment.js

    hooks.version = '2.29.4';

    setHookCallback(createLocal);

    hooks.fn = proto;
    hooks.min = min;
    hooks.max = max;
    hooks.now = now;
    hooks.utc = createUTC;
    hooks.unix = createUnix;
    hooks.months = listMonths;
    hooks.isDate = isDate;
    hooks.locale = getSetGlobalLocale;
    hooks.invalid = createInvalid;
    hooks.duration = createDuration;
    hooks.isMoment = isMoment;
    hooks.weekdays = listWeekdays;
    hooks.parseZone = createInZone;
    hooks.localeData = getLocale;
    hooks.isDuration = isDuration;
    hooks.monthsShort = listMonthsShort;
    hooks.weekdaysMin = listWeekdaysMin;
    hooks.defineLocale = defineLocale;
    hooks.updateLocale = updateLocale;
    hooks.locales = listLocales;
    hooks.weekdaysShort = listWeekdaysShort;
    hooks.normalizeUnits = normalizeUnits;
    hooks.relativeTimeRounding = getSetRelativeTimeRounding;
    hooks.relativeTimeThreshold = getSetRelativeTimeThreshold;
    hooks.calendarFormat = getCalendarFormat;
    hooks.prototype = proto;

    // currently HTML5 input type only supports 24-hour formats
    hooks.HTML5_FMT = {
        DATETIME_LOCAL: 'YYYY-MM-DDTHH:mm', // <input type="datetime-local" />
        DATETIME_LOCAL_SECONDS: 'YYYY-MM-DDTHH:mm:ss', // <input type="datetime-local" step="1" />
        DATETIME_LOCAL_MS: 'YYYY-MM-DDTHH:mm:ss.SSS', // <input type="datetime-local" step="0.001" />
        DATE: 'YYYY-MM-DD', // <input type="date" />
        TIME: 'HH:mm', // <input type="time" />
        TIME_SECONDS: 'HH:mm:ss', // <input type="time" step="1" />
        TIME_MS: 'HH:mm:ss.SSS', // <input type="time" step="0.001" />
        WEEK: 'GGGG-[W]WW', // <input type="week" />
        MONTH: 'YYYY-MM', // <input type="month" />
    };

    return hooks;

})));
});

var colors = {
  white: '#ffffff',
  black: '#000000',
  dark: '#161616',
  blue: '#438CED',
  backgroundColor: '#f1f2f6',
  darkModeBackgroundColor: '#1e1f28',
  darkModeSecondaryBackgroundColor: '#1B1C25',
  lightModeBackgroundColor: '#f1f2f6',
  hoverBackgroundColor: '#f1f2f6',
  darkModeHoverBackgroundColor: '#25262E',
  lightModeHoverBackgroundColor: '#f1f2f6',
  textColor1: '#111539',
  darkModeTextColor1: '#ffffffcc',
  lightModeTextColor1: '#111539',
  textColor2: '#707388',
  textColor3: '#A0A1B0',
  placeholderTextColor: '#acacad',
  gray0: '#F3F5F8',
  gray1: '#EDEDED',
  borderColor: '#dfe0eb',
  borderColor2: '#818C99',
  primary: '#5159F6',
  primaryLight: '#E3E7FF',
  darkModePrimary: '#6B72FF',
  lightModePrimary: '#5159F6',
  darkModePrimaryLight: '#1c1f47',
  lightModePrimaryLight: '#E3E7FF',
  incomingRepliedMessageBackground: '#fbfbfc',
  ownRepliedMessageBackground: '#f9fbfd',
  red1: '#FA4C56',
  red2: '#d7596c',
  purple: '#7A6EF6',
  defaultAvatarBackground: '#D0D8E3',
  deleteUserIconBackground: '#D0D8E3'
};
var size = {
  mobileS: '320px',
  mobileM: '375px',
  mobileL: '425px',
  tablet: '768px',
  laptop: '1024px',
  laptopL: '1440px',
  max: '2560px'
};
var device = {
  mobileS: "(min-width: " + size.mobileS + ")",
  mobileM: "(min-width: " + size.mobileM + ")",
  mobileL: "(min-width: " + size.mobileL + ")",
  tablet: "screen and (max-width: " + size.tablet + ")",
  laptop: "screen and (max-width: " + size.laptop + ")",
  laptopL: "screen and (min-width: " + size.laptopL + ")",
  max: "screen and (max-width: " + size.max + ")"
};

var CustomUploader;
var sendAttachmentsAsSeparateMessages = false;
var pendingUploaders = {};
var setCustomUploader = function setCustomUploader(uploader) {
  CustomUploader = uploader;
};
var setSendAttachmentsAsSeparateMessages = function setSendAttachmentsAsSeparateMessages(asSeparate) {
  sendAttachmentsAsSeparateMessages = asSeparate;
};
var getSendAttachmentsAsSeparateMessages = function getSendAttachmentsAsSeparateMessages() {
  return sendAttachmentsAsSeparateMessages;
};
var getCustomUploader = function getCustomUploader() {
  return CustomUploader;
};
var getCustomDownloader = function getCustomDownloader() {
  return CustomUploader && CustomUploader.download;
};
var customUpload = function customUpload(attachment, progress, getUpdatedFilePath) {
  return new Promise(function (resolve, reject) {
    if (CustomUploader) {
      var uploadTask = {
        updateLocalFileLocation: getUpdatedFilePath,
        progress: progress,
        failure: function failure(e) {
          return reject(e);
        },
        success: function success(uri) {
          return resolve(uri);
        },
        cancel: function cancel() {},
        stop: function stop() {},
        resume: function resume() {}
      };
      pendingUploaders[attachment.tid] = uploadTask;
      CustomUploader.upload(attachment, uploadTask);
    } else {
      reject(new Error('No Custom uploader'));
    }
  });
};
var pauseUpload = function pauseUpload(attachmentId) {
  if (pendingUploaders[attachmentId]) {
    return pendingUploaders[attachmentId].stop();
  } else {
    console.log('Unknown uploading task');
    return false;
  }
};
var resumeUpload = function resumeUpload(attachmentId) {
  if (pendingUploaders[attachmentId]) {
    return pendingUploaders[attachmentId].resume();
  } else {
    console.log('Unknown uploading task');
    return false;
  }
};
var cancelUpload = function cancelUpload(attachmentId) {
  if (pendingUploaders[attachmentId]) {
    return pendingUploaders[attachmentId].cancel();
  }
};

var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;
var StatusText = styled__default.span(_templateObject || (_templateObject = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  font-weight: 400;\n  font-size: 12px;\n"])), colors.textColor2);
var ReadIconWrapper = styled__default(SvgTicksRead)(_templateObject2 || (_templateObject2 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.primary;
});
var DeliveredIconWrapper = styled__default(SvgTicksDelivered)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
});
var SentIconWrapper = styled__default(SvgTicksSent)(_templateObject4 || (_templateObject4 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
});
var PendingIconWrapper = styled__default(SvgPendingIcon)(_templateObject5 || (_templateObject5 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
});
var messageStatusIcon = function messageStatusIcon(messageStatus, messageStatusDisplayingType, iconColor, readIconColor) {
  switch (messageStatus) {
    case MESSAGE_DELIVERY_STATUS.READ:
      return messageStatusDisplayingType === 'ticks' ? /*#__PURE__*/React__default.createElement(ReadIconWrapper, {
        color: readIconColor
      }) : /*#__PURE__*/React__default.createElement(StatusText, null, "\u2022 Seen");

    case MESSAGE_DELIVERY_STATUS.DELIVERED:
      return messageStatusDisplayingType === 'ticks' ? /*#__PURE__*/React__default.createElement(DeliveredIconWrapper, {
        color: iconColor
      }) : /*#__PURE__*/React__default.createElement(StatusText, null, "\u2022 Not seen yet");

    case MESSAGE_DELIVERY_STATUS.SENT:
      return messageStatusDisplayingType === 'ticks' ? /*#__PURE__*/React__default.createElement(SentIconWrapper, {
        color: iconColor
      }) : /*#__PURE__*/React__default.createElement(StatusText, null, "\u2022 Not seen yet");

    default:
      return /*#__PURE__*/React__default.createElement(PendingIconWrapper, {
        color: iconColor
      });
  }
};
var bytesToSize = function bytesToSize(bytes, decimals) {
  if (decimals === void 0) {
    decimals = 2;
  }

  if (bytes === 0) return '0 Bytes';
  var k = 1000;
  var dm = decimals < 0 ? 0 : decimals;
  var sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
  var i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + " " + sizes[i];
};
var systemMessageUserName = function systemMessageUserName(contact, userId) {
  return contact ? contact.firstName ? contact.firstName.split(' ')[0] : contact.id : userId || 'Deleted user';
};
var filesPromisesOnDownload = {};
var setDownloadFilePromise = function setDownloadFilePromise(attachmentId, promise) {
  filesPromisesOnDownload[attachmentId] = promise;
};
var downloadFile = function downloadFile(attachment, download, done, progressCallback) {
  try {
    return Promise.resolve(_catch(function () {
      var customDownloader = getCustomDownloader();
      var response;

      var _temp = function () {
        if (customDownloader) {
          var urlPromise = customDownloader(attachment.url, download, function (progress) {
            if (progressCallback) {
              progressCallback(progress);
            }
          });
          filesPromisesOnDownload[attachment.id] = urlPromise;
          return Promise.resolve(urlPromise).then(function (result) {
            FileSaver.saveAs(result.Body, attachment.name);

            if (done) {
              done(attachment.id || '');
            }

            delete filesPromisesOnDownload[attachment.id];
          });
        } else {
          return Promise.resolve(fetch(attachment.url)).then(function (_fetch) {
            response = _fetch;
            return Promise.resolve(response.blob()).then(function (data) {
              if (done) {
                done(attachment.id || '');
              }

              FileSaver.saveAs(data, attachment.name);
            });
          });
        }
      }();

      if (_temp && _temp.then) return _temp.then(function () {});
    }, function (e) {
      console.log('error on download... ', e);

      if (done) {
        done(attachment.id || '', true);
      }
    }));
  } catch (e) {
    return Promise.reject(e);
  }
};
var cancelDownloadFile = function cancelDownloadFile(attachmentId) {
  var promise = filesPromisesOnDownload[attachmentId];

  if (promise) {
    var customUploader = getCustomUploader();

    if (customUploader) {
      customUploader.cancelRequest(promise);
    }
  }
};
var calculateRenderedImageWidth = function calculateRenderedImageWidth(width, height, maxWidth, maxHeight) {
  var maxWdt = maxWidth || 420;
  var maxHg = maxHeight || 400;
  var minWidth = 165;
  var aspectRatio = width / height;

  if (aspectRatio >= maxWdt / maxHg) {
    return [Math.max(minWidth, Math.min(maxWdt, width)), Math.min(maxHg, height, maxWdt / aspectRatio) + 2];
  } else {
    if (maxHg <= height) {
      return [Math.min(maxWdt, maxHg * aspectRatio), Math.min(maxHg, height)];
    } else {
      return [Math.min(maxWdt, height * aspectRatio), Math.min(maxHg, height)];
    }
  }
};
var userLastActiveDateFormat = function userLastActiveDateFormat(date) {
  var formattingDate = moment(date).format();
  var currentTime = moment();
  var minutesDiff = currentTime.diff(formattingDate, 'minutes');

  if (minutesDiff <= 59) {
    return "Last seen " + (minutesDiff === 0 ? 1 : minutesDiff) + " " + (minutesDiff > 1 ? ' minutes ago' : ' minute ago');
  }

  var startOfDay = moment().startOf('day');
  var isToday = moment(date).diff(startOfDay) >= 0;

  if (isToday) {
    return "Last seen " + moment(date).format('HH:mm');
  }

  var yesterday = moment().subtract(1, 'day').startOf('day');
  var isInYesterday = moment(date).diff(yesterday) >= 0;

  if (isInYesterday) {
    return "Last seen Yesterday at " + moment(date).format('HH:mm');
  }

  var isInLastWeek = moment().diff(moment(date), 'weeks') < 1;

  if (isInLastWeek) {
    return "Last seen " + moment(date).format('dddd') + " at " + moment(date).format('HH:mm');
  }

  return "Last seen " + moment(date).format('DD.MM.YY');
};
var formatAudioVideoTime = function formatAudioVideoTime(currentTime) {
  var minutes = Math.floor(currentTime / 60);
  var seconds = Math.floor(currentTime % 60);
  return minutes + ":" + (seconds < 10 ? "0" + seconds : seconds);
};
var formatLargeText = function formatLargeText(text, maxLength) {
  if (text.length > maxLength) {
    var firstHalf = text.slice(0, maxLength / 2 - 1);
    var secondHalf = text.slice(-(maxLength / 2));

    if (firstHalf.length + secondHalf.length > maxLength) {
      return formatLargeText(firstHalf + secondHalf, maxLength);
    } else {
      return firstHalf + '...' + secondHalf;
    }
  } else {
    return text;
  }
};
var detectOS = function detectOS() {
  var userAgent = window.navigator.userAgent;
  var platform = window.navigator.platform;
  var macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];
  var windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];
  var iosPlatforms = ['iPhone', 'iPad', 'iPod'];
  var os = null;

  if (macosPlatforms.includes(platform)) {
    os = 'Mac OS';
  } else if (iosPlatforms.includes(platform)) {
    os = 'iOS';
  } else if (windowsPlatforms.includes(platform)) {
    os = 'Windows';
  } else if (/Android/.test(userAgent)) {
    os = 'Android';
  } else if (/Linux/.test(platform)) {
    os = 'Linux';
  }

  return os;
};
var detectBrowser = function detectBrowser() {
  var browser = '';

  if (window && window.navigator) {
    var userAgent = window.navigator.userAgent;

    if (userAgent.includes('Opera') || userAgent.includes('OPR')) {
      browser = 'Opera';
    } else if (userAgent.includes('Edge')) {
      browser = 'Edge';
    } else if (userAgent.includes('Chrome')) {
      browser = 'Chrome';
    } else if (userAgent.includes('Safari')) {
      browser = 'Safari';
    } else if (userAgent.includes('Firefox')) {
      browser = 'Firefox';
    } else if (userAgent.includes('MSIE') || userAgent.includes('Trident/')) {
      browser = 'Internet Explorer';
    }
  }

  return browser;
};
var getEmojisCategoryTitle = function getEmojisCategoryTitle(categoryKey) {
  var category;

  switch (categoryKey) {
    case 'People':
      category = 'Smileys & People';
      break;

    case 'Animals':
      category = 'Animals & Nature';
      break;

    case 'Food':
      category = 'Food & Drink';
      break;

    case 'Travel':
      category = 'Travel & Places';
      break;

    case 'Objects':
      category = 'Objects';
      break;

    case 'Symbols':
      category = 'Symbols';
      break;

    case 'Flags':
      category = 'Flags';
      break;

    default:
      category = '';
      break;
  }

  return category;
};
var hashString = function hashString(str) {
  try {
    var _temp4 = function _temp4(_result) {
      if (_exit2) return _result;
      var hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(function (_byte) {
        return _byte.toString(16).padStart(2, '0');
      }).join('');
    };

    var _exit2 = false;
    var encoder = new TextEncoder();
    var encodedData = encoder.encode(str);
    var hashBuffer;

    var _temp5 = _catch(function () {
      return Promise.resolve(crypto.subtle.digest('SHA-256', encodedData)).then(function (_crypto$subtle$digest) {
        hashBuffer = _crypto$subtle$digest;
      });
    }, function () {
      _exit2 = true;
      return '';
    });

    return Promise.resolve(_temp5 && _temp5.then ? _temp5.then(_temp4) : _temp4(_temp5));
  } catch (e) {
    return Promise.reject(e);
  }
};

var MESSAGES_MAX_LENGTH = 60;
var LOAD_MAX_MESSAGE_COUNT = 20;
var MESSAGE_LOAD_DIRECTION = {
  PREV: 'prev',
  NEXT: 'next'
};
var sendMessageHandler;
var setSendMessageHandler = function setSendMessageHandler(handler) {
  sendMessageHandler = handler;
};
var pendingAttachments = {};
var messagesMap = {};
var pendingMessagesMap = {};
var activeChannelAllMessages = [];
var prevCached = false;
var nextCached = false;
var setAllMessages = function setAllMessages(messages) {
  activeChannelAllMessages = messages;
};
var addAllMessages = function addAllMessages(messages, direction) {
  if (direction === MESSAGE_LOAD_DIRECTION.PREV) {
    activeChannelAllMessages = [].concat(messages, activeChannelAllMessages);

    if (activeChannelAllMessages.length > MESSAGES_MAX_LENGTH) {
      setHasNextCached(true);
    }
  } else {
    activeChannelAllMessages = [].concat(activeChannelAllMessages, messages);

    if (activeChannelAllMessages.length > MESSAGES_MAX_LENGTH) {
      setHasPrevCached(true);
    }
  }
};
var updateMessageOnAllMessages = function updateMessageOnAllMessages(messageId, updatedParams) {
  activeChannelAllMessages = activeChannelAllMessages.map(function (message) {
    if (message.tid === messageId || message.id === messageId) {
      if (updatedParams.state === MESSAGE_STATUS.DELETE) {
        return _extends({}, updatedParams);
      }

      return _extends({}, message, updatedParams);
    }

    return message;
  });
};
var removeMessageFromAllMessages = function removeMessageFromAllMessages(messageId) {
  activeChannelAllMessages = [].concat(activeChannelAllMessages).filter(function (msg) {
    return !(msg.id === messageId || msg.tid === messageId);
  });
};
var updateMarkersOnAllMessages = function updateMarkersOnAllMessages(markersMap, name) {
  activeChannelAllMessages = activeChannelAllMessages.map(function (message) {
    if (markersMap[message.id] && (message.deliveryStatus === MESSAGE_DELIVERY_STATUS.SENT || name === MESSAGE_DELIVERY_STATUS.READ)) {
      return _extends({}, message, {
        deliveryStatus: name
      });
    }

    return message;
  });
};
var getAllMessages = function getAllMessages() {
  return activeChannelAllMessages;
};
var removeAllMessages = function removeAllMessages() {
  activeChannelAllMessages = [];
  setHasPrevCached(false);
  setHasNextCached(false);
};
var setHasPrevCached = function setHasPrevCached(state) {
  prevCached = state;
};
var getHasPrevCached = function getHasPrevCached() {
  return prevCached;
};
var setHasNextCached = function setHasNextCached(state) {
  return nextCached = state;
};
var getHasNextCached = function getHasNextCached() {
  return nextCached;
};
var getFromAllMessagesByMessageId = function getFromAllMessagesByMessageId(messageId, direction, getWithLastMessage) {
  var messagesForAdd = [];

  if (getWithLastMessage) {
    messagesForAdd = [].concat(activeChannelAllMessages).slice(-MESSAGES_MAX_LENGTH);
    setHasPrevCached(activeChannelAllMessages.length > MESSAGES_MAX_LENGTH);
    setHasNextCached(false);
  } else {
    var fromMessageIndex = activeChannelAllMessages.findIndex(function (mes) {
      return mes.id === messageId;
    });

    if (fromMessageIndex !== 0) {
      if (direction === MESSAGE_LOAD_DIRECTION.PREV) {
        var sliceFromIndex = fromMessageIndex <= LOAD_MAX_MESSAGE_COUNT ? 0 : fromMessageIndex - (LOAD_MAX_MESSAGE_COUNT + 1);
        messagesForAdd = activeChannelAllMessages.slice(sliceFromIndex, fromMessageIndex);
        setHasPrevCached(!(messagesForAdd.length < LOAD_MAX_MESSAGE_COUNT || sliceFromIndex === 0));
        setHasNextCached(true);
      } else {
        var toMessage = fromMessageIndex + LOAD_MAX_MESSAGE_COUNT + 1;
        messagesForAdd = activeChannelAllMessages.slice(fromMessageIndex + 1, toMessage);

        if (toMessage > activeChannelAllMessages.length - 1) {
          setHasNextCached(false);
        } else {
          setHasNextCached(!(messagesForAdd.length < LOAD_MAX_MESSAGE_COUNT));
        }

        setHasPrevCached(true);
      }
    } else {
      setHasPrevCached(false);
    }
  }

  return messagesForAdd;
};
function setMessagesToMap(channelId, messages) {
  messagesMap[channelId] = messages;
}
function addMessageToMap(channelId, message) {
  if (messagesMap[channelId] && messagesMap[channelId].length >= MESSAGES_MAX_LENGTH) {
    messagesMap[channelId].shift();
  }

  if (messagesMap[channelId]) {
    messagesMap[channelId].push(message);
  } else {
    messagesMap[channelId] = [message];
  }

  if (message.deliveryStatus === MESSAGE_DELIVERY_STATUS.PENDING) {
    if (pendingMessagesMap[channelId]) {
      pendingMessagesMap[channelId].push(message);
    } else {
      pendingMessagesMap[channelId] = [message];
    }
  }
}
function updateMessageOnMap(channelId, updatedMessage) {
  if (updatedMessage.params.deliveryStatus !== MESSAGE_DELIVERY_STATUS.PENDING && pendingMessagesMap[channelId]) {
    if (updatedMessage.params.state === MESSAGE_STATUS.FAILED) {
      pendingMessagesMap[channelId] = pendingMessagesMap[channelId].map(function (msg) {
        if (msg.tid === updatedMessage.messageId) {
          return _extends({}, msg, updatedMessage.params);
        }

        return msg;
      });
    } else {
      var filteredMessages = pendingMessagesMap[channelId].filter(function (msg) {
        return msg.tid !== updatedMessage.messageId;
      });

      if (filteredMessages && filteredMessages.length && filteredMessages.length > 0) {
        pendingMessagesMap[channelId] = filteredMessages;
      } else {
        delete pendingMessagesMap[channelId];
      }
    }
  }

  if (messagesMap[channelId]) {
    messagesMap[channelId] = messagesMap[channelId].map(function (mes) {
      if (mes.tid === updatedMessage.messageId || mes.id === updatedMessage.messageId) {
        if (updatedMessage.params.state === MESSAGE_STATUS.DELETE) {
          return _extends({}, updatedMessage.params);
        } else {
          return _extends({}, mes, updatedMessage.params);
        }
      }

      return mes;
    });
  }
}
function addReactionToMessageOnMap(channelId, message, reaction, isSelf) {
  if (messagesMap[channelId]) {
    messagesMap[channelId] = messagesMap[channelId].map(function (msg) {
      if (msg.id === message.id) {
        var slfReactions = [].concat(msg.userReactions);

        if (isSelf) {
          if (slfReactions) {
            slfReactions.push(reaction);
          } else {
            slfReactions = [reaction];
          }
        }

        return _extends({}, msg, {
          userReactions: slfReactions,
          reactionTotals: message.reactionTotals
        });
      }

      return msg;
    });
  }
}
var addReactionOnAllMessages = function addReactionOnAllMessages(message, reaction, isSelf) {
  activeChannelAllMessages = activeChannelAllMessages.map(function (msg) {
    if (msg.id === message.id) {
      var slfReactions = [].concat(msg.userReactions);

      if (isSelf) {
        if (slfReactions) {
          slfReactions.push(reaction);
        } else {
          slfReactions = [reaction];
        }
      }

      return _extends({}, msg, {
        userReactions: slfReactions,
        reactionTotals: message.reactionTotals
      });
    }

    return msg;
  });
};
function removeReactionToMessageOnMap(channelId, message, reaction, isSelf) {
  if (messagesMap[channelId]) {
    messagesMap[channelId] = messagesMap[channelId].map(function (msg) {
      if (msg.id === message.id) {
        var userReactions = msg.userReactions;

        if (isSelf) {
          userReactions = msg.userReactions.filter(function (selfReaction) {
            return selfReaction.key !== reaction.key;
          });
        }

        return _extends({}, msg, {
          reactionTotals: message.reactionTotals,
          userReactions: userReactions
        });
      }

      return msg;
    });
  }
}
var removeReactionOnAllMessages = function removeReactionOnAllMessages(message, reaction, isSelf) {
  activeChannelAllMessages = activeChannelAllMessages.map(function (msg) {
    if (msg.id === message.id) {
      var userReactions = msg.userReactions;

      if (isSelf) {
        userReactions = msg.userReactions.filter(function (selfReaction) {
          return selfReaction.key !== reaction.key;
        });
      }

      return _extends({}, msg, {
        reactionTotals: message.reactionTotals,
        userReactions: userReactions
      });
    }

    return msg;
  });
};
function updateMessageStatusOnMap(channelId, newMarkers) {
  if (messagesMap[channelId] && newMarkers && newMarkers.markersMap) {
    messagesMap[channelId] = messagesMap[channelId].map(function (mes) {
      var name = newMarkers.name;
      var markersMap = newMarkers.markersMap;

      if (markersMap[mes.id] && (mes.deliveryStatus === MESSAGE_DELIVERY_STATUS.SENT || name === MESSAGE_DELIVERY_STATUS.READ)) {
        return _extends({}, mes, {
          deliveryStatus: name
        });
      }

      return mes;
    });
  }
}
function getMessagesFromMap(channelId) {
  return messagesMap[channelId];
}
function removeMessagesFromMap(channelId) {
  delete messagesMap[channelId];
}
function removeMessageFromMap(channelId, messageId) {
  messagesMap[channelId] = [].concat(messagesMap[channelId]).filter(function (msg) {
    return !(msg.id === messageId || msg.tid === messageId);
  });
  pendingMessagesMap[channelId] = [].concat(pendingMessagesMap[channelId]).filter(function (msg) {
    return !(msg.id === messageId || msg.tid === messageId);
  });
}
function removePendingMessageFromMap(channelId, messageId) {
  if (pendingMessagesMap[channelId]) {
    pendingMessagesMap[channelId] = [].concat(pendingMessagesMap[channelId]).filter(function (msg) {
      return !(msg.id === messageId || msg.tid === messageId);
    });
  }
}
function clearMessagesMap() {
  messagesMap = {};
}
function checkChannelExistsOnMessagesMap(channelId) {
  return !!messagesMap[channelId];
}
var pendingVideoAttachmentsThumbs = {};
var setVideoThumb = function setVideoThumb(attachmentId, thumb) {
  pendingVideoAttachmentsThumbs[attachmentId] = thumb;
};
var getVideoThumb = function getVideoThumb(attachmentId) {
  return pendingVideoAttachmentsThumbs[attachmentId];
};
var deleteVideoThumb = function deleteVideoThumb(attachmentId) {
  delete pendingVideoAttachmentsThumbs[attachmentId];
};
var setPendingAttachment = function setPendingAttachment(attachmentId, data) {
  pendingAttachments[attachmentId] = _extends({}, pendingAttachments[attachmentId], data);
};
var getPendingAttachment = function getPendingAttachment(attachmentId) {
  return pendingAttachments[attachmentId];
};
var deletePendingAttachment = function deletePendingAttachment(attachmentId) {
  return delete pendingAttachments[attachmentId];
};
var getPendingMessages = function getPendingMessages(channelId) {
  return pendingMessagesMap[channelId];
};
var addPendingMessageToMap = function addPendingMessageToMap(channelId, pendingMessage) {
  if (pendingMessagesMap[channelId]) {
    pendingMessagesMap[channelId].push(pendingMessage);
  } else {
    pendingMessagesMap[channelId] = [pendingMessage];
  }
};
var setPendingMessages = function setPendingMessages(channelId, pendingMessages) {
  pendingMessagesMap[channelId] = pendingMessages;
};
var getPendingMessagesMap = function getPendingMessagesMap() {
  return pendingMessagesMap;
};
var draftMessagesMap = {};
var getDraftMessageFromMap = function getDraftMessageFromMap(channelId) {
  return draftMessagesMap[channelId];
};
var checkDraftMessagesIsEmpty = function checkDraftMessagesIsEmpty() {
  return Object.keys(draftMessagesMap).length === 0;
};
var removeDraftMessageFromMap = function removeDraftMessageFromMap(channelId) {
  delete draftMessagesMap[channelId];
};
var setDraftMessageToMap = function setDraftMessageToMap(channelId, draftMessage) {
  draftMessagesMap[channelId] = draftMessage;
};
var visibleMessagesMap = {};
var getVisibleMessagesMap = function getVisibleMessagesMap() {
  return visibleMessagesMap;
};
var clearVisibleMessagesMap = function clearVisibleMessagesMap() {
  visibleMessagesMap = {};
};
var setMessageToVisibleMessagesMap = function setMessageToVisibleMessagesMap(message) {
  visibleMessagesMap[message.id] = {
    id: message.id
  };
};
var removeMessageFromVisibleMessagesMap = function removeMessageFromVisibleMessagesMap(message) {
  delete visibleMessagesMap[message.id];
};

var initialState$1 = {
  messagesLoadingState: null,
  messagesHasNext: false,
  messagesHasPrev: true,
  threadMessagesHasNext: false,
  threadMessagesHasPrev: true,
  activeChannelMessages: [],
  attachmentsForPopup: [],
  activeTabAttachments: [],
  attachmentHasNext: true,
  attachmentForPopupHasNext: true,
  messageToEdit: null,
  activeChannelNewMessage: null,
  pendingMessages: {},
  activeChannelNewMarkers: {
    name: '',
    markersMap: {}
  },
  activeChannelMessageUpdated: null,
  scrollToNewMessage: {
    scrollToBottom: false,
    updateMessageList: false,
    isIncomingMessage: false
  },
  showScrollToNewMessageButton: false,
  sendMessageInputHeight: 0,
  messageForReply: null,
  attachmentsUploadingState: {},
  scrollToMessage: null,
  reactionsList: [],
  reactionsHasNext: true,
  reactionsLoadingState: null,
  openedMessageMenu: '',
  attachmentsUploadingProgress: {},
  playingAudioId: null,
  selectedMessagesMap: null
};
var MessageReducer = (function (state, _temp) {
  if (state === void 0) {
    state = initialState$1;
  }

  var _ref = _temp === void 0 ? {
    type: ''
  } : _temp,
      type = _ref.type,
      payload = _ref.payload;

  var newState = _extends({}, state);

  switch (type) {
    case ADD_MESSAGE:
      {
        var messagesCopy = [].concat(newState.activeChannelMessages);

        if (newState.activeChannelMessages.length >= MESSAGES_MAX_LENGTH) {
          messagesCopy.shift();
          newState.activeChannelMessages = [].concat(messagesCopy, [payload.message]);
        } else {
          newState.activeChannelMessages = [].concat(messagesCopy, [payload.message]);
        }

        return newState;
      }

    case DELETE_MESSAGE_FROM_LIST:
      {
        newState.activeChannelMessages = [].concat(newState.activeChannelMessages).filter(function (msg) {
          return !(msg.id === payload.messageId || msg.tid === payload.messageId);
        });
        return newState;
      }

    case SET_SCROLL_TO_MESSAGE:
      {
        newState.scrollToMessage = payload.messageId;
        return newState;
      }

    case SET_SCROLL_TO_NEW_MESSAGE:
      {
        newState.scrollToNewMessage = {
          scrollToBottom: payload.scrollToBottom,
          updateMessageList: payload.updateMessageList,
          isIncomingMessage: payload.isIncomingMessage
        };
        return newState;
      }

    case SET_SHOW_SCROLL_TO_NEW_MESSAGE_BUTTON:
      {
        newState.showScrollToNewMessageButton = payload.state;
        return newState;
      }

    case SET_MESSAGES:
      {
        var messages = payload.messages;
        newState.activeChannelMessages = messages;
        return newState;
      }

    case ADD_MESSAGES:
      {
        var _messages = payload.messages,
            direction = payload.direction;

        var _messagesCopy = [].concat(newState.activeChannelMessages);

        var newMessagesLength = _messages.length;
        var currentMessagesLength = newState.activeChannelMessages.length;

        if (direction === MESSAGE_LOAD_DIRECTION.PREV) {
          if (currentMessagesLength + newMessagesLength >= MESSAGES_MAX_LENGTH) {
            setHasNextCached(true);

            if (newMessagesLength > 0) {
              if (currentMessagesLength >= MESSAGES_MAX_LENGTH) {
                _messagesCopy.splice(-newMessagesLength);
              } else {
                _messagesCopy.splice(-(newMessagesLength - (MESSAGES_MAX_LENGTH - currentMessagesLength)));
              }
            }

            newState.activeChannelMessages = [].concat(_messages, _messagesCopy);
          } else if (newMessagesLength + currentMessagesLength > MESSAGES_MAX_LENGTH) {
            var sliceElementCount = newMessagesLength + currentMessagesLength - MESSAGES_MAX_LENGTH;
            setHasNextCached(true);

            _messagesCopy.splice(-sliceElementCount);

            newState.activeChannelMessages = [].concat(_messages, _messagesCopy);
          } else {
            newState.activeChannelMessages = [].concat(_messages, newState.activeChannelMessages);
          }
        } else if (direction === 'next') {
          if (currentMessagesLength >= MESSAGES_MAX_LENGTH) {
            setHasPrevCached(true);

            _messagesCopy.splice(0, _messages.length);

            newState.activeChannelMessages = [].concat(_messagesCopy, _messages);
          } else if (newMessagesLength + currentMessagesLength > MESSAGES_MAX_LENGTH) {
            var _sliceElementCount = newMessagesLength + currentMessagesLength - MESSAGES_MAX_LENGTH;

            setHasPrevCached(true);

            _messagesCopy.splice(0, _sliceElementCount);

            newState.activeChannelMessages = [].concat(_messagesCopy, _messages);
          } else {
            newState.activeChannelMessages = [].concat(newState.activeChannelMessages, _messages);
          }
        }

        return newState;
      }

    case UPDATE_MESSAGES_STATUS:
      {
        var name = payload.name,
            markersMap = payload.markersMap;
        var markerName = name;

        var _messagesCopy2 = [].concat(newState.activeChannelMessages);

        var isChanged = false;
        newState.activeChannelNewMarkers = {
          name: name,
          markersMap: markersMap
        };

        _messagesCopy2.forEach(function (message, index) {
          if (markersMap[message.id] && (message.deliveryStatus === MESSAGE_DELIVERY_STATUS.SENT || markerName === MESSAGE_DELIVERY_STATUS.READ) && message.state !== 'Deleted') {
            var messageCopy = _extends({}, message);

            messageCopy.deliveryStatus = markerName;
            _messagesCopy2[index] = messageCopy;

            if (!isChanged) {
              isChanged = true;
            }
          }
        });

        if (isChanged) {
          newState.activeChannelMessages = _messagesCopy2;
        }

        return newState;
      }

    case UPDATE_MESSAGE:
      {
        var messageId = payload.messageId,
            params = payload.params,
            addIfNotExists = payload.addIfNotExists;

        var _messagesCopy3 = [].concat(newState.activeChannelMessages);

        var messageFound = false;
        newState.activeChannelMessages = _messagesCopy3.map(function (message) {
          if (message.tid === messageId || message.id === messageId) {
            messageFound = true;

            if (params.state === MESSAGE_STATUS.DELETE) {
              return _extends({}, params);
            } else {
              return _extends({}, message, params);
            }
          }

          return message;
        });

        if (!messageFound && addIfNotExists) {
          console.log('message not found on update message, add message to list .. ...', params);
          newState.activeChannelMessages = [].concat(newState.activeChannelMessages, [params]);
        }

        return newState;
      }

    case ADD_REACTION_TO_MESSAGE:
      {
        var message = payload.message,
            reaction = payload.reaction,
            isSelf = payload.isSelf;
        newState.activeChannelMessages = newState.activeChannelMessages.map(function (msg) {
          if (msg.id === message.id) {
            var slfReactions = [].concat(msg.userReactions);

            if (isSelf) {
              if (slfReactions) {
                slfReactions.push(reaction);
              } else {
                slfReactions = [reaction];
              }
            }

            return _extends({}, msg, {
              userReactions: slfReactions,
              reactionTotals: message.reactionTotals
            });
          }

          return msg;
        });
        return newState;
      }

    case DELETE_REACTION_FROM_MESSAGE:
      {
        var _reaction = payload.reaction,
            _message = payload.message,
            _isSelf = payload.isSelf;

        var _messagesCopy4 = [].concat(newState.activeChannelMessages);

        newState.activeChannelMessages = _messagesCopy4.map(function (msg) {
          if (msg.id === _message.id) {
            var userReactions = msg.userReactions;

            if (_isSelf) {
              userReactions = msg.userReactions.filter(function (selfReaction) {
                return selfReaction.key !== _reaction.key;
              });
            }

            return _extends({}, msg, {
              reactionTotals: _message.reactionTotals,
              userReactions: userReactions
            });
          }

          return msg;
        });
        return newState;
      }

    case SET_HAS_PREV_MESSAGES:
      {
        newState.messagesHasPrev = payload.hasPrev;
        return newState;
      }

    case SET_MESSAGES_HAS_NEXT:
      {
        newState.messagesHasNext = payload.hasNext;
        return newState;
      }

    case CLEAR_MESSAGES:
      {
        newState.activeChannelMessages = [];
        return newState;
      }

    case EMPTY_CHANNEL_ATTACHMENTS:
      {
        newState.activeTabAttachments = [];
        return newState;
      }

    case SET_ATTACHMENTS:
      {
        var attachments = payload.attachments;
        newState.activeTabAttachments = attachments;
        return newState;
      }

    case SET_ATTACHMENTS_FOR_POPUP:
      {
        var _attachments = payload.attachments;
        newState.attachmentsForPopup = _attachments;
        return newState;
      }

    case ADD_ATTACHMENTS:
      {
        var _attachments2 = payload.attachments;
        var attachmentsCopy = [].concat(newState.activeTabAttachments);
        newState.activeTabAttachments = [].concat(attachmentsCopy, _attachments2);
        return newState;
      }

    case ADD_ATTACHMENTS_FOR_POPUP:
      {
        var _attachments3 = payload.attachments,
            _direction = payload.direction;

        var _attachmentsCopy = [].concat(newState.attachmentsForPopup);

        if (_direction === queryDirection.PREV) {
          newState.attachmentsForPopup = [].concat(_attachmentsCopy, _attachments3);
        } else {
          newState.attachmentsForPopup = [].concat(_attachments3, _attachmentsCopy);
        }

        return newState;
      }

    case SET_ATTACHMENTS_COMPLETE:
      {
        var hasPrev = payload.hasPrev;
        newState.attachmentHasNext = hasPrev;
        return newState;
      }

    case SET_ATTACHMENTS_COMPLETE_FOR_POPUP:
      {
        var _hasPrev = payload.hasPrev;
        newState.attachmentForPopupHasNext = _hasPrev;
        return newState;
      }

    case UPDATE_UPLOAD_PROGRESS:
      {
        var uploaded = payload.uploaded,
            total = payload.total,
            attachmentId = payload.attachmentId,
            progress = payload.progress;

        var attachmentsUploadingProgressCopy = _extends({}, newState.attachmentsUploadingProgress);

        var updateData = {
          uploaded: uploaded,
          total: total,
          progress: progress
        };
        attachmentsUploadingProgressCopy[attachmentId] = _extends({}, attachmentsUploadingProgressCopy[attachmentId], updateData);
        newState.attachmentsUploadingProgress = attachmentsUploadingProgressCopy;
        return newState;
      }

    case REMOVE_UPLOAD_PROGRESS:
      {
        var _attachmentId = payload.attachmentId;

        var _attachmentsUploadingProgressCopy = _extends({}, newState.attachmentsUploadingProgress);

        delete _attachmentsUploadingProgressCopy[_attachmentId];
        newState.attachmentsUploadingProgress = _attachmentsUploadingProgressCopy;
        return newState;
      }

    case SET_MESSAGE_TO_EDIT:
      {
        newState.messageToEdit = payload.message;
        return newState;
      }

    case SET_MESSAGES_LOADING_STATE:
      {
        newState.messagesLoadingState = payload.state;
        return newState;
      }

    case SET_SEND_MESSAGE_INPUT_HEIGHT:
      {
        newState.sendMessageInputHeight = payload.height;
        return newState;
      }

    case SET_MESSAGE_FOR_REPLY:
      {
        var _message2 = payload.message;
        newState.messageForReply = _message2;
        return newState;
      }

    case UPLOAD_ATTACHMENT_COMPILATION:
      {
        var _extends2;

        var attachmentUploadingState = payload.attachmentUploadingState,
            _attachmentId2 = payload.attachmentId;
        newState.attachmentsUploadingState = _extends({}, newState.attachmentsUploadingState, (_extends2 = {}, _extends2[_attachmentId2] = attachmentUploadingState, _extends2));
        return newState;
      }

    case SET_REACTIONS_LIST:
      {
        var reactions = payload.reactions,
            hasNext = payload.hasNext;
        newState.reactionsHasNext = hasNext;
        newState.reactionsList = [].concat(reactions);
        return newState;
      }

    case ADD_REACTIONS_TO_LIST:
      {
        var _reactions = payload.reactions,
            _hasNext = payload.hasNext;
        newState.reactionsHasNext = _hasNext;
        newState.reactionsList = [].concat(newState.reactionsList, _reactions);
        return newState;
      }

    case ADD_REACTION_TO_LIST:
      {
        newState.reactionsList = [].concat(newState.reactionsList, [payload.reaction]);
        return newState;
      }

    case DELETE_REACTION_FROM_LIST:
      {
        var _reaction2 = payload.reaction;
        newState.reactionsList = [].concat(newState.reactionsList).filter(function (item) {
          return item.id !== _reaction2.id;
        });
        return newState;
      }

    case SET_REACTIONS_LOADING_STATE:
      {
        newState.reactionsLoadingState = payload.state;
        return newState;
      }

    case SET_MESSAGE_MENU_OPENED:
      {
        newState.openedMessageMenu = payload.messageId;
        return newState;
      }

    case SET_PLAYING_AUDIO_ID:
      {
        newState.playingAudioId = payload.id;
        return newState;
      }

    case ADD_SELECTED_MESSAGE:
      {
        if (!newState.selectedMessagesMap) {
          var messagesMap = new Map();
          messagesMap.set(payload.message.id, payload.message);
          newState.selectedMessagesMap = messagesMap;
        } else {
          var _messagesMap = new Map(newState.selectedMessagesMap);

          _messagesMap.set(payload.message.id, payload.message);

          newState.selectedMessagesMap = _messagesMap;
        }

        return newState;
      }

    case REMOVE_SELECTED_MESSAGE:
      {
        if (newState.selectedMessagesMap) {
          var _messagesMap2 = new Map(newState.selectedMessagesMap);

          _messagesMap2["delete"](payload.messageId);

          newState.selectedMessagesMap = _messagesMap2;
        }

        return newState;
      }

    case CLEAR_SELECTED_MESSAGES:
      {
        newState.selectedMessagesMap = null;
        return newState;
      }

    case DESTROY_SESSION:
      {
        newState = initialState$1;
        return newState;
      }

    default:
      return state;
  }
});

var GET_MEMBERS = 'GET_MEMBERS';
var ADD_MEMBERS = 'ADD_MEMBERS';
var SET_MEMBERS_TO_LIST = 'SET_MEMBERS_TO_LIST';
var ADD_MEMBERS_TO_LIST = 'ADD_MEMBERS_TO_LIST';
var UPDATE_MEMBERS = 'UPDATE_MEMBERS';
var UPDATE_MEMBERS_PRESENCE = 'UPDATE_MEMBERS_PRESENCE';
var LOAD_MORE_MEMBERS = 'LOAD_MORE_MEMBERS';
var SET_MEMBERS_LOADING_STATE = 'SET_MEMBERS_LOADING_STATE';
var CLEAR_MEMBERS = 'CLEAR_MEMBERS';
var KICK_MEMBER = 'KICK_MEMBER';
var BLOCK_MEMBER = 'BLOCK_MEMBER';
var REPORT_MEMBER = 'REPORT_MEMBER';
var REMOVE_MEMBER_FROM_LIST = 'REMOVE_MEMBER_FROM_LIST';
var GET_ROLES = 'GET_ROLES';
var GET_ROLES_FAIL = 'GET_ROLES_FAIL';
var GET_ROLES_SUCCESS = 'GET_ROLES_SUCCESS';
var CHANGE_MEMBER_ROLE = 'CHANGE_MEMBER_ROLE';

var initialState$2 = {
  membersLoadingState: false,
  membersHasNext: true,
  activeChannelMembers: [],
  roles: [],
  getRolesFail: undefined,
  rolesMap: {}
};
var MembersReducer = (function (state, _ref) {
  if (state === void 0) {
    state = initialState$2;
  }

  var type = _ref.type,
      payload = _ref.payload;

  var newState = _extends({}, state);

  switch (type) {
    case SET_MEMBERS_TO_LIST:
      {
        var members = payload.members;
        newState.activeChannelMembers = [].concat(members);
        return newState;
      }

    case ADD_MEMBERS_TO_LIST:
      {
        var _members = payload.members;
        newState.activeChannelMembers = [].concat(newState.activeChannelMembers, _members);
        return newState;
      }

    case UPDATE_MEMBERS:
      {
        var _members2 = payload.members;
        console.log('UPDATE_MEMBERS . ... .. ', _members2);
        var updateMembers = [];
        var membersCopy = [].concat(newState.activeChannelMembers);

        if (_members2.length) {
          var updatedMembersMap = {};

          for (var i = 0; i < _members2.length; i++) {
            updatedMembersMap[_members2[i].id] = _members2[i];
          }

          updateMembers = membersCopy.map(function (member) {
            if (updatedMembersMap[member.id]) {
              return updatedMembersMap[member.id];
            }

            return member;
          });
          newState.activeChannelMembers = updateMembers;
        }

        return newState;
      }

    case UPDATE_MEMBERS_PRESENCE:
      {
        var usersMap = payload.usersMap;
        console.log('UPDATE_MEMBERS_PRESENCE . ... .. ', usersMap);
        var _updateMembers = [];

        if (newState.activeChannelMembers.length) {
          var _membersCopy = [].concat(newState.activeChannelMembers);

          _updateMembers = _membersCopy.map(function (member) {
            if (usersMap[member.id]) {
              return _extends({}, member, usersMap[member.id]);
            }

            return member;
          });
          newState.activeChannelMembers = _updateMembers;
        }

        return newState;
      }

    case CLEAR_MEMBERS:
      {
        newState.activeChannelMembers = [];
        return newState;
      }

    case REMOVE_MEMBER_FROM_LIST:
      {
        var _members3 = payload.members;

        if (_members3.length) {
          var _updateMembers2 = [];

          var _membersCopy2 = [].concat(newState.activeChannelMembers);

          var removedMembersMap = {};

          for (var _i = 0; _i < _members3.length; _i++) {
            removedMembersMap[_members3[_i].id] = _members3[_i];
          }

          _updateMembers2 = _membersCopy2.filter(function (member) {
            return !removedMembersMap[member.id];
          });
          newState.activeChannelMembers = _updateMembers2;
        }

        return newState;
      }

    case SET_MEMBERS_LOADING_STATE:
      {
        newState.membersLoadingState = payload.state;
        return newState;
      }

    case GET_ROLES_SUCCESS:
      {
        var roles = payload.roles;
        var rolesMap = {};
        roles.forEach(function (role) {
          rolesMap[role.name] = role;
        });
        newState.rolesMap = rolesMap;
        newState.roles = roles;
        return newState;
      }

    case GET_ROLES_FAIL:
      {
        var attempts = payload.attempts,
            timeout = payload.timeout;

        if (attempts || timeout) {
          newState.getRolesFail = {
            attempts: attempts,
            timeout: timeout
          };
        } else {
          newState.getRolesFail = undefined;
        }

        return newState;
      }

    case DESTROY_SESSION:
      {
        newState = initialState$2;
        return newState;
      }

    default:
      return state;
  }
});

var SET_CONNECTION_STATUS = 'SET_CONNECTION_STATUS';
var SET_CONTACT_LOADING_STATE = 'SET_CONTACT_LOADING_STATE';
var GET_CONTACTS = 'GET_CONTACTS';
var SET_CONTACTS = 'SET_CONTACTS';
var GET_USERS = 'GET_USERS';
var LOAD_MORE_USERS = 'LOAD_MORE_USERS';
var SET_USERS_LOADING_STATE = 'SET_USERS_LOADING_STATE';
var SET_USERS = 'SET_USERS';
var ADD_USERS = 'ADD_USERS';
var BLOCK_USERS = 'BLOCK_USERS';
var UNBLOCK_USERS = 'UNBLOCK_USERS';
var SET_USER = 'SET_USER';
var UPDATE_PROFILE = 'UPDATE_PROFILE';
var UPDATE_USER_PROFILE = 'UPDATE_USER_PROFILE';
var BROWSER_TAB_IS_ACTIVE = 'BROWSER_TAB_IS_ACTIVE';
var CHECK_USER_STATUS = 'CHECK_USER_STATUS';
var UPDATE_USER_MAP = 'UPDATE_USER_MAP';
var CONNECTION_EVENT_TYPES = {
  TOKEN_WILL_EXPIRE: 'TOKEN_WILL_EXPIRE',
  CONNECTION_STATUS_CHANGED: 'CONNECTION_STATUS_CHANGED',
  TOKEN_EXPIRED: 'TOKEN_EXPIRED'
};
var CONNECTION_STATUS = {
  CONNECTING: 'Connecting',
  CONNECTED: 'Connected',
  CONNECTING_FAILED: 'Failed',
  DISCONNECTED: 'Disconnected'
};

var initialState$3 = {
  connectionStatus: '',
  contactList: [],
  usersList: [],
  usersLoadingState: null,
  contactsMap: {},
  updatedUserMap: {},
  user: {
    id: '',
    firstName: '',
    lastName: '',
    state: ''
  },
  browserTabIsActive: true
};
var UserReducer = (function (state, _ref) {
  if (state === void 0) {
    state = initialState$3;
  }

  var type = _ref.type,
      payload = _ref.payload;

  var newState = _extends({}, state);

  switch (type) {
    case SET_CONNECTION_STATUS:
      {
        var status = payload.status;
        newState.connectionStatus = status;
        return newState;
      }

    case SET_USER:
      {
        newState.user = _extends({}, payload.user);
        return newState;
      }

    case SET_USERS:
      {
        newState.usersList = [].concat(payload.users);
        return newState;
      }

    case ADD_USERS:
      {
        newState.usersList = [].concat(newState.usersList, payload.users);
        return newState;
      }

    case SET_USERS_LOADING_STATE:
      {
        newState.usersLoadingState = payload.state;
        return newState;
      }

    case UPDATE_USER_MAP:
      {
        newState.updatedUserMap = payload.usersMap;
        return newState;
      }

    case SET_CONTACTS:
      {
        var contacts = payload.contacts;
        newState.contactList = [].concat(contacts);
        var contactsMap = {};
        contacts.forEach(function (contact) {
          contactsMap[contact.id] = contact;
        });
        newState.contactsMap = contactsMap;
        return newState;
      }

    case UPDATE_USER_PROFILE:
      {
        newState.user = _extends({}, newState.user, payload.profile);
        return newState;
      }

    case BROWSER_TAB_IS_ACTIVE:
      {
        newState.browserTabIsActive = payload.state;
        return newState;
      }

    case DESTROY_SESSION:
      {
        newState = initialState$3;
        return newState;
      }

    default:
      return state;
  }
});

var SET_THEME = 'SET_THEME';

var initialState$4 = {
  theme: 'light'
};
var ThemeReducer = (function (state, _ref) {
  if (state === void 0) {
    state = initialState$4;
  }

  var type = _ref.type,
      payload = _ref.payload;

  var newState = _extends({}, state);

  switch (type) {
    case SET_THEME:
      {
        var theme = payload.theme;
        newState.theme = theme;
        return newState;
      }

    default:
      return state;
  }
});

var reducers = redux.combineReducers({
  ChannelReducer: ChannelReducer,
  MessageReducer: MessageReducer,
  MembersReducer: MembersReducer,
  ThemeReducer: ThemeReducer,
  UserReducer: UserReducer
});

function createChannelAC(channelData, dontCreateIfNotExists) {
  return {
    type: CREATE_CHANNEL,
    payload: {
      channelData: channelData,
      dontCreateIfNotExists: dontCreateIfNotExists
    }
  };
}
function getChannelsAC(params, isJoinChannel) {
  return {
    type: GET_CHANNELS,
    payload: {
      params: params,
      isJoinChannel: isJoinChannel
    }
  };
}
function loadMoreChannels(limit) {
  return {
    type: LOAD_MORE_CHANNEL,
    payload: {
      limit: limit
    }
  };
}
function searchChannelsAC(params, contactsMap) {
  return {
    type: SEARCH_CHANNELS,
    payload: {
      params: params,
      contactsMap: contactsMap
    }
  };
}
function setSearchedChannelsAC(searchedChannels) {
  return {
    type: SET_SEARCHED_CHANNELS,
    payload: {
      searchedChannels: searchedChannels
    }
  };
}
function setCloseSearchChannelsAC(close) {
  return {
    type: SET_CLOSE_SEARCH_CHANNELS,
    payload: {
      close: close
    }
  };
}
function getChannelsForForwardAC(searchValue) {
  return {
    type: GET_CHANNELS_FOR_FORWARD,
    payload: {
      searchValue: searchValue
    }
  };
}
function addChannelsForForwardAC(channels) {
  return {
    type: ADD_CHANNELS_FOR_FORWARD,
    payload: {
      channels: channels
    }
  };
}
function setChannelsForForwardAC(channels) {
  return {
    type: SET_CHANNELS_FOR_FORWARD,
    payload: {
      channels: channels
    }
  };
}
function setChannelsLoadingStateAC(state, forForward) {
  return {
    type: SET_CHANNELS_LOADING_STATE,
    payload: {
      state: state,
      forForward: forForward
    }
  };
}
function channelHasNextAC(hasNext, forForward) {
  return {
    type: CHANNELS_HAS_NEXT,
    payload: {
      hasNext: hasNext,
      forForward: forForward
    }
  };
}
function loadMoreChannelsForForward(limit) {
  return {
    type: LOAD_MORE_CHANNELS_FOR_FORWARD,
    payload: {
      limit: limit
    }
  };
}
function searchChannelsForForwardAC(params, contactsMap) {
  return {
    type: SEARCH_CHANNELS_FOR_FORWARD,
    payload: {
      params: params,
      contactsMap: contactsMap
    }
  };
}
function setSearchedChannelsForForwardAC(searchedChannels) {
  return {
    type: SET_SEARCHED_CHANNELS_FOR_FORWARD,
    payload: {
      searchedChannels: searchedChannels
    }
  };
}
function addChannelAC(channel) {
  return {
    type: ADD_CHANNEL,
    payload: {
      channel: channel
    }
  };
}
function addChannelsAC(channels) {
  return {
    type: ADD_CHANNELS,
    payload: {
      channels: channels
    }
  };
}
function deleteChannelAC(channelId) {
  return {
    type: DELETE_CHANNEL,
    payload: {
      channelId: channelId
    }
  };
}
function blockChannelAC(channelId) {
  return {
    type: BLOCK_CHANNEL,
    payload: {
      channelId: channelId
    }
  };
}
function removeChannelAC(channelId) {
  return {
    type: REMOVE_CHANNEL,
    payload: {
      channelId: channelId
    }
  };
}
function removeChannelCachesAC(channelId) {
  return {
    type: REMOVE_CHANNEL_CACHES,
    payload: {
      channelId: channelId
    }
  };
}
function setChannelToAddAC(channel) {
  return {
    type: SET_CHANNEL_TO_ADD,
    payload: {
      channel: channel
    }
  };
}
function setAddedToChannelAC(channel) {
  return {
    type: SET_ADDED_TO_CHANNEL,
    payload: {
      channel: channel
    }
  };
}
function setChannelToRemoveAC(channel) {
  return {
    type: SET_CHANNEL_TO_REMOVE,
    payload: {
      channel: channel
    }
  };
}
function setChannelToHideAC(channel) {
  return {
    type: SET_CHANNEL_TO_HIDE,
    payload: {
      channel: channel
    }
  };
}
function setChannelToUnHideAC(channel) {
  return {
    type: SET_CHANNEL_TO_UNHIDE,
    payload: {
      channel: channel
    }
  };
}
function setChannelsAC(channels) {
  return {
    type: SET_CHANNELS,
    payload: {
      channels: channels
    }
  };
}
function setActiveChannelAC(channel) {
  return {
    type: SET_ACTIVE_CHANNEL,
    payload: {
      channel: channel
    }
  };
}
function switchChannelActionAC(channel) {
  return {
    type: SWITCH_CHANNEL,
    payload: {
      channel: channel
    }
  };
}
function updateChannelAC(channelId, config) {
  return {
    type: UPDATE_CHANNEL,
    payload: {
      channelId: channelId,
      config: config
    }
  };
}
function updateChannelDataAC(channelId, config, moveUp) {
  return {
    type: UPDATE_CHANNEL_DATA,
    payload: {
      channelId: channelId,
      config: config,
      moveUp: moveUp
    }
  };
}
function updateSearchedChannelDataAC(channelId, config, groupName) {
  return {
    type: UPDATE_SEARCHED_CHANNEL_DATA,
    payload: {
      channelId: channelId,
      updateData: config,
      groupName: groupName
    }
  };
}
function updateChannelLastMessageAC(message, channel) {
  return {
    type: UPDATE_CHANNEL_LAST_MESSAGE,
    payload: {
      message: message,
      channel: channel
    }
  };
}
function updateChannelLastMessageStatusAC(message, channel) {
  return {
    type: UPDATE_CHANNEL_LAST_MESSAGE_STATUS,
    payload: {
      message: message,
      channel: channel
    }
  };
}
function markMessagesAsReadAC(channelId, messageIds) {
  return {
    type: MARK_MESSAGES_AS_READ,
    payload: {
      channelId: channelId,
      messageIds: messageIds
    }
  };
}
function markMessagesAsDeliveredAC(channelId, messageIds) {
  return {
    type: MARK_MESSAGES_AS_DELIVERED,
    payload: {
      channelId: channelId,
      messageIds: messageIds
    }
  };
}
function sendTypingAC(state) {
  return {
    type: SEND_TYPING,
    payload: {
      state: state
    }
  };
}
function switchTypingIndicatorAC(typingState, channelId, from) {
  return {
    type: SWITCH_TYPING_INDICATOR,
    payload: {
      typingState: typingState,
      from: from,
      channelId: channelId
    }
  };
}
function turnOffNotificationsAC(expireTime) {
  return {
    type: TURN_OFF_NOTIFICATION,
    payload: {
      expireTime: expireTime
    }
  };
}
function turnOnNotificationsAC() {
  return {
    type: TURN_ON_NOTIFICATION
  };
}
function markChannelAsReadAC(channelId) {
  return {
    type: MARK_CHANNEL_AS_READ,
    payload: {
      channelId: channelId
    }
  };
}
function markChannelAsUnReadAC(channelId) {
  return {
    type: MARK_CHANNEL_AS_UNREAD,
    payload: {
      channelId: channelId
    }
  };
}
function switchChannelInfoAC(open) {
  return {
    type: CHANNEL_INFO_OPEN_CLOSE,
    payload: {
      open: open
    }
  };
}
function leaveChannelAC(channelId) {
  return {
    type: LEAVE_CHANNEL,
    payload: {
      channelId: channelId
    }
  };
}
function toggleEditChannelAC(state) {
  return {
    type: TOGGLE_EDIT_CHANNEL,
    payload: {
      state: state
    }
  };
}
function updateUserStatusOnChannelAC(usersMap) {
  return {
    type: UPDATE_USER_STATUS_ON_CHANNEL,
    payload: {
      usersMap: usersMap
    }
  };
}
function setChannelListWithAC(width) {
  return {
    type: SET_CHANNEL_LIST_WIDTH,
    payload: {
      width: width
    }
  };
}
function clearHistoryAC(channelId) {
  return {
    type: CLEAR_HISTORY,
    payload: {
      channelId: channelId
    }
  };
}
function deleteAllMessagesAC(channelId) {
  return {
    type: DELETE_ALL_MESSAGES,
    payload: {
      channelId: channelId
    }
  };
}
function joinChannelAC(channelId) {
  return {
    type: JOIN_TO_CHANNEL,
    payload: {
      channelId: channelId
    }
  };
}
function setIsDraggingAC(isDragging) {
  return {
    type: SET_IS_DRAGGING,
    payload: {
      isDragging: isDragging
    }
  };
}
function setDraggedAttachments(attachments, type) {
  return {
    type: SET_DRAGGED_ATTACHMENTS,
    payload: {
      attachments: attachments,
      type: type
    }
  };
}
function setTabIsActiveAC(isActive) {
  return {
    type: SET_TAB_IS_ACTIVE,
    payload: {
      isActive: isActive
    }
  };
}
function setHideChannelListAC(hide) {
  return {
    type: SET_HIDE_CHANNEL_LIST,
    payload: {
      hide: hide
    }
  };
}
function setChannelDraftMessageIsRemovedAC(channelId) {
  return {
    type: DRAFT_IS_REMOVED,
    payload: {
      channelId: channelId
    }
  };
}
function watchForEventsAC() {
  return {
    type: WATCH_FOR_EVENTS
  };
}
function destroySession() {
  return {
    type: DESTROY_SESSION
  };
}

var _avatarColors = ['#FF3E74', '#4F6AFF', '#FBB019', '#00CC99', '#9F35E7', '#63AFFF'];
var setAvatarColor = function setAvatarColor(colors) {
  _avatarColors = colors;
};
var getAvatarColors = function getAvatarColors() {
  return _avatarColors;
};

var _path$4;

function _extends$5() {
  _extends$5 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$5.apply(this, arguments);
}

function SvgClose(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$5({
    width: 12,
    height: 12,
    viewBox: "0 0 12.01 12.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$4 || (_path$4 = /*#__PURE__*/React.createElement("path", {
    d: "M11 1L1 11M1 1l10 10",
    stroke: "#707388",
    strokeWidth: 1.6,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })));
}

var _path$5;

function _extends$6() {
  _extends$6 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$6.apply(this, arguments);
}

function SvgSearch(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$6({
    width: 14,
    height: 14,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$5 || (_path$5 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M13.743 12.574L9.91 8.74a5.425 5.425 0 001.05-3.232A5.531 5.531 0 005.46 0 5.436 5.436 0 000 5.468a5.532 5.532 0 005.5 5.508 5.409 5.409 0 003.242-1.061l.004-.003 3.83 3.831a.827.827 0 101.167-1.169zM5.496 9.878a4.426 4.426 0 01-4.4-4.406 4.35 4.35 0 014.368-4.374 4.425 4.425 0 014.4 4.406 4.35 4.35 0 01-4.368 4.374z",
    fill: "#9294A1"
  })));
}

var _templateObject$1, _templateObject2$1, _templateObject3$1, _templateObject4$1, _templateObject5$1, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13, _templateObject14, _templateObject15, _templateObject16, _templateObject17, _templateObject18, _templateObject19, _templateObject20, _templateObject21, _templateObject22, _templateObject23, _templateObject24, _templateObject25, _templateObject26, _templateObject27, _templateObject28, _templateObject29, _templateObject30, _templateObject31, _templateObject32, _templateObject33, _templateObject34, _templateObject35, _templateObject36, _templateObject37, _templateObject38, _templateObject39, _templateObject40, _templateObject41, _templateObject42, _templateObject43, _templateObject44, _templateObject45;
function md5(inputString) {
  var hc = '0123456789abcdef';

  function rh(n) {
    var j;
    var s = '';

    for (j = 0; j <= 3; j++) {
      s += hc.charAt(n >> j * 8 + 4 & 0x0f) + hc.charAt(n >> j * 8 & 0x0f);
    }

    return s;
  }

  function ad(x, y) {
    var l = (x & 0xffff) + (y & 0xffff);
    var m = (x >> 16) + (y >> 16) + (l >> 16);
    return m << 16 | l & 0xffff;
  }

  function rl(n, c) {
    return n << c | n >>> 32 - c;
  }

  function cm(q, a, b, x, s, t) {
    return ad(rl(ad(ad(a, q), ad(x, t)), s), b);
  }

  function ff(a, b, c, d, x, s, t) {
    return cm(b & c | ~b & d, a, b, x, s, t);
  }

  function gg(a, b, c, d, x, s, t) {
    return cm(b & d | c & ~d, a, b, x, s, t);
  }

  function hh(a, b, c, d, x, s, t) {
    return cm(b ^ c ^ d, a, b, x, s, t);
  }

  function ii(a, b, c, d, x, s, t) {
    return cm(c ^ (b | ~d), a, b, x, s, t);
  }

  function sb(x) {
    var i;
    var nblk = (x.length + 8 >> 6) + 1;
    var blks = new Array(nblk * 16);

    for (i = 0; i < nblk * 16; i++) {
      blks[i] = 0;
    }

    for (i = 0; i < x.length; i++) {
      blks[i >> 2] |= x.charCodeAt(i) << i % 4 * 8;
    }

    blks[i >> 2] |= 0x80 << i % 4 * 8;
    blks[nblk * 16 - 2] = x.length * 8;
    return blks;
  }

  var i;
  var x = sb(inputString);
  var a = 1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d = 271733878;
  var olda;
  var oldb;
  var oldc;
  var oldd;

  for (i = 0; i < x.length; i += 16) {
    olda = a;
    oldb = b;
    oldc = c;
    oldd = d;
    a = ff(a, b, c, d, x[i], 7, -680876936);
    d = ff(d, a, b, c, x[i + 1], 12, -389564586);
    c = ff(c, d, a, b, x[i + 2], 17, 606105819);
    b = ff(b, c, d, a, x[i + 3], 22, -1044525330);
    a = ff(a, b, c, d, x[i + 4], 7, -176418897);
    d = ff(d, a, b, c, x[i + 5], 12, 1200080426);
    c = ff(c, d, a, b, x[i + 6], 17, -1473231341);
    b = ff(b, c, d, a, x[i + 7], 22, -45705983);
    a = ff(a, b, c, d, x[i + 8], 7, 1770035416);
    d = ff(d, a, b, c, x[i + 9], 12, -1958414417);
    c = ff(c, d, a, b, x[i + 10], 17, -42063);
    b = ff(b, c, d, a, x[i + 11], 22, -1990404162);
    a = ff(a, b, c, d, x[i + 12], 7, 1804603682);
    d = ff(d, a, b, c, x[i + 13], 12, -40341101);
    c = ff(c, d, a, b, x[i + 14], 17, -1502002290);
    b = ff(b, c, d, a, x[i + 15], 22, 1236535329);
    a = gg(a, b, c, d, x[i + 1], 5, -165796510);
    d = gg(d, a, b, c, x[i + 6], 9, -1069501632);
    c = gg(c, d, a, b, x[i + 11], 14, 643717713);
    b = gg(b, c, d, a, x[i], 20, -373897302);
    a = gg(a, b, c, d, x[i + 5], 5, -701558691);
    d = gg(d, a, b, c, x[i + 10], 9, 38016083);
    c = gg(c, d, a, b, x[i + 15], 14, -660478335);
    b = gg(b, c, d, a, x[i + 4], 20, -405537848);
    a = gg(a, b, c, d, x[i + 9], 5, 568446438);
    d = gg(d, a, b, c, x[i + 14], 9, -1019803690);
    c = gg(c, d, a, b, x[i + 3], 14, -187363961);
    b = gg(b, c, d, a, x[i + 8], 20, 1163531501);
    a = gg(a, b, c, d, x[i + 13], 5, -1444681467);
    d = gg(d, a, b, c, x[i + 2], 9, -51403784);
    c = gg(c, d, a, b, x[i + 7], 14, 1735328473);
    b = gg(b, c, d, a, x[i + 12], 20, -1926607734);
    a = hh(a, b, c, d, x[i + 5], 4, -378558);
    d = hh(d, a, b, c, x[i + 8], 11, -2022574463);
    c = hh(c, d, a, b, x[i + 11], 16, 1839030562);
    b = hh(b, c, d, a, x[i + 14], 23, -35309556);
    a = hh(a, b, c, d, x[i + 1], 4, -1530992060);
    d = hh(d, a, b, c, x[i + 4], 11, 1272893353);
    c = hh(c, d, a, b, x[i + 7], 16, -155497632);
    b = hh(b, c, d, a, x[i + 10], 23, -1094730640);
    a = hh(a, b, c, d, x[i + 13], 4, 681279174);
    d = hh(d, a, b, c, x[i], 11, -358537222);
    c = hh(c, d, a, b, x[i + 3], 16, -722521979);
    b = hh(b, c, d, a, x[i + 6], 23, 76029189);
    a = hh(a, b, c, d, x[i + 9], 4, -640364487);
    d = hh(d, a, b, c, x[i + 12], 11, -421815835);
    c = hh(c, d, a, b, x[i + 15], 16, 530742520);
    b = hh(b, c, d, a, x[i + 2], 23, -995338651);
    a = ii(a, b, c, d, x[i], 6, -198630844);
    d = ii(d, a, b, c, x[i + 7], 10, 1126891415);
    c = ii(c, d, a, b, x[i + 14], 15, -1416354905);
    b = ii(b, c, d, a, x[i + 5], 21, -57434055);
    a = ii(a, b, c, d, x[i + 12], 6, 1700485571);
    d = ii(d, a, b, c, x[i + 3], 10, -1894986606);
    c = ii(c, d, a, b, x[i + 10], 15, -1051523);
    b = ii(b, c, d, a, x[i + 1], 21, -2054922799);
    a = ii(a, b, c, d, x[i + 8], 6, 1873313359);
    d = ii(d, a, b, c, x[i + 15], 10, -30611744);
    c = ii(c, d, a, b, x[i + 6], 15, -1560198380);
    b = ii(b, c, d, a, x[i + 13], 21, 1309151649);
    a = ii(a, b, c, d, x[i + 4], 6, -145523070);
    d = ii(d, a, b, c, x[i + 11], 10, -1120210379);
    c = ii(c, d, a, b, x[i + 2], 15, 718787259);
    b = ii(b, c, d, a, x[i + 9], 21, -343485551);
    a = ad(a, olda);
    b = ad(b, oldb);
    c = ad(c, oldc);
    d = ad(d, oldd);
  }

  return rh(a) + rh(b) + rh(c) + rh(d);
}
var GlobalStyles = styled.createGlobalStyle(_templateObject$1 || (_templateObject$1 = _taggedTemplateLiteralLoose(["\n\n  .mention_menu_item-active {\n    background: #e6f7ff;\n  }\n\n  @keyframes makeVisible {\n    0% {\n      opacity: 0;\n      visibility: visible;\n    }\n    100% {\n      opacity: 1;\n      visibility: visible;\n    }\n  }\n"])));
function generateAvatarColor(itemName) {
  var avatarColors = getAvatarColors();

  if (itemName && itemName !== '') {
    var hash = md5(itemName).toString().padStart(32, '0').slice(-6);
    var hashInt = parseInt(hash, 16);
    var colorIndex = hashInt % avatarColors.length;
    return avatarColors[colorIndex];
  }

  return null;
}
var DropdownOptionsUl = styled__default.ul(_templateObject2$1 || (_templateObject2$1 = _taggedTemplateLiteralLoose(["\n  list-style: none;\n  margin: 0;\n  padding: 0;\n"])));
var DropdownOptionLi = styled__default.li(_templateObject3$1 || (_templateObject3$1 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  line-height: 20px;\n  color: ", ";\n  margin: ", ";\n  padding: 6px 6px 6px 16px;\n\n  &:hover {\n    background: ", ";\n  }\n\n  & > svg {\n    width: ", ";\n    min-width: ", ";\n    height: ", ";\n    color: ", ";\n    margin-right: 10px;\n  }\n"])), function (props) {
  return props.textColor || colors.textColor1;
}, function (props) {
  return props.margin;
}, function (props) {
  return props.hoverBackground || colors.gray0;
}, function (props) {
  return props.iconWidth;
}, function (props) {
  return props.iconWidth;
}, function (props) {
  return props.iconWidth;
}, function (props) {
  return props.iconColor;
});
var CustomSelect = styled__default.div(_templateObject4$1 || (_templateObject4$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: 40px;\n  min-height: 40px;\n  width: 100%;\n  min-width: ", ";\n  max-width: ", ";\n  background: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  border-radius: 4px;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 14px;\n  line-height: 16px;\n  color: ", ";\n  margin-top: ", ";\n\n  ::placeholder {\n    color: ", ";\n  }\n\n  &:disabled {\n    background-color: ", ";\n  }\n\n  .dropdown-wrapper {\n    width: 100%;\n  }\n\n  .dropdown-body {\n    width: 100%;\n  }\n\n  .dropdown-trigger {\n    & .default-selection {\n      color: ", ";\n    }\n\n    //width: calc(100% - 20px);\n  }\n"])), function (props) {
  return props.minWidth;
}, function (props) {
  return props.maxWidth;
}, function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.isError ? "1px solid " + colors.red1 : "1px solid " + colors.gray1;
}, function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.marginTop;
}, colors.textColor3, colors.gray1, colors.textColor3);
var CustomSelectTrigger = styled__default.span(_templateObject5$1 || (_templateObject5$1 = _taggedTemplateLiteralLoose(["\n  display: block;\n  width: calc(100% - 22px);\n  padding: 8px 10px 8px 15px;\n  text-align: left;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 14px;\n  line-height: 23px;\n  color: ", ";\n  text-transform: capitalize;\n"])), function (props) {
  return props.color || colors.textColor1;
});
var Label = styled__default.label(_templateObject6 || (_templateObject6 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 13px;\n  line-height: 20px;\n  margin-top: 20px;\n  margin-bottom: 4px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var UploadFile = styled__default.input(_templateObject7 || (_templateObject7 = _taggedTemplateLiteralLoose(["\n  display: none;\n"])));
var UploadFileLabel = styled__default.label(_templateObject8 || (_templateObject8 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  width: 100%;\n  display: block;\n"])));
var InputErrorMessage = styled__default.p(_templateObject9 || (_templateObject9 = _taggedTemplateLiteralLoose(["\n  font-size: 12px;\n  color: ", ";\n  margin: 4px 0 0;\n"])), colors.red1);
var CustomInput = styled__default.input(_templateObject10 || (_templateObject10 = _taggedTemplateLiteralLoose(["\n  height: 40px;\n  width: 100%;\n  background: ", ";\n  border: ", ";\n  color: ", ";\n  box-sizing: border-box;\n  border-radius: 8px;\n  padding: 11px 14px;\n  font-family: Inter, sans-serif;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 15px;\n  line-height: 20px;\n  opacity: 1;\n  outline: none;\n\n  &:focus {\n    border: 1px solid ", ";\n    outline: ", ";\n  }\n  &:disabled {\n    background-color: ", ";\n    opacity: 1;\n    color: #383b51;\n  }\n  &::placeholder {\n    opacity: 1;\n    color: ", ";\n  }\n"])), function (props) {
  return props.theme === THEME.DARK ? colors.backgroundColor : colors.white;
}, function (props) {
  return props.error ? "1px solid " + colors.red1 : props.theme !== THEME.DARK ? "1px solid " + colors.gray1 : 'none';
}, function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.error ? "1px solid " + colors.red1 : colors.primary;
}, function (props) {
  return props.error ? "1px solid " + colors.red2 : props.theme !== THEME.DARK ? "2px solid " + colors.backgroundColor : 'none';
}, colors.gray0, colors.textColor3);
var FilterField = styled__default.div(_templateObject11 || (_templateObject11 = _taggedTemplateLiteralLoose(["\n  border: 1px solid #d7d8e3;\n  border-radius: 4px;\n  background-color: transparent;\n  margin-left: 12px;\n"])));
var FilterFieldSpan = styled__default.span(_templateObject12 || (_templateObject12 = _taggedTemplateLiteralLoose(["\n  display: block;\n  width: 100px;\n  padding: 8px 0 8px 8px;\n  text-align: left;\n  font-size: 0.875rem;\n  line-height: 1rem;\n"])));
var CustomRadioWrapper = styled__default.div(_templateObject13 || (_templateObject13 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  margin-top: 16px;\n  label {\n    font-size: 14px;\n    line-height: 16px;\n    color: ", ";\n  }\n"])), colors.textColor1);
var CustomRadio = styled__default.input(_templateObject14 || (_templateObject14 = _taggedTemplateLiteralLoose(["\n  height: 16px;\n  width: 16px;\n  margin: 0 10px 0 0;\n  cursor: pointer;\n"])));
var Row = styled__default.div(_templateObject15 || (_templateObject15 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: row;\n  margin: ", ";\n  margin-top: ", ";\n  margin-bottom: ", ";\n  margin-right: ", ";\n  margin-left: ", ";\n  align-items: ", ";\n  justify-content: ", ";\n  width: ", ";\n  height: ", ";\n  min-height: ", ";\n  padding: ", ";\n  padding-left: ", ";\n  padding-right: ", ";\n  flex-wrap: ", ";\n"])), function (props) {
  return props.margin;
}, function (props) {
  return props.marginTop;
}, function (props) {
  return props.marginBottom;
}, function (props) {
  return props.marginRight;
}, function (props) {
  return props.marginLeft;
}, function (props) {
  return props.align;
}, function (props) {
  return props.justify;
}, function (props) {
  return props.width;
}, function (props) {
  return props.height;
}, function (props) {
  return props.minHeight;
}, function (props) {
  return props.padding;
}, function (props) {
  return props.paddingLeft;
}, function (props) {
  return props.paddingRight;
}, function (props) {
  return props.flexWrap;
});
var Button = styled__default.button(_templateObject16 || (_templateObject16 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  box-sizing: border-box;\n  text-decoration: none;\n  outline: none;\n  cursor: ", ";\n  text-align: center;\n  font-style: normal;\n  border-radius: ", ";\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 20px;\n  padding: 8px 16px;\n  background-color: ", ";\n  color: ", ";\n  border: 1px solid ", ";\n  margin: ", ";\n  user-select: none;\n  transition: opacity 0.1s;\n  opacity: ", ";\n  &:hover,\n  &:focus {\n    opacity: ", ";\n  }\n"])), function (props) {
  return !props.disabled && 'pointer';
}, function (props) {
  return props.borderRadius || '4px';
}, function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.color || (props.backgroundColor ? colors.white : colors.textColor1);
}, function (props) {
  return props.backgroundColor || colors.gray1;
}, function (props) {
  return props.margin || '0';
}, function (props) {
  return props.disabled ? 0.5 : 1;
}, function (props) {
  return props.disabled ? 0.5 : 0.8;
});
var PopupName = styled__default.h3(_templateObject17 || (_templateObject17 = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: 500;\n  font-size: 20px;\n  line-height: 23px;\n  color: ", ";\n  margin: 0;\n  margin-top: ", ";\n  margin-bottom: ", ";\n  padding: ", ";\n  word-break: break-word;\n\n  ", "\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.marginTop;
}, function (props) {
  return props.marginBottom;
}, function (props) {
  return props.padding;
}, function (props) {
  if (props.isDelete) {
    return "\n            max-width: calc(100% - 20px);\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n        ";
  }

  return '';
});
var ButtonBlock = styled__default.div(_templateObject18 || (_templateObject18 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  margin-top: ", ";\n  padding-right: ", ";\n  justify-content: ", ";\n  height: ", ";\n  min-height: ", ";\n  background-color: ", ";\n\n  a {\n    width: 88px;\n    height: 40px;\n    margin: 0 4px;\n    font-size: 15px;\n    font-weight: 500;\n  }\n"])), function (props) {
  return props.marginTop || '10px';
}, function (props) {
  return props.paddingRight || '0px';
}, function (props) {
  return props.justify || 'flex-end';
}, function (props) {
  return props.height;
}, function (props) {
  return props.height;
}, function (props) {
  return props.backgroundColor;
});
var Popup = styled__default.div(_templateObject19 || (_templateObject19 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  min-height: 150px;\n  min-width: ", ";\n  max-width: ", ";\n  max-height: ", ";\n  width: ", ";\n  height: ", ";\n  display: ", ";\n  flex-direction: column;\n  padding: ", ";\n  background: ", ";\n  box-shadow: ", ";\n  border-radius: 8px;\n  box-sizing: border-box;\n\n  ", ";\n"])), function (props) {
  return props.minWidth || '400px';
}, function (props) {
  return props.maxWidth || '600px';
}, function (props) {
  return props.maxHeight || '650px';
}, function (props) {
  return props.width || 'unset';
}, function (props) {
  return props.height || 'unset';
}, function (props) {
  return props.display || 'flex';
}, function (props) {
  return props.padding ? props.padding : '22px 24px';
}, function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.boxShadow || '4px 4px 30px rgba(0, 0, 0, 0.06)';
}, function (props) {
  return props.isLoading && "\n        user-select: none;\n\n        & > * {\n           pointer-events: none;\n           user-select: none;\n        }\n\n         " + ButtonBlock + " {\n          a, button {\n            pointer-events: none;\n            user-select: none;\n            opacity: 0.7;\n          }\n        }\n    ";
});
var PopupBody = styled__default.div(_templateObject20 || (_templateObject20 = _taggedTemplateLiteralLoose(["\n  padding: ", ";\n  margin-bottom: 8px;\n  height: ", ";\n"])), function (props) {
  return (props.paddingV || 0) + " " + (props.paddingH || 0);
}, function (props) {
  return props.withFooter ? "calc(100% - (54px + " + props.paddingV + "))" : 'calc(100% - 54px)';
});
var PopupDescription = styled__default.span(_templateObject21 || (_templateObject21 = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: normal;\n  font-size: 15px;\n  line-height: 22px;\n  color: ", ";\n  cursor: default;\n  white-space: pre-line;\n  margin-top: ", ";\n  margin-bottom: ", ";\n  word-break: break-word;\n\n  .highlight {\n    text-decoration: underline;\n    font-weight: 500;\n    color: ", ";\n  }\n"])), colors.textColor2, function (props) {
  return props.marginTop || '10px';
}, function (props) {
  return props.marginBottom || '10px';
}, colors.primary);
var BoltText = styled__default.span(_templateObject22 || (_templateObject22 = _taggedTemplateLiteralLoose(["\n  font-weight: 500;\n"])));
var PopupFooter = styled__default(ButtonBlock)(_templateObject23 || (_templateObject23 = _taggedTemplateLiteralLoose(["\n  margin-top: ", ";\n  padding: 8px 16px;\n  border-radius: 0 0 8px 8px;\n  z-index: 2;\n"])), function (props) {
  return props.marginTop || '0';
});
var SectionHeader = styled__default.h4(_templateObject24 || (_templateObject24 = _taggedTemplateLiteralLoose(["\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 20px;\n  color: ", ";\n  margin: ", ";\n  text-transform: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.margin || 0;
}, function (props) {
  return props.uppercase && 'uppercase';
});
var ItemNote = styled__default.div(_templateObject25 || (_templateObject25 = _taggedTemplateLiteralLoose(["\n  display: none;\n  position: absolute;\n  z-index: 301;\n  padding: 10px 12px;\n  background-color: ", ";\n  border-radius: 12px;\n  font-size: 0.75rem;\n  white-space: nowrap;\n  font-weight: 600;\n  color: white;\n  pointer-events: none;\n  user-select: none;\n\n  &::before {\n    content: '';\n    position: absolute;\n    z-index: -1;\n    background-color: ", ";\n    border-radius: 3px;\n    width: 14px;\n    height: 14px;\n\n    ", " ", "\n  }\n\n  ", " ", " ", " ", "\n"])), colors.textColor1, colors.textColor1, function (props) {
  return props.direction === 'right' && "\n            left: -5px;\n            top: 50%;\n            transform: translateY(-50%) rotate(45deg);\n        ";
}, function (props) {
  return props.direction === 'top' && "\n            bottom: -5px;\n            left: 50%;\n            transform: translateX(-50%) rotate(45deg);\n        ";
}, function (props) {
  return props.visible && "\n       display: block;\n    ";
}, function (props) {
  return props.direction === 'right' && "\n        top: 50%;\n        left: calc(100% + 15px);\n        transform: translateY(-50%);\n    ";
}, function (props) {
  return props.direction === 'top' && "\n        bottom: calc(100% + 15px);\n        left: 50%;\n        transform: translateX(-50%);\n    ";
}, function (props) {
  return props.disabled && "\n        color: " + colors.textColor2 + ";\n    ";
});
var CustomSwitcher = styled__default.div(_templateObject26 || (_templateObject26 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  position: relative;\n"])));
var SwitcherLabel = styled__default.label(_templateObject27 || (_templateObject27 = _taggedTemplateLiteralLoose(["\n  width: 48px;\n  height: 28px;\n  background: rgb(226, 226, 226);\n  display: inline-block;\n  border-radius: 50px;\n  position: relative;\n  transition: all 0.3s ease;\n  transform-origin: 20% center;\n  border: 3px solid #fff;\n  cursor: pointer;\n\n  &:before {\n    content: '';\n    position: absolute;\n    display: block;\n    transition: all 0.2s ease;\n    width: 24px;\n    height: 24px;\n    top: 2px;\n    left: 2px;\n    border-radius: 20px;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.251475), 0 2px 6px rgba(0, 0, 0, 0.404256);\n    background: #fff;\n  }\n"])));
var UploadAvatarButton = styled__default.button(_templateObject28 || (_templateObject28 = _taggedTemplateLiteralLoose(["\n  display: block;\n  height: 32px;\n  margin-top: 8px;\n  border: none;\n  color: #fff;\n  font-weight: 500;\n  font-size: 14px;\n  background: ", ";\n  border-radius: 4px;\n  outline: none !important;\n  cursor: pointer;\n  padding: 7px 12px;\n  line-height: 10px;\n"])), colors.primary);
var UploadAvatarHandler = styled__default.div(_templateObject29 || (_templateObject29 = _taggedTemplateLiteralLoose(["\n  margin-left: 18px;\n  font-size: 13px;\n  color: ", ";\n"])), colors.textColor1);
var MentionedUser = styled__default.span(_templateObject30 || (_templateObject30 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  font-weight: ", ";\n"])), function (props) {
  return props.isLastMessage ? colors.textColor2 : props.color || colors.primary;
}, function (props) {
  return props.isLastMessage && '500';
});
var StyledText = styled__default.span(_templateObject31 || (_templateObject31 = _taggedTemplateLiteralLoose(["\n  font-weight: ", ";\n  font-family: ", ";\n  font-style: ", ";\n  text-decoration: ", ";\n  letter-spacing: ", ";\n  &.bold {\n    font-weight: bold;\n  }\n  &.italic {\n    font-style: italic;\n  }\n  &.underline {\n    text-decoration: underline;\n  }\n  &.strikethrough {\n    text-decoration: line-through;\n  }\n  &.underline.strikethrough {\n    text-decoration: underline line-through;\n  }\n  &.monospace {\n    letter-spacing: 4px;\n  }\n"])), function (props) {
  return props.fontWeight || props.isLastMessage && '500';
}, function (props) {
  return props.fontFamily;
}, function (props) {
  return props.fontStyle;
}, function (props) {
  return props.textDecoration;
}, function (props) {
  return props.letterSpacing;
});
var MessageOwner = styled__default.h3(_templateObject32 || (_templateObject32 = _taggedTemplateLiteralLoose(["\n  margin: 0 12px 4px 0;\n  white-space: nowrap;\n  color: ", ";\n  margin-left: ", ";\n  font-weight: 500;\n  font-size: ", ";\n  line-height: ", ";\n  cursor: ", ";\n  overflow: hidden;\n  text-overflow: ellipsis;\n"])), function (props) {
  return props.color || colors.primary;
}, function (props) {
  return props.rtlDirection && 'auto';
}, function (props) {
  return props.fontSize || '15px';
}, function (props) {
  return props.fontSize || '15px';
}, function (props) {
  return props.clickable && 'pointer';
});
var MessageText = styled__default.pre(_templateObject33 || (_templateObject33 = _taggedTemplateLiteralLoose(["\n  display: flow-root;\n  position: relative;\n  font-family: ", ";\n  margin: 0;\n  padding: ", ";\n  padding-bottom: ", ";\n  //font-size: ", ";\n  font-size: ", ";\n  font-weight: 400;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  //white-space: normal;\n  line-height: ", ";\n  //letter-spacing: -0.2px;\n  letter-spacing: 0.3px;\n  color: ", ";\n  user-select: text;\n\n  ", "\n\n  &::after {\n    content: '';\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    height: 1px;\n  }\n\n  & a {\n    color: ", ";\n  }\n"])), function (props) {
  return props.fontFamily || 'sans-serif';
}, function (props) {
  return props.withAttachment && (props.showMessageSenderName ? props.withPaddings ? '0 12px 10px' : '0 0 10px' : props.isForwarded ? props.withPaddings ? '4px 12px 10px' : '4px 0px 10px' : '8px 12px 10px');
}, function (props) {
  return props.withAttachment && !props.withMediaAttachment && '2px';
}, function (props) {
  return props.fontSize || '15px';
}, function (props) {
  return props.fontSize || '16px';
}, function (props) {
  return props.lineHeight || '20px';
}, function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.isRepliedMessage && "\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n  ";
}, colors.blue);
var ReplyMessageText = styled__default.span(_templateObject34 || (_templateObject34 = _taggedTemplateLiteralLoose(["\n  display: -webkit-box;\n  position: relative;\n  margin: 0;\n  padding: ", ";\n  font-size: ", ";\n  font-weight: 400;\n  line-height: ", ";\n  letter-spacing: -0.2px;\n  color: ", ";\n  user-select: text;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n\n  & a {\n    color: ", ";\n  }\n"])), function (props) {
  return props.withAttachment && props.showMessageSenderName ? '0 12px 10px' : props.withAttachment ? '8px 12px 10px' : '';
}, function (props) {
  return props.fontSize || '15px';
}, function (props) {
  return props.lineHeight || '20px';
}, colors.textColor1, colors.blue);
var CloseIcon = styled__default(SvgClose)(_templateObject35 || (_templateObject35 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: 13px;\n  right: 13px;\n  cursor: pointer;\n  padding: 15px;\n  box-sizing: content-box;\n  color: ", ";\n"])), function (props) {
  return props.color;
});
var ClearTypedText = styled__default(CloseIcon)(_templateObject36 || (_templateObject36 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: 8px;\n  right: 10px;\n  cursor: pointer;\n  padding: 4px;\n"])));
var StyledSearchSvg = styled__default(SvgSearch)(_templateObject37 || (_templateObject37 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  position: absolute;\n  top: 12px;\n  left: ", ";\n"])), function (props) {
  return props.left || '14px';
});
var SubTitle = styled__default.span(_templateObject38 || (_templateObject38 = _taggedTemplateLiteralLoose(["\n  font-size: 13px;\n  line-height: 16px;\n  letter-spacing: -0.078px;\n  color: ", ";\n  margin: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
}, function (props) {
  return props.margin;
});
var AttachmentIconCont = styled__default.span(_templateObject39 || (_templateObject39 = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  width: 40px;\n  height: 40px;\n  background-color: ", ";\n  border-radius: 50%;\n"])), function (props) {
  return props.backgroundColor || colors.primary;
});
var UploadingIcon = styled__default.span(_templateObject40 || (_templateObject40 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  border-style: solid;\n  border-color: ", ";\n  border-width: ", ";\n  border-top-width: ", ";\n  border-top-color: rgba(0, 0, 0, 0);\n  border-radius: 50%;\n  width: ", ";\n  height: ", ";\n\n  animation: preloader 1.5s linear infinite;\n\n  @keyframes preloader {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n"])), function (props) {
  return props.color || 'rgba(255, 255, 255, 0.8)';
}, function (props) {
  return props.borderWidth || (props.fileAttachment ? '2px' : '3px');
}, function (props) {
  return props.borderWidth || (props.fileAttachment ? '2px' : '3px');
}, function (props) {
  return props.width || (props.fileAttachment ? '26px' : props.isRepliedMessage ? '28px' : '40px');
}, function (props) {
  return props.height || (props.fileAttachment ? '26px' : props.isRepliedMessage ? '28px' : '40px');
});
var TextInOneLine = styled__default.span(_templateObject41 || (_templateObject41 = _taggedTemplateLiteralLoose(["\n  display: -webkit-box;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"])));
var CancelResumeWrapper = styled__default.span(_templateObject42 || (_templateObject42 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  z-index: 3;\n\n  > svg {\n    width: 20px;\n    height: 20px;\n  }\n"])));
var UploadPercent = styled__default.span(_templateObject43 || (_templateObject43 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  color: #fff;\n  width: ", ";\n  height: ", ";\n  //background-color: rgba(0,0,0,0.4);\n  background-color: ", ";\n  border-radius: ", ";\n}\n  ", "\n"])), function (props) {
  return props.fileAttachment || props.isRepliedMessage || props.isDetailsView ? '40px' : '56px';
}, function (props) {
  return props.fileAttachment || props.isRepliedMessage || props.isDetailsView ? '40px' : '56px';
}, function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.borderRadius ? props.borderRadius : props.fileAttachment ? '8px' : props.isRepliedMessage ? '4px' : ' 50%';
}, function (props) {
  return (props.fileAttachment || props.isRepliedMessage) && "& > svg {\n    width: 15px;\n    height: 15px;\n  }";
});
var UploadProgress = styled__default.div(_templateObject44 || (_templateObject44 = _taggedTemplateLiteralLoose(["\n  position: ", ";\n  top: ", ";\n  left: ", ";\n  width: ", ";\n  height: ", ";\n  min-width: ", ";\n  min-height: ", ";\n  display: flex;\n  //display: none;\n  align-items: center;\n  justify-content: center;\n  //border-radius: ", ";\n  background-image: url(", ");\n  background-size: cover;\n  background-position: center;\n  border-radius: ", ";\n  z-index: ", ";\n  cursor: pointer;\n  border: ", ";\n  box-sizing: border-box;\n  /* ", "*/\n  ", "\n  ", "\n"])), function (props) {
  return !props.positionStatic && 'absolute';
}, function (props) {
  return props.fileAttachment ? '8px' : '0';
}, function (props) {
  return props.fileAttachment ? '12px' : '0';
}, function (props) {
  return props.fileAttachment || props.isRepliedMessage ? '40px' : props.width ? props.width + "px" : '100%';
}, function (props) {
  return props.fileAttachment || props.isRepliedMessage ? '40px' : props.height ? props.height + "px" : '100%';
}, function (props) {
  return !props.fileAttachment && !props.isRepliedMessage ? props.imageMinWidth || '165px' : null;
}, function (props) {
  return !props.fileAttachment && !props.isRepliedMessage && !props.isDetailsView && '165px';
}, function (props) {
  return props.fileAttachment ? '8px' : props.isRepliedMessage ? '4px' : ' 50%';
}, function (props) {
  return "" + (props.withPrefix ? 'data:image/jpeg;base64,' : '') + props.backgroundImage;
}, function (props) {
  return props.fileAttachment ? '8px' : props.borderRadius ? props.borderRadius : props.isRepliedMessage ? '4px' : '8px';
}, function (props) {
  return props.zIndex || 5;
}, function (props) {
  return props.isRepliedMessage ? '0.5px solid rgba(0, 0, 0, 0.1)' : props.withBorder && "2px solid " + props.backgroundColor;
}, function (props) {
  return props.isFailedAttachment && 'background-color: rgba(237, 77, 96, 0.1);';
}, function (props) {
  return props.whiteBackground && "\n    background-color: rgba(255,255,255,0.3);\n    border: 1px solid  " + colors.gray1 + ";\n\n    " + UploadingIcon + " {\n        border: 4px solid rgba(238,238,238,0.8);\n        border-top: 4px solid " + colors.primary + ";\n    }\n  ";
}, function (props) {
  return props.isDetailsView && "\n    width: 100%;\n    height: 100%;\n    min-width: inherit;\n  ";
});
var AttachmentPreviewTitle = styled__default.span(_templateObject45 || (_templateObject45 = _taggedTemplateLiteralLoose(["\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 20px);\n  font-style: normal;\n  font-weight: normal;\n  font-size: 15px;\n  line-height: 20px;\n  height: 20px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});

var makeUsername = function makeUsername(contact, user, fromContact, getFirstNameOnly) {
  var _contact$lastName;

  if (hideUserPresence && user && user.id && hideUserPresence(user)) {
    return user.id.toUpperCase();
  }

  return fromContact && contact ? contact.firstName ? getFirstNameOnly ? "" + contact.firstName.split(' ')[0] : contact.firstName.trim() + " " + ((_contact$lastName = contact.lastName) === null || _contact$lastName === void 0 ? void 0 : _contact$lastName.trim()) : contact.id : user ? user.firstName ? getFirstNameOnly ? "" + (fromContact ? '~' : '') + user.firstName.split(' ')[0] : "" + (fromContact ? '~' : '') + user.firstName.trim() + " " + user.lastName.trim() : user.id || 'Deleted user' : 'Deleted user';
};
var isJSON = function isJSON(str) {
  try {
    return JSON.parse(str) && !!str;
  } catch (e) {
    return false;
  }
};

var linkifyTextPart = function linkifyTextPart(textPart, match) {
  var newMessageText;
  var prevMatchEnd = 0;
  var lastFoundIndex = 0;
  match.forEach(function (matchItem, index) {
    var matchIndex = textPart.indexOf(matchItem.text, lastFoundIndex);
    lastFoundIndex = matchIndex + matchItem.text.length;

    if (index === 0) {
      newMessageText = [textPart.substring(0, matchIndex), /*#__PURE__*/React__default.createElement("a", {
        draggable: false,
        key: index,
        href: matchItem.url,
        target: '_blank',
        rel: 'noreferrer'
      }, "" + matchItem.text)];
    } else {
      newMessageText.push(textPart.substring(prevMatchEnd, matchIndex), /*#__PURE__*/React__default.createElement("a", {
        draggable: false,
        key: index,
        href: matchItem.url,
        target: '_blank',
        rel: 'noreferrer'
      }, "" + matchItem.text));
    }

    prevMatchEnd = matchIndex + matchItem.text.length;

    if (index === match.length - 1) {
      newMessageText.push(textPart.substring(prevMatchEnd));
    }
  });
  return newMessageText || textPart;
};

var combineMessageAttributes = function combineMessageAttributes(attributes) {
  var attributesPositions = attributes.sort(function (a, b) {
    return a.offset - b.offset;
  });
  var combinedAttributes = {};
  attributesPositions.forEach(function (attribute) {
    var offset = attribute.offset;
    var typeValue = attribute.type;

    if (offset in combinedAttributes) {
      combinedAttributes[offset].type += " " + typeValue;
    } else {
      combinedAttributes[offset] = {
        type: typeValue,
        metadata: attribute.metadata,
        offset: offset,
        length: attribute.length
      };
    }
  });
  return Object.values(combinedAttributes);
};
var MessageTextFormat = function MessageTextFormat(_ref2) {
  var text = _ref2.text,
      message = _ref2.message,
      contactsMap = _ref2.contactsMap,
      getFromContacts = _ref2.getFromContacts,
      isLastMessage = _ref2.isLastMessage,
      asSampleText = _ref2.asSampleText;
  var messageText = [];
  var linkify = new LinkifyIt();
  var messageBodyAttributes = JSON.parse(JSON.stringify(message.bodyAttributes));

  if (message.body && messageBodyAttributes && messageBodyAttributes.length > 0) {
    var combinedAttributesList = combineMessageAttributes(messageBodyAttributes);
    var textPart = text;
    var nextPartIndex;
    combinedAttributesList.forEach(function (attribute, index) {
      var attributeOffset = attribute.offset;

      try {
        var firstPart = "" + (textPart ? textPart === null || textPart === void 0 ? void 0 : textPart.substring(nextPartIndex || 0, attributeOffset) : '');
        var firstPartMatch = firstPart ? linkify.match(firstPart) : '';

        if (!isLastMessage && !asSampleText && firstPartMatch) {
          firstPart = linkifyTextPart(firstPart, firstPartMatch);
        }

        var secondPart = "" + (textPart ? textPart === null || textPart === void 0 ? void 0 : textPart.substring(attributeOffset + attribute.length) : '');
        var secondPartMatch = secondPart ? linkify.match(secondPart) : '';

        if (!isLastMessage && !asSampleText && secondPartMatch) {
          secondPart = linkifyTextPart(secondPart, secondPartMatch);
        }

        if (attribute.type === 'mention') {
          var mentionDisplay = message.mentionedUsers && message.mentionedUsers.find(function (men) {
            return men.id === attribute.metadata;
          });
          var user = getClient().user;
          var mentionDisplayName = "@" + makeUsername(user.id === mentionDisplay.id ? mentionDisplay : contactsMap[mentionDisplay.id], mentionDisplay, getFromContacts).trim();
          nextPartIndex = attribute.offset + attribute.length;
          messageText.push(firstPart, asSampleText ? mentionDisplayName : /*#__PURE__*/React__default.createElement(MentionedUser, {
            isLastMessage: isLastMessage,
            color: colors.primary,
            key: attributeOffset
          }, mentionDisplayName), index === combinedAttributesList.length - 1 ? secondPart : '');
        } else {
          nextPartIndex = attributeOffset + attribute.length;
          messageText.push(firstPart, asSampleText ? "" + text.slice(attributeOffset, attributeOffset + attribute.length).trim() : /*#__PURE__*/React__default.createElement(StyledText, {
            isLastMessage: isLastMessage,
            className: attribute.type,
            key: attributeOffset + "-" + attribute.type
          }, "" + text.slice(attributeOffset, attributeOffset + attribute.length).trim()), index === combinedAttributesList.length - 1 ? secondPart : '');
        }
      } catch (e) {
        console.log('Error on format message text, message: ', message, 'error: ', e);
      }
    });
  } else {
    var match = linkify.match(text);

    if (!isLastMessage && !asSampleText && match) {
      messageText = linkifyTextPart(text, match);
    }
  }

  return messageText.length > 1 ? asSampleText ? messageText.join('') : messageText : text;
};
var lastMessageDateFormat = function lastMessageDateFormat(date) {
  var currentTime = moment();
  var startOfDay = currentTime.startOf('day');
  var isToday = moment(date).diff(startOfDay) >= 0;

  if (isToday) {
    return moment(date).format('HH:mm');
  }

  var isInLastWeek = moment().diff(moment(date), 'weeks') < 1;

  if (isInLastWeek) {
    return moment(date).format('dddd');
  }

  return moment(date).format('DD.MM.YY');
};
var allowEditDeleteIncomingMessage = true;
var setAllowEditDeleteIncomingMessage = function setAllowEditDeleteIncomingMessage(allow) {
  allowEditDeleteIncomingMessage = allow;
};
var getAllowEditDeleteIncomingMessage = function getAllowEditDeleteIncomingMessage() {
  return allowEditDeleteIncomingMessage;
};
var bodyAttributesMapByType = {
  1: ['bold'],
  2: ['italic'],
  3: ['bold', 'italic'],
  4: ['strikethrough'],
  5: ['bold', 'strikethrough'],
  6: ['italic', 'strikethrough'],
  7: ['bold', 'italic', 'strikethrough'],
  8: ['underline'],
  9: ['bold', 'underline'],
  10: ['italic', 'underline'],
  11: ['bold', 'italic', 'underline'],
  12: ['strikethrough', 'underline'],
  13: ['bold', 'strikethrough', 'underline'],
  14: ['italic', 'strikethrough', 'underline'],
  15: ['bold', 'italic', 'strikethrough', 'underline'],
  16: ['monospace'],
  17: ['bold', 'monospace'],
  18: ['italic', 'monospace'],
  19: ['bold', 'italic', 'monospace'],
  20: ['strikethrough', 'monospace'],
  21: ['bold', 'strikethrough', 'monospace'],
  22: ['italic', 'strikethrough', 'monospace'],
  23: ['bold', 'italic', 'strikethrough', 'monospace'],
  24: ['underline', 'monospace'],
  25: ['bold', 'underline', 'monospace'],
  26: ['italic', 'underline', 'monospace'],
  27: ['bold', 'italic', 'underline', 'monospace'],
  28: ['strikethrough', 'underline', 'monospace'],
  29: ['bold', 'strikethrough', 'underline', 'monospace'],
  30: ['italic', 'strikethrough', 'underline', 'monospace'],
  31: ['bold', 'italic', 'strikethrough', 'underline', 'monospace']
};
var EditorTheme = {
  paragraph: 'editor_paragraph',
  text: {
    bold: 'text_bold',
    code: 'text_monospace',
    italic: 'text_italic',
    strikethrough: 'text_strikethrough',
    subscript: 'text_subscript',
    superscript: 'text_superscript',
    underline: 'text_underline',
    underlineStrikethrough: 'text_underlineStrikethrough'
  }
};

var allChannels = [];
var channelsMap = {};
var channelTypesMemberDisplayTextMap;
var defaultRolesByChannelTypesMap;
var activeChannelId = '';
var UploadImageIcon;
function setChannelInMap(channel) {
  channelsMap[channel.id] = _extends({}, channel);
}
function setActiveChannelId(id) {
  activeChannelId = id;
}
function getActiveChannelId() {
  return activeChannelId;
}
function setChannelsInMap(channels) {
  var channelsForUpdateLastReactionMessage = [];
  var formattedChannel = channels.map(function (channel) {
    if (channel.newReactions && channel.newReactions.length && channel.lastMessage && channel.lastMessage.id < channel.newReactions[0].id) {
      channelsForUpdateLastReactionMessage.push(channel);
    }

    channel.metadata = isJSON(channel.metadata) ? JSON.parse(channel.metadata) : channel.metadata;
    channelsMap[channel.id] = _extends({}, channel);
    return channel;
  });
  return {
    channels: JSON.parse(JSON.stringify(formattedChannel)),
    channelsForUpdateLastReactionMessage: channelsForUpdateLastReactionMessage
  };
}
function getChannelFromMap(channelId) {
  return channelsMap[channelId];
}
function getLastChannelFromMap() {
  return Object.values(channelsMap)[0];
}
function removeChannelFromMap(channelId) {
  delete channelsMap[channelId];
}
function checkChannelExists(channelId) {
  return !!channelsMap[channelId];
}
function destroyChannelsMap() {
  channelsMap = {};
  activeChannelId = '';
  allChannels = [];
  defaultRolesByChannelTypesMap = {};
  channelTypesMemberDisplayTextMap = {};
}
var query = {
  channelQuery: null,
  channelQueryForward: null,
  blockedQuery: null,
  current: null,
  membersQuery: null,
  usersQuery: null,
  hiddenQuery: null,
  messageQuery: null,
  blockedMembersQuery: null,
  AttachmentByTypeQuery: null,
  AttachmentByTypeQueryForPopup: null,
  ReactionsQuery: null
};
var unreadScrollTo = {
  isScrolled: true
};
function getUnreadScrollTo() {
  return unreadScrollTo.isScrolled;
}
function setUnreadScrollTo(state) {
  unreadScrollTo.isScrolled = state;
}
function getUploadImageIcon() {
  return UploadImageIcon;
}
function setUploadImageIcon(icon) {
  UploadImageIcon = icon;
}
function getChannelTypesMemberDisplayTextMap() {
  return channelTypesMemberDisplayTextMap;
}
function setChannelTypesMemberDisplayTextMap(map) {
  channelTypesMemberDisplayTextMap = map;
}
function getDefaultRolesByChannelTypesMap() {
  return defaultRolesByChannelTypesMap;
}
function setDefaultRolesByChannelTypesMap(map) {
  defaultRolesByChannelTypesMap = map;
}
var handleNewMessages;
function setHandleNewMessages(callback) {
  handleNewMessages = callback;
}
function addChannelsToAllChannels(channels) {
  allChannels = [].concat(allChannels, channels);
}
function addChannelToAllChannels(channel) {
  allChannels.push(channel);
}
function getAllChannels() {
  return allChannels;
}
function getChannelFromAllChannels(channelId) {
  return allChannels.find(function (channel) {
    return channel.id === channelId;
  });
}
function deleteChannelFromAllChannels(channelId) {
  allChannels = allChannels.filter(function (channel) {
    return channel.id !== channelId;
  });
}
function updateChannelLastMessageOnAllChannels(channelId, message) {
  var updateChannel = allChannels.find(function (chan) {
    return chan.id === channelId;
  });

  if (message.state === 'Deleted' || message.state === 'Edited') {
    var _updateChannel;

    if (((_updateChannel = updateChannel) === null || _updateChannel === void 0 ? void 0 : _updateChannel.lastMessage.id) === message.id) {
      allChannels = allChannels.map(function (chan) {
        if (chan.id === channelId) {
          channelsMap[channelId] = _extends({}, chan, {
            lastMessage: message
          });
          return _extends({}, chan, {
            lastMessage: message
          });
        }

        return chan;
      });
    }
  } else {
    var updatedChannels = allChannels.filter(function (chan) {
      return chan.id !== channelId;
    });

    if (updateChannel) {
      var updateMessage = message;

      if (updateChannel.lastMessage && updateChannel.lastMessage.id === message.id && updateChannel.lastMessage.deliveryStatus === MESSAGE_DELIVERY_STATUS.READ) {
        updateMessage.deliveryStatus = MESSAGE_DELIVERY_STATUS.READ;
      }

      updateChannel = _extends({}, updateChannel, {
        lastMessage: updateMessage
      });
      channelsMap[channelId] = updateChannel;
      allChannels = [updateChannel].concat(updatedChannels);
    }
  }
}
function updateChannelOnAllChannels(channelId, config, messageUpdateData) {
  allChannels = allChannels.map(function (channel) {
    if (channel.id === channelId) {
      channel = _extends({}, channel, config);

      if (messageUpdateData && channel.lastMessage && messageUpdateData.id === channel.lastMessage.id) {
        var updateMessage = messageUpdateData;

        if (channel.lastMessage.id === messageUpdateData.id && channel.lastMessage.deliveryStatus === MESSAGE_DELIVERY_STATUS.READ) {
          updateMessage.deliveryStatus = MESSAGE_DELIVERY_STATUS.READ;
        }

        channel.lastMessage = _extends({}, channel.lastMessage, updateMessage);
      }
    }

    return channel;
  });

  if (channelsMap[channelId]) {
    channelsMap[channelId] = _extends({}, channelsMap[channelId], config);
  }
}
var getChannelGroupName = function getChannelGroupName(channel) {
  return channel.type === CHANNEL_TYPE.DIRECT || channel.type === CHANNEL_TYPE.PRIVATE || channel.type === CHANNEL_TYPE.GROUP ? CHANNEL_GROUP_TYPES.DIRECT_PRIVATE : CHANNEL_GROUP_TYPES.PUBLIC;
};

function sendMessageAC(message, channelId, connectionState, sendAttachmentsAsSeparateMessage, isResend) {
  return {
    type: SEND_MESSAGE,
    payload: {
      message: message,
      channelId: channelId,
      connectionState: connectionState,
      sendAttachmentsAsSeparateMessage: sendAttachmentsAsSeparateMessage,
      isResend: isResend
    }
  };
}
function sendTextMessageAC(message, channelId, connectionState) {
  return {
    type: SEND_TEXT_MESSAGE,
    payload: {
      message: message,
      channelId: channelId,
      connectionState: connectionState
    }
  };
}
function resendMessageAC(message, channelId, connectionState) {
  return {
    type: RESEND_MESSAGE,
    payload: {
      channelId: channelId,
      message: message,
      connectionState: connectionState
    }
  };
}
function forwardMessageAC(message, channelId, connectionState) {
  return {
    type: FORWARD_MESSAGE,
    payload: {
      message: message,
      channelId: channelId,
      connectionState: connectionState
    }
  };
}
function deleteMessageAC(channelId, messageId, deleteOption) {
  return {
    type: DELETE_MESSAGE,
    payload: {
      channelId: channelId,
      messageId: messageId,
      deleteOption: deleteOption
    }
  };
}
function deleteMessageFromListAC(messageId) {
  return {
    type: DELETE_MESSAGE_FROM_LIST,
    payload: {
      messageId: messageId
    }
  };
}
function editMessageAC(channelId, message) {
  return {
    type: EDIT_MESSAGE,
    payload: {
      channelId: channelId,
      message: message
    }
  };
}
function setMessageToEditAC(message) {
  return {
    type: SET_MESSAGE_TO_EDIT,
    payload: {
      message: message
    }
  };
}
function getMessagesAC(channel, loadWithLastMessage, messageId, limit) {
  return {
    type: GET_MESSAGES,
    payload: {
      channel: channel,
      loadWithLastMessage: loadWithLastMessage,
      messageId: messageId,
      limit: limit
    }
  };
}
function setScrollToMessagesAC(messageId) {
  return {
    type: SET_SCROLL_TO_MESSAGE,
    payload: {
      messageId: messageId
    }
  };
}
function setMessagesLoadingStateAC(state) {
  return {
    type: SET_MESSAGES_LOADING_STATE,
    payload: {
      state: state
    }
  };
}
function addMessagesAC(messages, direction) {
  return {
    type: ADD_MESSAGES,
    payload: {
      messages: messages,
      direction: direction
    }
  };
}
function setMessagesAC(messages) {
  return {
    type: SET_MESSAGES,
    payload: {
      messages: messages
    }
  };
}
function addReactionAC(channelId, messageId, key, score, reason, enforceUnique) {
  return {
    type: ADD_REACTION,
    payload: {
      channelId: channelId,
      messageId: messageId,
      key: key,
      score: score,
      reason: reason,
      enforceUnique: enforceUnique
    }
  };
}
function deleteReactionAC(channelId, messageId, key, isLastReaction) {
  return {
    type: DELETE_REACTION,
    payload: {
      channelId: channelId,
      messageId: messageId,
      key: key,
      isLastReaction: isLastReaction
    }
  };
}
function addReactionToMessageAC(message, reaction, isSelf) {
  return {
    type: ADD_REACTION_TO_MESSAGE,
    payload: {
      message: message,
      reaction: reaction,
      isSelf: isSelf
    }
  };
}
function deleteReactionFromMessageAC(message, reaction, isSelf) {
  return {
    type: DELETE_REACTION_FROM_MESSAGE,
    payload: {
      message: message,
      reaction: reaction,
      isSelf: isSelf
    }
  };
}
function getReactionsAC(messageId, key, limit) {
  return {
    type: GET_REACTIONS,
    payload: {
      messageId: messageId,
      key: key,
      limit: limit
    }
  };
}
function loadMoreReactionsAC(limit) {
  return {
    type: LOAD_MORE_REACTIONS,
    payload: {
      limit: limit
    }
  };
}
function setReactionsListAC(reactions, hasNext) {
  return {
    type: SET_REACTIONS_LIST,
    payload: {
      reactions: reactions,
      hasNext: hasNext
    }
  };
}
function addReactionsToListAC(reactions, hasNext) {
  return {
    type: ADD_REACTIONS_TO_LIST,
    payload: {
      reactions: reactions,
      hasNext: hasNext
    }
  };
}
function addReactionToListAC(reaction) {
  return {
    type: ADD_REACTION_TO_LIST,
    payload: {
      reaction: reaction
    }
  };
}
function deleteReactionFromListAC(reaction) {
  return {
    type: DELETE_REACTION_FROM_LIST,
    payload: {
      reaction: reaction
    }
  };
}
function setReactionsLoadingStateAC(state) {
  return {
    type: SET_REACTIONS_LOADING_STATE,
    payload: {
      state: state
    }
  };
}
function updateAttachmentUploadingStateAC(attachmentUploadingState, attachmentId) {
  return {
    type: UPLOAD_ATTACHMENT_COMPILATION,
    payload: {
      attachmentUploadingState: attachmentUploadingState,
      attachmentId: attachmentId
    }
  };
}
function removeAttachmentProgressAC(attachmentId) {
  return {
    type: REMOVE_UPLOAD_PROGRESS,
    payload: {
      attachmentId: attachmentId
    }
  };
}
function emptyChannelAttachmentsAC() {
  return {
    type: EMPTY_CHANNEL_ATTACHMENTS
  };
}
function addMessageAC(message) {
  return {
    type: ADD_MESSAGE,
    payload: {
      message: message
    }
  };
}
function scrollToNewMessageAC(scrollToBottom, updateMessageList, isIncomingMessage) {
  return {
    type: SET_SCROLL_TO_NEW_MESSAGE,
    payload: {
      scrollToBottom: scrollToBottom,
      updateMessageList: updateMessageList,
      isIncomingMessage: isIncomingMessage
    }
  };
}
function showScrollToNewMessageButtonAC(state) {
  return {
    type: SET_SHOW_SCROLL_TO_NEW_MESSAGE_BUTTON,
    payload: {
      state: state
    }
  };
}
function loadMoreMessagesAC(channelId, limit, direction, messageId, hasNext) {
  return {
    type: LOAD_MORE_MESSAGES,
    payload: {
      limit: limit,
      direction: direction,
      channelId: channelId,
      messageId: messageId,
      hasNext: hasNext
    }
  };
}
function setMessagesHasPrevAC(hasPrev) {
  return {
    type: SET_HAS_PREV_MESSAGES,
    payload: {
      hasPrev: hasPrev
    }
  };
}
function setMessagesHasNextAC(hasNext) {
  return {
    type: SET_MESSAGES_HAS_NEXT,
    payload: {
      hasNext: hasNext
    }
  };
}
function updateMessageAC(messageId, params, addIfNotExists) {
  return {
    type: UPDATE_MESSAGE,
    payload: {
      messageId: messageId,
      params: params,
      addIfNotExists: addIfNotExists
    }
  };
}
function updateMessagesStatusAC(name, markersMap) {
  return {
    type: UPDATE_MESSAGES_STATUS,
    payload: {
      name: name,
      markersMap: markersMap
    }
  };
}
function clearMessagesAC() {
  return {
    type: CLEAR_MESSAGES
  };
}
function getAttachmentsAC(channelId, attachmentType, limit, direction, attachmentId, forPopup) {
  return {
    type: GET_MESSAGES_ATTACHMENTS,
    payload: {
      channelId: channelId,
      attachmentType: attachmentType,
      limit: limit,
      direction: direction,
      forPopup: forPopup,
      attachmentId: attachmentId
    }
  };
}
function setAttachmentsAC(attachments) {
  return {
    type: SET_ATTACHMENTS,
    payload: {
      attachments: attachments
    }
  };
}
function setAttachmentsForPopupAC(attachments) {
  return {
    type: SET_ATTACHMENTS_FOR_POPUP,
    payload: {
      attachments: attachments
    }
  };
}
function loadMoreAttachmentsAC(limit) {
  return {
    type: LOAD_MORE_MESSAGES_ATTACHMENTS,
    payload: {
      limit: limit
    }
  };
}
function addAttachmentsAC(attachments) {
  return {
    type: ADD_ATTACHMENTS,
    payload: {
      attachments: attachments
    }
  };
}
function addAttachmentsForPopupAC(attachments, direction) {
  return {
    type: ADD_ATTACHMENTS_FOR_POPUP,
    payload: {
      attachments: attachments,
      direction: direction
    }
  };
}
function setAttachmentsCompleteAC(hasPrev) {
  return {
    type: SET_ATTACHMENTS_COMPLETE,
    payload: {
      hasPrev: hasPrev
    }
  };
}
function setAttachmentsCompleteForPopupAC(hasPrev) {
  return {
    type: SET_ATTACHMENTS_COMPLETE_FOR_POPUP,
    payload: {
      hasPrev: hasPrev
    }
  };
}
function pauseAttachmentUploadingAC(attachmentId) {
  return {
    type: PAUSE_ATTACHMENT_UPLOADING,
    payload: {
      attachmentId: attachmentId
    }
  };
}
function resumeAttachmentUploadingAC(attachmentId) {
  return {
    type: RESUME_ATTACHMENT_UPLOADING,
    payload: {
      attachmentId: attachmentId
    }
  };
}
function setSendMessageInputHeightAC(height) {
  return {
    type: SET_SEND_MESSAGE_INPUT_HEIGHT,
    payload: {
      height: height
    }
  };
}
function setMessageMenuOpenedAC(messageId) {
  return {
    type: SET_MESSAGE_MENU_OPENED,
    payload: {
      messageId: messageId
    }
  };
}
function setMessageForReplyAC(message) {
  return {
    type: SET_MESSAGE_FOR_REPLY,
    payload: {
      message: message
    }
  };
}
function setPlayingAudioIdAC(id) {
  return {
    type: SET_PLAYING_AUDIO_ID,
    payload: {
      id: id
    }
  };
}
function addSelectedMessageAC(message) {
  return {
    type: ADD_SELECTED_MESSAGE,
    payload: {
      message: message
    }
  };
}
function removeSelectedMessageAC(messageId) {
  return {
    type: REMOVE_SELECTED_MESSAGE,
    payload: {
      messageId: messageId
    }
  };
}
function clearSelectedMessagesAC() {
  return {
    type: CLEAR_SELECTED_MESSAGES
  };
}

function setConnectionStatusAC(status) {
  return {
    type: SET_CONNECTION_STATUS,
    payload: {
      status: status
    }
  };
}
function getUsersAC(params) {
  return {
    type: GET_USERS,
    payload: {
      params: params
    }
  };
}
function loadMoreUsersAC(limit) {
  return {
    type: LOAD_MORE_USERS,
    payload: {
      limit: limit
    }
  };
}
function setUsersLoadingStateAC(state) {
  return {
    type: SET_USERS_LOADING_STATE,
    payload: {
      state: state
    }
  };
}
function setUsersAC(users) {
  return {
    type: SET_USERS,
    payload: {
      users: users
    }
  };
}
function addUsersAC(users) {
  return {
    type: ADD_USERS,
    payload: {
      users: users
    }
  };
}
function getContactsAC() {
  return {
    type: GET_CONTACTS,
    payload: {}
  };
}
function setContactsAC(contacts) {
  return {
    type: SET_CONTACTS,
    payload: {
      contacts: contacts
    }
  };
}
function blockUserAC(userIds) {
  return {
    type: BLOCK_USERS,
    payload: {
      userIds: userIds
    }
  };
}
function unblockUserAC(userIds) {
  return {
    type: UNBLOCK_USERS,
    payload: {
      userIds: userIds
    }
  };
}
function setContactsLoadingStateAC(status) {
  return {
    type: SET_CONTACT_LOADING_STATE,
    payload: {
      status: status
    }
  };
}
function setUserAC(user) {
  return {
    type: SET_USER,
    payload: {
      user: user
    }
  };
}
function updateUserProfileAC(profile) {
  return {
    type: UPDATE_USER_PROFILE,
    payload: {
      profile: profile
    }
  };
}
function browserTabIsActiveAC(state) {
  return {
    type: BROWSER_TAB_IS_ACTIVE,
    payload: {
      state: state
    }
  };
}
function checkUserStatusAC(usersMap) {
  return {
    type: CHECK_USER_STATUS,
    payload: {
      usersMap: usersMap
    }
  };
}
function updateUserStatusOnMapAC(usersMap) {
  return {
    type: UPDATE_USER_MAP,
    payload: {
      usersMap: usersMap
    }
  };
}
function updateProfileAC(user, firstName, lastName, avatarUrl, metadata, avatarFile, presence) {
  return {
    type: UPDATE_PROFILE,
    payload: {
      user: user,
      firstName: firstName,
      lastName: lastName,
      avatarUrl: avatarUrl,
      metadata: metadata,
      avatarFile: avatarFile,
      presence: presence
    }
  };
}

var userDisplayNameFromContact = false;
var setShowOnlyContactUsers = function setShowOnlyContactUsers(value) {
  userDisplayNameFromContact = value;
};
var getShowOnlyContactUsers = function getShowOnlyContactUsers() {
  return userDisplayNameFromContact;
};

var contactsMap = {};
var logoSrc = '';
var showNotifications = true;
var setNotification = function setNotification(body, user, channel, reaction, attachment) {
  var getFromContacts = getShowOnlyContactUsers();
  var attachmentType;

  if (attachment) {
    var attType = attachment.type;
    attachmentType = attType === attachmentTypes.voice ? 'Voice' : attType === attachmentTypes.image ? 'Photo' : attType === attachmentTypes.video ? 'Video' : 'File';
  }

  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var notification;

  if (showNotifications) {
    if (reaction) {
      notification = new Notification("" + (isDirectChannel ? makeUsername(contactsMap[user.id], user, getFromContacts) : channel.subject), {
        body: (channel.type !== CHANNEL_TYPE.DIRECT ? makeUsername(contactsMap[user.id], user, getFromContacts) + ': ' : '') + " reacted " + reaction + " to \"" + (attachmentType || '') + (attachmentType && body ? ': ' : '') + body + "\"",
        icon: logoSrc
      });
    } else {
      notification = new Notification("" + (isDirectChannel ? makeUsername(contactsMap[user.id], user, getFromContacts) : channel.subject), {
        body: isDirectChannel ? "" + (attachmentType || '') + (attachmentType && body ? ': ' : '') + body : makeUsername(contactsMap[user.id], user, getFromContacts) + "\n" + (attachmentType || '') + (attachmentType && body ? ': ' : '') + body,
        icon: logoSrc
      });
    }

    notification.onclick = function (event) {
      event.preventDefault();
      window.focus();
      store.dispatch({
        type: SWITCH_CHANNEL,
        payload: {
          channel: channel
        }
      });
      notification.close();
    };

    if (window.sceytTabNotifications) {
      window.sceytTabNotifications.close();
    }

    window.sceytTabNotifications = notification;
  }
};
var setNotificationLogoSrc = function setNotificationLogoSrc(src) {
  logoSrc = src;
};
var setContactsMap = function setContactsMap(contacts) {
  contactsMap = contacts;
};
var setShowNotifications = function setShowNotifications(show) {
  showNotifications = show;
};
var getShowNotifications = function getShowNotifications() {
  return showNotifications;
};

function getMembersAC(channelId) {
  return {
    type: GET_MEMBERS,
    payload: {
      channelId: channelId
    }
  };
}
function setMembersToListAC(members) {
  return {
    type: SET_MEMBERS_TO_LIST,
    payload: {
      members: members
    }
  };
}
function addMembersToListAC(members) {
  return {
    type: ADD_MEMBERS_TO_LIST,
    payload: {
      members: members
    }
  };
}
function updateMembersAC(members) {
  return {
    type: UPDATE_MEMBERS,
    payload: {
      members: members
    }
  };
}
function updateMembersPresenceAC(usersMap) {
  return {
    type: UPDATE_MEMBERS_PRESENCE,
    payload: {
      usersMap: usersMap
    }
  };
}
function loadMoreMembersAC(limit) {
  return {
    type: LOAD_MORE_MEMBERS,
    payload: {
      limit: limit
    }
  };
}
function setMembersLoadingStateAC(state) {
  return {
    type: SET_MEMBERS_LOADING_STATE,
    payload: {
      state: state
    }
  };
}
function addMembersAC(channelId, members) {
  return {
    type: ADD_MEMBERS,
    payload: {
      channelId: channelId,
      members: members
    }
  };
}
function kickMemberAC(channelId, memberId) {
  return {
    type: KICK_MEMBER,
    payload: {
      channelId: channelId,
      memberId: memberId
    }
  };
}
function blockMemberAC(channelId, memberId) {
  return {
    type: BLOCK_MEMBER,
    payload: {
      channelId: channelId,
      memberId: memberId
    }
  };
}
function removeMemberFromListAC(members) {
  return {
    type: REMOVE_MEMBER_FROM_LIST,
    payload: {
      members: members
    }
  };
}
function getRolesAC(timeout, attempts) {
  return {
    type: GET_ROLES,
    payload: {
      timeout: timeout,
      attempts: attempts
    }
  };
}
function getRolesFailAC(timeout, attempts) {
  return {
    type: GET_ROLES_FAIL,
    payload: {
      timeout: timeout,
      attempts: attempts
    }
  };
}
function getRolesSuccess(roles) {
  return {
    type: GET_ROLES_SUCCESS,
    payload: {
      roles: roles
    }
  };
}
function changeMemberRoleAC(channelId, members) {
  return {
    type: CHANGE_MEMBER_ROLE,
    payload: {
      channelId: channelId,
      members: members
    }
  };
}

var connectionStatusSelector = function connectionStatusSelector(store) {
  return store.UserReducer.connectionStatus;
};
var contactListSelector = function contactListSelector(store) {
  return store.UserReducer.contactList;
};
var contactsMapSelector = function contactsMapSelector(store) {
  return store.UserReducer.contactsMap;
};
var userSelector = function userSelector(store) {
  return store.UserReducer.user;
};
var usersListSelector = function usersListSelector(store) {
  return store.UserReducer.usersList;
};
var usersLoadingStateSelector = function usersLoadingStateSelector(store) {
  return store.UserReducer.usersLoadingState;
};
var browserTabIsActiveSelector = function browserTabIsActiveSelector(store) {
  return store.UserReducer.browserTabIsActive;
};

var activeChannelMessagesSelector = function activeChannelMessagesSelector(store) {
  return store.MessageReducer.activeChannelMessages;
};
var messagesLoadingState = function messagesLoadingState(store) {
  return store.MessageReducer.messagesLoadingState;
};
var messagesHasNextSelector = function messagesHasNextSelector(store) {
  return store.MessageReducer.messagesHasNext;
};
var messagesHasPrevSelector = function messagesHasPrevSelector(store) {
  return store.MessageReducer.messagesHasPrev;
};
var attachmentCompilationStateSelector = function attachmentCompilationStateSelector(store) {
  return store.MessageReducer.attachmentsUploadingState;
};
var attachmentsUploadProgressSelector = function attachmentsUploadProgressSelector(store) {
  return store.MessageReducer.attachmentsUploadingProgress;
};
var activeTabAttachmentsSelector = function activeTabAttachmentsSelector(store) {
  return store.MessageReducer.activeTabAttachments;
};
var activeTabAttachmentsHasNextSelector = function activeTabAttachmentsHasNextSelector(store) {
  return store.MessageReducer.attachmentHasNext;
};
var attachmentsForPopupSelector = function attachmentsForPopupSelector(store) {
  return store.MessageReducer.attachmentsForPopup;
};
var messageForReplySelector = function messageForReplySelector(store) {
  return store.MessageReducer.messageForReply;
};
var messageToEditSelector = function messageToEditSelector(store) {
  return store.MessageReducer.messageToEdit;
};
var scrollToNewMessageSelector = function scrollToNewMessageSelector(store) {
  return store.MessageReducer.scrollToNewMessage;
};
var showScrollToNewMessageButtonSelector = function showScrollToNewMessageButtonSelector(store) {
  return store.MessageReducer.showScrollToNewMessageButton;
};
var sendMessageInputHeightSelector = function sendMessageInputHeightSelector(store) {
  return store.MessageReducer.sendMessageInputHeight;
};
var scrollToMessageSelector = function scrollToMessageSelector(store) {
  return store.MessageReducer.scrollToMessage;
};
var reactionsListSelector = function reactionsListSelector(store) {
  return store.MessageReducer.reactionsList;
};
var reactionsHasNextSelector = function reactionsHasNextSelector(store) {
  return store.MessageReducer.reactionsHasNext;
};
var reactionsLoadingStateSelector = function reactionsLoadingStateSelector(store) {
  return store.MessageReducer.reactionsLoadingState;
};
var openedMessageMenuSelector = function openedMessageMenuSelector(store) {
  return store.MessageReducer.openedMessageMenu;
};
var playingAudioIdSelector = function playingAudioIdSelector(store) {
  return store.MessageReducer.playingAudioId;
};
var selectedMessagesMapSelector = function selectedMessagesMapSelector(store) {
  return store.MessageReducer.selectedMessagesMap;
};

var _marked = /*#__PURE__*/_regeneratorRuntime().mark(watchForEvents);
function watchForEvents() {
  var SceytChatClient, channelListener, connectionListener, typingUsersTimeout, chan, _yield$take, type, args, createdChannel, getFromContacts, channelExists, channel, _channel, member, _channelExists, _activeChannelId, groupName, _channel2, _channelExists2, _channel3, removedMembers, _activeChannelId2, _channelExists3, activeChannel, _groupName, _channel4, addedMembers, _activeChannelId3, _channelExists4, _groupName2, updatedChannel, _channelExists5, subject, avatarUrl, muted, mutedTill, _groupName3, _channel5, message, messageToHandle, _activeChannelId4, _channelExists6, channelForAdd, hasNextMessage, _groupName4, showNotifications, tabIsActive, contactsMap, _getFromContacts, messageBody, _ret, _ret2, _channel6, from, channelId, _channel7, _channel8, deletedMessage, _activeChannelId6, _channelExists7, _channel9, _message, _activeChannelId7, _channelExists8, _channel10, user, _message2, reaction, isSelf, _activeChannelId8, _contactsMap, _getFromContacts2, _messageBody, channelUpdateParams, _channel11, _user, _message3, _reaction, channelFromMap, _isSelf, _activeChannelId9, _channelUpdateParams, _channel12, channelUnreadCount, _updatedChannel, _channel13, _activeChannelId10, channelExist, _channel14, _channel15, _channel16, _channel17, _channel18, _groupName5, _channel19, _groupName6, _channel20, members, _activeChannelId11, i, status;

  return _regeneratorRuntime().wrap(function watchForEvents$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          SceytChatClient = getClient();
          channelListener = new SceytChatClient.ChannelListener();
          connectionListener = new SceytChatClient.ConnectionListener();
          typingUsersTimeout = {};
          chan = createSagaMiddleware.eventChannel(function (emitter) {
            channelListener.onCreated = function (createdChannel) {
              emitter({
                type: CHANNEL_EVENT_TYPES.CREATE,
                args: {
                  createdChannel: createdChannel
                }
              });
            };

            channelListener.onMemberJoined = function (channel, joinedMember) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.JOIN,
                args: {
                  channel: channel,
                  joinedMember: joinedMember
                }
              });
            };

            channelListener.onMemberLeft = function (channel, member) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.LEAVE,
                args: {
                  channel: channel,
                  member: member
                }
              });
            };

            channelListener.onBlocked = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.BLOCK,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onUnblocked = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.UNBLOCK,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onMembersAdded = function (_ref) {
              var channel = _ref.channel,
                  addedMembers = _ref.addedMembers;
              return emitter({
                type: CHANNEL_EVENT_TYPES.ADD_MEMBERS,
                args: {
                  channel: channel,
                  addedMembers: addedMembers
                }
              });
            };

            channelListener.onMembersKicked = function (_ref2) {
              var channel = _ref2.channel,
                  removedMembers = _ref2.removedMembers;
              return emitter({
                type: CHANNEL_EVENT_TYPES.KICK_MEMBERS,
                args: {
                  channel: channel,
                  removedMembers: removedMembers
                }
              });
            };

            channelListener.onUpdated = function (updatedChannel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.UPDATE_CHANNEL,
                args: {
                  updatedChannel: updatedChannel
                }
              });
            };

            channelListener.onMessage = function (channel, message) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.MESSAGE,
                args: {
                  channel: channel,
                  message: message
                }
              });
            };

            channelListener.onDeleted = function (channelId) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.DELETE,
                args: {
                  channelId: channelId
                }
              });
            };

            channelListener.onMessageEdited = function (channel, user, message) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.EDIT_MESSAGE,
                args: {
                  channel: channel,
                  user: user,
                  message: message
                }
              });
            };

            channelListener.onMessageDeleted = function (channel, user, deletedMessage) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.DELETE_MESSAGE,
                args: {
                  channel: channel,
                  user: user,
                  deletedMessage: deletedMessage
                }
              });
            };

            channelListener.onReactionAdded = function (channel, user, message, reaction) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.REACTION_ADDED,
                args: {
                  channel: channel,
                  user: user,
                  message: message,
                  reaction: reaction
                }
              });
            };

            channelListener.onReactionDeleted = function (channel, user, message, reaction) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.REACTION_DELETED,
                args: {
                  channel: channel,
                  user: user,
                  message: message,
                  reaction: reaction
                }
              });
            };

            channelListener.onMemberStartedTyping = function (channel, from) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.START_TYPING,
                args: {
                  channel: channel,
                  from: from
                }
              });
            };

            channelListener.onMemberStoppedTyping = function (channel, from) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.STOP_TYPING,
                args: {
                  channel: channel,
                  from: from
                }
              });
            };

            channelListener.onReceivedMessageListMarker = function (channelId, markerList) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.MESSAGE_MARKERS_RECEIVED,
                args: {
                  channelId: channelId,
                  markerList: markerList
                }
              });
            };

            channelListener.onTotalUnreadCountUpdated = function (channel, unreadChannels, totalUnread, channelUnreadCount) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.UNREAD_MESSAGES_INFO,
                args: {
                  channel: channel,
                  unreadChannels: unreadChannels,
                  totalUnread: totalUnread,
                  channelUnreadCount: channelUnreadCount
                }
              });
            };

            channelListener.onHidden = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.HIDE,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onMuted = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.MUTE,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onUnmuted = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.UNMUTE,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onShown = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.UNHIDE,
                args: {
                  channel: channel
                }
              });
            };

            connectionListener.onConnectionStateChanged = function (status) {
              return emitter({
                type: CONNECTION_EVENT_TYPES.CONNECTION_STATUS_CHANGED,
                args: {
                  status: status
                }
              });
            };

            channelListener.onMarkedAsUnread = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CHANNEL_MARKED_AS_UNREAD,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onMarkedAsRead = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CHANNEL_MARKED_AS_READ,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onHistoryCleared = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CLEAR_HISTORY,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onDeletedAllMessages = function (channel) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CLEAR_HISTORY,
                args: {
                  channel: channel
                }
              });
            };

            channelListener.onMembersRoleChanged = function (channel, members) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CHANGE_ROLE,
                args: {
                  channel: channel,
                  members: members
                }
              });
            };

            channelListener.onOwnerChanged = function (channel, newOwner, oldOwner) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.CHANGE_OWNER,
                args: {
                  channel: channel,
                  newOwner: newOwner,
                  oldOwner: oldOwner
                }
              });
            };

            channelListener.onMembersBlocked = function (channel, removedMembers) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.MEMBER_BLOCKED,
                args: {
                  channel: channel,
                  removedMembers: removedMembers
                }
              });
            };

            channelListener.onMembersUnblocked = function (channel, unblockedMembers) {
              return emitter({
                type: CHANNEL_EVENT_TYPES.MEMBER_UNBLOCKED,
                args: {
                  channel: channel,
                  unblockedMembers: unblockedMembers
                }
              });
            };

            SceytChatClient.addChannelListener('CHANNEL_EVENTS', channelListener);
            SceytChatClient.addConnectionListener('CONNECTION_EVENTS', connectionListener);
            return function () {
              SceytChatClient.removeChannelListener('CHANNEL_EVENTS');
              SceytChatClient.removeConnectionListener('CONNECTION_EVENTS');
            };
          });

        case 5:

          _context3.next = 8;
          return effects.take(chan);

        case 8:
          _yield$take = _context3.sent;
          type = _yield$take.type;
          args = _yield$take.args;
          _context3.t0 = type;
          _context3.next = _context3.t0 === CHANNEL_EVENT_TYPES.CREATE ? 14 : _context3.t0 === CHANNEL_EVENT_TYPES.JOIN ? 28 : _context3.t0 === CHANNEL_EVENT_TYPES.LEAVE ? 36 : _context3.t0 === CHANNEL_EVENT_TYPES.BLOCK ? 60 : _context3.t0 === CHANNEL_EVENT_TYPES.UNBLOCK ? 67 : _context3.t0 === CHANNEL_EVENT_TYPES.KICK_MEMBERS ? 69 : _context3.t0 === CHANNEL_EVENT_TYPES.ADD_MEMBERS ? 98 : _context3.t0 === CHANNEL_EVENT_TYPES.UPDATE_CHANNEL ? 121 : _context3.t0 === CHANNEL_EVENT_TYPES.MESSAGE ? 132 : _context3.t0 === CHANNEL_EVENT_TYPES.MESSAGE_MARKERS_RECEIVED ? 194 : _context3.t0 === CHANNEL_EVENT_TYPES.START_TYPING ? 198 : _context3.t0 === CHANNEL_EVENT_TYPES.STOP_TYPING ? 202 : _context3.t0 === CHANNEL_EVENT_TYPES.DELETE ? 207 : _context3.t0 === CHANNEL_EVENT_TYPES.DELETE_MESSAGE ? 214 : _context3.t0 === CHANNEL_EVENT_TYPES.EDIT_MESSAGE ? 231 : _context3.t0 === CHANNEL_EVENT_TYPES.REACTION_ADDED ? 246 : _context3.t0 === CHANNEL_EVENT_TYPES.REACTION_DELETED ? 270 : _context3.t0 === CHANNEL_EVENT_TYPES.UNREAD_MESSAGES_INFO ? 286 : _context3.t0 === CHANNEL_EVENT_TYPES.CLEAR_HISTORY ? 293 : _context3.t0 === CHANNEL_EVENT_TYPES.MUTE ? 311 : _context3.t0 === CHANNEL_EVENT_TYPES.UNMUTE ? 317 : _context3.t0 === CHANNEL_EVENT_TYPES.HIDE ? 323 : _context3.t0 === CHANNEL_EVENT_TYPES.UNHIDE ? 328 : _context3.t0 === CHANNEL_EVENT_TYPES.CHANNEL_MARKED_AS_UNREAD ? 333 : _context3.t0 === CHANNEL_EVENT_TYPES.CHANNEL_MARKED_AS_READ ? 341 : _context3.t0 === CHANNEL_EVENT_TYPES.CHANGE_ROLE ? 349 : _context3.t0 === CONNECTION_EVENT_TYPES.CONNECTION_STATUS_CHANGED ? 368 : 376;
          break;

        case 14:
          createdChannel = args.createdChannel;
          getFromContacts = getShowOnlyContactUsers();
          console.log('CHANNEL_EVENT_CREATE ... ', createdChannel);
          channelExists = checkChannelExists(createdChannel.id);

          if (channelExists) {
            _context3.next = 26;
            break;
          }

          if (!getFromContacts) {
            _context3.next = 22;
            break;
          }

          _context3.next = 22;
          return effects.put(getContactsAC());

        case 22:
          _context3.next = 24;
          return effects.call(setChannelInMap, createdChannel);

        case 24:
          _context3.next = 26;
          return effects.put(setChannelToAddAC(JSON.parse(JSON.stringify(createdChannel))));

        case 26:
          addChannelToAllChannels(createdChannel);
          return _context3.abrupt("break", 377);

        case 28:
          channel = args.channel;
          console.log('channel JOIN ... ', channel);
          _context3.next = 32;
          return effects.call(getActiveChannelId);

        case 32:

          addChannelToAllChannels(channel);
          return _context3.abrupt("break", 377);

        case 36:
          _channel = args.channel, member = args.member;
          console.log('channel LEAVE ... ', _channel, member);
          _channelExists = checkChannelExists(_channel.id);
          _context3.next = 41;
          return effects.call(getActiveChannelId);

        case 41:
          _activeChannelId = _context3.sent;

          if (!(member.id === SceytChatClient.user.id)) {
            _context3.next = 49;
            break;
          }

          _context3.next = 45;
          return effects.put(removeChannelAC(_channel.id));

        case 45:
          removeChannelFromMap(_channel.id);
          deleteChannelFromAllChannels(_channel.id);
          _context3.next = 59;
          break;

        case 49:
          groupName = getChannelGroupName(_channel);

          if (!_channelExists) {
            _context3.next = 56;
            break;
          }

          if (!(_activeChannelId === _channel.id)) {
            _context3.next = 54;
            break;
          }

          _context3.next = 54;
          return effects.put(removeMemberFromListAC([member]));

        case 54:
          _context3.next = 56;
          return effects.put(updateChannelDataAC(_channel.id, {
            memberCount: _channel.memberCount,
            muted: _channel.muted,
            mutedTill: _channel.mutedTill
          }));

        case 56:
          _context3.next = 58;
          return effects.put(updateSearchedChannelDataAC(_channel.id, {
            memberCount: _channel.memberCount,
            muted: _channel.muted,
            mutedTill: _channel.mutedTill
          }, groupName));

        case 58:
          updateChannelOnAllChannels(_channel.id, {
            memberCount: _channel.memberCount,
            muted: _channel.muted,
            mutedTill: _channel.mutedTill
          });

        case 59:
          return _context3.abrupt("break", 377);

        case 60:
          console.log('channel BLOCK ... ');
          _channel2 = args.channel;
          _channelExists2 = checkChannelExists(_channel2.id);

          if (!_channelExists2) {
            _context3.next = 66;
            break;
          }

          _context3.next = 66;
          return effects.put(removeChannelAC(_channel2.id));

        case 66:
          return _context3.abrupt("break", 377);

        case 67:
          console.log('channel UNBLOCK ... ');
          return _context3.abrupt("break", 377);

        case 69:
          _channel3 = args.channel, removedMembers = args.removedMembers;
          console.log('channel KICK_MEMBERS ... ', removedMembers);
          _context3.next = 73;
          return effects.call(getActiveChannelId);

        case 73:
          _activeChannelId2 = _context3.sent;
          _channelExists3 = checkChannelExists(_channel3.id);

          if (!_channelExists3) {
            _context3.next = 96;
            break;
          }

          if (!removedMembers.find(function (mem) {
            return mem.id === SceytChatClient.user.id;
          })) {
            _context3.next = 88;
            break;
          }

          removeChannelFromMap(_channel3.id);
          _context3.next = 80;
          return effects.put(removeChannelAC(_channel3.id));

        case 80:
          _context3.next = 82;
          return effects.call(getLastChannelFromMap);

        case 82:
          activeChannel = _context3.sent;

          if (!activeChannel) {
            _context3.next = 86;
            break;
          }

          _context3.next = 86;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(activeChannel))));

        case 86:
          _context3.next = 96;
          break;

        case 88:
          if (!(_activeChannelId2 === _channel3.id)) {
            _context3.next = 91;
            break;
          }

          _context3.next = 91;
          return effects.put(removeMemberFromListAC(removedMembers));

        case 91:
          _groupName = getChannelGroupName(_channel3);
          _context3.next = 94;
          return effects.put(updateSearchedChannelDataAC(_channel3.id, {
            memberCount: _channel3.memberCount,
            muted: _channel3.muted,
            mutedTill: _channel3.mutedTill
          }, _groupName));

        case 94:
          _context3.next = 96;
          return effects.put(updateChannelDataAC(_channel3.id, {
            memberCount: _channel3.memberCount,
            muted: _channel3.muted,
            mutedTill: _channel3.mutedTill
          }));

        case 96:
          updateChannelOnAllChannels(_channel3.id, {
            memberCount: _channel3.memberCount,
            muted: _channel3.muted,
            mutedTill: _channel3.mutedTill
          });
          return _context3.abrupt("break", 377);

        case 98:
          _channel4 = args.channel, addedMembers = args.addedMembers;
          console.log('channel ADD_MEMBERS ... ', addedMembers);
          _context3.next = 102;
          return effects.call(getActiveChannelId);

        case 102:
          _activeChannelId3 = _context3.sent;
          _channelExists4 = checkChannelExists(_channel4.id);

          if (!_channelExists4) {
            _context3.next = 112;
            break;
          }

          if (!(_activeChannelId3 === _channel4.id)) {
            _context3.next = 108;
            break;
          }

          _context3.next = 108;
          return effects.put(addMembersToListAC(addedMembers));

        case 108:
          _context3.next = 110;
          return effects.put(updateChannelDataAC(_channel4.id, {
            memberCount: _channel4.memberCount,
            muted: _channel4.muted,
            mutedTill: _channel4.mutedTill
          }));

        case 110:
          _context3.next = 116;
          break;

        case 112:
          _context3.next = 114;
          return effects.call(setChannelInMap, _channel4);

        case 114:
          _context3.next = 116;
          return effects.put(setAddedToChannelAC(JSON.parse(JSON.stringify(_channel4))));

        case 116:
          _groupName2 = getChannelGroupName(_channel4);
          _context3.next = 119;
          return effects.put(updateSearchedChannelDataAC(_channel4.id, {
            memberCount: _channel4.memberCount,
            muted: _channel4.muted,
            mutedTill: _channel4.mutedTill
          }, _groupName2));

        case 119:
          updateChannelOnAllChannels(_channel4.id, {
            memberCount: _channel4.memberCount,
            muted: _channel4.muted,
            mutedTill: _channel4.mutedTill
          });
          return _context3.abrupt("break", 377);

        case 121:
          updatedChannel = args.updatedChannel;
          _channelExists5 = checkChannelExists(updatedChannel.id);
          subject = updatedChannel.subject, avatarUrl = updatedChannel.avatarUrl, muted = updatedChannel.muted, mutedTill = updatedChannel.mutedTill;

          if (!_channelExists5) {
            _context3.next = 127;
            break;
          }

          _context3.next = 127;
          return effects.put(updateChannelDataAC(updatedChannel.id, {
            subject: subject,
            avatarUrl: avatarUrl,
            muted: muted,
            mutedTill: mutedTill
          }));

        case 127:
          _groupName3 = getChannelGroupName(updatedChannel);
          _context3.next = 130;
          return effects.put(updateSearchedChannelDataAC(updatedChannel.id, {
            subject: subject,
            avatarUrl: avatarUrl,
            muted: muted,
            mutedTill: mutedTill
          }, _groupName3));

        case 130:
          updateChannelOnAllChannels(updatedChannel.id, {
            subject: subject,
            avatarUrl: avatarUrl,
            muted: muted,
            mutedTill: mutedTill
          });
          return _context3.abrupt("break", 377);

        case 132:
          _channel5 = args.channel, message = args.message;
          console.log('channel MESSAGE ... id : ', message.id, ' message: ', message, ' channel: ', _channel5);
          messageToHandle = handleNewMessages ? handleNewMessages(message, _channel5) : message;

          if (!(messageToHandle && _channel5)) {
            _context3.next = 193;
            break;
          }

          _context3.next = 138;
          return effects.call(getActiveChannelId);

        case 138:
          _activeChannelId4 = _context3.sent;
          _channelExists6 = checkChannelExists(_channel5.id);
          channelForAdd = JSON.parse(JSON.stringify(_channel5));
          _context3.next = 143;
          return effects.put(addChannelAC(channelForAdd));

        case 143:
          if (_channelExists6) {
            _context3.next = 148;
            break;
          }

          _context3.next = 146;
          return effects.call(setChannelInMap, _channel5);

        case 146:
          _context3.next = 151;
          break;

        case 148:
          if (message.repliedInThread) {
            _context3.next = 151;
            break;
          }

          _context3.next = 151;
          return effects.put(updateChannelLastMessageAC(message, channelForAdd));

        case 151:
          if (!(_channel5.id === _activeChannelId4)) {
            _context3.next = 163;
            break;
          }

          if (getHasNextCached()) {
            _context3.next = 155;
            break;
          }

          _context3.next = 155;
          return effects.put(addMessageAC(message));

        case 155:
          addAllMessages([message], MESSAGE_LOAD_DIRECTION.NEXT);

          _context3.next = 159;
          return effects.select(messagesHasNextSelector);

        case 159:
          hasNextMessage = _context3.sent;

          if (!(!getHasNextCached() && !hasNextMessage)) {
            _context3.next = 163;
            break;
          }

          _context3.next = 163;
          return effects.put(scrollToNewMessageAC(true, false, true));

        case 163:
          if (getMessagesFromMap(_channel5.id) && getMessagesFromMap(_channel5.id).length) {
            addMessageToMap(_channel5.id, message);
          }

          _context3.next = 166;
          return effects.put(updateChannelDataAC(_channel5.id, _extends({}, channelForAdd, {
            userMessageReactions: [],
            lastReactedMessage: null
          })));

        case 166:
          _groupName4 = getChannelGroupName(_channel5);
          _context3.next = 169;
          return effects.put(updateSearchedChannelDataAC(_channel5.id, _extends({}, channelForAdd, {
            userMessageReactions: [],
            lastReactedMessage: null
          }), _groupName4));

        case 169:
          showNotifications = getShowNotifications();

          if (!(showNotifications && !message.silent && message.user.id !== SceytChatClient.user.id && !_channel5.muted)) {
            _context3.next = 191;
            break;
          }

          if (!(Notification.permission === 'granted')) {
            _context3.next = 184;
            break;
          }

          _context3.next = 174;
          return effects.select(browserTabIsActiveSelector);

        case 174:
          tabIsActive = _context3.sent;
          console.log('document.visibilityState ... ', document.visibilityState);
          console.log('tabIsActive ... ', tabIsActive);

          if (!(document.visibilityState !== 'visible' || !tabIsActive || _channel5.id !== _activeChannelId4)) {
            _context3.next = 184;
            break;
          }

          _context3.next = 180;
          return effects.select(contactsMapSelector);

        case 180:
          contactsMap = _context3.sent;
          _getFromContacts = getShowOnlyContactUsers();
          messageBody = MessageTextFormat({
            text: message.body,
            message: message,
            contactsMap: contactsMap,
            getFromContacts: _getFromContacts,
            isLastMessage: false,
            asSampleText: true
          });
          setNotification(messageBody, message.user, _channel5, undefined, message.attachments && message.attachments.length ? message.attachments.find(function (att) {
            return att.type !== attachmentTypes.link;
          }) : undefined);

        case 184:
          if (!(message.repliedInThread && message.parentMessage.id)) {
            _context3.next = 189;
            break;
          }

          _context3.next = 187;
          return effects.put(markMessagesAsDeliveredAC(message.parentMessage.id, [message.id]));

        case 187:
          _context3.next = 191;
          break;

        case 189:
          _context3.next = 191;
          return effects.put(markMessagesAsDeliveredAC(_channel5.id, [message.id]));

        case 191:
          updateChannelOnAllChannels(_channel5.id, _extends({}, channelForAdd, {
            userMessageReactions: [],
            lastReactedMessage: null
          }));
          updateChannelLastMessageOnAllChannels(_channel5.id, _channel5.lastMessage);

        case 193:
          return _context3.abrupt("break", 377);

        case 194:
          return _context3.delegateYield( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
            var channelId, markerList, channel, _activeChannelId5, updateLastMessage, markersMap, lastMessage;

            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) {
                switch (_context.prev = _context.next) {
                  case 0:
                    channelId = args.channelId, markerList = args.markerList;
                    _context.next = 3;
                    return effects.call(getChannelFromMap, channelId);

                  case 3:
                    channel = _context.sent;
                    console.log('channel MESSAGE_MARKERS_RECEIVED ... channel: ', channel, 'markers list: ', markerList);

                    if (!channel) {
                      _context.next = 22;
                      break;
                    }

                    _context.next = 8;
                    return effects.call(getActiveChannelId);

                  case 8:
                    _activeChannelId5 = _context.sent;
                    updateLastMessage = false;
                    markersMap = {};
                    markerList.messageIds.forEach(function (messageId) {
                      removePendingMessageFromMap(channel.id, messageId);
                      markersMap[messageId] = true;

                      if (channel) {
                        if (channel.lastMessage && messageId === channel.lastMessage.id && channel.lastMessage.deliveryStatus !== MESSAGE_DELIVERY_STATUS.READ) {
                          updateLastMessage = true;
                        }
                      }

                      updateChannelOnAllChannels(channelId, {}, {
                        id: messageId,
                        deliveryStatus: markerList.name
                      });
                    });

                    if (!updateLastMessage) {
                      _context.next = 17;
                      break;
                    }

                    lastMessage = _extends({}, channel.lastMessage, {
                      deliveryStatus: markerList.name
                    });
                    updateChannelLastMessageOnAllChannels(channel.id, lastMessage);
                    _context.next = 17;
                    return effects.put(updateChannelLastMessageStatusAC(lastMessage, JSON.parse(JSON.stringify(channel))));

                  case 17:
                    if (!(_activeChannelId5 === channelId)) {
                      _context.next = 21;
                      break;
                    }

                    _context.next = 20;
                    return effects.put(updateMessagesStatusAC(markerList.name, markersMap));

                  case 20:
                    updateMarkersOnAllMessages(markersMap, markerList.name);

                  case 21:
                    updateMessageStatusOnMap(channel.id, {
                      name: markerList.name,
                      markersMap: markersMap
                    });

                  case 22:
                    return _context.abrupt("return", "break");

                  case 23:
                  case "end":
                    return _context.stop();
                }
              }
            }, _callee);
          })(), "t1", 195);

        case 195:
          _ret = _context3.t1;

          if (!(_ret === "break")) {
            _context3.next = 198;
            break;
          }

          return _context3.abrupt("break", 377);

        case 198:
          return _context3.delegateYield( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
            var channel, from;
            return _regeneratorRuntime().wrap(function _callee2$(_context2) {
              while (1) {
                switch (_context2.prev = _context2.next) {
                  case 0:
                    channel = args.channel, from = args.from;

                    if (typingUsersTimeout[from.id]) {
                      clearTimeout(typingUsersTimeout[from.id]);
                    }

                    typingUsersTimeout[from.id] = setTimeout(function () {
                      channelListener.onMemberStoppedTyping(channel, from);
                    }, 4000);
                    _context2.next = 5;
                    return effects.put(switchTypingIndicatorAC(true, channel.id, from));

                  case 5:
                    return _context2.abrupt("return", "break");

                  case 6:
                  case "end":
                    return _context2.stop();
                }
              }
            }, _callee2);
          })(), "t2", 199);

        case 199:
          _ret2 = _context3.t2;

          if (!(_ret2 === "break")) {
            _context3.next = 202;
            break;
          }

          return _context3.abrupt("break", 377);

        case 202:
          _channel6 = args.channel, from = args.from;

          if (typingUsersTimeout[from.id]) {
            clearTimeout(typingUsersTimeout[from.id]);
          }

          _context3.next = 206;
          return effects.put(switchTypingIndicatorAC(false, _channel6.id, from));

        case 206:
          return _context3.abrupt("break", 377);

        case 207:
          channelId = args.channelId;
          console.log('channel DELETE ... ');
          _channel7 = getChannelFromMap(channelId);
          _context3.next = 212;
          return effects.put(setChannelToRemoveAC(_channel7));

        case 212:
          deleteChannelFromAllChannels(channelId);
          return _context3.abrupt("break", 377);

        case 214:
          _channel8 = args.channel, deletedMessage = args.deletedMessage;
          _activeChannelId6 = getActiveChannelId();
          console.log('channel DELETE_MESSAGE ... ');
          _channelExists7 = checkChannelExists(_channel8.id);

          if (!(_channel8.id === _activeChannelId6)) {
            _context3.next = 222;
            break;
          }

          updateMessageOnAllMessages(deletedMessage.id, deletedMessage);
          _context3.next = 222;
          return effects.put(updateMessageAC(deletedMessage.id, deletedMessage));

        case 222:
          updateMessageOnMap(_channel8.id, {
            messageId: deletedMessage.id,
            params: deletedMessage
          });

          if (!_channelExists7) {
            _context3.next = 229;
            break;
          }

          _context3.next = 226;
          return effects.put(updateChannelDataAC(_channel8.id, {
            newMessageCount: _channel8.newMessageCount,
            muted: _channel8.muted,
            mutedTill: _channel8.mutedTill
          }));

        case 226:
          if (!(_channel8.lastMessage.id === deletedMessage.id)) {
            _context3.next = 229;
            break;
          }

          _context3.next = 229;
          return effects.put(updateChannelLastMessageAC(deletedMessage, _channel8));

        case 229:
          updateChannelOnAllChannels(_channel8.id, {
            newMessageCount: _channel8.newMessageCount,
            muted: _channel8.muted,
            mutedTill: _channel8.mutedTill
          }, deletedMessage);
          return _context3.abrupt("break", 377);

        case 231:
          _channel9 = args.channel, _message = args.message;
          console.log('channel EDIT_MESSAGE ... ', _message);
          _activeChannelId7 = getActiveChannelId();
          _channelExists8 = checkChannelExists(_channel9.id);

          if (!(_channel9.id === _activeChannelId7)) {
            _context3.next = 239;
            break;
          }

          _context3.next = 238;
          return effects.put(updateMessageAC(_message.id, {
            body: _message.body,
            state: _message.state,
            attachments: _message.attachments,
            updatedAt: _message.updatedAt
          }));

        case 238:
          updateMessageOnAllMessages(_message.id, {
            body: _message.body,
            state: _message.state,
            attachments: _message.attachments,
            updatedAt: _message.updatedAt
          });

        case 239:
          if (!_channelExists8) {
            _context3.next = 243;
            break;
          }

          if (!(_channel9.lastMessage.id === _message.id)) {
            _context3.next = 243;
            break;
          }

          _context3.next = 243;
          return effects.put(updateChannelLastMessageAC(_message, _channel9));

        case 243:
          if (checkChannelExistsOnMessagesMap(_channel9.id)) {
            updateMessageOnMap(_channel9.id, {
              messageId: _message.id,
              params: _message
            });
          }

          updateChannelOnAllChannels(_channel9.id, {}, _message);
          return _context3.abrupt("break", 377);

        case 246:
          _channel10 = args.channel, user = args.user, _message2 = args.message, reaction = args.reaction;
          console.log('channel REACTION_ADDED ... ', args);
          isSelf = user.id === SceytChatClient.user.id;
          _activeChannelId8 = getActiveChannelId();

          if (!(_channel10.id === _activeChannelId8)) {
            _context3.next = 254;
            break;
          }

          _context3.next = 253;
          return effects.put(addReactionToMessageAC(_message2, reaction, isSelf));

        case 253:
          addReactionOnAllMessages(_message2, reaction, true);

        case 254:
          if (!(_message2.user.id === SceytChatClient.user.id)) {
            _context3.next = 268;
            break;
          }

          if (!(!isSelf && Notification.permission === 'granted')) {
            _context3.next = 263;
            break;
          }

          if (!(document.visibilityState !== 'visible' || _channel10.id !== _activeChannelId8)) {
            _context3.next = 263;
            break;
          }

          _context3.next = 259;
          return effects.select(contactsMapSelector);

        case 259:
          _contactsMap = _context3.sent;
          _getFromContacts2 = getShowOnlyContactUsers();
          _messageBody = MessageTextFormat({
            text: _message2.body,
            message: _message2,
            contactsMap: _contactsMap,
            getFromContacts: _getFromContacts2,
            isLastMessage: false,
            asSampleText: true
          });
          setNotification(_messageBody, reaction.user, _channel10, reaction.key, _message2.attachments && _message2.attachments.length ? _message2.attachments.find(function (att) {
            return att.type !== attachmentTypes.link;
          }) : undefined);

        case 263:
          if (!(_channel10.newReactions && _channel10.newReactions.length)) {
            _context3.next = 267;
            break;
          }

          channelUpdateParams = {
            userMessageReactions: _channel10.newReactions,
            lastReactedMessage: _message2,
            newReactions: _channel10.newReactions,
            muted: _channel10.muted,
            mutedTill: _channel10.mutedTill
          };
          _context3.next = 267;
          return effects.put(updateChannelDataAC(_channel10.id, channelUpdateParams));

        case 267:
          updateChannelOnAllChannels(_channel10.id, {
            userMessageReactions: _channel10.newReactions,
            lastReactedMessage: _message2,
            newReactions: _channel10.newReactions,
            muted: _channel10.muted,
            mutedTill: _channel10.mutedTill
          });

        case 268:
          if (checkChannelExistsOnMessagesMap(_channel10.id)) {
            addReactionToMessageOnMap(_channel10.id, _message2, reaction, true);
          }

          return _context3.abrupt("break", 377);

        case 270:
          _channel11 = args.channel, _user = args.user, _message3 = args.message, _reaction = args.reaction;
          console.log('channel REACTION_DELETED ... ', _channel11);
          channelFromMap = getChannelFromMap(_channel11.id);
          _isSelf = _user.id === SceytChatClient.user.id;
          _activeChannelId9 = getActiveChannelId();

          if (!(_channel11.id === _activeChannelId9)) {
            _context3.next = 279;
            break;
          }

          _context3.next = 278;
          return effects.put(deleteReactionFromMessageAC(_message3, _reaction, _isSelf));

        case 278:
          removeReactionOnAllMessages(_message3, _reaction, true);

        case 279:
          _channelUpdateParams = JSON.parse(JSON.stringify(_channel11));

          if (channelFromMap && channelFromMap.lastReactedMessage && channelFromMap.lastReactedMessage.id === _message3.id) {
            _channelUpdateParams.lastReactedMessage = null;
          }

          _context3.next = 283;
          return effects.put(updateChannelDataAC(_channel11.id, _channelUpdateParams));

        case 283:
          updateChannelOnAllChannels(_channel11.id, _channelUpdateParams);

          if (checkChannelExistsOnMessagesMap(_channel11.id)) {
            removeReactionToMessageOnMap(_channel11.id, _message3, _reaction, true);
          }

          return _context3.abrupt("break", 377);

        case 286:
          _channel12 = args.channel, channelUnreadCount = args.channelUnreadCount;
          console.log('channel UNREAD_MESSAGES_INFO .channelUnreadCount', channelUnreadCount, 'channel: ', _channel12);
          _updatedChannel = JSON.parse(JSON.stringify(_channel12));
          _context3.next = 291;
          return effects.put(updateChannelDataAC(_channel12.id, _updatedChannel));

        case 291:
          updateChannelOnAllChannels(_channel12.id, _updatedChannel);
          return _context3.abrupt("break", 377);

        case 293:
          _channel13 = args.channel;
          console.log('CLEAR_HISTORY: ', _channel13);
          _context3.next = 297;
          return effects.call(getActiveChannelId);

        case 297:
          _activeChannelId10 = _context3.sent;
          _context3.next = 300;
          return effects.call(checkChannelExists, _channel13.id);

        case 300:
          channelExist = _context3.sent;

          if (!(_channel13.id === _activeChannelId10)) {
            _context3.next = 305;
            break;
          }

          _context3.next = 304;
          return effects.put(clearMessagesAC());

        case 304:
          removeAllMessages();

        case 305:
          removeMessagesFromMap(_channel13.id);

          if (!channelExist) {
            _context3.next = 309;
            break;
          }

          _context3.next = 309;
          return effects.put(updateChannelDataAC(_channel13.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0,
            muted: _channel13.muted,
            mutedTill: _channel13.mutedTill
          }));

        case 309:
          updateChannelOnAllChannels(_channel13.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0,
            muted: _channel13.muted,
            mutedTill: _channel13.mutedTill
          });
          return _context3.abrupt("break", 377);

        case 311:
          _channel14 = args.channel;
          console.log('channel MUTE ... ');
          _context3.next = 315;
          return effects.put(updateChannelDataAC(_channel14.id, {
            muted: _channel14.muted,
            mutedTill: _channel14.mutedTill
          }));

        case 315:
          updateChannelOnAllChannels(_channel14.id, {
            muted: _channel14.muted,
            mutedTill: _channel14.mutedTill
          });
          return _context3.abrupt("break", 377);

        case 317:
          _channel15 = args.channel;
          console.log('channel UNMUTE ... ');
          _context3.next = 321;
          return effects.put(updateChannelDataAC(_channel15.id, {
            muted: _channel15.muted,
            mutedTill: _channel15.mutedTill
          }));

        case 321:
          updateChannelOnAllChannels(_channel15.id, {
            muted: _channel15.muted,
            mutedTill: _channel15.mutedTill
          });
          return _context3.abrupt("break", 377);

        case 323:
          _channel16 = args.channel;
          console.log('channel HIDE ... ');
          _context3.next = 327;
          return effects.put(setChannelToHideAC(_channel16));

        case 327:
          return _context3.abrupt("break", 377);

        case 328:
          _channel17 = args.channel;
          console.log('channel UNHIDE ... ');
          _context3.next = 332;
          return effects.put(setChannelToUnHideAC(_channel17));

        case 332:
          return _context3.abrupt("break", 377);

        case 333:
          _channel18 = args.channel;
          _context3.next = 336;
          return effects.put(updateChannelDataAC(_channel18.id, {
            unread: _channel18.unread,
            muted: _channel18.muted,
            mutedTill: _channel18.mutedTill
          }));

        case 336:
          _groupName5 = getChannelGroupName(_channel18);
          _context3.next = 339;
          return effects.put(updateSearchedChannelDataAC(_channel18.id, {
            unread: _channel18.unread
          }, _groupName5));

        case 339:
          updateChannelOnAllChannels(_channel18.id, {
            unread: _channel18.unread
          });
          return _context3.abrupt("break", 377);

        case 341:
          _channel19 = args.channel;
          _context3.next = 344;
          return effects.put(updateChannelDataAC(_channel19.id, {
            unread: _channel19.unread,
            muted: _channel19.muted,
            mutedTill: _channel19.mutedTill
          }));

        case 344:
          _groupName6 = getChannelGroupName(_channel19);
          _context3.next = 347;
          return effects.put(updateSearchedChannelDataAC(_channel19.id, {
            unread: _channel19.unread
          }, _groupName6));

        case 347:
          updateChannelOnAllChannels(_channel19.id, {
            unread: _channel19.unread
          });
          return _context3.abrupt("break", 377);

        case 349:
          _channel20 = args.channel, members = args.members;
          console.log('channel CHANGE_ROLE  channel ... ', _channel20);
          console.log('channel CHANGE_ROLE  member ... ', members);
          _context3.next = 354;
          return effects.call(getActiveChannelId);

        case 354:
          _activeChannelId11 = _context3.sent;

          if (!(_channel20.id === _activeChannelId11)) {
            _context3.next = 358;
            break;
          }

          _context3.next = 358;
          return effects.put(updateMembersAC(members));

        case 358:
          i = 0;

        case 359:
          if (!(i < members.length)) {
            _context3.next = 367;
            break;
          }

          if (!(members[i].id === SceytChatClient.user.id)) {
            _context3.next = 364;
            break;
          }

          _context3.next = 363;
          return effects.put(updateChannelDataAC(_channel20.id, {
            userRole: members[i].role,
            muted: _channel20.muted,
            mutedTill: _channel20.mutedTill
          }));

        case 363:
          updateChannelOnAllChannels(_channel20.id, {
            userRole: members[i].role,
            muted: _channel20.muted,
            mutedTill: _channel20.mutedTill
          });

        case 364:
          i++;
          _context3.next = 359;
          break;

        case 367:
          return _context3.abrupt("break", 377);

        case 368:
          status = args.status;
          console.log('connection status changed . . . . . ', status);
          _context3.next = 372;
          return effects.put(setConnectionStatusAC(status));

        case 372:
          if (!(status === CONNECTION_STATUS.CONNECTED)) {
            _context3.next = 375;
            break;
          }

          _context3.next = 375;
          return effects.put(getRolesAC());

        case 375:
          return _context3.abrupt("break", 377);

        case 376:
          console.warn('UNHANDLED EVENT FROM REDUX-SAGA EVENT-CHANNEL');

        case 377:
          _context3.next = 5;
          break;

        case 379:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked);
}

var _marked$1 = /*#__PURE__*/_regeneratorRuntime().mark(createChannel),
    _marked2 = /*#__PURE__*/_regeneratorRuntime().mark(getChannels),
    _marked3 = /*#__PURE__*/_regeneratorRuntime().mark(searchChannels),
    _marked4 = /*#__PURE__*/_regeneratorRuntime().mark(getChannelsForForward),
    _marked5 = /*#__PURE__*/_regeneratorRuntime().mark(searchChannelsForForward),
    _marked6 = /*#__PURE__*/_regeneratorRuntime().mark(channelsLoadMore),
    _marked7 = /*#__PURE__*/_regeneratorRuntime().mark(channelsForForwardLoadMore),
    _marked8 = /*#__PURE__*/_regeneratorRuntime().mark(markMessagesRead),
    _marked9 = /*#__PURE__*/_regeneratorRuntime().mark(markMessagesDelivered),
    _marked10 = /*#__PURE__*/_regeneratorRuntime().mark(switchChannel),
    _marked11 = /*#__PURE__*/_regeneratorRuntime().mark(notificationsTurnOff),
    _marked12 = /*#__PURE__*/_regeneratorRuntime().mark(notificationsTurnOn),
    _marked13 = /*#__PURE__*/_regeneratorRuntime().mark(markChannelAsRead),
    _marked14 = /*#__PURE__*/_regeneratorRuntime().mark(markChannelAsUnRead),
    _marked15 = /*#__PURE__*/_regeneratorRuntime().mark(removeChannelCaches),
    _marked16 = /*#__PURE__*/_regeneratorRuntime().mark(leaveChannel),
    _marked17 = /*#__PURE__*/_regeneratorRuntime().mark(deleteChannel),
    _marked18 = /*#__PURE__*/_regeneratorRuntime().mark(blockChannel),
    _marked19 = /*#__PURE__*/_regeneratorRuntime().mark(updateChannel),
    _marked20 = /*#__PURE__*/_regeneratorRuntime().mark(checkUsersStatus),
    _marked21 = /*#__PURE__*/_regeneratorRuntime().mark(sendTyping),
    _marked22 = /*#__PURE__*/_regeneratorRuntime().mark(clearHistory),
    _marked23 = /*#__PURE__*/_regeneratorRuntime().mark(deleteAllMessages),
    _marked24 = /*#__PURE__*/_regeneratorRuntime().mark(joinChannel),
    _marked25 = /*#__PURE__*/_regeneratorRuntime().mark(watchForChannelEvents),
    _marked26 = /*#__PURE__*/_regeneratorRuntime().mark(ChannelsSaga);

function createChannel(action) {
  var payload, channelData, dontCreateIfNotExists, SceytChatClient, createChannelData, fileToUpload, channelIsExistOnAllChannels, createdChannel, allChannels, memberId, checkChannelExist, messageToSend, _allChannels, _memberId;

  return _regeneratorRuntime().wrap(function createChannel$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.prev = 0;
          payload = action.payload;
          channelData = payload.channelData, dontCreateIfNotExists = payload.dontCreateIfNotExists;
          SceytChatClient = getClient();
          createChannelData = _extends({}, channelData);

          if (!createChannelData.avatarFile) {
            _context.next = 10;
            break;
          }

          fileToUpload = {
            data: createChannelData.avatarFile,
            progress: function progress(progressPercent) {
              console.log('upload percent - ', progressPercent);
            }
          };
          _context.next = 9;
          return effects.call(SceytChatClient.uploadFile, fileToUpload);

        case 9:
          createChannelData.avatarUrl = _context.sent;

        case 10:
          delete createChannelData.avatarFile;
          channelIsExistOnAllChannels = false;

          if (!(channelData.type === CHANNEL_TYPE.DIRECT && dontCreateIfNotExists)) {
            _context.next = 25;
            break;
          }

          allChannels = getAllChannels();
          memberId = channelData.members[0].id;
          allChannels.forEach(function (channel) {
            if (channel.type === CHANNEL_TYPE.DIRECT) {
              var directChannelUser = channel.members.find(function (member) {
                return member.id === memberId;
              });

              if (directChannelUser) {
                channelIsExistOnAllChannels = true;
              }
            }
          });

          if (!channelIsExistOnAllChannels) {
            _context.next = 22;
            break;
          }

          _context.next = 19;
          return effects.call(SceytChatClient.Channel.create, createChannelData);

        case 19:
          createdChannel = _context.sent;
          _context.next = 23;
          break;

        case 22:
          createdChannel = _extends({}, channelData, {
            isMockChannel: true,
            avatarUrl: '',
            createdAt: new Date(Date.now()),
            hidden: false,
            id: uuid.v4(),
            lastMessage: null,
            memberCount: 2,
            metadata: '',
            newMentionCount: 0,
            newMessageCount: 0,
            newReactedMessageCount: 0,
            muted: false,
            subject: '',
            userRole: 'owner'
          });

        case 23:
          _context.next = 28;
          break;

        case 25:
          _context.next = 27;
          return effects.call(SceytChatClient.Channel.create, createChannelData);

        case 27:
          createdChannel = _context.sent;

        case 28:
          checkChannelExist = false;

          if (!(createdChannel.type === CHANNEL_TYPE.DIRECT)) {
            _context.next = 33;
            break;
          }

          _context.next = 32;
          return effects.call(checkChannelExists, createdChannel.id);

        case 32:
          checkChannelExist = _context.sent;

        case 33:
          if (checkChannelExist) {
            _context.next = 43;
            break;
          }

          _context.next = 36;
          return effects.call(setChannelInMap, createdChannel);

        case 36:
          if (!(createdChannel.type !== CHANNEL_TYPE.DIRECT)) {
            _context.next = 40;
            break;
          }

          messageToSend = {
            body: createdChannel.type === CHANNEL_TYPE.BROADCAST || createdChannel.type === CHANNEL_TYPE.PUBLIC ? 'CC' : 'CG',
            mentionedMembers: [],
            attachments: [],
            type: 'system'
          };
          _context.next = 40;
          return effects.put(sendTextMessageAC(messageToSend, createdChannel.id, CONNECTION_STATUS.CONNECTED));

        case 40:
          if (!(!dontCreateIfNotExists || channelIsExistOnAllChannels)) {
            _context.next = 43;
            break;
          }

          _context.next = 43;
          return effects.put(setChannelToAddAC(JSON.parse(JSON.stringify(createdChannel))));

        case 43:
          _context.next = 45;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(_extends({}, createdChannel, {
            isLinkedChannel: dontCreateIfNotExists
          })))));

        case 45:
          if (dontCreateIfNotExists) {
            if (!channelIsExistOnAllChannels) {
              addChannelsToAllChannels(createdChannel);
            }
          } else {
            _allChannels = getAllChannels();
            _memberId = channelData.members[0].id;

            _allChannels.forEach(function (channel) {
              if (channel.type === CHANNEL_TYPE.DIRECT) {
                var directChannelUser = channel.members.find(function (member) {
                  return member.id === _memberId;
                });

                if (directChannelUser) {
                  channelIsExistOnAllChannels = true;
                }
              }
            });

            if (!channelIsExistOnAllChannels) {
              addChannelsToAllChannels(createdChannel);
            }
          }

          _context.next = 48;
          return effects.call(setActiveChannelId, createdChannel.id);

        case 48:
          _context.next = 53;
          break;

        case 50:
          _context.prev = 50;
          _context.t0 = _context["catch"](0);
          console.log(_context.t0, 'Error on create channel');

        case 53:
        case "end":
          return _context.stop();
      }
    }
  }, _marked$1, null, [[0, 50]]);
}

function getChannels(action) {
  var payload, params, SceytChatClient, channelQueryBuilder, channelQuery, channelsData, channelId, activeChannel, _yield$call, mappedChannels, channelsForUpdateLastReactionMessage, channelMessageMap, _channelsData$channel, allChannelsQueryBuilder, allChannelsQuery, hasNext, i, allChannelsData;

  return _regeneratorRuntime().wrap(function getChannels$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          _context2.prev = 0;
          payload = action.payload;
          params = payload.params;
          SceytChatClient = getClient();
          _context2.next = 6;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING));

        case 6:
          channelQueryBuilder = new SceytChatClient.ChannelListQueryBuilder();

          if (params.filter && params.filter.channelType) {
            channelQueryBuilder.types(params.filter.channelType);
          }

          channelQueryBuilder.order('lastMessage');
          channelQueryBuilder.limit(params.limit || 50);
          _context2.next = 12;
          return effects.call(channelQueryBuilder.build);

        case 12:
          channelQuery = _context2.sent;
          _context2.next = 15;
          return effects.call(channelQuery.loadNextPage);

        case 15:
          channelsData = _context2.sent;
          _context2.next = 18;
          return effects.put(channelHasNextAC(channelsData.hasNext));

        case 18:
          _context2.next = 20;
          return effects.call(getActiveChannelId);

        case 20:
          channelId = _context2.sent;

          if (!channelId) {
            _context2.next = 27;
            break;
          }

          _context2.next = 24;
          return effects.call(getChannelFromMap, channelId);

        case 24:
          _context2.t0 = _context2.sent;
          _context2.next = 28;
          break;

        case 27:
          _context2.t0 = null;

        case 28:
          activeChannel = _context2.t0;
          _context2.next = 31;
          return effects.call(destroyChannelsMap);

        case 31:
          _context2.next = 33;
          return effects.call(setChannelsInMap, channelsData.channels);

        case 33:
          _yield$call = _context2.sent;
          mappedChannels = _yield$call.channels;
          channelsForUpdateLastReactionMessage = _yield$call.channelsForUpdateLastReactionMessage;

          if (!channelsForUpdateLastReactionMessage.length) {
            _context2.next = 41;
            break;
          }

          channelMessageMap = {};
          _context2.next = 40;
          return effects.call(function () {
            try {
              return Promise.resolve(Promise.all(channelsForUpdateLastReactionMessage.map(function (channel) {
                try {
                  return Promise.resolve(new Promise(function (resolve) {
                    channel.getMessagesById([channel.newReactions[0].messageId]).then(function (messages) {
                      channelMessageMap[channel.id] = messages[0];
                      resolve(true);
                    })["catch"](function (e) {
                      console.log(e, 'Error on getMessagesById');
                      resolve(true);
                    });
                  }));
                } catch (e) {
                  return Promise.reject(e);
                }
              })));
            } catch (e) {
              return Promise.reject(e);
            }
          });

        case 40:
          mappedChannels = mappedChannels.map(function (channel) {
            if (channelMessageMap[channel.id]) {
              channel.lastReactedMessage = channelMessageMap[channel.id];
            }

            return channel;
          });

        case 41:
          _context2.next = 43;
          return effects.put(setChannelsAC(mappedChannels));

        case 43:
          if (!channelId) {
            _channelsData$channel = channelsData.channels;
            activeChannel = _channelsData$channel[0];
          }

          query.channelQuery = channelQuery;

          if (!activeChannel) {
            _context2.next = 48;
            break;
          }

          _context2.next = 48;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(activeChannel))));

        case 48:
          _context2.next = 50;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED));

        case 50:
          allChannelsQueryBuilder = new SceytChatClient.ChannelListQueryBuilder();
          allChannelsQueryBuilder.order('lastMessage');
          allChannelsQueryBuilder.limit(50);
          _context2.next = 55;
          return effects.call(allChannelsQueryBuilder.build);

        case 55:
          allChannelsQuery = _context2.sent;
          hasNext = true;
          i = 0;

        case 58:
          if (!(i <= 4)) {
            _context2.next = 74;
            break;
          }

          if (!hasNext) {
            _context2.next = 71;
            break;
          }

          _context2.prev = 60;
          _context2.next = 63;
          return effects.call(allChannelsQuery.loadNextPage);

        case 63:
          allChannelsData = _context2.sent;
          hasNext = allChannelsData.hasNext;
          addChannelsToAllChannels(allChannelsData.channels);
          _context2.next = 71;
          break;

        case 68:
          _context2.prev = 68;
          _context2.t1 = _context2["catch"](60);
          console.log(_context2.t1, 'Error on get all channels');

        case 71:
          i++;
          _context2.next = 58;
          break;

        case 74:
          _context2.next = 80;
          break;

        case 76:
          _context2.prev = 76;
          _context2.t2 = _context2["catch"](0);
          console.log(_context2.t2, 'Error on get channels');

        case 80:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2, null, [[0, 76], [60, 68]]);
}

function searchChannels(action) {
  var payload, params, contactsMap, SceytChatClient, getFromContacts, searchBy, channelQueryBuilder, allChannels, publicChannels, chatsGroups, contactsList, contactsWithChannelsMap, lowerCaseSearchBy, channelQuery, channelsData, channelsToAdd;
  return _regeneratorRuntime().wrap(function searchChannels$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          _context3.prev = 0;
          payload = action.payload;
          params = payload.params, contactsMap = payload.contactsMap;
          console.log('search channel payload: ', payload);
          SceytChatClient = getClient();
          getFromContacts = getShowOnlyContactUsers();
          _context3.next = 8;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING));

        case 8:
          searchBy = params.search;

          if (!searchBy) {
            _context3.next = 38;
            break;
          }

          channelQueryBuilder = new SceytChatClient.ChannelListQueryBuilder();

          if (params.filter && params.filter.channelType) {
            channelQueryBuilder.types(params.filter.channelType);
          }

          allChannels = getAllChannels();
          publicChannels = [];
          chatsGroups = [];
          contactsList = [];
          contactsWithChannelsMap = {};
          lowerCaseSearchBy = searchBy.toLowerCase();
          allChannels.forEach(function (channel) {
            if (channel.type === CHANNEL_TYPE.DIRECT) {
              var directChannelUser = channel.members.find(function (member) {
                return member.id !== SceytChatClient.user.id;
              });

              if (directChannelUser && contactsMap[directChannelUser.id]) {
                contactsWithChannelsMap[directChannelUser.id] = true;
              }

              var userName = makeUsername(directChannelUser && contactsMap[directChannelUser.id], directChannelUser, getFromContacts).toLowerCase();

              if (userName.includes(lowerCaseSearchBy)) {
                chatsGroups.push(channel);
              }
            } else {
              if (channel.subject && channel.subject.toLowerCase().includes(lowerCaseSearchBy)) {
                if (channel.type === CHANNEL_TYPE.PUBLIC || channel.type === CHANNEL_TYPE.BROADCAST) {
                  publicChannels.push(channel);
                } else {
                  chatsGroups.push(channel);
                }
              }
            }
          });

          if (getFromContacts) {
            Object.values(contactsMap).forEach(function (contact) {
              if (!contactsWithChannelsMap[contact.id]) {
                var userName = makeUsername(contact, undefined, true).toLowerCase();

                if (userName.includes(lowerCaseSearchBy)) {
                  contactsList.push(contact);
                }
              }
            });
          }

          _context3.next = 22;
          return effects.put(setSearchedChannelsAC({
            chats_groups: JSON.parse(JSON.stringify(chatsGroups)),
            channels: JSON.parse(JSON.stringify(publicChannels)),
            contacts: JSON.parse(JSON.stringify(contactsList))
          }));

        case 22:
          _context3.next = 24;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED));

        case 24:
          channelQueryBuilder.query(lowerCaseSearchBy);
          channelQueryBuilder.limit(params.limit || 50);
          channelQueryBuilder.order('lastMessage');
          channelQueryBuilder.filterKey(['subject']);
          channelQueryBuilder.searchOperator('contains');
          _context3.next = 31;
          return effects.call(channelQueryBuilder.build);

        case 31:
          channelQuery = _context3.sent;
          _context3.next = 34;
          return effects.call(channelQuery.loadNextPage);

        case 34:
          channelsData = _context3.sent;
          channelsToAdd = channelsData.channels.filter(function (channel) {
            return channel.type === CHANNEL_TYPE.PUBLIC || channel.type === CHANNEL_TYPE.BROADCAST;
          });
          _context3.next = 38;
          return effects.put(setSearchedChannelsAC({
            chats_groups: JSON.parse(JSON.stringify(chatsGroups)),
            channels: JSON.parse(JSON.stringify(channelsToAdd)),
            contacts: JSON.parse(JSON.stringify(contactsList))
          }));

        case 38:
          _context3.next = 44;
          break;

        case 40:
          _context3.prev = 40;
          _context3.t0 = _context3["catch"](0);
          console.log(_context3.t0, 'Error on get channels');

        case 44:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked3, null, [[0, 40]]);
}

function getChannelsForForward() {
  var SceytChatClient, channelQueryBuilder, channelQuery, channelsData, channelsToAdd, _yield$call2, mappedChannels;

  return _regeneratorRuntime().wrap(function getChannelsForForward$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          _context4.prev = 0;
          SceytChatClient = getClient();
          _context4.next = 4;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING, true));

        case 4:
          channelQueryBuilder = new SceytChatClient.ChannelListQueryBuilder();
          channelQueryBuilder.order('lastMessage');
          channelQueryBuilder.limit(20);
          _context4.next = 9;
          return effects.call(channelQueryBuilder.build);

        case 9:
          channelQuery = _context4.sent;
          _context4.next = 12;
          return effects.call(channelQuery.loadNextPage);

        case 12:
          channelsData = _context4.sent;
          _context4.next = 15;
          return effects.put(channelHasNextAC(channelsData.hasNext, true));

        case 15:
          channelsToAdd = channelsData.channels.filter(function (channel) {
            return channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? channel.userRole === 'admin' || channel.userRole === 'owner' : channel.type === CHANNEL_TYPE.DIRECT ? channel.members.find(function (member) {
              return member.id && member.id !== SceytChatClient.user.id;
            }) : true;
          });
          _context4.next = 18;
          return effects.call(setChannelsInMap, channelsToAdd);

        case 18:
          _yield$call2 = _context4.sent;
          mappedChannels = _yield$call2.channels;
          _context4.next = 22;
          return effects.put(setChannelsForForwardAC(mappedChannels));

        case 22:
          query.channelQueryForward = channelQuery;
          _context4.next = 25;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED, true));

        case 25:
          _context4.next = 31;
          break;

        case 27:
          _context4.prev = 27;
          _context4.t0 = _context4["catch"](0);
          console.log(_context4.t0, 'Error on get for forward channels');

        case 31:
        case "end":
          return _context4.stop();
      }
    }
  }, _marked4, null, [[0, 27]]);
}

function searchChannelsForForward(action) {
  var payload, params, contactsMap, SceytChatClient, getFromContacts, searchBy, channelQueryBuilder, allChannels, publicChannels, chatsGroups, contactsList, contactsWithChannelsMap, lowerCaseSearchBy, channelQuery, channelsData, channelsToAdd;
  return _regeneratorRuntime().wrap(function searchChannelsForForward$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          _context5.prev = 0;
          payload = action.payload;
          params = payload.params, contactsMap = payload.contactsMap;
          SceytChatClient = getClient();
          getFromContacts = getShowOnlyContactUsers();
          _context5.next = 7;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING, true));

        case 7:
          searchBy = params.search;

          if (!searchBy) {
            _context5.next = 37;
            break;
          }

          channelQueryBuilder = new SceytChatClient.ChannelListQueryBuilder();

          if (params.filter && params.filter.channelType) {
            channelQueryBuilder.types(params.filter.channelType);
          }

          allChannels = getAllChannels();
          publicChannels = [];
          chatsGroups = [];
          contactsList = [];
          contactsWithChannelsMap = {};
          lowerCaseSearchBy = searchBy.toLowerCase();
          allChannels.forEach(function (channel) {
            if (channel.type === CHANNEL_TYPE.DIRECT) {
              var directChannelUser = channel.members.find(function (member) {
                return member.id !== SceytChatClient.user.id;
              });

              if (directChannelUser && contactsMap[directChannelUser.id]) {
                contactsWithChannelsMap[directChannelUser.id] = true;
              }

              var userName = makeUsername(directChannelUser && contactsMap[directChannelUser.id], directChannelUser, getFromContacts).toLowerCase();

              if (userName.includes(lowerCaseSearchBy)) {
                chatsGroups.push(channel);
              }
            } else {
              if (channel.subject && channel.subject.toLowerCase().includes(lowerCaseSearchBy)) {
                if (channel.type === CHANNEL_TYPE.PUBLIC || channel.type === CHANNEL_TYPE.BROADCAST) {
                  publicChannels.push(channel);
                } else {
                  chatsGroups.push(channel);
                }
              }
            }
          });

          if (getFromContacts) {
            Object.values(contactsMap).forEach(function (contact) {
              if (!contactsWithChannelsMap[contact.id]) {
                var userName = makeUsername(contact, undefined, true).toLowerCase();

                if (userName.includes(lowerCaseSearchBy)) {
                  contactsList.push(contact);
                }
              }
            });
          }

          _context5.next = 21;
          return effects.put(setSearchedChannelsForForwardAC({
            chats_groups: JSON.parse(JSON.stringify(chatsGroups)),
            channels: JSON.parse(JSON.stringify(publicChannels)),
            contacts: JSON.parse(JSON.stringify(contactsList))
          }));

        case 21:
          _context5.next = 23;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED, true));

        case 23:
          channelQueryBuilder.query(lowerCaseSearchBy);
          channelQueryBuilder.limit(params.limit || 50);
          channelQueryBuilder.order('lastMessage');
          channelQueryBuilder.filterKey(['subject']);
          channelQueryBuilder.searchOperator('contains');
          _context5.next = 30;
          return effects.call(channelQueryBuilder.build);

        case 30:
          channelQuery = _context5.sent;
          _context5.next = 33;
          return effects.call(channelQuery.loadNextPage);

        case 33:
          channelsData = _context5.sent;
          channelsToAdd = channelsData.channels.filter(function (channel) {
            return channel.type === CHANNEL_TYPE.PUBLIC || channel.type === CHANNEL_TYPE.BROADCAST;
          });
          _context5.next = 37;
          return effects.put(setSearchedChannelsForForwardAC({
            chats_groups: JSON.parse(JSON.stringify(chatsGroups)),
            channels: JSON.parse(JSON.stringify(channelsToAdd)),
            contacts: JSON.parse(JSON.stringify(contactsList))
          }));

        case 37:
          _context5.next = 43;
          break;

        case 39:
          _context5.prev = 39;
          _context5.t0 = _context5["catch"](0);
          console.log(_context5.t0, 'Error on get channels');

        case 43:
        case "end":
          return _context5.stop();
      }
    }
  }, _marked5, null, [[0, 39]]);
}

function channelsLoadMore(action) {
  var payload, limit, channelQuery, channelsData, _yield$call3, mappedChannels, channelsForUpdateLastReactionMessage, channelMessageMap;

  return _regeneratorRuntime().wrap(function channelsLoadMore$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          _context6.prev = 0;
          payload = action.payload;
          limit = payload.limit;
          channelQuery = query.channelQuery;

          if (limit) {
            channelQuery.limit = limit;
          }

          _context6.next = 7;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING));

        case 7:
          _context6.next = 9;
          return effects.call(channelQuery.loadNextPage);

        case 9:
          channelsData = _context6.sent;
          _context6.next = 12;
          return effects.put(channelHasNextAC(channelsData.hasNext));

        case 12:
          _context6.next = 14;
          return effects.call(setChannelsInMap, channelsData.channels);

        case 14:
          _yield$call3 = _context6.sent;
          mappedChannels = _yield$call3.channels;
          channelsForUpdateLastReactionMessage = _yield$call3.channelsForUpdateLastReactionMessage;

          if (!channelsForUpdateLastReactionMessage.length) {
            _context6.next = 22;
            break;
          }

          channelMessageMap = {};
          _context6.next = 21;
          return effects.call(function () {
            try {
              return Promise.resolve(Promise.all(channelsForUpdateLastReactionMessage.map(function (channel) {
                try {
                  return Promise.resolve(new Promise(function (resolve) {
                    channel.getMessagesById([channel.newReactions[0].messageId]).then(function (messages) {
                      channelMessageMap[channel.id] = messages[0];
                      resolve(true);
                    })["catch"](function (e) {
                      console.log(e, 'Error on getMessagesById');
                      resolve(true);
                    });
                  }));
                } catch (e) {
                  return Promise.reject(e);
                }
              })));
            } catch (e) {
              return Promise.reject(e);
            }
          });

        case 21:
          mappedChannels = mappedChannels.map(function (channel) {
            if (channelMessageMap[channel.id]) {
              channel.lastReactedMessage = channelMessageMap[channel.id];
            }

            return channel;
          });

        case 22:
          _context6.next = 24;
          return effects.put(addChannelsAC(mappedChannels));

        case 24:
          _context6.next = 26;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED));

        case 26:
          _context6.next = 31;
          break;

        case 28:
          _context6.prev = 28;
          _context6.t0 = _context6["catch"](0);
          console.log(_context6.t0, 'Error in load more channels');

        case 31:
        case "end":
          return _context6.stop();
      }
    }
  }, _marked6, null, [[0, 28]]);
}

function channelsForForwardLoadMore(action) {
  var payload, limit, SceytChatClient, channelQueryForward, channelsData, channelsToAdd, _yield$call4, mappedChannels;

  return _regeneratorRuntime().wrap(function channelsForForwardLoadMore$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          _context7.prev = 0;
          payload = action.payload;
          limit = payload.limit;
          SceytChatClient = getClient();
          channelQueryForward = query.channelQueryForward;

          if (limit) {
            channelQueryForward.limit = limit;
          }

          _context7.next = 8;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADING));

        case 8:
          _context7.next = 10;
          return effects.call(channelQueryForward.loadNextPage);

        case 10:
          channelsData = _context7.sent;
          _context7.next = 13;
          return effects.put(channelHasNextAC(channelsData.hasNext, true));

        case 13:
          channelsToAdd = channelsData.channels.filter(function (channel) {
            return channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? channel.userRole === 'admin' || channel.userRole === 'owner' : channel.type === CHANNEL_TYPE.DIRECT ? channel.members.find(function (member) {
              return member.id && member.id !== SceytChatClient.user.id;
            }) : true;
          });
          _context7.next = 16;
          return effects.call(setChannelsInMap, channelsToAdd);

        case 16:
          _yield$call4 = _context7.sent;
          mappedChannels = _yield$call4.channels;
          _context7.next = 20;
          return effects.put(addChannelsForForwardAC(mappedChannels));

        case 20:
          _context7.next = 22;
          return effects.put(setChannelsLoadingStateAC(LOADING_STATE.LOADED));

        case 22:
          _context7.next = 27;
          break;

        case 24:
          _context7.prev = 24;
          _context7.t0 = _context7["catch"](0);
          console.log(_context7.t0, 'Error in load more channels for forward');

        case 27:
        case "end":
          return _context7.stop();
      }
    }
  }, _marked7, null, [[0, 24]]);
}

function markMessagesRead(action) {
  var payload, channelId, messageIds, channel, messageListMarker, _iterator, _step, messageId, updateParams;

  return _regeneratorRuntime().wrap(function markMessagesRead$(_context8) {
    while (1) {
      switch (_context8.prev = _context8.next) {
        case 0:
          payload = action.payload;
          channelId = payload.channelId, messageIds = payload.messageIds;
          _context8.next = 4;
          return effects.call(getChannelFromMap, channelId);

        case 4:
          channel = _context8.sent;
          _context8.prev = 5;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          if (!channel) {
            _context8.next = 24;
            break;
          }

          _context8.next = 10;
          return effects.call(channel.markMessagesAsDisplayed, messageIds);

        case 10:
          messageListMarker = _context8.sent;
          _context8.next = 13;
          return effects.put(updateChannelDataAC(channel.id, {
            lastReadMessageId: channel.lastDisplayedMsgId
          }));

        case 13:
          updateChannelOnAllChannels(channel.id, {
            lastReadMessageId: channel.lastDisplayedMsgId
          });
          _iterator = _createForOfIteratorHelperLoose(messageListMarker.messageIds);

        case 15:
          if ((_step = _iterator()).done) {
            _context8.next = 24;
            break;
          }

          messageId = _step.value;
          updateParams = {
            deliveryStatus: MESSAGE_DELIVERY_STATUS.READ,
            userMarkers: [{
              user: messageListMarker.user,
              createdAt: messageListMarker.createAt,
              messageId: messageId,
              name: MESSAGE_DELIVERY_STATUS.READ
            }]
          };
          _context8.next = 20;
          return effects.put(updateMessageAC(messageId, updateParams));

        case 20:
          updateMessageOnMap(channel.id, {
            messageId: messageId,
            params: updateParams
          });
          updateMessageOnAllMessages(messageId, updateParams);

        case 22:
          _context8.next = 15;
          break;

        case 24:
          _context8.next = 29;
          break;

        case 26:
          _context8.prev = 26;
          _context8.t0 = _context8["catch"](5);
          console.log(_context8.t0, 'Error on mark messages read');

        case 29:
        case "end":
          return _context8.stop();
      }
    }
  }, _marked8, null, [[5, 26]]);
}

function markMessagesDelivered(action) {
  var payload, channelId, messageIds, channel;
  return _regeneratorRuntime().wrap(function markMessagesDelivered$(_context9) {
    while (1) {
      switch (_context9.prev = _context9.next) {
        case 0:
          payload = action.payload;
          channelId = payload.channelId, messageIds = payload.messageIds;
          _context9.prev = 2;
          _context9.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context9.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          if (!channel) {
            _context9.next = 10;
            break;
          }

          _context9.next = 10;
          return effects.call(channel.markMessagesAsReceived, messageIds);

        case 10:
          _context9.next = 15;
          break;

        case 12:
          _context9.prev = 12;
          _context9.t0 = _context9["catch"](2);
          console.log(_context9.t0, 'Error on mark messages delivered');

        case 15:
        case "end":
          return _context9.stop();
      }
    }
  }, _marked9, null, [[2, 12]]);
}

function switchChannel(action) {
  var payload, channel, existingChannel, addChannel, currentActiveChannel, channelToSwitch;
  return _regeneratorRuntime().wrap(function switchChannel$(_context10) {
    while (1) {
      switch (_context10.prev = _context10.next) {
        case 0:
          _context10.prev = 0;
          payload = action.payload;
          channel = payload.channel;
          existingChannel = checkChannelExists(channel.id);

          if (!existingChannel) {
            addChannel = getChannelFromAllChannels(channel.id);

            if (addChannel) {
              setChannelInMap(addChannel);
            }
          }

          currentActiveChannel = getChannelFromMap(getActiveChannelId());
          _context10.next = 8;
          return effects.call(setUnreadScrollTo, true);

        case 8:
          _context10.next = 10;
          return effects.call(setActiveChannelId, channel && channel.id);

        case 10:
          channelToSwitch = channel;

          if (channel.isLinkedChannel) {
            channelToSwitch.linkedFrom = currentActiveChannel;
          }

          _context10.next = 14;
          return effects.put(setActiveChannelAC(_extends({}, channelToSwitch)));

        case 14:

          _context10.next = 20;
          break;

        case 17:
          _context10.prev = 17;
          _context10.t0 = _context10["catch"](0);
          console.log('error in switch channel');

        case 20:
        case "end":
          return _context10.stop();
      }
    }
  }, _marked10, null, [[0, 17]]);
}

function notificationsTurnOff(action) {
  var expireTime, activeChannelId, channel, updatedChannel;
  return _regeneratorRuntime().wrap(function notificationsTurnOff$(_context11) {
    while (1) {
      switch (_context11.prev = _context11.next) {
        case 0:
          expireTime = action.payload.expireTime;
          _context11.next = 3;
          return effects.call(getActiveChannelId);

        case 3:
          activeChannelId = _context11.sent;
          _context11.next = 6;
          return effects.call(getChannelFromMap, activeChannelId);

        case 6:
          channel = _context11.sent;
          _context11.prev = 7;
          _context11.next = 10;
          return effects.call(channel.mute, expireTime);

        case 10:
          updatedChannel = _context11.sent;
          console.log('updatedChannel. . . . . .. ', updatedChannel);
          updateChannelOnAllChannels(channel.id, {
            muted: updatedChannel.muted,
            mutedTill: updatedChannel.mutedTill
          });
          _context11.next = 15;
          return effects.put(updateChannelDataAC(updatedChannel.id, {
            muted: updatedChannel.muted,
            mutedTill: updatedChannel.mutedTill
          }));

        case 15:
          _context11.next = 20;
          break;

        case 17:
          _context11.prev = 17;
          _context11.t0 = _context11["catch"](7);
          console.log('ERROR turn off notifications', _context11.t0.message);

        case 20:
        case "end":
          return _context11.stop();
      }
    }
  }, _marked11, null, [[7, 17]]);
}

function notificationsTurnOn() {
  var activeChannelId, channel, updatedChannel;
  return _regeneratorRuntime().wrap(function notificationsTurnOn$(_context12) {
    while (1) {
      switch (_context12.prev = _context12.next) {
        case 0:
          _context12.next = 2;
          return effects.call(getActiveChannelId);

        case 2:
          activeChannelId = _context12.sent;
          _context12.next = 5;
          return effects.call(getChannelFromMap, activeChannelId);

        case 5:
          channel = _context12.sent;
          _context12.prev = 6;
          _context12.next = 9;
          return effects.call(channel.unmute);

        case 9:
          updatedChannel = _context12.sent;
          updateChannelOnAllChannels(channel.id, {
            muted: updatedChannel.muted,
            mutedTill: updatedChannel.mutedTill
          });
          _context12.next = 13;
          return effects.put(updateChannelDataAC(updatedChannel.id, {
            muted: updatedChannel.muted,
            mutedTill: updatedChannel.mutedTill
          }));

        case 13:
          _context12.next = 18;
          break;

        case 15:
          _context12.prev = 15;
          _context12.t0 = _context12["catch"](6);
          console.log('ERROR turn on notifications: ', _context12.t0.message);

        case 18:
        case "end":
          return _context12.stop();
      }
    }
  }, _marked12, null, [[6, 15]]);
}

function markChannelAsRead(action) {
  var channelId, channel;
  return _regeneratorRuntime().wrap(function markChannelAsRead$(_context13) {
    while (1) {
      switch (_context13.prev = _context13.next) {
        case 0:
          _context13.prev = 0;
          channelId = action.payload.channelId;
          _context13.next = 4;
          return effects.call(getChannelFromMap, channelId);

        case 4:
          channel = _context13.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          _context13.next = 8;
          return effects.call(channel.markAsRead);

        case 8:
          updateChannelOnAllChannels(channel.id, {
            unread: false
          });
          _context13.next = 11;
          return effects.put(updateChannelDataAC(channel.id, {
            unread: false
          }));

        case 11:
          _context13.next = 16;
          break;

        case 13:
          _context13.prev = 13;
          _context13.t0 = _context13["catch"](0);
          console.log(_context13.t0, 'Error in set channel unread');

        case 16:
        case "end":
          return _context13.stop();
      }
    }
  }, _marked13, null, [[0, 13]]);
}

function markChannelAsUnRead(action) {
  var channelId, channel;
  return _regeneratorRuntime().wrap(function markChannelAsUnRead$(_context14) {
    while (1) {
      switch (_context14.prev = _context14.next) {
        case 0:
          _context14.prev = 0;
          channelId = action.payload.channelId;
          _context14.next = 4;
          return effects.call(getChannelFromMap, channelId);

        case 4:
          channel = _context14.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          _context14.next = 8;
          return effects.call(channel.markAsUnRead);

        case 8:
          updateChannelOnAllChannels(channel.id, {
            unread: true
          });
          _context14.next = 11;
          return effects.put(updateChannelDataAC(channel.id, {
            unread: true
          }));

        case 11:
          _context14.next = 16;
          break;

        case 13:
          _context14.prev = 13;
          _context14.t0 = _context14["catch"](0);
          console.log(_context14.t0, 'Error in set channel unread');

        case 16:
        case "end":
          return _context14.stop();
      }
    }
  }, _marked14, null, [[0, 13]]);
}

function removeChannelCaches(action) {
  var payload, channelId, activeChannelId, activeChannel;
  return _regeneratorRuntime().wrap(function removeChannelCaches$(_context15) {
    while (1) {
      switch (_context15.prev = _context15.next) {
        case 0:
          payload = action.payload;
          channelId = payload.channelId;
          _context15.next = 4;
          return effects.call(getActiveChannelId);

        case 4:
          activeChannelId = _context15.sent;
          removeChannelFromMap(channelId);
          removeMessagesFromMap(channelId);

          if (!(activeChannelId === channelId)) {
            _context15.next = 14;
            break;
          }

          _context15.next = 10;
          return effects.call(getLastChannelFromMap);

        case 10:
          activeChannel = _context15.sent;

          if (!activeChannel) {
            _context15.next = 14;
            break;
          }

          _context15.next = 14;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(activeChannel))));

        case 14:
        case "end":
          return _context15.stop();
      }
    }
  }, _marked15);
}

function leaveChannel(action) {
  var payload, channelId, channel, messageBuilder, messageToSend;
  return _regeneratorRuntime().wrap(function leaveChannel$(_context16) {
    while (1) {
      switch (_context16.prev = _context16.next) {
        case 0:
          _context16.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          _context16.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context16.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          if (!channel) {
            _context16.next = 24;
            break;
          }

          if (!(channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE)) {
            _context16.next = 16;
            break;
          }

          messageBuilder = channel.createMessageBuilder();
          messageBuilder.setBody('LG').setType('system').setDisplayCount(0).setSilent(true);
          messageToSend = messageBuilder.create();

          console.log('send message for left');
          _context16.next = 16;
          return effects.call(channel.sendMessage, messageToSend);

        case 16:
          console.log('leave');
          _context16.next = 19;
          return effects.call(channel.leave);

        case 19:
          _context16.next = 21;
          return effects.put(removeChannelAC(channelId));

        case 21:
          deleteChannelFromAllChannels(channelId);
          _context16.next = 24;
          return effects.put(removeChannelCachesAC(channelId));

        case 24:
          _context16.next = 29;
          break;

        case 26:
          _context16.prev = 26;
          _context16.t0 = _context16["catch"](0);
          console.log('ERROR in leave channel - ', _context16.t0.message);

        case 29:
        case "end":
          return _context16.stop();
      }
    }
  }, _marked16, null, [[0, 26]]);
}

function deleteChannel(action) {
  var payload, channelId, channel;
  return _regeneratorRuntime().wrap(function deleteChannel$(_context17) {
    while (1) {
      switch (_context17.prev = _context17.next) {
        case 0:
          _context17.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          _context17.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context17.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          if (!channel) {
            _context17.next = 16;
            break;
          }

          _context17.next = 10;
          return effects.call(channel["delete"]);

        case 10:
          _context17.next = 12;
          return effects.put(setChannelToRemoveAC(channel));

        case 12:
          _context17.next = 14;
          return effects.put(removeChannelAC(channelId));

        case 14:
          _context17.next = 16;
          return effects.put(removeChannelCachesAC(channelId));

        case 16:
          _context17.next = 21;
          break;

        case 18:
          _context17.prev = 18;
          _context17.t0 = _context17["catch"](0);
          console.log('ERROR in delete channel');

        case 21:
        case "end":
          return _context17.stop();
      }
    }
  }, _marked17, null, [[0, 18]]);
}

function blockChannel(action) {
  var payload, channelId, channel;
  return _regeneratorRuntime().wrap(function blockChannel$(_context18) {
    while (1) {
      switch (_context18.prev = _context18.next) {
        case 0:
          _context18.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          _context18.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context18.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          if (!channel) {
            _context18.next = 14;
            break;
          }

          _context18.next = 10;
          return effects.call(channel.block);

        case 10:
          _context18.next = 12;
          return effects.put(removeChannelAC(channelId));

        case 12:
          _context18.next = 14;
          return effects.put(removeChannelCachesAC(channelId));

        case 14:
          _context18.next = 19;
          break;

        case 16:
          _context18.prev = 16;
          _context18.t0 = _context18["catch"](0);
          console.log('ERROR in block channel - ', _context18.t0.message);

        case 19:
        case "end":
          return _context18.stop();
      }
    }
  }, _marked18, null, [[0, 16]]);
}

function updateChannel(action) {
  var payload, channelId, config, SceytChatClient, channel, paramsToUpdate, fileToUpload, _yield$call5, subject, avatarUrl, metadata;

  return _regeneratorRuntime().wrap(function updateChannel$(_context19) {
    while (1) {
      switch (_context19.prev = _context19.next) {
        case 0:
          _context19.prev = 0;
          payload = action.payload;
          channelId = payload.channelId, config = payload.config;
          SceytChatClient = getClient();
          _context19.next = 6;
          return effects.call(getChannelFromMap, channelId);

        case 6:
          channel = _context19.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          paramsToUpdate = {
            uri: channel.uri,
            subject: channel.subject,
            metadata: channel.metadata,
            avatarUrl: channel.avatarUrl
          };

          if (!config.avatar) {
            _context19.next = 14;
            break;
          }

          fileToUpload = {
            data: config.avatar,
            progress: function progress(progressPercent) {
              console.log('upload percent - ', progressPercent);
            }
          };
          _context19.next = 13;
          return effects.call(SceytChatClient.uploadFile, fileToUpload);

        case 13:
          paramsToUpdate.avatarUrl = _context19.sent;

        case 14:
          if (config.subject) {
            paramsToUpdate.subject = config.subject;
          }

          if (config.metadata) {
            paramsToUpdate.metadata = JSON.stringify(config.metadata);
          }

          if (config.avatarUrl === '') {
            paramsToUpdate.avatarUrl = '';
          }

          _context19.next = 19;
          return effects.call(channel.update, paramsToUpdate);

        case 19:
          _yield$call5 = _context19.sent;
          subject = _yield$call5.subject;
          avatarUrl = _yield$call5.avatarUrl;
          metadata = _yield$call5.metadata;
          _context19.next = 25;
          return effects.put(updateChannelDataAC(channelId, {
            subject: subject,
            avatarUrl: avatarUrl,
            metadata: isJSON(metadata) ? JSON.parse(metadata) : metadata
          }));

        case 25:
          updateChannelOnAllChannels(channelId, {
            subject: subject,
            avatarUrl: avatarUrl,
            metadata: isJSON(metadata) ? JSON.parse(metadata) : metadata
          });
          _context19.next = 31;
          break;

        case 28:
          _context19.prev = 28;
          _context19.t0 = _context19["catch"](0);
          console.log('ERROR in update channel', _context19.t0.message);

        case 31:
        case "end":
          return _context19.stop();
      }
    }
  }, _marked19, null, [[0, 28]]);
}

function checkUsersStatus() {
  var SceytChatClient, usersForUpdate, updatedUsers, usersToUpdateMap, update, updateData;
  return _regeneratorRuntime().wrap(function checkUsersStatus$(_context20) {
    while (1) {
      switch (_context20.prev = _context20.next) {
        case 0:
          _context20.prev = 0;
          SceytChatClient = getClient();
          usersForUpdate = Object.keys(usersMap);
          _context20.next = 5;
          return effects.call(SceytChatClient.getUsers, usersForUpdate);

        case 5:
          updatedUsers = _context20.sent;
          usersToUpdateMap = {};
          update = false;
          updatedUsers.forEach(function (updatedUser) {
            if (updatedUser.presence && (updatedUser.presence.state !== usersMap[updatedUser.id].presence.state || updatedUser.presence.status !== usersMap[updatedUser.id].presence.status || updatedUser.presence.lastActiveAt && new Date(updatedUser.presence.lastActiveAt).getTime() !== new Date(usersMap[updatedUser.id].presence.lastActiveAt).getTime() || updatedUser.avatarUrl !== usersMap[updatedUser.id].avatarUrl || updatedUser.firstName !== usersMap[updatedUser.id].firstName || updatedUser.lastName !== usersMap[updatedUser.id].lastName)) {
              updateUserOnMap(updatedUser);
              usersToUpdateMap[updatedUser.id] = updatedUser;
              update = true;
            }
          });

          if (!update) {
            _context20.next = 17;
            break;
          }

          updateData = JSON.parse(JSON.stringify(usersToUpdateMap));
          _context20.next = 13;
          return effects.put(updateMembersPresenceAC(updateData));

        case 13:
          _context20.next = 15;
          return effects.put(updateUserStatusOnMapAC(updateData));

        case 15:
          _context20.next = 17;
          return effects.put(updateUserStatusOnChannelAC(updateData));

        case 17:
          _context20.next = 22;
          break;

        case 19:
          _context20.prev = 19;
          _context20.t0 = _context20["catch"](0);
          console.log('ERROR in check user status : ', _context20.t0.message);

        case 22:
        case "end":
          return _context20.stop();
      }
    }
  }, _marked20, null, [[0, 19]]);
}

function sendTyping(action) {
  var state, activeChannelId, channel;
  return _regeneratorRuntime().wrap(function sendTyping$(_context21) {
    while (1) {
      switch (_context21.prev = _context21.next) {
        case 0:
          state = action.payload.state;
          _context21.next = 3;
          return effects.call(getActiveChannelId);

        case 3:
          activeChannelId = _context21.sent;
          _context21.next = 6;
          return effects.call(getChannelFromMap, activeChannelId);

        case 6:
          channel = _context21.sent;
          _context21.prev = 7;

          if (!channel) {
            _context21.next = 16;
            break;
          }

          if (!state) {
            _context21.next = 14;
            break;
          }

          _context21.next = 12;
          return effects.call(channel.startTyping);

        case 12:
          _context21.next = 16;
          break;

        case 14:
          _context21.next = 16;
          return effects.call(channel.stopTyping);

        case 16:
          _context21.next = 21;
          break;

        case 18:
          _context21.prev = 18;
          _context21.t0 = _context21["catch"](7);
          console.log('ERROR in send typing');

        case 21:
        case "end":
          return _context21.stop();
      }
    }
  }, _marked21, null, [[7, 18]]);
}

function clearHistory(action) {
  var payload, channelId, channel, activeChannelId, groupName;
  return _regeneratorRuntime().wrap(function clearHistory$(_context22) {
    while (1) {
      switch (_context22.prev = _context22.next) {
        case 0:
          _context22.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          _context22.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context22.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          _context22.next = 9;
          return effects.call(getActiveChannelId);

        case 9:
          activeChannelId = _context22.sent;

          if (!channel) {
            _context22.next = 25;
            break;
          }

          _context22.next = 13;
          return effects.call(channel.deleteAllMessages);

        case 13:
          _context22.next = 15;
          return effects.put(clearMessagesAC());

        case 15:
          removeMessagesFromMap(channelId);

          if (channelId === activeChannelId) {
            removeAllMessages();
          }

          _context22.next = 19;
          return effects.put(clearSelectedMessagesAC());

        case 19:
          _context22.next = 21;
          return effects.put(updateChannelDataAC(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          }));

        case 21:
          updateChannelOnAllChannels(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          });
          groupName = getChannelGroupName(channel);
          _context22.next = 25;
          return effects.put(updateSearchedChannelDataAC(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          }, groupName));

        case 25:
          _context22.next = 30;
          break;

        case 27:
          _context22.prev = 27;
          _context22.t0 = _context22["catch"](0);
          console.log('ERROR in clear history');

        case 30:
        case "end":
          return _context22.stop();
      }
    }
  }, _marked22, null, [[0, 27]]);
}

function deleteAllMessages(action) {
  var payload, channelId, channel, activeChannelId, groupName;
  return _regeneratorRuntime().wrap(function deleteAllMessages$(_context23) {
    while (1) {
      switch (_context23.prev = _context23.next) {
        case 0:
          _context23.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          _context23.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context23.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          _context23.next = 9;
          return effects.call(getActiveChannelId);

        case 9:
          activeChannelId = _context23.sent;

          if (!channel) {
            _context23.next = 26;
            break;
          }

          _context23.next = 13;
          return effects.call(channel.deleteAllMessages, true);

        case 13:
          removeMessagesFromMap(channelId);

          if (!(channelId === activeChannelId)) {
            _context23.next = 18;
            break;
          }

          _context23.next = 17;
          return effects.put(clearMessagesAC());

        case 17:
          removeAllMessages();

        case 18:
          _context23.next = 20;
          return effects.put(clearSelectedMessagesAC());

        case 20:
          _context23.next = 22;
          return effects.put(updateChannelDataAC(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          }));

        case 22:
          updateChannelOnAllChannels(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          });
          groupName = getChannelGroupName(channel);
          _context23.next = 26;
          return effects.put(updateSearchedChannelDataAC(channel.id, {
            lastMessage: null,
            newMessageCount: 0,
            newMentionCount: 0
          }, groupName));

        case 26:
          _context23.next = 31;
          break;

        case 28:
          _context23.prev = 28;
          _context23.t0 = _context23["catch"](0);
          console.log('ERROR in clear history');

        case 31:
        case "end":
          return _context23.stop();
      }
    }
  }, _marked23, null, [[0, 28]]);
}

function joinChannel(action) {
  var payload, channelId, SceytChatClient, channel, joinedChannel;
  return _regeneratorRuntime().wrap(function joinChannel$(_context24) {
    while (1) {
      switch (_context24.prev = _context24.next) {
        case 0:
          _context24.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          SceytChatClient = getClient();
          _context24.next = 6;
          return effects.call(getChannelFromMap, channelId);

        case 6:
          channel = _context24.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);
          }

          if (channel) {
            _context24.next = 12;
            break;
          }

          _context24.next = 11;
          return effects.call(SceytChatClient.getChannel, channelId);

        case 11:
          channel = _context24.sent;

        case 12:
          _context24.next = 14;
          return effects.call(channel.join);

        case 14:
          joinedChannel = _context24.sent;
          console.log('set close search channels. . ` . .', true);
          _context24.next = 18;
          return effects.put(setCloseSearchChannelsAC(true));

        case 18:
          _context24.next = 20;
          return effects.put(setChannelToAddAC(JSON.parse(JSON.stringify(joinedChannel))));

        case 20:
          _context24.next = 22;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(joinedChannel))));

        case 22:
          addChannelsToAllChannels(joinedChannel);
          _context24.next = 25;
          return effects.call(setActiveChannelId, joinedChannel.id);

        case 25:
          _context24.next = 30;
          break;

        case 27:
          _context24.prev = 27;
          _context24.t0 = _context24["catch"](0);
          console.log(_context24.t0, 'Error in join to channel');

        case 30:
        case "end":
          return _context24.stop();
      }
    }
  }, _marked24, null, [[0, 27]]);
}

function watchForChannelEvents() {
  return _regeneratorRuntime().wrap(function watchForChannelEvents$(_context25) {
    while (1) {
      switch (_context25.prev = _context25.next) {
        case 0:
          _context25.next = 2;
          return effects.call(watchForEvents);

        case 2:
        case "end":
          return _context25.stop();
      }
    }
  }, _marked25);
}

function ChannelsSaga() {
  return _regeneratorRuntime().wrap(function ChannelsSaga$(_context26) {
    while (1) {
      switch (_context26.prev = _context26.next) {
        case 0:
          _context26.next = 2;
          return effects.takeLatest(CREATE_CHANNEL, createChannel);

        case 2:
          _context26.next = 4;
          return effects.takeLatest(GET_CHANNELS, getChannels);

        case 4:
          _context26.next = 6;
          return effects.takeLatest(SEARCH_CHANNELS, searchChannels);

        case 6:
          _context26.next = 8;
          return effects.takeLatest(GET_CHANNELS_FOR_FORWARD, getChannelsForForward);

        case 8:
          _context26.next = 10;
          return effects.takeLatest(SEARCH_CHANNELS_FOR_FORWARD, searchChannelsForForward);

        case 10:
          _context26.next = 12;
          return effects.takeLatest(LOAD_MORE_CHANNEL, channelsLoadMore);

        case 12:
          _context26.next = 14;
          return effects.takeLatest(LOAD_MORE_CHANNELS_FOR_FORWARD, channelsForForwardLoadMore);

        case 14:
          _context26.next = 16;
          return effects.takeEvery(SWITCH_CHANNEL, switchChannel);

        case 16:
          _context26.next = 18;
          return effects.takeLatest(LEAVE_CHANNEL, leaveChannel);

        case 18:
          _context26.next = 20;
          return effects.takeLatest(DELETE_CHANNEL, deleteChannel);

        case 20:
          _context26.next = 22;
          return effects.takeLatest(BLOCK_CHANNEL, blockChannel);

        case 22:
          _context26.next = 24;
          return effects.takeLatest(UPDATE_CHANNEL, updateChannel);

        case 24:
          _context26.next = 26;
          return effects.takeEvery(MARK_MESSAGES_AS_READ, markMessagesRead);

        case 26:
          _context26.next = 28;
          return effects.takeLatest(MARK_MESSAGES_AS_DELIVERED, markMessagesDelivered);

        case 28:
          _context26.next = 30;
          return effects.takeLatest(WATCH_FOR_EVENTS, watchForChannelEvents);

        case 30:
          _context26.next = 32;
          return effects.takeLatest(TURN_OFF_NOTIFICATION, notificationsTurnOff);

        case 32:
          _context26.next = 34;
          return effects.takeLatest(TURN_ON_NOTIFICATION, notificationsTurnOn);

        case 34:
          _context26.next = 36;
          return effects.takeLatest(MARK_CHANNEL_AS_READ, markChannelAsRead);

        case 36:
          _context26.next = 38;
          return effects.takeLatest(MARK_CHANNEL_AS_UNREAD, markChannelAsUnRead);

        case 38:
          _context26.next = 40;
          return effects.takeLatest(CHECK_USER_STATUS, checkUsersStatus);

        case 40:
          _context26.next = 42;
          return effects.takeLatest(SEND_TYPING, sendTyping);

        case 42:
          _context26.next = 44;
          return effects.takeLatest(CLEAR_HISTORY, clearHistory);

        case 44:
          _context26.next = 46;
          return effects.takeLatest(JOIN_TO_CHANNEL, joinChannel);

        case 46:
          _context26.next = 48;
          return effects.takeLatest(DELETE_ALL_MESSAGES, deleteAllMessages);

        case 48:
          _context26.next = 50;
          return effects.takeLatest(REMOVE_CHANNEL_CACHES, removeChannelCaches);

        case 50:
        case "end":
          return _context26.stop();
      }
    }
  }, _marked26);
}

function rgbaToThumbHash(w, h, rgba) {
  if (w > 100 || h > 100) throw new Error(w + "x" + h + " doesn't fit in 100x100");
  var PI = Math.PI,
      round = Math.round,
      max = Math.max,
      cos = Math.cos,
      abs = Math.abs;
  var avg_r = 0;
  var avg_g = 0;
  var avg_b = 0;
  var avg_a = 0;

  for (var i = 0, j = 0; i < w * h; i++, j += 4) {
    var alpha = rgba[j + 3] / 255;
    avg_r += alpha / 255 * rgba[j];
    avg_g += alpha / 255 * rgba[j + 1];
    avg_b += alpha / 255 * rgba[j + 2];
    avg_a += alpha;
  }

  if (avg_a) {
    avg_r /= avg_a;
    avg_g /= avg_a;
    avg_b /= avg_a;
  }

  var hasAlpha = avg_a < w * h;
  var l_limit = hasAlpha ? 5 : 7;
  var lx = max(1, round(l_limit * w / max(w, h)));
  var ly = max(1, round(l_limit * h / max(w, h)));
  var l = [];
  var p = [];
  var q = [];
  var a = [];

  for (var _i = 0, _j = 0; _i < w * h; _i++, _j += 4) {
    var _alpha = rgba[_j + 3] / 255;

    var r = avg_r * (1 - _alpha) + _alpha / 255 * rgba[_j];
    var g = avg_g * (1 - _alpha) + _alpha / 255 * rgba[_j + 1];
    var b = avg_b * (1 - _alpha) + _alpha / 255 * rgba[_j + 2];
    l[_i] = (r + g + b) / 3;
    p[_i] = (r + g) / 2 - b;
    q[_i] = r - g;
    a[_i] = _alpha;
  }

  var encodeChannel = function encodeChannel(channel, nx, ny) {
    var dc = 0;
    var ac = [];
    var scale = 0;
    var fx = [];

    for (var cy = 0; cy < ny; cy++) {
      for (var cx = 0; cx * ny < nx * (ny - cy); cx++) {
        var f = 0;

        for (var x = 0; x < w; x++) {
          fx[x] = cos(PI / w * cx * (x + 0.5));
        }

        for (var y = 0; y < h; y++) {
          for (var _x = 0, fy = cos(PI / h * cy * (y + 0.5)); _x < w; _x++) {
            f += channel[_x + y * w] * fx[_x] * fy;
          }
        }

        f /= w * h;

        if (cx || cy) {
          ac.push(f);
          scale = max(scale, abs(f));
        } else {
          dc = f;
        }
      }
    }

    if (scale) for (var _i2 = 0; _i2 < ac.length; _i2++) {
      ac[_i2] = 0.5 + 0.5 / scale * ac[_i2];
    }
    return [dc, ac, scale];
  };

  var _encodeChannel = encodeChannel(l, max(3, lx), max(3, ly)),
      l_dc = _encodeChannel[0],
      l_ac = _encodeChannel[1],
      l_scale = _encodeChannel[2];

  var _encodeChannel2 = encodeChannel(p, 3, 3),
      p_dc = _encodeChannel2[0],
      p_ac = _encodeChannel2[1],
      p_scale = _encodeChannel2[2];

  var _encodeChannel3 = encodeChannel(q, 3, 3),
      q_dc = _encodeChannel3[0],
      q_ac = _encodeChannel3[1],
      q_scale = _encodeChannel3[2];

  var _ref = hasAlpha ? encodeChannel(a, 5, 5) : [],
      a_dc = _ref[0],
      a_ac = _ref[1],
      a_scale = _ref[2];

  var isLandscape = w > h;
  var header24 = round(63 * l_dc) | round(31.5 + 31.5 * p_dc) << 6 | round(31.5 + 31.5 * q_dc) << 12 | round(31 * l_scale) << 18 | hasAlpha << 23;
  var header16 = (isLandscape ? ly : lx) | round(63 * p_scale) << 3 | round(63 * q_scale) << 9 | isLandscape << 15;
  var hash = [header24 & 255, header24 >> 8 & 255, header24 >> 16, header16 & 255, header16 >> 8];
  var ac_start = hasAlpha ? 6 : 5;
  var ac_index = 0;
  if (hasAlpha) hash.push(round(15 * a_dc) | round(15 * a_scale) << 4);

  for (var _i3 = 0, _arr = hasAlpha ? [l_ac, p_ac, q_ac, a_ac] : [l_ac, p_ac, q_ac]; _i3 < _arr.length; _i3++) {
    var ac = _arr[_i3];

    for (var _iterator = _createForOfIteratorHelperLoose(ac), _step; !(_step = _iterator()).done;) {
      var f = _step.value;
      hash[ac_start + (ac_index >> 1)] |= round(15 * f) << ((ac_index++ & 1) << 2);
    }
  }

  return new Uint8Array(hash);
}
function thumbHashToRGBA(hash) {
  var PI = Math.PI,
      min = Math.min,
      max = Math.max,
      cos = Math.cos,
      round = Math.round;
  var header24 = hash[0] | hash[1] << 8 | hash[2] << 16;
  var header16 = hash[3] | hash[4] << 8;
  var l_dc = (header24 & 63) / 63;
  var p_dc = (header24 >> 6 & 63) / 31.5 - 1;
  var q_dc = (header24 >> 12 & 63) / 31.5 - 1;
  var l_scale = (header24 >> 18 & 31) / 31;
  var hasAlpha = header24 >> 23;
  var p_scale = (header16 >> 3 & 63) / 63;
  var q_scale = (header16 >> 9 & 63) / 63;
  var isLandscape = header16 >> 15;
  var lx = max(3, isLandscape ? hasAlpha ? 5 : 7 : header16 & 7);
  var ly = max(3, isLandscape ? header16 & 7 : hasAlpha ? 5 : 7);
  var a_dc = hasAlpha ? (hash[5] & 15) / 15 : 1;
  var a_scale = (hash[5] >> 4) / 15;
  var ac_start = hasAlpha ? 6 : 5;
  var ac_index = 0;

  var decodeChannel = function decodeChannel(nx, ny, scale) {
    var ac = [];

    for (var cy = 0; cy < ny; cy++) {
      for (var cx = cy ? 0 : 1; cx * ny < nx * (ny - cy); cx++) {
        ac.push(((hash[ac_start + (ac_index >> 1)] >> ((ac_index++ & 1) << 2) & 15) / 7.5 - 1) * scale);
      }
    }

    return ac;
  };

  var l_ac = decodeChannel(lx, ly, l_scale);
  var p_ac = decodeChannel(3, 3, p_scale * 1.25);
  var q_ac = decodeChannel(3, 3, q_scale * 1.25);
  var a_ac = hasAlpha && decodeChannel(5, 5, a_scale);
  var ratio = thumbHashToApproximateAspectRatio(hash);
  var w = round(ratio > 1 ? 32 : 32 * ratio);
  var h = round(ratio > 1 ? 32 / ratio : 32);
  var rgba = new Uint8Array(w * h * 4);
  var fx = [];
  var fy = [];

  for (var y = 0, i = 0; y < h; y++) {
    for (var x = 0; x < w; x++, i += 4) {
      var l = l_dc;
      var p = p_dc;
      var q = q_dc;
      var a = a_dc;

      for (var cx = 0, n = max(lx, hasAlpha ? 5 : 3); cx < n; cx++) {
        fx[cx] = cos(PI / w * (x + 0.5) * cx);
      }

      for (var cy = 0, _n = max(ly, hasAlpha ? 5 : 3); cy < _n; cy++) {
        fy[cy] = cos(PI / h * (y + 0.5) * cy);
      }

      for (var _cy = 0, j = 0; _cy < ly; _cy++) {
        for (var _cx = _cy ? 0 : 1, fy2 = fy[_cy] * 2; _cx * ly < lx * (ly - _cy); _cx++, j++) {
          l += l_ac[j] * fx[_cx] * fy2;
        }
      }

      for (var _cy2 = 0, _j2 = 0; _cy2 < 3; _cy2++) {
        for (var _cx2 = _cy2 ? 0 : 1, _fy = fy[_cy2] * 2; _cx2 < 3 - _cy2; _cx2++, _j2++) {
          var f = fx[_cx2] * _fy;
          p += p_ac[_j2] * f;
          q += q_ac[_j2] * f;
        }
      }

      if (hasAlpha) for (var _cy3 = 0, _j3 = 0; _cy3 < 5; _cy3++) {
        for (var _cx3 = _cy3 ? 0 : 1, _fy2 = fy[_cy3] * 2; _cx3 < 5 - _cy3; _cx3++, _j3++) {
          a += a_ac[_j3] * fx[_cx3] * _fy2;
        }
      }
      var b = l - 2 / 3 * p;
      var r = (3 * l - b + q) / 2;
      var g = r - q;
      rgba[i] = max(0, 255 * min(1, r));
      rgba[i + 1] = max(0, 255 * min(1, g));
      rgba[i + 2] = max(0, 255 * min(1, b));
      rgba[i + 3] = max(0, 255 * min(1, a));
    }
  }

  return {
    w: w,
    h: h,
    rgba: rgba
  };
}
function thumbHashToApproximateAspectRatio(hash) {
  var header = hash[3];
  var hasAlpha = hash[2] & 0x80;
  var isLandscape = hash[4] & 0x80;
  var lx = isLandscape ? hasAlpha ? 5 : 7 : header & 7;
  var ly = isLandscape ? header & 7 : hasAlpha ? 5 : 7;
  return lx / ly;
}
function rgbaToDataURL(w, h, rgba) {
  var row = w * 4 + 1;
  var idat = 6 + h * (5 + row);
  var bytes = [137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, w >> 8, w & 255, 0, 0, h >> 8, h & 255, 8, 6, 0, 0, 0, 0, 0, 0, 0, idat >>> 24, idat >> 16 & 255, idat >> 8 & 255, idat & 255, 73, 68, 65, 84, 120, 1];
  var table = [0, 498536548, 997073096, 651767980, 1994146192, 1802195444, 1303535960, 1342533948, -306674912, -267414716, -690576408, -882789492, -1687895376, -2032938284, -1609899400, -1111625188];
  var a = 1;
  var b = 0;

  for (var y = 0, i = 0, end = row - 1; y < h; y++, end += row - 1) {
    bytes.push(y + 1 < h ? 0 : 1, row & 255, row >> 8, ~row & 255, row >> 8 ^ 255, 0);

    for (b = (b + a) % 65521; i < end; i++) {
      var u = rgba[i] & 255;
      bytes.push(u);
      a = (a + u) % 65521;
      b = (b + a) % 65521;
    }
  }

  bytes.push(b >> 8, b & 255, a >> 8, a & 255, 0, 0, 0, 0, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130);

  for (var _i4 = 0, _arr2 = [[12, 29], [37, 41 + idat]]; _i4 < _arr2.length; _i4++) {
    var _arr2$_i = _arr2[_i4],
        start = _arr2$_i[0],
        _end = _arr2$_i[1];
    var c = ~0;

    for (var _i5 = start; _i5 < _end; _i5++) {
      c ^= bytes[_i5];
      c = c >>> 4 ^ table[c & 15];
      c = c >>> 4 ^ table[c & 15];
    }

    c = ~c;
    bytes[_end++] = c >>> 24;
    bytes[_end++] = c >> 16 & 255;
    bytes[_end++] = c >> 8 & 255;
    bytes[_end++] = c & 255;
  }

  return 'data:image/png;base64,' + btoa(String.fromCharCode.apply(String, bytes));
}
function thumbHashToDataURL(hash) {
  var image = thumbHashToRGBA(hash);
  return rgbaToDataURL(image.w, image.h, image.rgba);
}

var MAX_WIDTH = 1280;
var MAX_HEIGHT = 1080;
var MIME_TYPE = 'image/jpeg';
var QUALITY = 0.9;
var THUMBNAIL_MAX_WIDTH = 6;
var THUMBNAIL_MAX_HEIGHT = 6;
function resizeImage(file, maxWidth, maxHeight, quality) {
  return new Promise(function (resolve) {
    var blobURL = URL.createObjectURL(file);
    var img = new Image();
    img.src = blobURL;

    img.onerror = function () {
      URL.revokeObjectURL(this.src);
      console.log('Cannot load image');
    };

    img.onload = function () {
      URL.revokeObjectURL(this.src);

      var _calculateSize = calculateSize(img.width, img.height, maxWidth || MAX_WIDTH, maxHeight || MAX_HEIGHT),
          newWidth = _calculateSize[0],
          newHeight = _calculateSize[1];

      var canvas = document.createElement('canvas');
      canvas.width = newWidth;
      canvas.height = newHeight;
      var ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, newWidth, newHeight);
      canvas.toBlob(function (blob) {
        resolve({
          file: file,
          blob: blob,
          newWidth: newWidth,
          newHeight: newHeight
        });
      }, MIME_TYPE, quality || QUALITY);
    };
  });
}
var binaryToBase64 = function binaryToBase64(binary) {
  return btoa(String.fromCharCode.apply(String, binary));
};
var base64ToBinary = function base64ToBinary(base64) {
  return new Uint8Array(atob(base64).split('').map(function (x) {
    return x.charCodeAt(0);
  }));
};

var binaryThumbHashToDataURL = function binaryThumbHashToDataURL(binaryThumbHash) {
  return thumbHashToDataURL(binaryThumbHash);
};

var base64ToToDataURL = function base64ToToDataURL(base64) {
  var thumbHashFromBase64 = base64ToBinary(base64);
  return binaryThumbHashToDataURL(thumbHashFromBase64);
};
function createImageThumbnail(file, path, maxWidth, maxHeight) {
  return new Promise(function (resolve) {
    var blobURL;

    if (file) {
      blobURL = URL.createObjectURL(file);
    }

    var img = new Image();
    img.src = blobURL || path || '';

    img.onerror = function () {
      URL.revokeObjectURL(this.src);
      console.log('Cannot load image');
    };

    img.onload = function () {
      if (blobURL) {
        URL.revokeObjectURL(this.src);
      }

      var _calculateSize3 = calculateSize(img.width, img.height, maxWidth || THUMBNAIL_MAX_WIDTH, maxHeight || THUMBNAIL_MAX_HEIGHT),
          newWidth = _calculateSize3[0],
          newHeight = _calculateSize3[1];

      var canvas = document.createElement('canvas');
      canvas.width = newWidth;
      canvas.height = newHeight;
      var ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, newWidth, newHeight);
      var pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
      var binaryThumbHash = rgbaToThumbHash(pixels.width, pixels.height, pixels.data);
      var thumbHashToBase64 = binaryToBase64(binaryThumbHash);
      resolve({
        thumbnail: thumbHashToBase64,
        imageWidth: img.width,
        imageHeight: img.height
      });
    };
  });
}
function getImageSize(path) {
  return new Promise(function (resolve) {
    fetch(path).then(function (response) {
      response.blob().then(function (res) {
        resolve(res.size);
      });
    });
  });
}
function calculateSize(width, height, maxWidth, maxHeight) {
  if (width > height) {
    if (width > maxWidth) {
      height = Math.round(height * maxWidth / width);
      width = maxWidth;
    }
  } else {
    if (height > maxHeight) {
      width = Math.round(width * maxHeight / height);
      height = maxHeight;
    }
  }

  if (height < 1) {
    height = 1;
  }

  return [width, height];
}

var currentVersion = 1;
var setDataToDB = function setDataToDB(dbName, storeName, data, keyPath) {
  if (!('indexedDB' in window)) {
    console.log("This browser doesn't support IndexedDB");
  } else {
    var openRequest = indexedDB.open(dbName, currentVersion);

    openRequest.onupgradeneeded = function () {
      var db = openRequest.result;
      addData(db, storeName, keyPath, data);
    };

    openRequest.onerror = function () {
      console.error('Indexeddb Error ', openRequest.error);
    };

    openRequest.onsuccess = function (event) {
      var db = event.target.result;

      if (db.objectStoreNames.contains(storeName)) {
        addData(db, storeName, keyPath, data);
      } else {
        db.close();
        currentVersion++;
        setDataToDB(dbName, storeName, data, keyPath);
      }

      db.onversionchange = function () {
        db.close();
        alert('The database is out of date, please reload the page.');
      };
    };

    openRequest.onblocked = function () {};
  }
};
var getDataFromDB = function getDataFromDB(dbName, storeName, keyPath, keyPatName) {
  return new Promise(function (resolve, reject) {
    var openRequest = indexedDB.open(dbName, currentVersion);

    openRequest.onupgradeneeded = function (event) {
      var db = event.target.result;

      if (db.objectStoreNames.contains(storeName)) {
        var transaction = db.transaction([storeName]);
        var objectStore = transaction.objectStore(storeName);
        resolve(objectStore.get(keyPath));
      } else {
        db.createObjectStore(storeName, {
          keyPath: keyPatName
        });
        resolve('');
      }
    };

    openRequest.onerror = function (event) {
      if (event.target.error.name === 'VersionError') {
        currentVersion++;
        resolve(getDataFromDB(dbName, storeName, keyPath));
      } else {
        reject(event);
      }
    };

    openRequest.onsuccess = function (event) {
      var db = event.target.result;

      if (db.objectStoreNames.contains(storeName)) {
        var transaction = db.transaction(storeName, 'readonly');
        var objectStore = transaction.objectStore(storeName);
        var request = objectStore.get(keyPath);

        request.onsuccess = function (event) {
          var result = event.target.result;

          if (result) {
            db.close();
            resolve(result);
          } else {
            console.log('No data found for the specified keyPathValue.');
            db.close();
            resolve('');
          }
        };

        request.onerror = function (event) {
          db.close();
          console.error('Error retrieving data: ', event.target.error);
        };
      } else {
        db.close();
        resolve('');
      }
    };
  });
};

var addData = function addData(db, storeName, keyPath, data) {
  if (!db.objectStoreNames.contains(storeName)) {
    var objectStore = db.createObjectStore(storeName, {
      keyPath: keyPath
    });

    objectStore.transaction.oncomplete = function () {
      var channelObjectStore = db.transaction(storeName, 'readwrite').objectStore(storeName);
      data.forEach(function (value) {
        var request = channelObjectStore.put(value);

        request.onsuccess = function () {};

        request.onerror = function () {
          console.log('Error on put channel to db .. ', request.error);
        };
      });
    };
  } else {
    var transaction = db.transaction(storeName, 'readwrite');
    var store = transaction.objectStore(storeName);
    data.forEach(function (value) {
      var request = store.put(value);

      request.onsuccess = function () {
        console.log('data added to db.. ', request.result);
      };

      request.onerror = function () {
        console.log('Error on put channel to db .. ', request.error);
      };
    });
  }
};

var _marked$2 = /*#__PURE__*/_regeneratorRuntime().mark(sendMessage),
    _marked2$1 = /*#__PURE__*/_regeneratorRuntime().mark(sendTextMessage),
    _marked3$1 = /*#__PURE__*/_regeneratorRuntime().mark(forwardMessage),
    _marked4$1 = /*#__PURE__*/_regeneratorRuntime().mark(resendMessage),
    _marked5$1 = /*#__PURE__*/_regeneratorRuntime().mark(deleteMessage),
    _marked6$1 = /*#__PURE__*/_regeneratorRuntime().mark(editMessage),
    _marked7$1 = /*#__PURE__*/_regeneratorRuntime().mark(getMessagesQuery),
    _marked8$1 = /*#__PURE__*/_regeneratorRuntime().mark(loadMoreMessages),
    _marked9$1 = /*#__PURE__*/_regeneratorRuntime().mark(addReaction),
    _marked10$1 = /*#__PURE__*/_regeneratorRuntime().mark(deleteReaction),
    _marked11$1 = /*#__PURE__*/_regeneratorRuntime().mark(getReactions),
    _marked12$1 = /*#__PURE__*/_regeneratorRuntime().mark(loadMoreReactions),
    _marked13$1 = /*#__PURE__*/_regeneratorRuntime().mark(getMessageAttachments),
    _marked14$1 = /*#__PURE__*/_regeneratorRuntime().mark(loadMoreMessageAttachments),
    _marked15$1 = /*#__PURE__*/_regeneratorRuntime().mark(pauseAttachmentUploading),
    _marked16$1 = /*#__PURE__*/_regeneratorRuntime().mark(resumeAttachmentUploading),
    _marked17$1 = /*#__PURE__*/_regeneratorRuntime().mark(MessageSaga);

function sendMessage(action) {
  var payload, message, connectionState, channelId, sendAttachmentsAsSeparateMessage, channel, SceytChatClient, createChannelData, mentionedUserIds, customUploader, thumbnailMetas, linkAttachment, messageAttachment, fileType, messageBuilder, messageToSend, messageCopy, pendingMessage, hasNextMessages, messagesToAdd, filePath, handleUploadProgress, fileSize, handleUpdateLocalPath, uri, attachmentMeta, attachmentBuilder, attachmentToSend, linkAttachmentToSend, linkAttachmentBuilder, messageResponse, pendingAttachment, messageUpdateData, messageToUpdate, channelUpdateParam, _attachmentBuilder, _attachmentToSend, _messageResponse, _messageUpdateData, _messageToUpdate, _channelUpdateParam, attachmentsToSend, _messageBuilder, _messageToSend, attachmentsLocalPaths, receivedPaths, uploadAllAttachments, uploadedAttachments, _messageCopy2, _hasNextMessages, _messagesToAdd, _messageResponse2, attachmentsToUpdate, currentAttachmentsMap, _messageUpdateData2, _messageToUpdate2, _channelUpdateParam2;

  return _regeneratorRuntime().wrap(function sendMessage$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          payload = action.payload;
          message = payload.message, connectionState = payload.connectionState, channelId = payload.channelId, sendAttachmentsAsSeparateMessage = payload.sendAttachmentsAsSeparateMessage;
          _context.prev = 2;
          _context.next = 5;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 5:
          _context.next = 7;
          return effects.call(getChannelFromMap, channelId);

        case 7:
          channel = _context.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          if (!channel.isMockChannel) {
            _context.next = 20;
            break;
          }

          SceytChatClient = getClient();
          removeChannelFromMap(channelId);
          createChannelData = {
            type: channel.type,
            members: channel.members,
            metadata: ''
          };
          _context.next = 15;
          return effects.call(SceytChatClient.Channel.create, createChannelData);

        case 15:
          channel = _context.sent;
          _context.next = 18;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(channel))));

        case 18:
          addChannelsToAllChannels(channel);
          setChannelInMap(channel);

        case 20:
          _context.next = 22;
          return effects.put(addChannelAC(JSON.parse(JSON.stringify(channel))));

        case 22:
          console.log('send message . . . ', message);
          mentionedUserIds = message.mentionedMembers ? message.mentionedMembers.map(function (member) {
            return member.id;
          }) : [];
          customUploader = getCustomUploader();

          if (!(message.attachments && message.attachments.length)) {
            _context.next = 225;
            break;
          }

          if (!sendAttachmentsAsSeparateMessage) {
            _context.next = 167;
            break;
          }

          thumbnailMetas = {};
          linkAttachment = message.attachments.find(function (a) {
            return a.type === attachmentTypes.link;
          });
          messageAttachment = _extends({}, message.attachments[0], {
            url: message.attachments[0].data
          });
          fileType = messageAttachment.url.type.split('/')[0];

          if (messageAttachment.cachedUrl) {
            _context.next = 44;
            break;
          }

          if (!(fileType === 'video')) {
            _context.next = 36;
            break;
          }

          thumbnailMetas = getVideoThumb(messageAttachment.tid);
          _context.next = 43;
          break;

        case 36:
          if (!(fileType === 'image')) {
            _context.next = 42;
            break;
          }

          _context.next = 39;
          return effects.call(createImageThumbnail, message.attachments[0].data, undefined, messageAttachment.type === 'file' ? 50 : undefined, messageAttachment.type === 'file' ? 50 : undefined);

        case 39:
          thumbnailMetas = _context.sent;
          _context.next = 43;
          break;

        case 42:
          if (fileType === attachmentTypes.voice) {
            thumbnailMetas = {
              duration: 3,
              thumbnail: messageAttachment.metadata.tmb
            };
          }

        case 43:
          messageAttachment.metadata = _extends({}, messageAttachment.metadata, thumbnailMetas && {
            tmb: thumbnailMetas.thumbnail,
            szw: thumbnailMetas.imageWidth,
            szh: thumbnailMetas.imageHeight,
            dur: thumbnailMetas.duration && Math.floor(thumbnailMetas.duration)
          });

        case 44:
          setPendingAttachment(messageAttachment.tid, messageAttachment.data);
          messageBuilder = channel.createMessageBuilder();
          messageBuilder.setBody(message.body).setAttachments([]).setBodyAttributes(message.bodyAttributes).setMentionUserIds(mentionedUserIds).setType(message.type).setDisplayCount(message.type === 'system' ? 0 : 1).setSilent(message.type === 'system').setMetadata(JSON.stringify(message.metadata));

          if (message.parentMessage) {
            messageBuilder.setParentMessageId(message.parentMessage ? message.parentMessage.id : null);
          }

          if (message.repliedInThread) {
            messageBuilder.setReplyInThread();
          }

          messageToSend = messageBuilder.create();
          messageCopy = _extends({}, messageToSend, {
            attachments: [].concat(messageAttachment)
          });
          pendingMessage = JSON.parse(JSON.stringify(_extends({}, messageCopy, {
            createdAt: new Date(Date.now()),
            mentionedUsers: message.mentionedMembers,
            parentMessage: message.parentMessage
          })));
          _context.next = 54;
          return effects.select(messagesHasNextSelector);

        case 54:
          hasNextMessages = _context.sent;

          if (getHasNextCached()) {
            _context.next = 63;
            break;
          }

          if (!hasNextMessages) {
            _context.next = 61;
            break;
          }

          _context.next = 59;
          return effects.put(getMessagesAC(channel));

        case 59:
          _context.next = 63;
          break;

        case 61:
          _context.next = 63;
          return effects.put(addMessageAC(JSON.parse(JSON.stringify(pendingMessage))));

        case 63:
          addMessageToMap(channel.id, pendingMessage);
          addAllMessages([pendingMessage], MESSAGE_LOAD_DIRECTION.NEXT);
          messagesToAdd = getFromAllMessagesByMessageId('', '', true);
          _context.next = 68;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(messagesToAdd))));

        case 68:
          _context.next = 70;
          return effects.put(scrollToNewMessageAC(true));

        case 70:
          if (messageAttachment.cachedUrl) {
            _context.next = 73;
            break;
          }

          _context.next = 73;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.UPLOADING, messageAttachment.tid));

        case 73:
          if (!customUploader) {
            _context.next = 140;
            break;
          }

          handleUploadProgress = function handleUploadProgress(_ref) {
            var loaded = _ref.loaded,
                total = _ref.total;
            store.dispatch({
              type: UPDATE_UPLOAD_PROGRESS,
              payload: {
                uploaded: loaded,
                total: total,
                progress: loaded / total,
                attachmentId: messageAttachment.tid
              }
            });
          };

          fileSize = messageAttachment.size;

          handleUpdateLocalPath = function handleUpdateLocalPath(updatedLink) {
            if (fileType === 'image') {
              filePath = updatedLink;
              messageCopy.attachments[0] = _extends({}, messageCopy.attachments[0], {
                attachmentUrl: updatedLink
              });
              var updateAttachmentPath = {
                attachments: [_extends({}, messageCopy.attachments[0], {
                  attachmentUrl: updatedLink
                })]
              };
              store.dispatch({
                type: UPDATE_MESSAGE,
                payload: {
                  message: JSON.parse(JSON.stringify(_extends({}, updateAttachmentPath)))
                }
              });
            }
          };

          _context.prev = 77;

          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context.next = 126;
            break;
          }

          if (!messageAttachment.cachedUrl) {
            _context.next = 84;
            break;
          }

          uri = messageAttachment.cachedUrl;
          store.dispatch({
            type: UPDATE_UPLOAD_PROGRESS,
            payload: {
              uploaded: messageAttachment.data.size,
              total: messageAttachment.data.size,
              progress: 1,
              attachmentId: messageAttachment.tid
            }
          });
          _context.next = 87;
          break;

        case 84:
          _context.next = 86;
          return effects.call(customUpload, messageAttachment, handleUploadProgress, handleUpdateLocalPath);

        case 86:
          uri = _context.sent;

        case 87:
          _context.next = 89;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.SUCCESS, messageAttachment.tid));

        case 89:
          if (!(!messageAttachment.cachedUrl && messageAttachment.url.type.split('/')[0] === 'image')) {
            _context.next = 96;
            break;
          }

          _context.next = 92;
          return effects.call(getImageSize, filePath);

        case 92:
          fileSize = _context.sent;
          _context.next = 95;
          return effects.call(createImageThumbnail, null, filePath, messageAttachment.type === 'file' ? 50 : undefined, messageAttachment.type === 'file' ? 50 : undefined);

        case 95:
          thumbnailMetas = _context.sent;

        case 96:
          attachmentMeta = messageAttachment.cachedUrl ? messageAttachment.metadata : JSON.stringify(_extends({}, messageAttachment.metadata, thumbnailMetas && thumbnailMetas.thumbnail && {
            tmb: thumbnailMetas.thumbnail,
            szw: thumbnailMetas.imageWidth,
            szh: thumbnailMetas.imageHeight
          }));
          attachmentBuilder = channel.createAttachmentBuilder(uri, messageAttachment.type);
          attachmentToSend = attachmentBuilder.setName(messageAttachment.name).setMetadata(attachmentMeta).setFileSize(fileSize || messageAttachment.size).setUpload(false).create();

          if (linkAttachment) {
            linkAttachmentBuilder = channel.createAttachmentBuilder(linkAttachment.data, linkAttachment.type);
            linkAttachmentToSend = linkAttachmentBuilder.setName(linkAttachment.name).setUpload(linkAttachment.upload).create();
          }

          if (linkAttachmentToSend) {
            messageToSend.attachments = [attachmentToSend, linkAttachmentToSend];
          } else {
            messageToSend.attachments = [attachmentToSend];
          }

          _context.next = 103;
          return effects.call(channel.sendMessage, messageToSend);

        case 103:
          messageResponse = _context.sent;
          messageResponse.attachments[0] = _extends({}, messageResponse.attachments[0], {
            user: JSON.parse(JSON.stringify(messageResponse.user)),
            tid: messageAttachment.tid,
            attachmentUrl: messageAttachment.attachmentUrl
          });
          pendingAttachment = getPendingAttachment(messageAttachment.tid);

          if (!messageAttachment.cachedUrl) {
            setDataToDB(DB_NAMES.FILES_STORAGE, DB_STORE_NAMES.ATTACHMENTS, [_extends({}, messageResponse.attachments[0], {
              checksum: pendingAttachment.checksum
            })], 'checksum');
          }

          _context.next = 109;
          return effects.put(removeAttachmentProgressAC(messageAttachment.tid));

        case 109:
          deletePendingAttachment(messageAttachment.tid);
          messageUpdateData = {
            id: messageResponse.id,
            body: messageResponse.body,
            type: messageResponse.type,
            state: messageResponse.state,
            displayCount: messageResponse.displayCount,
            deliveryStatus: messageResponse.deliveryStatus,
            attachments: messageResponse.attachments,
            mentionedUsers: messageResponse.mentionedUsers,
            bodyAttributes: messageResponse.bodyAttributes,
            metadata: messageResponse.metadata,
            parentMessage: messageResponse.parentMessage,
            repliedInThread: messageResponse.repliedInThread,
            createdAt: messageResponse.createdAt
          };
          _context.next = 113;
          return effects.put(updateMessageAC(messageToSend.tid, JSON.parse(JSON.stringify(messageUpdateData))));

        case 113:
          if (fileType === 'video') {
            deleteVideoThumb(messageAttachment.tid);
          }

          updateMessageOnMap(channel.id, {
            messageId: messageToSend.tid,
            params: messageUpdateData
          });
          updateMessageOnAllMessages(messageToSend.tid, messageUpdateData);
          messageToUpdate = JSON.parse(JSON.stringify(messageResponse));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);
          channelUpdateParam = {
            lastMessage: messageToUpdate,
            lastReactedMessage: null
          };

          if (!channel.unread) {
            _context.next = 122;
            break;
          }

          _context.next = 122;
          return effects.put(markChannelAsReadAC(channel.id));

        case 122:
          _context.next = 124;
          return effects.put(updateChannelDataAC(channel.id, channelUpdateParam, true));

        case 124:
          _context.next = 127;
          break;

        case 126:
          throw Error('Network error');

        case 127:
          _context.next = 138;
          break;

        case 129:
          _context.prev = 129;
          _context.t0 = _context["catch"](77);
          console.log('Error on uploading attachment', messageAttachment.tid);
          _context.next = 134;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.FAIL, messageAttachment.tid));

        case 134:
          updateMessageOnMap(channel.id, {
            messageId: messageToSend.tid,
            params: {
              state: MESSAGE_STATUS.FAILED
            }
          });
          updateMessageOnAllMessages(messageToSend.tid, {
            state: MESSAGE_STATUS.FAILED
          });
          _context.next = 138;
          return effects.put(updateMessageAC(messageToSend.tid, {
            state: MESSAGE_STATUS.FAILED
          }));

        case 138:
          _context.next = 165;
          break;

        case 140:
          _attachmentBuilder = channel.createAttachmentBuilder(messageAttachment.url, messageAttachment.type);
          _attachmentToSend = _attachmentBuilder.setName(messageAttachment.name).setMetadata(JSON.stringify(messageAttachment.metadata)).setUpload(messageAttachment.upload).create();

          if (!customUploader) {
            _attachmentToSend.progress = function (progressPercent) {
              console.log('progress ... ', progressPercent);
            };

            _attachmentToSend.completion = function (updatedAttachment, error) {
              if (error) {
                console.log('fail to upload attachment ... ', error);
              } else {
                console.log('success attachment. .. ', updatedAttachment);
              }
            };
          }

          _attachmentToSend.tid = messageAttachment.tid;
          _attachmentToSend.attachmentUrl = messageAttachment.attachmentUrl;
          messageToSend.attachments = [_attachmentToSend];
          _context.next = 148;
          return effects.call(channel.sendMessage, messageToSend);

        case 148:
          _messageResponse = _context.sent;
          deletePendingAttachment(messageAttachment.tid);
          _messageUpdateData = {
            id: _messageResponse.id,
            body: _messageResponse.body,
            type: _messageResponse.type,
            state: _messageResponse.state,
            displayCount: _messageResponse.displayCount,
            deliveryStatus: _messageResponse.deliveryStatus,
            attachments: _messageResponse.attachments,
            mentionedUsers: _messageResponse.mentionedUsers,
            metadata: _messageResponse.metadata,
            parentMessage: _messageResponse.parentMessage,
            bodyAttributes: _messageResponse.bodyAttributes,
            repliedInThread: _messageResponse.repliedInThread,
            createdAt: _messageResponse.createdAt
          };
          _context.next = 153;
          return effects.put(updateMessageAC(messageToSend.tid, JSON.parse(JSON.stringify(_messageUpdateData))));

        case 153:
          if (fileType === 'video') {
            deleteVideoThumb(messageAttachment.tid);
          }

          updateMessageOnMap(channel.id, {
            messageId: messageToSend.tid,
            params: _messageUpdateData
          });
          updateMessageOnAllMessages(messageToSend.tid, _messageUpdateData);
          _messageToUpdate = JSON.parse(JSON.stringify(_messageResponse));
          updateChannelLastMessageOnAllChannels(channel.id, _messageToUpdate);
          _channelUpdateParam = {
            lastMessage: _messageToUpdate,
            lastReactedMessage: null
          };

          if (!channel.unread) {
            _context.next = 162;
            break;
          }

          _context.next = 162;
          return effects.put(markChannelAsReadAC(channel.id));

        case 162:
          _context.next = 164;
          return effects.put(updateChannelDataAC(channel.id, _channelUpdateParam, true));

        case 164:
          updateChannelOnAllChannels(channel.id, _channelUpdateParam);

        case 165:
          _context.next = 225;
          break;

        case 167:
          attachmentsToSend = message.attachments.map(function (attachment) {
            var uri;

            if (attachment.cachedUrl) {
              uri = attachment.cachedUrl;
            }

            var attachmentBuilder = channel.createAttachmentBuilder(uri || attachment.data, attachment.type);
            var att = attachmentBuilder.setName(attachment.name).setMetadata(attachment.metadata).setUpload(customUploader ? false : attachment.upload).setFileSize(attachment.size).create();

            if (!customUploader) {
              var handleUpdateUploadProgress = function handleUpdateUploadProgress(percent) {
                store.dispatch({
                  type: UPDATE_UPLOAD_PROGRESS,
                  payload: {
                    uploaded: attachment.size * (percent / 100),
                    total: attachment.size,
                    progress: percent,
                    attachmentId: attachment.tid
                  }
                });
              };

              if (attachment.upload) {
                store.dispatch({
                  type: UPLOAD_ATTACHMENT_COMPILATION,
                  payload: {
                    attachmentUploadingState: UPLOAD_STATE.UPLOADING,
                    attachmentId: attachment.tid
                  }
                });
              }

              att.progress = function (progressPercent) {
                handleUpdateUploadProgress(progressPercent);
              };

              att.completion = function (updatedAttachment, error) {
                if (error) {
                  console.log('fail to upload attachment ... ', error);
                  store.dispatch({
                    type: UPLOAD_ATTACHMENT_COMPILATION,
                    payload: {
                      attachmentUploadingState: UPLOAD_STATE.FAIL,
                      attachmentId: attachment.tid
                    }
                  });
                } else {
                  var _pendingAttachment = getPendingAttachment(attachment.tid);

                  if (!attachment.cachedUrl) {
                    setDataToDB(DB_NAMES.FILES_STORAGE, DB_STORE_NAMES.ATTACHMENTS, [_extends({}, updatedAttachment, {
                      checksum: _pendingAttachment.checksum
                    })], 'checksum');
                  }

                  store.dispatch({
                    type: REMOVE_UPLOAD_PROGRESS,
                    payload: {
                      attachmentId: attachment.tid
                    }
                  });
                  deletePendingAttachment(attachment.tid);
                  store.dispatch({
                    type: UPLOAD_ATTACHMENT_COMPILATION,
                    payload: {
                      attachmentUploadingState: UPLOAD_STATE.SUCCESS,
                      attachmentId: attachment.tid
                    }
                  });
                }
              };
            }

            att.tid = attachment.tid;
            att.attachmentUrl = attachment.attachmentUrl;
            return att;
          });
          _messageBuilder = channel.createMessageBuilder();

          _messageBuilder.setBody(message.body).setBodyAttributes(message.bodyAttributes).setAttachments(message.attachments).setMentionUserIds(mentionedUserIds).setType(message.type).setDisplayCount(message.type === 'system' ? 0 : 1).setSilent(message.type === 'system').setMetadata(JSON.stringify(message.metadata));

          if (message.parentMessage) {
            _messageBuilder.setParentMessageId(message.parentMessage ? message.parentMessage.id : null);
          }

          if (message.repliedInThread) {
            _messageBuilder.setReplyInThread();
          }

          _messageToSend = _messageBuilder.create();

          if (!customUploader) {
            _context.next = 185;
            break;
          }

          attachmentsLocalPaths = {};
          receivedPaths = 1;

          uploadAllAttachments = function uploadAllAttachments() {
            try {
              return Promise.resolve(Promise.all(attachmentsToSend.map(function (attachment) {
                return customUpload(attachment, function (_ref2) {
                  var loaded = _ref2.loaded,
                      total = _ref2.total;
                  console.log('progress  ... ', loaded / total);
                }, function (updatedLink) {
                  if (attachment.tid) {
                    receivedPaths++;
                    attachmentsLocalPaths[attachment.tid] = updatedLink;

                    if (receivedPaths === attachmentsToSend.length) {
                      var _messageCopy = _extends({}, _messageToSend, {
                        attachments: message.attachments.map(function (att) {
                          return {
                            tid: att.tid,
                            name: att.name,
                            data: {},
                            type: att.type,
                            attachmentUrl: attachmentsLocalPaths[attachment.tid]
                          };
                        })
                      });

                      store.dispatch({
                        type: ADD_MESSAGE,
                        payload: {
                          message: JSON.parse(JSON.stringify(_extends({}, _messageCopy, {
                            createdAt: new Date(Date.now()),
                            parentMessage: message.parentMessage
                          })))
                        }
                      });
                    }
                  }
                });
              })));
            } catch (e) {
              return Promise.reject(e);
            }
          };

          _context.next = 179;
          return effects.call(uploadAllAttachments);

        case 179:
          uploadedAttachments = _context.sent;
          _context.next = 182;
          return effects.call(function () {
            try {
              return Promise.resolve(Promise.all(uploadedAttachments.map(function (att) {
                try {
                  return Promise.resolve(new Promise(function (resolve) {
                    store.dispatch({
                      type: UPLOAD_ATTACHMENT_COMPILATION,
                      payload: {
                        attachmentUploadingState: UPLOAD_STATE.UPLOADING,
                        attachment: att.attachment
                      }
                    });
                    createImageThumbnail(null, att.filePath).then(function (_ref3) {
                      var thumbnail = _ref3.thumbnail,
                          imageWidth = _ref3.imageWidth,
                          imageHeight = _ref3.imageHeight;
                      store.dispatch({
                        type: UPLOAD_ATTACHMENT_COMPILATION,
                        payload: {
                          attachmentUploadingState: UPLOAD_STATE.SUCCESS,
                          attachment: att.attachment
                        }
                      });
                      return resolve(_extends({}, att.attachment, {
                        url: att.uri,
                        metadata: JSON.stringify({
                          thumbnail: thumbnail,
                          width: imageWidth,
                          height: imageHeight
                        })
                      }));
                    });
                  }));
                } catch (e) {
                  return Promise.reject(e);
                }
              })));
            } catch (e) {
              return Promise.reject(e);
            }
          });

        case 182:
          attachmentsToSend = _context.sent;
          _context.next = 204;
          break;

        case 185:
          _messageCopy2 = _extends({}, _messageToSend, {
            attachments: message.attachments.map(function (att) {
              return {
                tid: att.tid,
                name: att.name,
                data: {},
                type: att.type,
                attachmentUrl: att.attachmentUrl
              };
            })
          });
          _context.next = 188;
          return effects.select(messagesHasNextSelector);

        case 188:
          _hasNextMessages = _context.sent;

          if (getHasNextCached()) {
            _context.next = 197;
            break;
          }

          if (!_hasNextMessages) {
            _context.next = 195;
            break;
          }

          _context.next = 193;
          return effects.put(getMessagesAC(channel));

        case 193:
          _context.next = 197;
          break;

        case 195:
          _context.next = 197;
          return effects.put(addMessageAC(JSON.parse(JSON.stringify(_messageCopy2))));

        case 197:
          addMessageToMap(channel.id, _messageCopy2);
          addAllMessages([_messageCopy2], MESSAGE_LOAD_DIRECTION.NEXT);
          _messagesToAdd = getFromAllMessagesByMessageId('', '', true);
          _context.next = 202;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(_messagesToAdd))));

        case 202:
          _context.next = 204;
          return effects.put(scrollToNewMessageAC(true));

        case 204:
          _messageToSend.attachments = attachmentsToSend;

          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context.next = 225;
            break;
          }

          _context.next = 208;
          return effects.call(channel.sendMessage, _messageToSend);

        case 208:
          _messageResponse2 = _context.sent;
          attachmentsToUpdate = [];

          if (_messageResponse2.attachments && _messageResponse2.attachments.length > 0) {
            currentAttachmentsMap = {};
            attachmentsToSend.forEach(function (attachment) {
              currentAttachmentsMap[attachment.tid] = attachment;
            });
            attachmentsToUpdate = _messageResponse2.attachments.map(function (attachment) {
              if (currentAttachmentsMap[attachment.tid]) {
                console.log('set at');
                return _extends({}, attachment, {
                  attachmentUrl: currentAttachmentsMap[attachment.tid].attachmentUrl
                });
              }

              return attachment;
            });
          }

          _messageUpdateData2 = {
            id: _messageResponse2.id,
            body: _messageResponse2.body,
            type: _messageResponse2.type,
            state: _messageResponse2.state,
            displayCount: _messageResponse2.displayCount,
            deliveryStatus: _messageResponse2.deliveryStatus,
            attachments: attachmentsToUpdate,
            mentionedUsers: _messageResponse2.mentionedUsers,
            bodyAttributes: _messageResponse2.bodyAttributes,
            metadata: _messageResponse2.metadata,
            parentMessage: _messageResponse2.parentMessage,
            repliedInThread: _messageResponse2.repliedInThread,
            createdAt: _messageResponse2.createdAt
          };
          _context.next = 214;
          return effects.put(updateMessageAC(_messageToSend.tid, JSON.parse(JSON.stringify(_messageUpdateData2))));

        case 214:
          updateMessageOnMap(channel.id, {
            messageId: _messageToSend.tid,
            params: _messageUpdateData2
          });
          updateMessageOnAllMessages(_messageToSend.tid, _messageUpdateData2);
          _messageToUpdate2 = JSON.parse(JSON.stringify(_messageResponse2));
          updateChannelLastMessageOnAllChannels(channel.id, _messageToUpdate2);
          _channelUpdateParam2 = {
            lastMessage: _messageToUpdate2,
            lastReactedMessage: null
          };

          if (!channel.unread) {
            _context.next = 222;
            break;
          }

          _context.next = 222;
          return effects.put(markChannelAsReadAC(channel.id));

        case 222:
          _context.next = 224;
          return effects.put(updateChannelDataAC(channel.id, _channelUpdateParam2, true));

        case 224:
          updateChannelOnAllChannels(channel.id, _channelUpdateParam2);

        case 225:
          _context.next = 230;
          break;

        case 227:
          _context.prev = 227;
          _context.t1 = _context["catch"](2);
          console.log('error on send message ... ', _context.t1);

        case 230:
        case "end":
          return _context.stop();
      }
    }
  }, _marked$2, null, [[2, 227], [77, 129]]);
}

function sendTextMessage(action) {
  var payload, message, connectionState, channelId, channel, sendMessageTid, SceytChatClient, createChannelData, mentionedUserIds, attachments, attachmentBuilder, att, messageBuilder, messageToSend, pendingMessage, hasNextMessages, messagesToAdd, messageResponse, messageUpdateData, messageToUpdate, channelUpdateParam;
  return _regeneratorRuntime().wrap(function sendTextMessage$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          payload = action.payload;
          message = payload.message, connectionState = payload.connectionState, channelId = payload.channelId;
          _context2.next = 4;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 4:
          _context2.next = 6;
          return effects.call(getChannelFromMap, channelId);

        case 6:
          channel = _context2.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context2.prev = 8;

          if (!channel.isMockChannel) {
            _context2.next = 20;
            break;
          }

          SceytChatClient = getClient();
          removeChannelFromMap(channelId);
          createChannelData = {
            type: channel.type,
            members: channel.members,
            metadata: ''
          };
          _context2.next = 15;
          return effects.call(SceytChatClient.Channel.create, createChannelData);

        case 15:
          channel = _context2.sent;
          _context2.next = 18;
          return effects.put(switchChannelActionAC(JSON.parse(JSON.stringify(channel))));

        case 18:
          addChannelsToAllChannels(channel);
          setChannelInMap(channel);

        case 20:
          _context2.next = 22;
          return effects.put(addChannelAC(JSON.parse(JSON.stringify(channel))));

        case 22:
          mentionedUserIds = message.mentionedMembers ? message.mentionedMembers.map(function (member) {
            return member.id;
          }) : [];
          attachments = message.attachments;

          if (message.attachments && message.attachments.length) {
            attachmentBuilder = channel.createAttachmentBuilder(attachments[0].data, attachments[0].type);
            att = attachmentBuilder.setName('').setUpload(attachments[0].upload).create();
            attachments = [att];
          }

          messageBuilder = channel.createMessageBuilder();
          messageBuilder.setBody(message.body).setBodyAttributes(message.bodyAttributes).setAttachments(attachments).setMentionUserIds(mentionedUserIds).setType(message.type).setDisplayCount(message.type === 'system' ? 0 : 1).setSilent(message.type === 'system').setMetadata(JSON.stringify(message.metadata));

          if (message.parentMessage) {
            messageBuilder.setParentMessageId(message.parentMessage ? message.parentMessage.id : null);
          }

          if (message.repliedInThread) {
            messageBuilder.setReplyInThread();
          }

          messageToSend = messageBuilder.create();
          pendingMessage = JSON.parse(JSON.stringify(_extends({}, messageToSend, {
            createdAt: new Date(Date.now()),
            mentionedUsers: message.mentionedMembers,
            parentMessage: message.parentMessage
          })));
          sendMessageTid = messageToSend.tid;

          if (pendingMessage.metadata) {
            pendingMessage.metadata = JSON.parse(pendingMessage.metadata);
          }

          console.log('pendingMessage >>> > >', pendingMessage);
          _context2.next = 36;
          return effects.select(messagesHasNextSelector);

        case 36:
          hasNextMessages = _context2.sent;

          if (getHasNextCached()) {
            _context2.next = 45;
            break;
          }

          if (!hasNextMessages) {
            _context2.next = 43;
            break;
          }

          _context2.next = 41;
          return effects.put(getMessagesAC(channel));

        case 41:
          _context2.next = 45;
          break;

        case 43:
          _context2.next = 45;
          return effects.put(addMessageAC(JSON.parse(JSON.stringify(pendingMessage))));

        case 45:
          addMessageToMap(channel.id, pendingMessage);
          addAllMessages([pendingMessage], MESSAGE_LOAD_DIRECTION.NEXT);
          messagesToAdd = getFromAllMessagesByMessageId('', '', true);
          _context2.next = 50;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(messagesToAdd))));

        case 50:
          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context2.next = 77;
            break;
          }

          console.log('send message messageToSend ... ', messageToSend);

          if (!sendMessageHandler) {
            _context2.next = 58;
            break;
          }

          _context2.next = 55;
          return effects.call(sendMessageHandler, messageToSend, channel.id);

        case 55:
          messageResponse = _context2.sent;
          _context2.next = 61;
          break;

        case 58:
          _context2.next = 60;
          return effects.call(channel.sendMessage, messageToSend);

        case 60:
          messageResponse = _context2.sent;

        case 61:
          messageUpdateData = {
            id: messageResponse.id,
            body: messageResponse.body,
            type: messageResponse.type,
            state: messageResponse.state,
            bodyAttributes: messageResponse.bodyAttributes,
            displayCount: messageResponse.displayCount,
            deliveryStatus: messageResponse.deliveryStatus,
            attachments: messageResponse.attachments,
            mentionedUsers: messageResponse.mentionedUsers,
            metadata: messageResponse.metadata,
            parentMessage: messageResponse.parentMessage,
            repliedInThread: messageResponse.repliedInThread,
            createdAt: messageResponse.createdAt
          };
          _context2.next = 64;
          return effects.put(updateMessageAC(messageToSend.tid, JSON.parse(JSON.stringify(messageUpdateData))));

        case 64:
          updateMessageOnMap(channel.id, {
            messageId: messageToSend.tid,
            params: messageUpdateData
          });
          updateMessageOnAllMessages(messageToSend.tid, messageUpdateData);
          messageToUpdate = JSON.parse(JSON.stringify(messageResponse));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);
          channelUpdateParam = {
            lastMessage: messageToUpdate,
            lastReactedMessage: null
          };
          _context2.next = 71;
          return effects.put(updateChannelDataAC(channel.id, channelUpdateParam, true));

        case 71:
          updateChannelOnAllChannels(channel.id, channelUpdateParam);

          if (!channel.unread) {
            _context2.next = 75;
            break;
          }

          _context2.next = 75;
          return effects.put(markChannelAsReadAC(channel.id));

        case 75:
          _context2.next = 78;
          break;

        case 77:
          throw new Error('Connection required to send message');

        case 78:
          _context2.next = 80;
          return effects.put(scrollToNewMessageAC(true));

        case 80:
          _context2.next = 82;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 82:
          _context2.next = 93;
          break;

        case 84:
          _context2.prev = 84;
          _context2.t0 = _context2["catch"](8);
          console.log('error on send text message ... ', _context2.t0);
          updateMessageOnMap(channel.id, {
            messageId: sendMessageTid,
            params: {
              state: MESSAGE_STATUS.FAILED
            }
          });
          updateMessageOnAllMessages(sendMessageTid, {
            state: MESSAGE_STATUS.FAILED
          });
          _context2.next = 91;
          return effects.put(updateMessageAC(sendMessageTid, {
            state: MESSAGE_STATUS.FAILED
          }));

        case 91:
          _context2.next = 93;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 93:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2$1, null, [[8, 84]]);
}

function forwardMessage(action) {
  var payload, _message, channelId, connectionState, channel, SceytChatClient, mentionedUserIds, attachments, attachmentBuilder, att, messageBuilder, messageToSend, pendingMessage, activeChannelId, isCachedChannel, hasNextMessages, messageResponse, messageUpdateData, messageToUpdate, channelUpdateParam;

  return _regeneratorRuntime().wrap(function forwardMessage$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          _context3.prev = 0;
          payload = action.payload;
          _message = payload.message, channelId = payload.channelId, connectionState = payload.connectionState;
          _context3.next = 5;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 5:
          _context3.next = 7;
          return effects.call(getChannelFromMap, channelId);

        case 7:
          channel = _context3.sent;

          if (channel) {
            _context3.next = 16;
            break;
          }

          channel = getChannelFromAllChannels(channelId);

          if (channel) {
            _context3.next = 15;
            break;
          }

          SceytChatClient = getClient();
          _context3.next = 14;
          return effects.call(SceytChatClient.getChannel, channelId);

        case 14:
          channel = _context3.sent;

        case 15:
          if (channel) {
            setChannelInMap(channel);
          }

        case 16:
          _context3.next = 18;
          return effects.put(addChannelAC(JSON.parse(JSON.stringify(channel))));

        case 18:
          mentionedUserIds = _message.mentionedMembers ? _message.mentionedMembers.map(function (member) {
            return member.id;
          }) : [];
          attachments = _message.attachments;

          if ((channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC) && !(channel.userRole === 'admin' || channel.userRole === 'owner')) {
            _context3.next = 71;
            break;
          }

          if (_message.attachments && _message.attachments.length) {
            attachmentBuilder = channel.createAttachmentBuilder(attachments[0].url, attachments[0].type);
            att = attachmentBuilder.setName(attachments[0].name).setMetadata(attachments[0].metadata).setFileSize(attachments[0].size).setUpload(false).create();
            attachments = [att];
          }

          messageBuilder = channel.createMessageBuilder();
          messageBuilder.setBody(_message.body).setBodyAttributes(_message.bodyAttributes).setAttachments(attachments).setMentionUserIds(mentionedUserIds).setType(_message.type).setMetadata(_message.metadata ? JSON.stringify(_message.metadata) : '').setForwardingMessageId(_message.forwardingDetails ? _message.forwardingDetails.messageId : _message.id);
          messageToSend = messageBuilder.create();
          pendingMessage = JSON.parse(JSON.stringify(_extends({}, messageToSend, {
            createdAt: new Date(Date.now())
          })));

          if (_message.forwardingDetails) {
            pendingMessage.forwardingDetails.user = _message.forwardingDetails.user;
            pendingMessage.forwardingDetails.channelId = _message.forwardingDetails.channelId;
          } else {
            pendingMessage.forwardingDetails.user = _message.user;
            pendingMessage.forwardingDetails.channelId = channelId;
          }

          pendingMessage.forwardingDetails.hops = _message.forwardingDetails ? _message.forwardingDetails.hops : 1;
          activeChannelId = getActiveChannelId();
          isCachedChannel = checkChannelExistsOnMessagesMap(channelId);

          if (!(channelId === activeChannelId)) {
            _context3.next = 48;
            break;
          }

          _context3.next = 33;
          return effects.select(messagesHasNextSelector);

        case 33:
          hasNextMessages = _context3.sent;

          if (getHasNextCached()) {
            _context3.next = 42;
            break;
          }

          if (!hasNextMessages) {
            _context3.next = 40;
            break;
          }

          _context3.next = 38;
          return effects.put(getMessagesAC(channel));

        case 38:
          _context3.next = 42;
          break;

        case 40:
          _context3.next = 42;
          return effects.put(addMessageAC(JSON.parse(JSON.stringify(pendingMessage))));

        case 42:
          addMessageToMap(channelId, pendingMessage);
          addAllMessages([pendingMessage], MESSAGE_LOAD_DIRECTION.NEXT);
          _context3.next = 46;
          return effects.put(scrollToNewMessageAC(true, true));

        case 46:
          _context3.next = 49;
          break;

        case 48:
          if (isCachedChannel) {
            addMessageToMap(channelId, pendingMessage);
          } else {
            addPendingMessageToMap(channelId, pendingMessage);
          }

        case 49:
          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context3.next = 71;
            break;
          }

          _context3.next = 52;
          return effects.call(channel.sendMessage, messageToSend);

        case 52:
          messageResponse = _context3.sent;
          messageUpdateData = {
            id: messageResponse.id,
            type: messageResponse.type,
            state: messageResponse.state,
            displayCount: messageResponse.displayCount,
            deliveryStatus: messageResponse.deliveryStatus,
            attachments: messageResponse.attachments,
            mentionedUsers: messageResponse.mentionedUsers,
            metadata: messageResponse.metadata,
            parentMessage: messageResponse.parentMessage,
            repliedInThread: messageResponse.repliedInThread,
            createdAt: messageResponse.createdAt
          };

          if (!(channelId === activeChannelId)) {
            _context3.next = 61;
            break;
          }

          _context3.next = 57;
          return effects.put(updateMessageAC(messageToSend.tid, JSON.parse(JSON.stringify(messageUpdateData))));

        case 57:
          updateMessageOnMap(channel.id, {
            messageId: messageToSend.tid,
            params: messageUpdateData
          });
          updateMessageOnAllMessages(messageToSend.tid, messageUpdateData);
          _context3.next = 62;
          break;

        case 61:
          if (isCachedChannel) {
            updateMessageOnMap(channel.id, {
              messageId: messageToSend.tid,
              params: messageUpdateData
            });
          } else {
            removePendingMessageFromMap(channelId, messageToSend.tid);
          }

        case 62:
          messageToUpdate = JSON.parse(JSON.stringify(messageResponse));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);
          channelUpdateParam = {
            lastMessage: messageToUpdate,
            lastReactedMessage: null
          };
          _context3.next = 67;
          return effects.put(updateChannelDataAC(channel.id, channelUpdateParam, true));

        case 67:
          updateChannelOnAllChannels(channel.id, channelUpdateParam);

          if (!channel.unread) {
            _context3.next = 71;
            break;
          }

          _context3.next = 71;
          return effects.put(markChannelAsReadAC(channel.id));

        case 71:
          _context3.next = 76;
          break;

        case 73:
          _context3.prev = 73;
          _context3.t0 = _context3["catch"](0);
          console.log('error on forward message ... ', _context3.t0);

        case 76:
          _context3.next = 78;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 78:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked3$1, null, [[0, 73]]);
}

function resendMessage(action) {
  var payload, message, connectionState, channelId, channel, customUploader, attachmentCompilation, _messageAttachment, _messageCopy3, handleUploadProgress, uri, _filePath, handleUpdateLocalPath, pendingAttachment, thumbnailMetas, fileSize, attachmentMeta, attachmentBuilder, attachmentToSend, messageResponse, messageUpdateData, _fileType, messageToUpdate, _messageCopy4, _messageResponse3, _messageUpdateData3, activeChannelId, _messageToUpdate3;

  return _regeneratorRuntime().wrap(function resendMessage$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          payload = action.payload;
          message = payload.message, connectionState = payload.connectionState, channelId = payload.channelId;
          _context4.next = 4;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 4:
          _context4.next = 6;
          return effects.call(getChannelFromMap, channelId);

        case 6:
          channel = _context4.sent;
          _context4.prev = 7;
          console.log('resend message .... ', message);

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context4.next = 12;
          return effects.put(addChannelAC(JSON.parse(JSON.stringify(channel))));

        case 12:
          customUploader = getCustomUploader();
          _context4.next = 15;
          return effects.put(updateMessageAC(message.tid, {
            state: MESSAGE_STATUS.UNMODIFIED
          }));

        case 15:
          updateMessageOnMap(channel.id, {
            messageId: message.tid,
            params: {
              state: MESSAGE_STATUS.UNMODIFIED
            }
          });
          updateMessageOnAllMessages(message.tid, {
            state: MESSAGE_STATUS.UNMODIFIED
          });

          if (!(message.attachments && message.attachments.length && message.state === MESSAGE_STATUS.FAILED)) {
            _context4.next = 95;
            break;
          }

          _context4.next = 20;
          return effects.select(attachmentCompilationStateSelector);

        case 20:
          attachmentCompilation = _context4.sent;
          _messageAttachment = _extends({}, message.attachments[0]);
          _messageCopy3 = _extends({}, message, {
            attachments: [_messageAttachment]
          });
          console.log('attachmentCompilation. .. . .', attachmentCompilation);

          if (!(connectionState === CONNECTION_STATUS.CONNECTED && attachmentCompilation[_messageAttachment.tid] && attachmentCompilation[_messageAttachment.tid] === UPLOAD_STATE.FAIL)) {
            _context4.next = 93;
            break;
          }

          _context4.next = 27;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.UPLOADING, _messageAttachment.tid));

        case 27:
          if (!customUploader) {
            _context4.next = 93;
            break;
          }

          handleUploadProgress = function handleUploadProgress(_ref4) {
            var loaded = _ref4.loaded,
                total = _ref4.total;
            console.log('progress ... ', loaded / total);
          };

          _context4.prev = 29;

          handleUpdateLocalPath = function handleUpdateLocalPath(updatedLink) {
            _filePath = updatedLink;
            thumbnailMetas = getVideoThumb(_messageAttachment.tid);
            _messageCopy3.attachments[0] = _extends({}, _messageCopy3.attachments[0], {
              attachmentUrl: updatedLink
            });
            var updateAttachmentPath = {
              attachments: [_extends({}, _messageCopy3.attachments[0], {
                attachmentUrl: updatedLink
              })]
            };
            store.dispatch({
              type: UPDATE_MESSAGE,
              payload: {
                message: JSON.parse(JSON.stringify(_extends({}, updateAttachmentPath)))
              }
            });
          };

          pendingAttachment = getPendingAttachment(message.attachments[0].tid);
          console.log('pendingAttachment ... ', pendingAttachment);

          if (!_messageAttachment.cachedUrl) {
            _context4.next = 37;
            break;
          }

          uri = pendingAttachment.file;
          _context4.next = 42;
          break;

        case 37:
          _messageAttachment.data = pendingAttachment.file;
          _messageAttachment.url = pendingAttachment.file;
          _context4.next = 41;
          return effects.call(customUpload, _messageAttachment, handleUploadProgress, handleUpdateLocalPath);

        case 41:
          uri = _context4.sent;

        case 42:
          console.log('messageAttachment ... ', _messageAttachment);
          _context4.next = 45;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.SUCCESS, _messageAttachment.tid));

        case 45:
          delete _messageCopy3.createdAt;
          thumbnailMetas = {};
          fileSize = _messageAttachment.cachedUrl ? _messageAttachment.size : pendingAttachment.file.size;
          console.log('uri ... ', uri);

          if (!(!_messageAttachment.cachedUrl && _messageAttachment.url.type.split('/')[0] === 'image')) {
            _context4.next = 56;
            break;
          }

          _context4.next = 52;
          return effects.call(getImageSize, _filePath);

        case 52:
          fileSize = _context4.sent;
          _context4.next = 55;
          return effects.call(createImageThumbnail, null, _filePath, _messageAttachment.type === 'file' ? 50 : undefined, _messageAttachment.type === 'file' ? 50 : undefined);

        case 55:
          thumbnailMetas = _context4.sent;

        case 56:
          if (_messageAttachment.cachedUrl) {
            attachmentMeta = _messageAttachment.metadata;
          } else {
            attachmentMeta = JSON.stringify(_extends({}, _messageAttachment.metadata, thumbnailMetas && thumbnailMetas.thumbnail && {
              tmb: thumbnailMetas.thumbnail,
              szw: thumbnailMetas.imageWidth,
              szh: thumbnailMetas.imageHeight
            }));
          }

          console.log('attachmentMeta ... ', attachmentMeta);
          attachmentBuilder = channel.createAttachmentBuilder(uri, _messageAttachment.type);
          attachmentToSend = attachmentBuilder.setName(_messageAttachment.name).setMetadata(attachmentMeta).setFileSize(fileSize).setUpload(false).create();
          console.log('attachmentToSend ... ', attachmentToSend);
          attachmentToSend.tid = _messageAttachment.tid;
          attachmentToSend.attachmentUrl = _messageAttachment.attachmentUrl;
          _context4.next = 65;
          return effects.put(updateMessageAC(_messageCopy3.tid, JSON.parse(JSON.stringify(_extends({}, _messageCopy3, {
            attachments: [attachmentToSend]
          })))));

        case 65:
          _messageCopy3.attachments = [attachmentToSend];

          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context4.next = 82;
            break;
          }

          _context4.next = 69;
          return effects.call(channel.sendMessage, _messageCopy3);

        case 69:
          messageResponse = _context4.sent;
          deletePendingAttachment(_messageAttachment.tid);
          messageUpdateData = {
            id: messageResponse.id,
            body: messageResponse.body,
            type: messageResponse.type,
            state: messageResponse.state,
            displayCount: messageResponse.displayCount,
            deliveryStatus: messageResponse.deliveryStatus,
            attachments: [_extends({}, messageResponse.attachments[0], {
              attachmentUrl: attachmentToSend.attachmentUrl,
              tid: attachmentToSend.tid
            })],
            mentionedUsers: messageResponse.mentionedUsers,
            metadata: messageResponse.metadata,
            parentMessage: messageResponse.parentMessage,
            repliedInThread: messageResponse.repliedInThread,
            bodyAttributes: messageResponse.bodyAttributes,
            createdAt: messageResponse.createdAt
          };
          _context4.next = 74;
          return effects.put(updateMessageAC(_messageCopy3.tid, JSON.parse(JSON.stringify(messageUpdateData))));

        case 74:
          _fileType = _messageAttachment.data && _messageAttachment.data.type ? _messageAttachment.data.type.split('/')[0] : _messageAttachment.type;

          if (_fileType === 'video') {
            deleteVideoThumb(_messageAttachment.tid);
          }

          updateMessageOnMap(channel.id, {
            messageId: _messageCopy3.tid,
            params: messageUpdateData
          });
          updateMessageOnAllMessages(_messageCopy3.tid, messageUpdateData);
          messageToUpdate = JSON.parse(JSON.stringify(messageResponse));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);
          _context4.next = 82;
          return effects.put(updateChannelLastMessageAC(messageToUpdate, {
            id: channel.id
          }));

        case 82:
          _context4.next = 93;
          break;

        case 84:
          _context4.prev = 84;
          _context4.t0 = _context4["catch"](29);
          console.log('fail upload attachment on resend message ... ', _context4.t0);
          _context4.next = 89;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.FAIL, _messageAttachment.tid));

        case 89:
          updateMessageOnMap(channel.id, {
            messageId: _messageCopy3.tid,
            params: {
              state: MESSAGE_STATUS.FAILED
            }
          });
          updateMessageOnAllMessages(_messageCopy3.tid, {
            state: MESSAGE_STATUS.FAILED
          });
          _context4.next = 93;
          return effects.put(updateMessageAC(_messageCopy3.tid, {
            state: MESSAGE_STATUS.FAILED
          }));

        case 93:
          _context4.next = 120;
          break;

        case 95:
          if (!(message.state === MESSAGE_STATUS.FAILED)) {
            _context4.next = 120;
            break;
          }

          console.log('send failed message ...');
          _messageCopy4 = _extends({}, message);
          delete _messageCopy4.createdAt;

          if (!(connectionState === CONNECTION_STATUS.CONNECTED)) {
            _context4.next = 120;
            break;
          }

          _context4.next = 102;
          return effects.call(channel.sendMessage, _messageCopy4);

        case 102:
          _messageResponse3 = _context4.sent;
          console.log('resend message response ... ', _messageResponse3);
          _messageUpdateData3 = {
            id: _messageResponse3.id,
            body: _messageResponse3.body,
            type: _messageResponse3.type,
            state: _messageResponse3.state,
            displayCount: _messageResponse3.displayCount,
            deliveryStatus: _messageResponse3.deliveryStatus,
            attachments: [],
            mentionedUsers: _messageResponse3.mentionedUsers,
            metadata: _messageResponse3.metadata,
            parentMessage: _messageResponse3.parentMessage,
            repliedInThread: _messageResponse3.repliedInThread,
            bodyAttributes: _messageResponse3.bodyAttributes,
            createdAt: _messageResponse3.createdAt
          };
          removePendingMessageFromMap(channel.id, _messageCopy4.tid);
          _context4.next = 108;
          return effects.put(updateMessageAC(_messageCopy4.tid, _messageUpdateData3));

        case 108:
          updateMessageOnMap(channel.id, {
            messageId: _messageCopy4.tid,
            params: _messageUpdateData3
          });
          activeChannelId = getActiveChannelId();

          if (!(channelId === activeChannelId)) {
            _context4.next = 115;
            break;
          }

          _context4.next = 113;
          return effects.put(updateMessageAC(_messageCopy4.tid, JSON.parse(JSON.stringify(_messageResponse3))));

        case 113:
          updateMessageOnMap(channel.id, {
            messageId: _messageCopy4.tid,
            params: _messageUpdateData3
          });
          updateMessageOnAllMessages(_messageCopy4.tid, _messageUpdateData3);

        case 115:
          updateChannelOnAllChannels(channel.id, channel);
          _messageToUpdate3 = JSON.parse(JSON.stringify(_messageResponse3));
          updateChannelLastMessageOnAllChannels(channel.id, _messageToUpdate3);
          _context4.next = 120;
          return effects.put(updateChannelLastMessageAC(_messageToUpdate3, {
            id: channel.id
          }));

        case 120:
          _context4.next = 122;
          return effects.put(scrollToNewMessageAC(true));

        case 122:
          _context4.next = 131;
          break;

        case 124:
          _context4.prev = 124;
          _context4.t1 = _context4["catch"](7);
          console.log('ERROR in resend message', _context4.t1.message, 'channel.. . ', channel);
          _context4.next = 129;
          return effects.put(updateMessageAC(message.tid, {
            state: MESSAGE_STATUS.FAILED
          }));

        case 129:
          updateMessageOnMap(channel.id, {
            messageId: message.tid,
            params: {
              state: MESSAGE_STATUS.FAILED
            }
          });
          updateMessageOnAllMessages(message.tid, {
            state: MESSAGE_STATUS.FAILED
          });

        case 131:
          _context4.next = 133;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 133:
        case "end":
          return _context4.stop();
      }
    }
  }, _marked4$1, null, [[7, 124], [29, 84]]);
}

function deleteMessage(action) {
  var payload, messageId, channelId, deleteOption, channel, deletedMessage, messageToUpdate;
  return _regeneratorRuntime().wrap(function deleteMessage$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          _context5.prev = 0;
          payload = action.payload;
          messageId = payload.messageId, channelId = payload.channelId, deleteOption = payload.deleteOption;
          _context5.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context5.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context5.next = 9;
          return effects.call(channel.deleteMessageById, messageId, deleteOption === 'forMe');

        case 9:
          deletedMessage = _context5.sent;
          console.log('deletedMessage . .. . .', deletedMessage);
          _context5.next = 13;
          return effects.put(updateMessageAC(deletedMessage.id, deletedMessage));

        case 13:
          updateMessageOnMap(channel.id, {
            messageId: deletedMessage.id,
            params: deletedMessage
          });
          updateMessageOnAllMessages(messageId, deletedMessage);
          messageToUpdate = JSON.parse(JSON.stringify(deletedMessage));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);

          if (!(channel.lastMessage.id === messageId)) {
            _context5.next = 20;
            break;
          }

          _context5.next = 20;
          return effects.put(updateChannelLastMessageAC(messageToUpdate, channel));

        case 20:
          _context5.next = 25;
          break;

        case 22:
          _context5.prev = 22;
          _context5.t0 = _context5["catch"](0);
          console.log('ERROR in delete message', _context5.t0.message);

        case 25:
        case "end":
          return _context5.stop();
      }
    }
  }, _marked5$1, null, [[0, 22]]);
}

function editMessage(action) {
  var payload, _message2, channelId, channel, editedMessage, messageToUpdate;

  return _regeneratorRuntime().wrap(function editMessage$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          _context6.prev = 0;
          payload = action.payload;
          _message2 = payload.message, channelId = payload.channelId;
          _context6.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context6.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context6.next = 9;
          return effects.call(channel.editMessage, _extends({}, _message2, {
            metadata: isJSON(_message2.metadata) ? _message2.metadata : JSON.stringify(_message2.metadata),
            attachments: _message2.attachments.map(function (att) {
              return _extends({}, att, {
                metadata: isJSON(att.metadata) ? att.metadata : JSON.stringify(att.metadata)
              });
            })
          }));

        case 9:
          editedMessage = _context6.sent;
          _context6.next = 12;
          return effects.put(updateMessageAC(editedMessage.id, editedMessage));

        case 12:
          updateMessageOnMap(channel.id, {
            messageId: editedMessage.id,
            params: editedMessage
          });
          updateMessageOnAllMessages(_message2.id, editedMessage);

          if (!(channel.lastMessage.id === _message2.id)) {
            _context6.next = 19;
            break;
          }

          messageToUpdate = JSON.parse(JSON.stringify(editedMessage));
          updateChannelLastMessageOnAllChannels(channel.id, messageToUpdate);
          _context6.next = 19;
          return effects.put(updateChannelLastMessageAC(messageToUpdate, channel));

        case 19:
          _context6.next = 24;
          break;

        case 21:
          _context6.prev = 21;
          _context6.t0 = _context6["catch"](0);
          console.log('ERROR in edit message', _context6.t0.message);

        case 24:
        case "end":
          return _context6.stop();
      }
    }
  }, _marked6$1, null, [[0, 21]]);
}

function getMessagesQuery(action) {
  var _action$payload, channel, loadWithLastMessage, messageId, limit, SceytChatClient, messageQueryBuilder, messageQuery, cachedMessages, result, allMessages, havLastMessage, _allMessages, messageIndex, maxLengthPart, pendingMessages, messagesMap, filteredPendingMessages, _pendingMessages, _messagesMap, _filteredPendingMessages, _pendingMessages2, _messagesMap2, _filteredPendingMessages2;

  return _regeneratorRuntime().wrap(function getMessagesQuery$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          _context7.prev = 0;
          _action$payload = action.payload, channel = _action$payload.channel, loadWithLastMessage = _action$payload.loadWithLastMessage, messageId = _action$payload.messageId, limit = _action$payload.limit;
          console.log('getMessagesQuery ... ', action.payload);

          if (!(channel.id && !channel.isMockChannel)) {
            _context7.next = 125;
            break;
          }

          SceytChatClient = getClient();
          messageQueryBuilder = new SceytChatClient.MessageListQueryBuilder(channel.id);
          messageQueryBuilder.limit(limit || MESSAGES_MAX_LENGTH);
          messageQueryBuilder.reverse(true);
          _context7.next = 10;
          return effects.call(messageQueryBuilder.build);

        case 10:
          messageQuery = _context7.sent;
          query.messageQuery = messageQuery;
          _context7.next = 14;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 14:
          cachedMessages = getMessagesFromMap(channel.id);
          result = {
            messages: [],
            hasNext: false
          };

          if (!loadWithLastMessage) {
            _context7.next = 45;
            break;
          }

          allMessages = getAllMessages();
          havLastMessage = allMessages && allMessages.length && channel.lastMessage && allMessages[allMessages.length - 1] && allMessages[allMessages.length - 1].id === channel.lastMessage.id;

          if (!(channel.newMessageCount && channel.newMessageCount > 0 || !havLastMessage)) {
            _context7.next = 35;
            break;
          }

          setHasPrevCached(false);
          setAllMessages([]);
          _context7.next = 24;
          return effects.call(messageQuery.loadPreviousMessageId, '0');

        case 24:
          result = _context7.sent;
          _context7.next = 27;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 27:
          setMessagesToMap(channel.id, result.messages);
          setAllMessages([].concat(result.messages));
          _context7.next = 31;
          return effects.put(setMessagesHasPrevAC(true));

        case 31:
          _context7.next = 33;
          return effects.put(markChannelAsReadAC(channel.id));

        case 33:
          _context7.next = 40;
          break;

        case 35:
          result.messages = getFromAllMessagesByMessageId('', '', true);
          _context7.next = 38;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 38:
          _context7.next = 40;
          return effects.put(setMessagesHasPrevAC(true));

        case 40:
          _context7.next = 42;
          return effects.put(setMessagesHasNextAC(false));

        case 42:
          setHasNextCached(false);
          _context7.next = 114;
          break;

        case 45:
          if (!messageId) {
            _context7.next = 76;
            break;
          }

          _allMessages = getAllMessages();
          messageIndex = _allMessages.findIndex(function (msg) {
            return msg.id === messageId;
          });
          maxLengthPart = MESSAGES_MAX_LENGTH / 2;

          if (!(messageIndex >= maxLengthPart)) {
            _context7.next = 57;
            break;
          }

          result.messages = _allMessages.slice(messageIndex - maxLengthPart, messageIndex + maxLengthPart);
          _context7.next = 53;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 53:
          setHasPrevCached(messageIndex > maxLengthPart);
          setHasNextCached(_allMessages.length > maxLengthPart);
          _context7.next = 72;
          break;

        case 57:
          messageQuery.limit = MESSAGES_MAX_LENGTH;
          console.log('load by message id from server ...............', messageId);
          _context7.next = 61;
          return effects.call(messageQuery.loadNearMessageId, messageId);

        case 61:
          result = _context7.sent;
          console.log('result from server ....... ', result);
          _context7.next = 65;
          return effects.put(setMessagesHasNextAC(true));

        case 65:
          pendingMessages = getPendingMessages(channel.id);

          if (pendingMessages && pendingMessages.length) {
            messagesMap = {};
            result.messages.forEach(function (msg) {
              messagesMap[msg.tid || ''] = msg;
            });
            filteredPendingMessages = pendingMessages.filter(function (msg) {
              return !messagesMap[msg.tid || ''];
            });
            setPendingMessages(channel.id, filteredPendingMessages);
            result.messages = [].concat(result.messages, filteredPendingMessages);
          }

          _context7.next = 69;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 69:
          setAllMessages([].concat(result.messages));
          setHasPrevCached(false);
          setHasNextCached(false);

        case 72:
          _context7.next = 74;
          return effects.put(setScrollToMessagesAC(messageId));

        case 74:
          _context7.next = 114;
          break;

        case 76:
          if (!(channel.newMessageCount && channel.lastDisplayedMsgId)) {
            _context7.next = 100;
            break;
          }

          setAllMessages([]);
          messageQuery.limit = MESSAGES_MAX_LENGTH;

          if (!Number(channel.lastDisplayedMsgId)) {
            _context7.next = 85;
            break;
          }

          _context7.next = 82;
          return effects.call(messageQuery.loadNearMessageId, channel.lastDisplayedMsgId);

        case 82:
          result = _context7.sent;
          _context7.next = 88;
          break;

        case 85:
          _context7.next = 87;
          return effects.call(messageQuery.loadPrevious);

        case 87:
          result = _context7.sent;

        case 88:
          setMessagesToMap(channel.id, result.messages);
          _context7.next = 91;
          return effects.put(setMessagesHasPrevAC(true));

        case 91:
          _context7.next = 93;
          return effects.put(setMessagesHasNextAC(channel.lastMessage && result.messages.length > 0 && channel.lastMessage.id !== result.messages[result.messages.length - 1].id));

        case 93:
          _pendingMessages = getPendingMessages(channel.id);

          if (_pendingMessages && _pendingMessages.length) {
            _messagesMap = {};
            result.messages.forEach(function (msg) {
              _messagesMap[msg.tid || ''] = msg;
            });
            _filteredPendingMessages = _pendingMessages.filter(function (msg) {
              return !_messagesMap[msg.tid || ''];
            });
            setPendingMessages(channel.id, _filteredPendingMessages);
            result.messages = [].concat(result.messages, _filteredPendingMessages);
          }

          setAllMessages([].concat(result.messages));
          _context7.next = 98;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 98:
          _context7.next = 114;
          break;

        case 100:
          setAllMessages([]);

          if (!(cachedMessages && cachedMessages.length)) {
            _context7.next = 105;
            break;
          }

          setAllMessages([].concat(cachedMessages));
          _context7.next = 105;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(cachedMessages))));

        case 105:
          console.log('load message from server');
          _context7.next = 108;
          return effects.call(messageQuery.loadPrevious);

        case 108:
          result = _context7.sent;
          result.messages.forEach(function (msg) {
            updateMessageOnMap(channel.id, {
              messageId: msg.id,
              params: msg
            });
            updateMessageOnAllMessages(msg.id, msg);
          });
          _context7.next = 112;
          return effects.put(setMessagesHasPrevAC(result.hasNext));

        case 112:
          _context7.next = 114;
          return effects.put(setMessagesHasNextAC(false));

        case 114:
          if (cachedMessages && cachedMessages.length) {
            _context7.next = 121;
            break;
          }

          _pendingMessages2 = getPendingMessages(channel.id);

          if (_pendingMessages2 && _pendingMessages2.length) {
            _messagesMap2 = {};
            result.messages.forEach(function (msg) {
              _messagesMap2[msg.tid || ''] = msg;
            });
            _filteredPendingMessages2 = _pendingMessages2.filter(function (msg) {
              return !_messagesMap2[msg.tid || ''];
            });
            setPendingMessages(channel.id, _filteredPendingMessages2);
            result.messages = [].concat(result.messages, _filteredPendingMessages2);
          }

          _context7.next = 119;
          return effects.put(setMessagesAC(JSON.parse(JSON.stringify(result.messages))));

        case 119:
          setMessagesToMap(channel.id, result.messages);
          setAllMessages([].concat(result.messages));

        case 121:
          _context7.next = 123;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 123:
          _context7.next = 128;
          break;

        case 125:
          if (!channel.isMockChannel) {
            _context7.next = 128;
            break;
          }

          _context7.next = 128;
          return effects.put(setMessagesAC([]));

        case 128:
          _context7.next = 133;
          break;

        case 130:
          _context7.prev = 130;
          _context7.t0 = _context7["catch"](0);
          console.log('error in message query', _context7.t0);

        case 133:
        case "end":
          return _context7.stop();
      }
    }
  }, _marked7$1, null, [[0, 130]]);
}

function loadMoreMessages(action) {
  var payload, limit, direction, channelId, messageId, hasNext, SceytChatClient, messageQueryBuilder, messageQuery, result;
  return _regeneratorRuntime().wrap(function loadMoreMessages$(_context8) {
    while (1) {
      switch (_context8.prev = _context8.next) {
        case 0:
          _context8.prev = 0;
          payload = action.payload;
          limit = payload.limit, direction = payload.direction, channelId = payload.channelId, messageId = payload.messageId, hasNext = payload.hasNext;
          console.log('loadMoreMessages .. .. ', payload);
          SceytChatClient = getClient();
          messageQueryBuilder = new SceytChatClient.MessageListQueryBuilder(channelId);
          messageQueryBuilder.reverse(true);
          _context8.next = 9;
          return effects.call(messageQueryBuilder.build);

        case 9:
          messageQuery = _context8.sent;
          messageQuery.limit = limit || 5;
          _context8.next = 13;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 13:
          result = {
            messages: [],
            hasNext: false
          };

          if (!(direction === MESSAGE_LOAD_DIRECTION.PREV)) {
            _context8.next = 28;
            break;
          }

          if (!getHasPrevCached()) {
            _context8.next = 19;
            break;
          }

          result.messages = getFromAllMessagesByMessageId(messageId, MESSAGE_LOAD_DIRECTION.PREV);
          _context8.next = 26;
          break;

        case 19:
          if (!hasNext) {
            _context8.next = 26;
            break;
          }

          _context8.next = 22;
          return effects.call(messageQuery.loadPreviousMessageId, messageId);

        case 22:
          result = _context8.sent;

          if (result.messages.length) {
            addAllMessages(result.messages, MESSAGE_LOAD_DIRECTION.PREV);
          }

          _context8.next = 26;
          return effects.put(setMessagesHasPrevAC(result.hasNext));

        case 26:
          _context8.next = 42;
          break;

        case 28:
          if (!getHasNextCached()) {
            _context8.next = 32;
            break;
          }

          result.messages = getFromAllMessagesByMessageId(messageId, MESSAGE_LOAD_DIRECTION.NEXT);
          _context8.next = 40;
          break;

        case 32:
          if (!hasNext) {
            _context8.next = 40;
            break;
          }

          messageQuery.reverse = false;
          _context8.next = 36;
          return effects.call(messageQuery.loadNextMessageId, messageId);

        case 36:
          result = _context8.sent;

          if (result.messages.length) {
            addAllMessages(result.messages, MESSAGE_LOAD_DIRECTION.NEXT);
          }

          _context8.next = 40;
          return effects.put(setMessagesHasNextAC(result.hasNext));

        case 40:
          _context8.next = 42;
          return effects.put(setMessagesHasPrevAC(true));

        case 42:
          if (!(result.messages && result.messages.length && result.messages.length > 0)) {
            _context8.next = 47;
            break;
          }

          _context8.next = 45;
          return effects.put(addMessagesAC(result.messages, direction));

        case 45:
          _context8.next = 49;
          break;

        case 47:
          _context8.next = 49;
          return effects.put(addMessagesAC([], direction));

        case 49:
          _context8.next = 51;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 51:
          _context8.next = 56;
          break;

        case 53:
          _context8.prev = 53;
          _context8.t0 = _context8["catch"](0);
          console.log('error in load more messages', _context8.t0);

        case 56:
        case "end":
          return _context8.stop();
      }
    }
  }, _marked8$1, null, [[0, 53]]);
}

function addReaction(action) {
  var payload, channelId, messageId, key, score, reason, enforceUnique, user, channel, _yield$call, _message3, reaction, channelUpdateParam;

  return _regeneratorRuntime().wrap(function addReaction$(_context9) {
    while (1) {
      switch (_context9.prev = _context9.next) {
        case 0:
          _context9.prev = 0;
          payload = action.payload;
          channelId = payload.channelId, messageId = payload.messageId, key = payload.key, score = payload.score, reason = payload.reason, enforceUnique = payload.enforceUnique;
          user = getClient().user;
          _context9.next = 6;
          return effects.call(getChannelFromMap, channelId);

        case 6:
          channel = _context9.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context9.next = 10;
          return effects.call(channel.addReaction, messageId, key, score, reason, enforceUnique);

        case 10:
          _yield$call = _context9.sent;
          _message3 = _yield$call.message;
          reaction = _yield$call.reaction;

          if (!(user.id === _message3.user.id)) {
            _context9.next = 18;
            break;
          }

          channelUpdateParam = {
            userMessageReactions: [reaction],
            lastReactedMessage: _message3,
            newReactions: [reaction]
          };
          _context9.next = 17;
          return effects.put(updateChannelDataAC(channel.id, channelUpdateParam));

        case 17:
          updateChannelOnAllChannels(channel.id, channelUpdateParam);

        case 18:
          _context9.next = 20;
          return effects.put(addChannelAC(JSON.parse(JSON.stringify(channel))));

        case 20:
          _context9.next = 22;
          return effects.put(addReactionToListAC(reaction));

        case 22:
          _context9.next = 24;
          return effects.put(addReactionToMessageAC(_message3, reaction, true));

        case 24:
          addReactionToMessageOnMap(channelId, _message3, reaction, true);
          addReactionOnAllMessages(_message3, reaction, true);
          _context9.next = 31;
          break;

        case 28:
          _context9.prev = 28;
          _context9.t0 = _context9["catch"](0);
          console.log('ERROR in add reaction', _context9.t0.message);

        case 31:
        case "end":
          return _context9.stop();
      }
    }
  }, _marked9$1, null, [[0, 28]]);
}

function deleteReaction(action) {
  var payload, channelId, messageId, key, isLastReaction, channel, _yield$call2, _message4, reaction, channelUpdateParam;

  return _regeneratorRuntime().wrap(function deleteReaction$(_context10) {
    while (1) {
      switch (_context10.prev = _context10.next) {
        case 0:
          _context10.prev = 0;
          payload = action.payload;
          channelId = payload.channelId, messageId = payload.messageId, key = payload.key, isLastReaction = payload.isLastReaction;
          _context10.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context10.sent;

          if (!channel) {
            channel = getChannelFromAllChannels(channelId);

            if (channel) {
              setChannelInMap(channel);
            }
          }

          _context10.next = 9;
          return effects.call(channel.deleteReaction, messageId, key);

        case 9:
          _yield$call2 = _context10.sent;
          _message4 = _yield$call2.message;
          reaction = _yield$call2.reaction;

          if (!isLastReaction) {
            _context10.next = 17;
            break;
          }

          channelUpdateParam = {
            userMessageReactions: [],
            lastReactedMessage: null
          };
          _context10.next = 16;
          return effects.put(updateChannelDataAC(channel.id, channelUpdateParam));

        case 16:
          updateChannelOnAllChannels(channel.id, channelUpdateParam);

        case 17:
          console.log('message received. ... ', _message4);
          _context10.next = 20;
          return effects.put(deleteReactionFromListAC(reaction));

        case 20:
          _context10.next = 22;
          return effects.put(deleteReactionFromMessageAC(_message4, reaction, true));

        case 22:
          removeReactionToMessageOnMap(channelId, _message4, reaction, true);
          removeReactionOnAllMessages(_message4, reaction, true);
          _context10.next = 29;
          break;

        case 26:
          _context10.prev = 26;
          _context10.t0 = _context10["catch"](0);
          console.log('ERROR in delete reaction', _context10.t0.message);

        case 29:
        case "end":
          return _context10.stop();
      }
    }
  }, _marked10$1, null, [[0, 26]]);
}

function getReactions(action) {
  var payload, messageId, key, limit, SceytChatClient, reactionQueryBuilder, reactionQuery, result;
  return _regeneratorRuntime().wrap(function getReactions$(_context11) {
    while (1) {
      switch (_context11.prev = _context11.next) {
        case 0:
          _context11.prev = 0;
          payload = action.payload;
          messageId = payload.messageId, key = payload.key, limit = payload.limit;
          SceytChatClient = getClient();
          _context11.next = 6;
          return effects.put(setReactionsLoadingStateAC(LOADING_STATE.LOADING));

        case 6:
          reactionQueryBuilder = new SceytChatClient.ReactionListQueryBuilder(messageId);
          reactionQueryBuilder.limit(limit || 10);

          if (key) {
            reactionQueryBuilder.setKey(key);
          }

          _context11.next = 11;
          return effects.call(reactionQueryBuilder.build);

        case 11:
          reactionQuery = _context11.sent;
          _context11.next = 14;
          return effects.call(reactionQuery.loadNext);

        case 14:
          result = _context11.sent;
          query.ReactionsQuery = reactionQuery;
          _context11.next = 18;
          return effects.put(setReactionsListAC(result.reactions, result.hasNext));

        case 18:
          _context11.next = 20;
          return effects.put(setReactionsLoadingStateAC(LOADING_STATE.LOADED));

        case 20:
          _context11.next = 25;
          break;

        case 22:
          _context11.prev = 22;
          _context11.t0 = _context11["catch"](0);
          console.log('ERROR in get reactions', _context11.t0.message);

        case 25:
        case "end":
          return _context11.stop();
      }
    }
  }, _marked11$1, null, [[0, 22]]);
}

function loadMoreReactions(action) {
  var payload, limit, ReactionQuery, result;
  return _regeneratorRuntime().wrap(function loadMoreReactions$(_context12) {
    while (1) {
      switch (_context12.prev = _context12.next) {
        case 0:
          _context12.prev = 0;
          payload = action.payload;
          limit = payload.limit;
          _context12.next = 5;
          return effects.put(setReactionsLoadingStateAC(LOADING_STATE.LOADING));

        case 5:
          ReactionQuery = query.ReactionsQuery;

          if (limit) {
            ReactionQuery.limit = limit;
          }

          _context12.next = 9;
          return effects.call(ReactionQuery.loadNext);

        case 9:
          result = _context12.sent;
          _context12.next = 12;
          return effects.put(addReactionsToListAC(result.reactions, result.hasNext));

        case 12:
          _context12.next = 14;
          return effects.put(setReactionsLoadingStateAC(LOADING_STATE.LOADED));

        case 14:
          _context12.next = 19;
          break;

        case 16:
          _context12.prev = 16;
          _context12.t0 = _context12["catch"](0);
          console.log('ERROR in load more reactions', _context12.t0.message);

        case 19:
        case "end":
          return _context12.stop();
      }
    }
  }, _marked12$1, null, [[0, 16]]);
}

function getMessageAttachments(action) {
  var _action$payload2, channelId, attachmentType, limit, direction, attachmentId, forPopup, SceytChatClient, typeList, AttachmentByTypeQueryBuilder, AttachmentByTypeQuery, result;

  return _regeneratorRuntime().wrap(function getMessageAttachments$(_context13) {
    while (1) {
      switch (_context13.prev = _context13.next) {
        case 0:
          _context13.prev = 0;
          _action$payload2 = action.payload, channelId = _action$payload2.channelId, attachmentType = _action$payload2.attachmentType, limit = _action$payload2.limit, direction = _action$payload2.direction, attachmentId = _action$payload2.attachmentId, forPopup = _action$payload2.forPopup;
          SceytChatClient = getClient();
          typeList = [attachmentTypes.video, attachmentTypes.image, attachmentTypes.file, attachmentTypes.link, attachmentTypes.voice];

          if (attachmentType === channelDetailsTabs.media) {
            typeList = [attachmentTypes.video, attachmentTypes.image];
          } else if (attachmentType === channelDetailsTabs.file) {
            typeList = [attachmentTypes.file];
          } else if (attachmentType === channelDetailsTabs.link) {
            typeList = [attachmentTypes.link];
          } else if (attachmentType === channelDetailsTabs.voice) {
            typeList = [attachmentTypes.voice];
          }

          AttachmentByTypeQueryBuilder = new SceytChatClient.AttachmentListQueryBuilder(channelId, typeList);
          AttachmentByTypeQueryBuilder.limit(limit || 34);
          _context13.next = 9;
          return effects.call(AttachmentByTypeQueryBuilder.build);

        case 9:
          AttachmentByTypeQuery = _context13.sent;

          if (forPopup) {
            AttachmentByTypeQuery.reverse = true;
          }

          if (!(direction === queryDirection.NEXT)) {
            _context13.next = 17;
            break;
          }

          _context13.next = 14;
          return effects.call(AttachmentByTypeQuery.loadPrevious);

        case 14:
          result = _context13.sent;
          _context13.next = 26;
          break;

        case 17:
          if (!(direction === queryDirection.NEAR)) {
            _context13.next = 23;
            break;
          }

          _context13.next = 20;
          return effects.call(AttachmentByTypeQuery.loadNearMessageId, attachmentId);

        case 20:
          result = _context13.sent;
          _context13.next = 26;
          break;

        case 23:
          _context13.next = 25;
          return effects.call(AttachmentByTypeQuery.loadPrevious);

        case 25:
          result = _context13.sent;

        case 26:
          if (!forPopup) {
            _context13.next = 34;
            break;
          }

          query.AttachmentByTypeQueryForPopup = AttachmentByTypeQuery;
          _context13.next = 30;
          return effects.put(setAttachmentsForPopupAC(JSON.parse(JSON.stringify(result.attachments))));

        case 30:
          _context13.next = 32;
          return effects.put(setAttachmentsCompleteForPopupAC(result.hasNext));

        case 32:
          _context13.next = 39;
          break;

        case 34:
          query.AttachmentByTypeQuery = AttachmentByTypeQuery;
          _context13.next = 37;
          return effects.put(setAttachmentsCompleteAC(result.hasNext));

        case 37:
          _context13.next = 39;
          return effects.put(setAttachmentsAC(JSON.parse(JSON.stringify(result.attachments))));

        case 39:
          _context13.next = 44;
          break;

        case 41:
          _context13.prev = 41;
          _context13.t0 = _context13["catch"](0);
          console.log('error in message attachment query');

        case 44:
        case "end":
          return _context13.stop();
      }
    }
  }, _marked13$1, null, [[0, 41]]);
}

function loadMoreMessageAttachments(action) {
  var _action$payload3, limit, direction, forPopup, AttachmentQuery, _yield$call3, attachments, hasNext;

  return _regeneratorRuntime().wrap(function loadMoreMessageAttachments$(_context14) {
    while (1) {
      switch (_context14.prev = _context14.next) {
        case 0:
          _context14.prev = 0;
          _action$payload3 = action.payload, limit = _action$payload3.limit, direction = _action$payload3.direction, forPopup = _action$payload3.forPopup;

          if (forPopup) {
            AttachmentQuery = query.AttachmentByTypeQueryForPopup;
          } else {
            AttachmentQuery = query.AttachmentByTypeQuery;
          }

          _context14.next = 5;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADING));

        case 5:
          AttachmentQuery.limit = limit;
          _context14.next = 8;
          return effects.call(AttachmentQuery.loadPrevious);

        case 8:
          _yield$call3 = _context14.sent;
          attachments = _yield$call3.attachments;
          hasNext = _yield$call3.hasNext;

          if (!forPopup) {
            _context14.next = 16;
            break;
          }

          _context14.next = 14;
          return effects.put(addAttachmentsForPopupAC(attachments, direction));

        case 14:
          _context14.next = 22;
          break;

        case 16:
          _context14.next = 18;
          return effects.put(setAttachmentsCompleteAC(hasNext));

        case 18:
          _context14.next = 20;
          return effects.put(setMessagesLoadingStateAC(LOADING_STATE.LOADED));

        case 20:
          _context14.next = 22;
          return effects.put(addAttachmentsAC(attachments));

        case 22:
          _context14.next = 28;
          break;

        case 24:
          _context14.prev = 24;
          _context14.t0 = _context14["catch"](0);
          console.log('error in message attachment query', _context14.t0);

        case 28:
        case "end":
          return _context14.stop();
      }
    }
  }, _marked14$1, null, [[0, 24]]);
}

function pauseAttachmentUploading(action) {
  var attachmentId, isPaused;
  return _regeneratorRuntime().wrap(function pauseAttachmentUploading$(_context15) {
    while (1) {
      switch (_context15.prev = _context15.next) {
        case 0:
          _context15.prev = 0;
          attachmentId = action.payload.attachmentId;

          if (!getCustomUploader()) {
            _context15.next = 7;
            break;
          }

          isPaused = pauseUpload(attachmentId);

          if (!isPaused) {
            _context15.next = 7;
            break;
          }

          _context15.next = 7;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.PAUSED, attachmentId));

        case 7:
          _context15.next = 13;
          break;

        case 9:
          _context15.prev = 9;
          _context15.t0 = _context15["catch"](0);
          console.log('error in pause attachment uploading', _context15.t0);

        case 13:
        case "end":
          return _context15.stop();
      }
    }
  }, _marked15$1, null, [[0, 9]]);
}

function resumeAttachmentUploading(action) {
  var attachmentId, isResumed;
  return _regeneratorRuntime().wrap(function resumeAttachmentUploading$(_context16) {
    while (1) {
      switch (_context16.prev = _context16.next) {
        case 0:
          _context16.prev = 0;
          attachmentId = action.payload.attachmentId;
          console.log('resume for attachment ... ', attachmentId);

          if (!getCustomUploader()) {
            _context16.next = 8;
            break;
          }

          isResumed = resumeUpload(attachmentId);

          if (!isResumed) {
            _context16.next = 8;
            break;
          }

          _context16.next = 8;
          return effects.put(updateAttachmentUploadingStateAC(UPLOAD_STATE.UPLOADING, attachmentId));

        case 8:
          _context16.next = 14;
          break;

        case 10:
          _context16.prev = 10;
          _context16.t0 = _context16["catch"](0);
          console.log('error in resume attachment uploading', _context16.t0);

        case 14:
        case "end":
          return _context16.stop();
      }
    }
  }, _marked16$1, null, [[0, 10]]);
}

function MessageSaga() {
  return _regeneratorRuntime().wrap(function MessageSaga$(_context17) {
    while (1) {
      switch (_context17.prev = _context17.next) {
        case 0:
          _context17.next = 2;
          return effects.takeEvery(SEND_MESSAGE, sendMessage);

        case 2:
          _context17.next = 4;
          return effects.takeEvery(SEND_TEXT_MESSAGE, sendTextMessage);

        case 4:
          _context17.next = 6;
          return effects.takeEvery(FORWARD_MESSAGE, forwardMessage);

        case 6:
          _context17.next = 8;
          return effects.takeEvery(RESEND_MESSAGE, resendMessage);

        case 8:
          _context17.next = 10;
          return effects.takeLatest(EDIT_MESSAGE, editMessage);

        case 10:
          _context17.next = 12;
          return effects.takeEvery(DELETE_MESSAGE, deleteMessage);

        case 12:
          _context17.next = 14;
          return effects.takeLatest(GET_MESSAGES, getMessagesQuery);

        case 14:
          _context17.next = 16;
          return effects.takeLatest(GET_MESSAGES_ATTACHMENTS, getMessageAttachments);

        case 16:
          _context17.next = 18;
          return effects.takeLatest(LOAD_MORE_MESSAGES_ATTACHMENTS, loadMoreMessageAttachments);

        case 18:
          _context17.next = 20;
          return effects.takeLatest(ADD_REACTION, addReaction);

        case 20:
          _context17.next = 22;
          return effects.takeLatest(DELETE_REACTION, deleteReaction);

        case 22:
          _context17.next = 24;
          return effects.takeEvery(LOAD_MORE_MESSAGES, loadMoreMessages);

        case 24:
          _context17.next = 26;
          return effects.takeEvery(GET_REACTIONS, getReactions);

        case 26:
          _context17.next = 28;
          return effects.takeEvery(LOAD_MORE_REACTIONS, loadMoreReactions);

        case 28:
          _context17.next = 30;
          return effects.takeEvery(PAUSE_ATTACHMENT_UPLOADING, pauseAttachmentUploading);

        case 30:
          _context17.next = 32;
          return effects.takeEvery(RESUME_ATTACHMENT_UPLOADING, resumeAttachmentUploading);

        case 32:
        case "end":
          return _context17.stop();
      }
    }
  }, _marked17$1);
}

var _marked$3 = /*#__PURE__*/_regeneratorRuntime().mark(getMembers),
    _marked2$2 = /*#__PURE__*/_regeneratorRuntime().mark(loadMoreMembers),
    _marked3$2 = /*#__PURE__*/_regeneratorRuntime().mark(addMembers),
    _marked4$2 = /*#__PURE__*/_regeneratorRuntime().mark(kickMemberFromChannel),
    _marked5$2 = /*#__PURE__*/_regeneratorRuntime().mark(blockMember),
    _marked6$2 = /*#__PURE__*/_regeneratorRuntime().mark(changeMemberRole),
    _marked7$2 = /*#__PURE__*/_regeneratorRuntime().mark(reportMember),
    _marked8$2 = /*#__PURE__*/_regeneratorRuntime().mark(getRoles),
    _marked9$2 = /*#__PURE__*/_regeneratorRuntime().mark(MembersSaga);

function getMembers(action) {
  var payload, channelId, SceytChatClient, membersQueryBuilder, membersQuery, _yield$call, members;

  return _regeneratorRuntime().wrap(function getMembers$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.prev = 0;
          payload = action.payload;
          channelId = payload.channelId;
          SceytChatClient = getClient();
          membersQueryBuilder = new SceytChatClient.MemberListQueryBuilder(channelId);
          membersQueryBuilder.all().byAffiliationOrder().orderKeyByUsername().limit(50);
          _context.next = 8;
          return effects.call(membersQueryBuilder.build);

        case 8:
          membersQuery = _context.sent;
          query.membersQuery = membersQuery;
          _context.next = 12;
          return effects.put(setMembersLoadingStateAC(LOADING_STATE.LOADING));

        case 12:
          _context.next = 14;
          return effects.call(membersQuery.loadNextPage);

        case 14:
          _yield$call = _context.sent;
          members = _yield$call.members;
          _context.next = 18;
          return effects.put(setMembersToListAC(members));

        case 18:
          _context.next = 20;
          return effects.put(setMembersLoadingStateAC(LOADING_STATE.LOADED));

        case 20:
          _context.next = 26;
          break;

        case 22:
          _context.prev = 22;
          _context.t0 = _context["catch"](0);
          console.log('ERROR in get members - ', _context.t0.message);

        case 26:
        case "end":
          return _context.stop();
      }
    }
  }, _marked$3, null, [[0, 22]]);
}

function loadMoreMembers(action) {
  var payload, limit, membersQuery, _yield$call2, members;

  return _regeneratorRuntime().wrap(function loadMoreMembers$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          _context2.prev = 0;
          payload = action.payload;
          limit = payload.limit;
          membersQuery = query.membersQuery;

          if (limit && membersQuery) {
            membersQuery.limit = limit;
          }

          _context2.next = 7;
          return effects.put(setMembersLoadingStateAC(LOADING_STATE.LOADING));

        case 7:
          _context2.next = 9;
          return effects.call(membersQuery.loadNextPage);

        case 9:
          _yield$call2 = _context2.sent;
          members = _yield$call2.members;
          _context2.next = 13;
          return effects.put(addMembersToListAC(members));

        case 13:
          _context2.next = 15;
          return effects.put(setMembersLoadingStateAC(LOADING_STATE.LOADED));

        case 15:
          _context2.next = 20;
          break;

        case 17:
          _context2.prev = 17;
          _context2.t0 = _context2["catch"](0);

        case 20:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2$2, null, [[0, 17]]);
}

function addMembers(action) {
  var payload, members, channelId, channel, membersToAdd, addedMembers, membersIds, messageToSend;
  return _regeneratorRuntime().wrap(function addMembers$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          _context3.prev = 0;
          payload = action.payload;
          members = payload.members, channelId = payload.channelId;
          _context3.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context3.sent;

          if (!channel) {
            _context3.next = 22;
            break;
          }

          membersToAdd = members.map(function (mem) {
            var memberBuilder = channel.createMemberBuilder(mem.id);
            return memberBuilder.setRole(mem.role).create();
          });
          _context3.next = 10;
          return effects.call(channel.addMembers, membersToAdd);

        case 10:
          addedMembers = _context3.sent;

          if (!(channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE)) {
            _context3.next = 17;
            break;
          }

          membersIds = [];
          addedMembers.forEach(function (mem) {
            membersIds.push(mem.id);
          });
          messageToSend = {
            metadata: {
              m: membersIds
            },
            body: 'AM',
            mentionedMembers: [],
            attachments: [],
            type: 'system'
          };
          _context3.next = 17;
          return effects.put(sendTextMessageAC(messageToSend, channelId, CONNECTION_STATUS.CONNECTED));

        case 17:
          _context3.next = 19;
          return effects.put(addMembersToListAC(addedMembers));

        case 19:
          updateChannelOnAllChannels(channel.id, {
            memberCount: channel.memberCount + addedMembers.length
          });
          _context3.next = 22;
          return effects.put(updateChannelDataAC(channel.id, {
            memberCount: channel.memberCount + addedMembers.length
          }));

        case 22:
          _context3.next = 27;
          break;

        case 24:
          _context3.prev = 24;
          _context3.t0 = _context3["catch"](0);
          console.log('error on add members... ', _context3.t0);

        case 27:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked3$2, null, [[0, 24]]);
}

function kickMemberFromChannel(action) {
  var payload, memberId, channelId, channel, removedMembers, membersIds, messageToSend;
  return _regeneratorRuntime().wrap(function kickMemberFromChannel$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          _context4.prev = 0;
          payload = action.payload;
          memberId = payload.memberId, channelId = payload.channelId;
          _context4.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context4.sent;
          _context4.next = 8;
          return effects.call(channel.kickMembers, [memberId]);

        case 8:
          removedMembers = _context4.sent;

          if (!(channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE)) {
            _context4.next = 15;
            break;
          }

          membersIds = [];
          removedMembers.forEach(function (mem) {
            membersIds.push(mem.id);
          });
          messageToSend = {
            metadata: {
              m: membersIds
            },
            body: 'RM',
            mentionedMembers: [],
            attachments: [],
            type: 'system'
          };
          _context4.next = 15;
          return effects.put(sendTextMessageAC(messageToSend, channelId, CONNECTION_STATUS.CONNECTED));

        case 15:
          _context4.next = 17;
          return effects.put(removeMemberFromListAC(removedMembers));

        case 17:
          updateChannelOnAllChannels(channel.id, {
            memberCount: channel.memberCount - removedMembers.length
          });
          _context4.next = 20;
          return effects.put(updateChannelDataAC(channel.id, {
            memberCount: channel.memberCount - removedMembers.length
          }));

        case 20:
          _context4.next = 24;
          break;

        case 22:
          _context4.prev = 22;
          _context4.t0 = _context4["catch"](0);

        case 24:
        case "end":
          return _context4.stop();
      }
    }
  }, _marked4$2, null, [[0, 22]]);
}

function blockMember(action) {
  var payload, memberId, channelId, channel, removedMembers;
  return _regeneratorRuntime().wrap(function blockMember$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          _context5.prev = 0;
          payload = action.payload;
          memberId = payload.memberId, channelId = payload.channelId;
          _context5.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context5.sent;
          _context5.next = 8;
          return effects.call(channel.blockMembers, [memberId]);

        case 8:
          removedMembers = _context5.sent;
          _context5.next = 11;
          return effects.put(removeMemberFromListAC(removedMembers));

        case 11:
          updateChannelOnAllChannels(channel.id, {
            memberCount: channel.memberCount - removedMembers.length
          });
          _context5.next = 14;
          return effects.put(updateChannelDataAC(channel.id, {
            memberCount: channel.memberCount - removedMembers.length
          }));

        case 14:
          _context5.next = 18;
          break;

        case 16:
          _context5.prev = 16;
          _context5.t0 = _context5["catch"](0);

        case 18:
        case "end":
          return _context5.stop();
      }
    }
  }, _marked5$2, null, [[0, 16]]);
}

function changeMemberRole(action) {
  var payload, channelId, members, channel, updatedMembers;
  return _regeneratorRuntime().wrap(function changeMemberRole$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          _context6.prev = 0;
          payload = action.payload;
          channelId = payload.channelId, members = payload.members;
          _context6.next = 5;
          return effects.call(getChannelFromMap, channelId);

        case 5:
          channel = _context6.sent;
          _context6.next = 8;
          return effects.call(channel.changeMembersRole, members);

        case 8:
          updatedMembers = _context6.sent;
          _context6.next = 11;
          return effects.put(updateMembersAC(updatedMembers));

        case 11:
          _context6.next = 16;
          break;

        case 13:
          _context6.prev = 13;
          _context6.t0 = _context6["catch"](0);
          console.log('error in change member role');

        case 16:
        case "end":
          return _context6.stop();
      }
    }
  }, _marked6$2, null, [[0, 13]]);
}

function reportMember(action) {
  var reportData, SceytChatClient;
  return _regeneratorRuntime().wrap(function reportMember$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          reportData = action.payload.reportData;
          SceytChatClient = getClient();
          _context7.prev = 2;
          _context7.next = 5;
          return effects.call(SceytChatClient.userReport, reportData.reportReason, reportData.userId, reportData.messageIds, reportData.reportDescription);

        case 5:
          _context7.next = 10;
          break;

        case 7:
          _context7.prev = 7;
          _context7.t0 = _context7["catch"](2);
          console.log('ERROR report user', _context7.t0.message);

        case 10:
        case "end":
          return _context7.stop();
      }
    }
  }, _marked7$2, null, [[2, 7]]);
}

function getRoles(action) {
  var _action$payload, timeout, attempts, SceytChatClient, roles;

  return _regeneratorRuntime().wrap(function getRoles$(_context8) {
    while (1) {
      switch (_context8.prev = _context8.next) {
        case 0:
          _action$payload = action.payload, timeout = _action$payload.timeout, attempts = _action$payload.attempts;
          _context8.prev = 1;
          SceytChatClient = getClient();
          _context8.next = 5;
          return effects.call(SceytChatClient.getRoles);

        case 5:
          roles = _context8.sent;
          _context8.next = 8;
          return effects.put(getRolesSuccess(roles));

        case 8:
          _context8.next = 10;
          return effects.put(getRolesFailAC());

        case 10:
          _context8.next = 17;
          break;

        case 12:
          _context8.prev = 12;
          _context8.t0 = _context8["catch"](1);
          console.log('ERROR get roles', _context8.t0);
          _context8.next = 17;
          return effects.put(getRolesFailAC((timeout || 0) + 300, (attempts || 0) + 1));

        case 17:
        case "end":
          return _context8.stop();
      }
    }
  }, _marked8$2, null, [[1, 12]]);
}

function MembersSaga() {
  return _regeneratorRuntime().wrap(function MembersSaga$(_context9) {
    while (1) {
      switch (_context9.prev = _context9.next) {
        case 0:
          _context9.next = 2;
          return effects.takeLatest(GET_MEMBERS, getMembers);

        case 2:
          _context9.next = 4;
          return effects.takeEvery(LOAD_MORE_MEMBERS, loadMoreMembers);

        case 4:
          _context9.next = 6;
          return effects.takeEvery(ADD_MEMBERS, addMembers);

        case 6:
          _context9.next = 8;
          return effects.takeEvery(KICK_MEMBER, kickMemberFromChannel);

        case 8:
          _context9.next = 10;
          return effects.takeEvery(BLOCK_MEMBER, blockMember);

        case 10:
          _context9.next = 12;
          return effects.takeEvery(REPORT_MEMBER, reportMember);

        case 12:
          _context9.next = 14;
          return effects.takeEvery(CHANGE_MEMBER_ROLE, changeMemberRole);

        case 14:
          _context9.next = 16;
          return effects.takeLatest(GET_ROLES, getRoles);

        case 16:
        case "end":
          return _context9.stop();
      }
    }
  }, _marked9$2);
}

var _marked$4 = /*#__PURE__*/_regeneratorRuntime().mark(getContacts),
    _marked2$3 = /*#__PURE__*/_regeneratorRuntime().mark(blockUser),
    _marked3$3 = /*#__PURE__*/_regeneratorRuntime().mark(unblockUser),
    _marked4$3 = /*#__PURE__*/_regeneratorRuntime().mark(updateProfile),
    _marked5$3 = /*#__PURE__*/_regeneratorRuntime().mark(getUsers),
    _marked6$3 = /*#__PURE__*/_regeneratorRuntime().mark(loadMoreUsers),
    _marked7$3 = /*#__PURE__*/_regeneratorRuntime().mark(MembersSaga$1);

function getContacts() {
  var SceytChatClient, contactsData;
  return _regeneratorRuntime().wrap(function getContacts$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.prev = 0;
          SceytChatClient = getClient();
          _context.next = 4;
          return effects.call(SceytChatClient.getAllContacts);

        case 4:
          contactsData = _context.sent;
          _context.next = 7;
          return effects.put(setContactsAC(JSON.parse(JSON.stringify(contactsData))));

        case 7:
          _context.next = 9;
          return effects.put(setContactsLoadingStateAC(LOADING_STATE.LOADED));

        case 9:
          _context.next = 15;
          break;

        case 11:
          _context.prev = 11;
          _context.t0 = _context["catch"](0);
          console.log('ERROR in get contacts - :', _context.t0.message);

        case 15:
        case "end":
          return _context.stop();
      }
    }
  }, _marked$4, null, [[0, 11]]);
}

function blockUser(action) {
  var SceytChatClient, payload, userIds, blockedUsers, activeChannelId, activeChannel, isDirectChannel, directChannelUser;
  return _regeneratorRuntime().wrap(function blockUser$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          _context2.prev = 0;
          SceytChatClient = getClient();
          payload = action.payload;
          userIds = payload.userIds;
          _context2.next = 6;
          return effects.call(SceytChatClient.blockUsers, userIds);

        case 6:
          blockedUsers = _context2.sent;
          _context2.next = 9;
          return effects.call(getActiveChannelId);

        case 9:
          activeChannelId = _context2.sent;
          _context2.next = 12;
          return effects.call(getChannelFromMap, activeChannelId);

        case 12:
          activeChannel = _context2.sent;
          isDirectChannel = activeChannel.type === CHANNEL_TYPE.DIRECT;
          directChannelUser = isDirectChannel && activeChannel.members.find(function (member) {
            return member.id !== SceytChatClient.user.id;
          });

          if (!(directChannelUser && directChannelUser.id === blockedUsers[0].id)) {
            _context2.next = 19;
            break;
          }

          _context2.next = 18;
          return effects.put(updateChannelDataAC(activeChannelId, {
            members: activeChannel.members.map(function (member) {
              if (member.id === blockedUsers[0].id) {
                return blockedUsers[0];
              } else {
                return member;
              }
            })
          }));

        case 18:
          updateChannelOnAllChannels(activeChannelId, {
            members: activeChannel.members.map(function (member) {
              if (member.id === blockedUsers[0].id) {
                return blockedUsers[0];
              } else {
                return member;
              }
            })
          });

        case 19:
          _context2.next = 24;
          break;

        case 21:
          _context2.prev = 21;
          _context2.t0 = _context2["catch"](0);
          console.log('error in block users', _context2.t0.message);

        case 24:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2$3, null, [[0, 21]]);
}

function unblockUser(action) {
  var SceytChatClient, payload, userIds, unblockedUsers, activeChannelId, activeChannel, isDirectChannel, directChannelUser;
  return _regeneratorRuntime().wrap(function unblockUser$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          _context3.prev = 0;
          SceytChatClient = getClient();
          payload = action.payload;
          userIds = payload.userIds;
          _context3.next = 6;
          return effects.call(SceytChatClient.unblockUsers, userIds);

        case 6:
          unblockedUsers = _context3.sent;
          _context3.next = 9;
          return effects.call(getActiveChannelId);

        case 9:
          activeChannelId = _context3.sent;
          _context3.next = 12;
          return effects.call(getChannelFromMap, activeChannelId);

        case 12:
          activeChannel = _context3.sent;
          isDirectChannel = activeChannel.type === CHANNEL_TYPE.DIRECT;
          directChannelUser = isDirectChannel && activeChannel.members.find(function (member) {
            return member.id !== SceytChatClient.user.id;
          });

          if (!(directChannelUser && directChannelUser.id === unblockedUsers[0].id)) {
            _context3.next = 19;
            break;
          }

          _context3.next = 18;
          return effects.put(updateChannelDataAC(activeChannelId, {
            members: activeChannel.members.map(function (member) {
              if (member.id === unblockedUsers[0].id) {
                return unblockedUsers[0];
              } else {
                return member;
              }
            })
          }));

        case 18:
          updateChannelOnAllChannels(activeChannelId, {
            members: activeChannel.members.map(function (member) {
              if (member.id === unblockedUsers[0].id) {
                return unblockedUsers[0];
              } else {
                return member;
              }
            })
          });

        case 19:
          _context3.next = 24;
          break;

        case 21:
          _context3.prev = 21;
          _context3.t0 = _context3["catch"](0);
          console.log('error in unblock users', _context3.t0.message);

        case 24:
        case "end":
          return _context3.stop();
      }
    }
  }, _marked3$3, null, [[0, 21]]);
}

function updateProfile(action) {
  var payload, user, firstName, lastName, avatarUrl, metadata, avatarFile, updateUserProfileData, SceytChatClient, fileToUpload, updatedUser;
  return _regeneratorRuntime().wrap(function updateProfile$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          _context4.prev = 0;
          payload = action.payload;
          user = payload.user, firstName = payload.firstName, lastName = payload.lastName, avatarUrl = payload.avatarUrl, metadata = payload.metadata, avatarFile = payload.avatarFile;
          updateUserProfileData = {};
          SceytChatClient = getClient();

          if (!avatarFile) {
            _context4.next = 12;
            break;
          }

          fileToUpload = {
            data: avatarFile,
            progress: function progress(progressPercent) {
              console.log('upload percent - ', progressPercent);
            }
          };
          _context4.next = 9;
          return effects.call(SceytChatClient.uploadFile, fileToUpload);

        case 9:
          updateUserProfileData.avatarUrl = _context4.sent;
          _context4.next = 13;
          break;

        case 12:
          if (avatarUrl && user.avatarUrl !== avatarUrl) {
            updateUserProfileData.avatarUrl = avatarUrl;
          }

        case 13:
          if (firstName && user.firstName !== firstName) {
            updateUserProfileData.firstName = firstName;
          }

          if (lastName && user.lastName !== lastName) {
            updateUserProfileData.lastName = lastName;
          }

          if (user.metadata !== metadata) {
            updateUserProfileData.metadata = metadata;
          }

          _context4.next = 18;
          return effects.call(SceytChatClient.setProfile, updateUserProfileData);

        case 18:
          updatedUser = _context4.sent;
          _context4.next = 21;
          return effects.put(updateUserProfileAC(_extends({}, updatedUser)));

        case 21:
          _context4.next = 26;
          break;

        case 23:
          _context4.prev = 23;
          _context4.t0 = _context4["catch"](0);
          console.log(_context4.t0, 'Error on update user');

        case 26:
        case "end":
          return _context4.stop();
      }
    }
  }, _marked4$3, null, [[0, 23]]);
}

function getUsers(action) {
  var payload, params, SceytChatClient, usersQueryBuilder, usersQuery, _yield$call, users;

  return _regeneratorRuntime().wrap(function getUsers$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          _context5.prev = 0;
          payload = action.payload;
          params = payload.params;
          SceytChatClient = getClient();
          usersQueryBuilder = new SceytChatClient.UserListQueryBuilder();

          if (params.query) {
            usersQueryBuilder.query(params.query);
          }

          if (params.limit) {
            usersQueryBuilder.limit(params.limit);
          }

          if (params.order === 'firstname') {
            usersQueryBuilder.orderByFirstname();
          }

          if (params.order === 'lastname') {
            usersQueryBuilder.orderByLastname();
          }

          if (params.order === 'username') {
            usersQueryBuilder.orderByUsername();
          }

          if (params.filter === 'all') {
            usersQueryBuilder.filterByAll();
          }

          if (params.filter === 'firstname') {
            usersQueryBuilder.filterByFirstname();
          }

          if (params.filter === 'lastname') {
            usersQueryBuilder.filterByLastname();
          }

          if (params.filter === 'username') {
            usersQueryBuilder.filterByUsername();
          }

          console.log('user query params ..... ', params);
          _context5.next = 17;
          return effects.call(usersQueryBuilder.build);

        case 17:
          usersQuery = _context5.sent;
          query.usersQuery = usersQuery;
          _context5.next = 21;
          return effects.put(setUsersLoadingStateAC(LOADING_STATE.LOADING));

        case 21:
          _context5.next = 23;
          return effects.call(usersQuery.loadNextPage);

        case 23:
          _yield$call = _context5.sent;
          users = _yield$call.users;
          _context5.next = 27;
          return effects.put(setUsersAC(users));

        case 27:
          _context5.next = 29;
          return effects.put(setUsersLoadingStateAC(LOADING_STATE.LOADED));

        case 29:
          _context5.next = 35;
          break;

        case 31:
          _context5.prev = 31;
          _context5.t0 = _context5["catch"](0);
          console.log('ERROR on get users', _context5.t0.message);

        case 35:
        case "end":
          return _context5.stop();
      }
    }
  }, _marked5$3, null, [[0, 31]]);
}

function loadMoreUsers(action) {
  var payload, limit, usersQuery, _yield$call2, users;

  return _regeneratorRuntime().wrap(function loadMoreUsers$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          _context6.prev = 0;
          payload = action.payload;
          limit = payload.limit;
          usersQuery = query.usersQuery;

          if (limit) {
            usersQuery.limit = limit;
          }

          _context6.next = 7;
          return effects.put(setUsersLoadingStateAC(LOADING_STATE.LOADING));

        case 7:
          _context6.next = 9;
          return effects.call(usersQuery.loadNextPage);

        case 9:
          _yield$call2 = _context6.sent;
          users = _yield$call2.users;
          _context6.next = 13;
          return effects.put(addUsersAC(users));

        case 13:
          _context6.next = 15;
          return effects.put(setUsersLoadingStateAC(LOADING_STATE.LOADED));

        case 15:
          _context6.next = 21;
          break;

        case 17:
          _context6.prev = 17;
          _context6.t0 = _context6["catch"](0);
          console.log('ERROR load more users', _context6.t0.message);

        case 21:
        case "end":
          return _context6.stop();
      }
    }
  }, _marked6$3, null, [[0, 17]]);
}

function MembersSaga$1() {
  return _regeneratorRuntime().wrap(function MembersSaga$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          _context7.next = 2;
          return effects.takeLatest(GET_CONTACTS, getContacts);

        case 2:
          _context7.next = 4;
          return effects.takeLatest(GET_USERS, getUsers);

        case 4:
          _context7.next = 6;
          return effects.takeLatest(LOAD_MORE_USERS, loadMoreUsers);

        case 6:
          _context7.next = 8;
          return effects.takeLatest(BLOCK_USERS, blockUser);

        case 8:
          _context7.next = 10;
          return effects.takeLatest(UNBLOCK_USERS, unblockUser);

        case 10:
          _context7.next = 12;
          return effects.takeLatest(UPDATE_PROFILE, updateProfile);

        case 12:
        case "end":
          return _context7.stop();
      }
    }
  }, _marked7$3);
}

var _marked$5 = /*#__PURE__*/_regeneratorRuntime().mark(rootSaga);
function rootSaga() {
  return _regeneratorRuntime().wrap(function rootSaga$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return effects.all([ChannelsSaga(), MessageSaga(), MembersSaga(), MembersSaga$1()]);

        case 2:
        case "end":
          return _context.stop();
      }
    }
  }, _marked$5);
}

var sagaMiddleware = createSagaMiddleware__default();
var store = configureStore({
  reducer: reducers,
  middleware: function middleware(getDefaultMiddleware) {
    return getDefaultMiddleware({
      thunk: false,
      serializableCheck: false
    }).concat(sagaMiddleware);
  },
  devTools: process.env.NODE_ENV !== 'production'
});
sagaMiddleware.run(rootSaga);

var channelsSelector = function channelsSelector(store) {
  return store.ChannelReducer.channels;
};
var searchedChannelsSelector = function searchedChannelsSelector(store) {
  return store.ChannelReducer.searchedChannels;
};
var searchedChannelsForForwardSelector = function searchedChannelsForForwardSelector(store) {
  return store.ChannelReducer.searchedChannelsForForward;
};
var closeSearchChannelSelector = function closeSearchChannelSelector(store) {
  return store.ChannelReducer.closeSearchChannel;
};
var channelsForForwardSelector = function channelsForForwardSelector(store) {
  return store.ChannelReducer.channelsForForward;
};
var deletedChannelSelector = function deletedChannelSelector(store) {
  return store.ChannelReducer.deletedChannel;
};
var addedChannelSelector = function addedChannelSelector(store) {
  return store.ChannelReducer.addedChannel;
};
var addedToChannelSelector = function addedToChannelSelector(store) {
  return store.ChannelReducer.addedToChannel;
};
var hiddenChannelSelector = function hiddenChannelSelector(store) {
  return store.ChannelReducer.hiddenChannel;
};
var visibleChannelSelector = function visibleChannelSelector(store) {
  return store.ChannelReducer.visibleChannel;
};
var activeChannelSelector = function activeChannelSelector(store) {
  return store.ChannelReducer.activeChannel;
};
var channelsLoadingState = function channelsLoadingState(store) {
  return store.ChannelReducer.channelsLoadingState;
};
var channelsLoadingStateForForwardSelector = function channelsLoadingStateForForwardSelector(store) {
  return store.ChannelReducer.channelsForForwardLoadingState;
};
var channelsHasNextSelector = function channelsHasNextSelector(store) {
  return store.ChannelReducer.channelsHasNext;
};
var channelsForForwardHasNextSelector = function channelsForForwardHasNextSelector(store) {
  return store.ChannelReducer.channelsForForwardHasNext;
};
var channelInfoIsOpenSelector = function channelInfoIsOpenSelector(store) {
  return store.ChannelReducer.channelInfoIsOpen;
};
var channelEditModeSelector = function channelEditModeSelector(store) {
  return store.ChannelReducer.channelEditMode;
};
var typingIndicatorSelector = function typingIndicatorSelector(channelId) {
  return function (store) {
    return store.ChannelReducer.typingIndicator[channelId];
  };
};
var channelListWidthSelector = function channelListWidthSelector(store) {
  return store.ChannelReducer.channelListWidth;
};
var channelListHiddenSelector = function channelListHiddenSelector(store) {
  return store.ChannelReducer.hideChannelList;
};
var isDraggingSelector = function isDraggingSelector(store) {
  return store.ChannelReducer.isDragging;
};
var draggedAttachmentsSelector = function draggedAttachmentsSelector(store) {
  return store.ChannelReducer.draggedAttachments;
};
var tabIsActiveSelector = function tabIsActiveSelector(store) {
  return store.ChannelReducer.tabIsActive;
};
var channelMessageDraftIsRemovedSelector = function channelMessageDraftIsRemovedSelector(store) {
  return store.ChannelReducer.draftIsRemoved;
};

function setThemeAC(theme) {
  return {
    type: SET_THEME,
    payload: {
      theme: theme
    }
  };
}

var useDidUpdate = function useDidUpdate(callback, deps) {
  var hasMount = React.useRef(false);
  React.useEffect(function () {
    if (hasMount.current) {
      callback();
    } else {
      hasMount.current = true;
    }
  }, deps);
};

var useEventListener = function useEventListener(eventName, handler, element, options) {
  if (options === void 0) {
    options = {};
  }

  var isBrowser = typeof window !== 'undefined';

  if (isBrowser && !element) {
    element = window;
  } else {
    element = global;
  }

  var savedHandler = React.useRef();
  var _options = options,
      capture = _options.capture,
      passive = _options.passive,
      once = _options.once;
  React.useLayoutEffect(function () {
    savedHandler.current = handler;
  }, [handler]);
  React.useLayoutEffect(function () {
    var isSupported = element && element.addEventListener;

    if (!isSupported) {
      return;
    }

    var eventListener = function eventListener(event) {
      return savedHandler.current(event);
    };

    var opts = {
      capture: capture,
      passive: passive,
      once: once
    };
    element.addEventListener(eventName, eventListener, opts);
    return function () {
      return element.removeEventListener(eventName, eventListener, opts);
    };
  }, [eventName, element, capture, passive, once]);
};

var useStateComplex = function useStateComplex(initialState) {
  var _useState = React.useState(initialState),
      state = _useState[0],
      setState = _useState[1];

  return [state, function (value) {
    setState(function (prevState) {
      return _extends({}, prevState, value);
    });
  }];
};

var activeChannelMembersSelector = function activeChannelMembersSelector(store) {
  return store.MembersReducer.activeChannelMembers;
};
var rolesSelector = function rolesSelector(store) {
  return store.MembersReducer.roles;
};
var getRolesFailSelector = function getRolesFailSelector(store) {
  return store.MembersReducer.getRolesFail;
};
var rolesMapSelector = function rolesMapSelector(store) {
  return store.MembersReducer.rolesMap;
};
var membersLoadingStateSelector = function membersLoadingStateSelector(store) {
  return store.MembersReducer.membersLoadingState;
};

var _templateObject$2, _templateObject2$2;

var SceytChat = function SceytChat(_ref) {
  var client = _ref.client,
      theme = _ref.theme,
      avatarColors = _ref.avatarColors,
      children = _ref.children,
      showOnlyContactUsers = _ref.showOnlyContactUsers,
      logoSrc = _ref.logoSrc,
      CustomUploader = _ref.CustomUploader,
      handleNewMessages = _ref.handleNewMessages,
      sendAttachmentsAsSeparateMessages = _ref.sendAttachmentsAsSeparateMessages,
      membersDisplayTextByChannelTypesMap = _ref.membersDisplayTextByChannelTypesMap,
      defaultRolesByChannelTypesMap = _ref.defaultRolesByChannelTypesMap,
      customColors = _ref.customColors,
      hideUserPresence = _ref.hideUserPresence,
      showNotifications = _ref.showNotifications;
  var dispatch = reactRedux.useDispatch();
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var draggingSelector = reactRedux.useSelector(isDraggingSelector, reactRedux.shallowEqual);
  var channelsListWidth = reactRedux.useSelector(channelListWidthSelector, reactRedux.shallowEqual);
  var getRolesFail = reactRedux.useSelector(getRolesFailSelector, reactRedux.shallowEqual);

  var _useState = React.useState(false),
      darkTheme = _useState[0],
      setDarkTheme = _useState[1];

  var _useState2 = React.useState(null),
      SceytChatClient = _useState2[0],
      setSceytChatClient = _useState2[1];

  var _useState3 = React.useState(true),
      tabIsActive = _useState3[0],
      setTabIsActive = _useState3[1];

  var hidden = null;
  var visibilityChange = null;

  if (typeof document.hidden !== 'undefined') {
    hidden = 'hidden';
    visibilityChange = 'visibilitychange';
  } else if (typeof document.msHidden !== 'undefined') {
    hidden = 'msHidden';
    visibilityChange = 'msvisibilitychange';
  } else if (typeof document.webkitHidden !== 'undefined') {
    hidden = 'webkitHidden';
    visibilityChange = 'webkitvisibilitychange';
  }

  var handleDropFile = function handleDropFile(e) {
    e.preventDefault();
    e.stopPropagation();
    dispatch(setIsDraggingAC(false));
  };

  var handleDragOver = function handleDragOver(e) {
    e.preventDefault();

    if (!draggingSelector) {
      dispatch(setIsDraggingAC(true));
    }
  };

  var handleVisibilityChange = function handleVisibilityChange() {
    if (document[hidden]) {
      setTabIsActive(false);
      dispatch(browserTabIsActiveAC(false));
    } else {
      setTabIsActive(true);
      dispatch(browserTabIsActiveAC(true));
    }
  };

  React.useEffect(function () {
    console.log('client is changed.... ', client);

    if (client) {
      setClient(client);
      setSceytChatClient(client);
      dispatch(setUserAC(client.user));
      dispatch(watchForEventsAC());
      dispatch(setConnectionStatusAC(client.connectionState));

      if (showOnlyContactUsers) {
        dispatch(getContactsAC());
      }

      dispatch(getRolesAC());
    } else {
      console.log('clearing all data  1 ....');
      clearMessagesMap();
      removeAllMessages();
      setActiveChannelId('');
      destroyChannelsMap();
      dispatch(destroySession());
    }

    window.onblur = function () {
      setTabIsActive(false);
    };

    window.onfocus = function () {
      setTabIsActive(true);
    };

    return function () {
      clearMessagesMap();
      removeAllMessages();
      setActiveChannelId('');
      destroyChannelsMap();
      dispatch(destroySession());
    };
  }, [client]);
  React.useEffect(function () {
    if (CustomUploader) {
      setCustomUploader(CustomUploader);
    }

    if (membersDisplayTextByChannelTypesMap) {
      setChannelTypesMemberDisplayTextMap(membersDisplayTextByChannelTypesMap);
    }

    if (defaultRolesByChannelTypesMap) {
      setDefaultRolesByChannelTypesMap(defaultRolesByChannelTypesMap);
    }

    if (handleNewMessages) {
      setHandleNewMessages(handleNewMessages);
    }

    if (customColors) {
      if (customColors.primaryColor) {
        colors.primary = customColors.primaryColor;
      }

      if (customColors.primaryLight) {
        colors.primaryLight = customColors.primaryLight;
      }

      if (customColors.textColor1) {
        colors.textColor1 = customColors.textColor1;
      }

      if (customColors.textColor2) {
        colors.textColor2 = customColors.textColor2;
      }

      if (customColors.textColor3) {
        colors.textColor3 = customColors.textColor3;
      }

      if (customColors.defaultAvatarBackground) {
        colors.defaultAvatarBackground = customColors.defaultAvatarBackground;
      }

      if (customColors.deletedUserAvatarBackground) {
        colors.deleteUserIconBackground = customColors.deletedUserAvatarBackground;
      }
    }

    if (sendAttachmentsAsSeparateMessages) {
      setSendAttachmentsAsSeparateMessages(sendAttachmentsAsSeparateMessages);
    }

    if (logoSrc) {
      setNotificationLogoSrc(logoSrc);
    }

    setShowNotifications(showNotifications);

    if (avatarColors) {
      setAvatarColor(avatarColors);
    }

    if (showOnlyContactUsers) {
      setShowOnlyContactUsers(showOnlyContactUsers);
    }

    if (showNotifications) {
      try {
        if (window.Notification && Notification.permission === 'default') {
          Promise.resolve(Notification.requestPermission()).then(function (permission) {
            console.log('permission:', permission);
          });
        }
      } catch (e) {
        console.error('safari Notification request permission', e);
      }

      window.sceytTabNotifications = null;
      window.sceytTabUrl = window.location.href;
    }

    document.addEventListener(visibilityChange, handleVisibilityChange, false);
    return function () {
      document.removeEventListener(visibilityChange, handleVisibilityChange);
    };
  }, [customColors]);
  React.useEffect(function () {
    dispatch(setTabIsActiveAC(tabIsActive));

    if (tabIsActive && showNotifications) {
      if (window.sceytTabNotifications) {
        window.sceytTabNotifications.close();
      }
    }
  }, [tabIsActive]);
  useDidUpdate(function () {
    if (theme === THEME.DARK) {
      dispatch(setThemeAC(THEME.DARK));
      colors.primary = colors.darkModePrimary;
      colors.textColor1 = colors.darkModeTextColor1;
      colors.primaryLight = colors.darkModePrimaryLight;
      colors.backgroundColor = colors.darkModeBackgroundColor;
      colors.hoverBackgroundColor = colors.darkModeHoverBackgroundColor;
      setDarkTheme(true);
    } else {
      dispatch(setThemeAC(THEME.LIGHT));
      colors.primary = colors.lightModePrimary;
      colors.textColor1 = colors.lightModeTextColor1;
      colors.primaryLight = colors.lightModePrimaryLight;
      colors.backgroundColor = colors.lightModeBackgroundColor;
      colors.hoverBackgroundColor = colors.lightModeHoverBackgroundColor;
      setDarkTheme(false);
    }
  }, [theme]);
  useDidUpdate(function () {
    if (getRolesFail) {
      console.log('getRolesFail ... ', getRolesFail);
    }

    if (getRolesFail && getRolesFail.attempts <= 5) {
      setTimeout(function () {
        dispatch(getRolesAC(getRolesFail.timeout, getRolesFail.attempts));
      }, getRolesFail.timeout);
    }
  }, [getRolesFail]);
  React.useEffect(function () {
    if (hideUserPresence) {
      setHideUserPresence(hideUserPresence);
    }

    if (contactsMap) {
      setContactsMap(contactsMap);
    }
  }, [contactsMap]);
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, SceytChatClient ? /*#__PURE__*/React__default.createElement(ChatContainer, {
    onDrop: handleDropFile,
    onDragOver: handleDragOver,
    withChannelsList: channelsListWidth && channelsListWidth > 0,
    backgroundColor: darkTheme ? colors.dark : colors.white,
    id: 'sceyt_chat_container'
  }, children) : '');
};
var Container = styled__default.div(_templateObject$2 || (_templateObject$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: 100vh;\n"])));
var ChatContainer = styled__default.div(_templateObject2$2 || (_templateObject2$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: 100%;\n  max-height: 100vh;\n  min-width: ", ";\n  background-color: ", ";\n"])), function (props) {
  return props.withChannelsList && '1200px';
}, function (props) {
  return props.backgroundColor || colors.white;
});

var SceytChatContainer = function SceytChatContainer(_ref) {
  var client = _ref.client,
      theme = _ref.theme,
      avatarColors = _ref.avatarColors,
      children = _ref.children,
      showOnlyContactUsers = _ref.showOnlyContactUsers,
      handleNewMessages = _ref.handleNewMessages,
      sendAttachmentsAsSeparateMessages = _ref.sendAttachmentsAsSeparateMessages,
      membersDisplayTextByChannelTypesMap = _ref.membersDisplayTextByChannelTypesMap,
      defaultRolesByChannelTypesMap = _ref.defaultRolesByChannelTypesMap,
      logoSrc = _ref.logoSrc,
      CustomUploader = _ref.CustomUploader,
      customColors = _ref.customColors,
      _ref$showNotification = _ref.showNotifications,
      showNotifications = _ref$showNotification === void 0 ? true : _ref$showNotification,
      hideUserPresence = _ref.hideUserPresence;
  return /*#__PURE__*/React__default.createElement(reactRedux.Provider, {
    store: store
  }, /*#__PURE__*/React__default.createElement(SceytChat, {
    client: client,
    theme: theme,
    avatarColors: avatarColors,
    children: children,
    showOnlyContactUsers: showOnlyContactUsers,
    logoSrc: logoSrc,
    CustomUploader: CustomUploader,
    handleNewMessages: handleNewMessages,
    sendAttachmentsAsSeparateMessages: sendAttachmentsAsSeparateMessages,
    membersDisplayTextByChannelTypesMap: membersDisplayTextByChannelTypesMap,
    defaultRolesByChannelTypesMap: defaultRolesByChannelTypesMap,
    customColors: customColors,
    showNotifications: showNotifications,
    hideUserPresence: hideUserPresence
  }));
};

var _path$6;

function _extends$7() {
  _extends$7 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$7.apply(this, arguments);
}

function SvgPicture(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$7({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$6 || (_path$6 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M3.614 2.052C4.366 1.65 5.107 1.5 6.798 1.5h4.404c1.691 0 2.432.15 3.184.552.672.36 1.203.89 1.562 1.562.402.752.552 1.493.552 3.184v4.404c0 1.691-.15 2.432-.552 3.184a3.763 3.763 0 01-1.562 1.562c-.752.402-1.493.552-3.184.552H6.798c-1.691 0-2.432-.15-3.184-.552a3.764 3.764 0 01-1.562-1.562c-.402-.752-.552-1.493-.552-3.184V6.798c0-1.691.15-2.432.552-3.184.36-.672.89-1.203 1.562-1.562zm7.16 7.07a.297.297 0 01.482.004l3.04 4.193c.101.139.074.335-.06.44a.297.297 0 01-.183.062h-9.57a.309.309 0 01-.304-.314c0-.07.022-.137.064-.192l2.22-2.954a.297.297 0 01.473-.008l1.528 1.861 2.31-3.092zM5.785 6.857a1.071 1.071 0 100-2.143 1.071 1.071 0 000 2.143z",
    fill: "#818C99"
  })));
}

var _path$7;

function _extends$8() {
  _extends$8 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$8.apply(this, arguments);
}

function SvgVideoCall(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$8({
    width: 16,
    height: 16,
    viewBox: "0 0 16.01 16.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$7 || (_path$7 = /*#__PURE__*/React.createElement("path", {
    d: "M.667 4.875C.667 3.839 1.507 3 2.542 3h6.875c1.036 0 1.875.84 1.875 1.875v6.25c0 1.036-.84 1.875-1.875 1.875H2.542a1.875 1.875 0 01-1.875-1.875v-6.25zM12.542 6.125l2.11-1.687a.625.625 0 011.015.488v6.149a.625.625 0 01-1.015.488l-2.11-1.688v-3.75z",
    fill: "CurrentColor"
  })));
}

var _path$8;

function _extends$9() {
  _extends$9 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$9.apply(this, arguments);
}

function SvgChoseFile(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$9({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$8 || (_path$8 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M3 3.75A2.25 2.25 0 015.25 1.5h7.5A2.25 2.25 0 0115 3.75v10.5a2.25 2.25 0 01-2.25 2.25h-7.5A2.25 2.25 0 013 14.25V3.75zm2.25 6.938c0-.311.252-.563.563-.563h6.375a.563.563 0 010 1.125H5.811a.563.563 0 01-.562-.563zm.563 2.062a.563.563 0 000 1.125h3.375a.563.563 0 000-1.125H5.812z",
    fill: "CurrentColor"
  })));
}

var _path$9, _path2;

function _extends$a() {
  _extends$a = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$a.apply(this, arguments);
}

function SvgVoiceIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$a({
    width: 16,
    height: 16,
    viewBox: "0 0 17 17",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$9 || (_path$9 = /*#__PURE__*/React.createElement("path", {
    d: "M5.5 3.5a2.5 2.5 0 015 0v4a2.5 2.5 0 01-5 0v-4zM7.375 13.125a.625.625 0 111.25 0v1.25a.625.625 0 11-1.25 0v-1.25zM14 7.125a.625.625 0 11-1.25 0 .625.625 0 011.25 0zM3.25 7.125a.625.625 0 11-1.25 0 .625.625 0 011.25 0z",
    fill: "CurrentColor"
  })), _path2 || (_path2 = /*#__PURE__*/React.createElement("path", {
    d: "M8 13a6 6 0 006-6h-1.25a4.75 4.75 0 11-9.5 0H2a6 6 0 006 6z",
    fill: "CurrentColor"
  })));
}

var _rect, _path$a;

function _extends$b() {
  _extends$b = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$b.apply(this, arguments);
}

function SvgUnreadMention(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$b({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect || (_rect = /*#__PURE__*/React.createElement("rect", {
    width: 20,
    height: 20,
    rx: 10,
    fill: "CurrentColor"
  })), _path$a || (_path$a = /*#__PURE__*/React.createElement("path", {
    d: "M10.004 16.087c-1.13 0-2.117-.229-2.96-.686a4.778 4.778 0 01-1.954-1.947c-.46-.84-.69-1.82-.69-2.942v-.405c0-1.116.24-2.106.72-2.972A5.064 5.064 0 017.14 5.12c.867-.48 1.859-.72 2.975-.72h.059c1.042 0 1.975.216 2.798.646a4.839 4.839 0 011.932 1.784c.464.76.696 1.621.696 2.585v.368c0 .66-.108 1.242-.324 1.748-.216.506-.519.9-.907 1.183a2.221 2.221 0 01-1.342.424c-.457 0-.85-.096-1.18-.287-.329-.192-.526-.443-.59-.752h-.073a1.193 1.193 0 01-.325.527c-.162.16-.36.285-.593.376a2.002 2.002 0 01-.734.136c-.403 0-.754-.098-1.054-.295a1.9 1.9 0 01-.693-.84c-.162-.364-.244-.794-.244-1.29v-.738c0-.482.083-.902.247-1.26.165-.36.401-.635.708-.827a1.998 1.998 0 011.08-.287c.364 0 .684.09.959.269.275.18.457.414.546.704h.059v-.192c0-.196.054-.352.162-.468a.577.577 0 01.442-.173c.182 0 .327.058.435.173.108.116.162.272.162.468v2.95c0 .25.077.45.229.6.152.15.351.226.597.226.26 0 .49-.101.686-.303.197-.201.348-.488.453-.859.106-.37.159-.805.159-1.301V9.45c0-.772-.183-1.463-.55-2.072a3.826 3.826 0 00-1.526-1.43c-.651-.345-1.39-.517-2.215-.517h-.06c-.894 0-1.685.197-2.374.59a4.084 4.084 0 00-1.603 1.663c-.381.715-.572 1.537-.572 2.466v.317c0 .924.185 1.734.553 2.43.369.695.891 1.23 1.567 1.607.676.376 1.464.564 2.363.564h.06c.334 0 .749-.037 1.245-.11.26-.035.43-.052.51-.052.142 0 .26.043.353.129.094.086.14.195.14.328a.51.51 0 01-.118.34.646.646 0 01-.339.198c-.477.123-1.086.185-1.829.185h-.066zm-1.18-5.545c0 .496.095.874.284 1.132.19.258.468.387.837.387.364 0 .642-.124.833-.373.192-.248.288-.608.288-1.08v-.597c0-.433-.102-.774-.306-1.025-.204-.25-.48-.376-.83-.376-.349 0-.62.132-.814.395-.195.262-.292.63-.292 1.102v.435z",
    fill: "#fff"
  })));
}

var _path$b, _path2$1, _path3;

function _extends$c() {
  _extends$c = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$c.apply(this, arguments);
}

function SvgDeletedUserAvatar(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$c({
    width: 51,
    height: 51,
    viewBox: "0 0 51.01 51.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$b || (_path$b = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M25 50c13.807 0 25-11.193 25-25S38.807 0 25 0 0 11.193 0 25s11.193 25 25 25z",
    fill: "CurrentColor"
  })), _path2$1 || (_path2$1 = /*#__PURE__*/React.createElement("path", {
    d: "M49.75 25c0 13.669-11.081 24.75-24.75 24.75S.25 38.669.25 25 11.331.25 25 .25 49.75 11.331 49.75 25z",
    stroke: "#000",
    strokeOpacity: 0.08,
    strokeWidth: 0.5,
    strokeLinejoin: "round"
  })), _path3 || (_path3 = /*#__PURE__*/React.createElement("path", {
    d: "M25 11.934c3.294 0 5.896 1.135 8.298 3.331C35.664 17.43 37 20.382 37 23.468l-.02 10.08c-.134 1.801-1.374 3.135-3.176 3.135s-2.279-1.25-3.82-.995c-1.54.256-2.12 2.246-4.984 2.246-2.865 0-3.5-2-4.984-2.245-1.541-.256-2.018.994-3.82.994-1.735 0-3.086-1.253-3.177-3.134L13 23.469c0-3.087 1.336-6.04 3.702-8.204 2.302-2.105 5.003-3.331 8.298-3.331zm4.633 16.439c-.527-.545-1.43-.589-2.017-.099-1.477 1.235-2.95 1.235-4.45.482a4.437 4.437 0 01-.782-.482l-.14-.104c-.583-.376-1.39-.3-1.877.203a1.261 1.261 0 00.106 1.873c.277.232.73.54 1.335.845 2.468 1.237 5.228 1.237 7.72-.845.585-.49.633-1.329.105-1.873zM20 20.933a2 2 0 100 4 2 2 0 000-4zm10 0a2 2 0 100 4 2 2 0 000-4z",
    fill: "#fff"
  })));
}

var _path$c;

function _extends$d() {
  _extends$d = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$d.apply(this, arguments);
}

function SvgDevaultAvatar32(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$d({
    width: 32,
    height: 32,
    viewBox: "0 0 32.01 32.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$c || (_path$c = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M24.946 29.267A15.926 15.926 0 0116 32c-3.602 0-6.926-1.19-9.6-3.199C2.514 25.882 0 21.235 0 16 0 7.163 7.163 0 16 0s16 7.163 16 16c0 5.523-2.798 10.392-7.054 13.267zM16 16.8c2.651 0 4.8-2.328 4.8-5.2 0-2.872-2.149-5.2-4.8-5.2s-4.8 2.328-4.8 5.2c0 2.872 2.149 5.2 4.8 5.2zm0 12c3.46 0 6.598-1.372 8.901-3.602A9.603 9.603 0 0016 19.2a9.603 9.603 0 00-8.901 5.998A12.758 12.758 0 0016 28.8z",
    fill: "CurrentColor"
  })));
}

var _templateObject$3, _templateObject2$3, _templateObject3$2, _templateObject4$2;

var Avatar = function Avatar(_ref) {
  var image = _ref.image,
      size = _ref.size,
      name = _ref.name,
      textSize = _ref.textSize,
      DeletedIcon = _ref.DeletedIcon,
      marginAuto = _ref.marginAuto,
      setDefaultAvatar = _ref.setDefaultAvatar,
      border = _ref.border,
      handleAvatarClick = _ref.handleAvatarClick;
  var isDeletedUserAvatar = !image && !name;
  var avatarText = '';

  if (!image && name) {
    var trimedName = name.trim();
    var splittedName = trimedName.split(' ');

    if (splittedName.length > 1 && splittedName[1]) {
      var firstWord = splittedName[0];
      var secondWord = splittedName[1];
      var firstCharOfFirstWord = firstWord.codePointAt(0);
      var firstCharOfSecondWord = secondWord.codePointAt(0);
      avatarText = "" + (firstCharOfFirstWord ? String.fromCodePoint(firstCharOfFirstWord) : '') + (firstCharOfSecondWord ? String.fromCodePoint(firstCharOfSecondWord) : '');
    } else {
      var _firstCharOfFirstWord = trimedName.codePointAt(0);

      avatarText = _firstCharOfFirstWord ? String.fromCodePoint(_firstCharOfFirstWord) : '';
    }
  }

  return /*#__PURE__*/React__default.createElement(Container$1, {
    border: border,
    marginAuto: marginAuto,
    size: size,
    isImage: !!(image || setDefaultAvatar),
    avatarName: name,
    textSize: textSize,
    onClick: handleAvatarClick,
    cursorPointer: !!handleAvatarClick
  }, isDeletedUserAvatar ? DeletedIcon || /*#__PURE__*/React__default.createElement(DeletedAvatarWrapper, {
    color: colors.deleteUserIconBackground
  }) : !image ? setDefaultAvatar ? /*#__PURE__*/React__default.createElement(DefaultAvatarWrapper, {
    color: colors.defaultAvatarBackground
  }) : /*#__PURE__*/React__default.createElement("span", null, avatarText) : /*#__PURE__*/React__default.createElement(AvatarImage, {
    draggable: false,
    showImage: true,
    src: image,
    size: size,
    alt: ''
  }));
};
var Container$1 = styled__default.div(_templateObject$3 || (_templateObject$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  flex: 0 0 auto;\n  text-transform: uppercase;\n  justify-content: center;\n  width: ", ";\n  height: ", ";\n  border: ", ";\n  border-radius: 50%;\n  color: #fff;\n  overflow: hidden;\n  margin: ", ";\n  ", ";\n  cursor: ", ";\n\n  span {\n    text-transform: uppercase;\n    font-style: normal;\n    white-space: nowrap;\n    font-weight: 500;\n    font-size: ", "\n  }\n;\n}\n\n& > svg {\n  height: ", ";\n  width: ", ";\n}\n\n"])), function (props) {
  return props.size ? props.size + "px" : '38px';
}, function (props) {
  return props.size ? props.size + "px" : '38px';
}, function (props) {
  return props.border;
}, function (props) {
  return props.marginAuto ? 'auto' : '';
}, function (props) {
  return !props.isImage ? "background-color:" + generateAvatarColor(props.avatarName) + ";" : '';
}, function (props) {
  return props.cursorPointer && 'pointer';
}, function (props) {
  return props.textSize ? props.textSize + "px" : '14px';
}, function (props) {
  return props.size && props.size + "px";
}, function (props) {
  return props.size && props.size + "px";
});
var AvatarImage = styled__default.img(_templateObject2$3 || (_templateObject2$3 = _taggedTemplateLiteralLoose(["\n  visibility: ", ";\n  width: ", ";\n  height: ", ";\n  object-fit: cover;\n"])), function (props) {
  return props.showImage ? 'visible' : 'hidden';
}, function (props) {
  return props.size + "px";
}, function (props) {
  return props.size + "px";
});
var DefaultAvatarWrapper = styled__default(SvgDevaultAvatar32)(_templateObject3$2 || (_templateObject3$2 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.defaultAvatarBackground;
});
var DeletedAvatarWrapper = styled__default(SvgDeletedUserAvatar)(_templateObject4$2 || (_templateObject4$2 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), function (props) {
  return props.color || colors.deleteUserIconBackground;
});

var updateInterval;
function useUpdatePresence(channel, isVisible) {
  var dispatch = reactRedux.useDispatch();
  var connectionStatus = reactRedux.useSelector(connectionStatusSelector);
  var ChatClient = getClient();
  var user = ChatClient.user;
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });
  var userId = directChannelUser && directChannelUser.id;

  if (userId && usersMap[userId] && !isVisible) {
    deleteUserFromMap(userId);
  }

  if (userId && !usersMap[userId] && isVisible && directChannelUser) {
    setUserToMap(directChannelUser);
  }

  if (Object.keys(usersMap).length && connectionStatus === CONNECTION_STATUS.CONNECTED) {
    clearInterval(updateInterval);
    updateInterval = setInterval(function () {
      dispatch(checkUserStatusAC(usersMap));
    }, 4000);
  } else if (!Object.keys(usersMap).length && updateInterval) {
    clearInterval(updateInterval);
    updateInterval = undefined;
  }

  React.useEffect(function () {
    clearInterval(updateInterval);
  }, [usersMap]);
  React.useEffect(function () {
    if (connectionStatus !== CONNECTION_STATUS.CONNECTED) {
      clearInterval(updateInterval);
    }
  }, [connectionStatus]);
  React.useEffect(function () {
    if (directChannelUser && usersMap[directChannelUser.id] && directChannelUser.presence && (directChannelUser.presence.state !== usersMap[directChannelUser.id].state || directChannelUser.presence.lastActiveAt && new Date(directChannelUser.presence.lastActiveAt).getTime() !== new Date(usersMap[directChannelUser.id].lastActiveAt).getTime())) {
      var _updateUserStatusOnCh;

      dispatch(updateUserStatusOnChannelAC((_updateUserStatusOnCh = {}, _updateUserStatusOnCh[directChannelUser.id] = directChannelUser, _updateUserStatusOnCh)));
      updateUserOnMap(directChannelUser);
    }
  }, []);
}

var _path$d;

function _extends$e() {
  _extends$e = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$e.apply(this, arguments);
}

function SvgUnmuteNotifications(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$e({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$d || (_path$d = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.246 1.75c3.575 0 5.924 2.96 5.924 6.47v1.375c0 .214.125.462.497.851.406.427.872.803 1.203 1.297.273.407.458.896.447 1.45a.773.773 0 01-1.546-.03c.014-.701-.8-1.205-1.224-1.65-.407-.427-.924-1.06-.924-1.918V8.22c0-2.845-1.833-4.924-4.377-4.924a4.15 4.15 0 00-2.254.632.773.773 0 01-.826-1.307 5.727 5.727 0 013.08-.871zM13.98 15.325c-.54 2.003-1.83 3.092-3.738 3.092s-3.198-1.089-3.738-3.093H4.86c-1.278 0-2.118-.432-2.493-1.212-.164-.341-.201-.618-.201-.998 0-1.111.809-1.853 1.528-2.595.453-.467.62-.728.62-.924 0-1.283-.033-2.55.39-3.784L2.737 3.843A.773.773 0 113.83 2.75l13.917 13.917a.773.773 0 11-1.093 1.093l-2.436-2.436h-.238zm-5.856 0h4.236c-.391 1.071-1.066 1.545-2.118 1.545-1.052 0-1.727-.474-2.118-1.545zM5.86 9.595c0-.84-.052-1.694.105-2.522l6.705 6.704H4.86c-.727 0-1.007-.143-1.1-.335-.287-.599.448-1.241.803-1.601.62-.628 1.297-1.304 1.297-2.246z",
    fill: "currentColor"
  })));
}

var _templateObject$4, _templateObject2$4, _templateObject3$3, _templateObject4$3, _templateObject5$2, _templateObject6$1, _templateObject7$1, _templateObject8$1, _templateObject9$1, _templateObject10$1, _templateObject11$1, _templateObject12$1, _templateObject13$1, _templateObject14$1, _templateObject15$1, _templateObject16$1, _templateObject17$1, _templateObject18$1, _templateObject19$1;

var Channel = function Channel(_ref) {
  var channel = _ref.channel,
      theme = _ref.theme,
      _ref$showAvatar = _ref.showAvatar,
      showAvatar = _ref$showAvatar === void 0 ? true : _ref$showAvatar,
      notificationsIsMutedIcon = _ref.notificationsIsMutedIcon,
      notificationsIsMutedIconColor = _ref.notificationsIsMutedIconColor,
      selectedChannelLeftBorder = _ref.selectedChannelLeftBorder,
      selectedChannelBackground = _ref.selectedChannelBackground,
      contactsMap = _ref.contactsMap,
      selectedChannelBorderRadius = _ref.selectedChannelBorderRadius,
      selectedChannelPaddings = _ref.selectedChannelPaddings,
      channelsPaddings = _ref.channelsPaddings,
      channelsMargin = _ref.channelsMargin;
  var dispatch = reactRedux.useDispatch();
  var ChatClient = getClient();
  var getFromContacts = getShowOnlyContactUsers();
  var user = ChatClient.user;
  var activeChannel = reactRedux.useSelector(activeChannelSelector) || {};
  var channelDraftIsRemoved = reactRedux.useSelector(channelMessageDraftIsRemovedSelector);
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });
  var typingIndicator = reactRedux.useSelector(typingIndicatorSelector(channel.id));

  var _useState = React.useState(),
      draftMessageText = _useState[0],
      setDraftMessageText = _useState[1];

  var lastMessage = channel.lastReactedMessage || channel.lastMessage;
  var lastMessageMetas = lastMessage && lastMessage.type === 'system' && lastMessage.metadata && (isJSON(lastMessage.metadata) ? JSON.parse(lastMessage.metadata) : lastMessage.metadata);

  var _useState2 = React.useState(0),
      statusWidth = _useState2[0],
      setStatusWidth = _useState2[1];

  var handleChangeActiveChannel = function handleChangeActiveChannel(chan) {
    if (activeChannel.id !== chan.id) {
      dispatch(sendTypingAC(false));
      dispatch(clearMessagesAC());
      dispatch(switchChannelActionAC(chan));
    }
  };

  var messageAuthorRef = React.useRef(null);
  var messageTimeAndStatusRef = React.useRef(null);
  useUpdatePresence(channel, true);
  React.useEffect(function () {
    if (messageTimeAndStatusRef.current) {
      setStatusWidth(messageTimeAndStatusRef.current.offsetWidth);
    }
  }, [messageTimeAndStatusRef, lastMessage]);
  React.useEffect(function () {
    if (activeChannel.id !== channel.id) {
      var channelDraftMessage = getDraftMessageFromMap(channel.id);

      if (channelDraftMessage) {
        setDraftMessageText(channelDraftMessage.text);
      } else if (draftMessageText) {
        setDraftMessageText(undefined);
      }
    }
  }, [activeChannel.id]);
  React.useEffect(function () {
    if (channelDraftIsRemoved && channelDraftIsRemoved === channel.id) {
      setDraftMessageText(undefined);
      dispatch(setChannelDraftMessageIsRemovedAC());
    }
  }, [channelDraftIsRemoved]);
  React.useEffect(function () {
    if (channel.muted) {
      var dateDiff = moment(channel.mutedTill).diff(moment());
      console.log('channel is muted. .. ', channel.subject || directChannelUser && (directChannelUser.firstName || directChannelUser.id), dateDiff);

      if (dateDiff <= 0) {
        dispatch(updateChannelDataAC(channel.id, {
          muted: false,
          mutedTill: null
        }));
        updateChannelOnAllChannels(channel.id, {
          muted: false,
          mutedTill: null
        });
      }
    }
  });
  return /*#__PURE__*/React__default.createElement(Container$2, {
    theme: theme,
    selectedChannel: channel.id === activeChannel.id,
    selectedChannelLeftBorder: selectedChannelLeftBorder,
    selectedBackgroundColor: selectedChannelBackground || (theme === THEME.DARK ? colors.hoverBackgroundColor : colors.primaryLight),
    selectedChannelPaddings: selectedChannelPaddings,
    channelsPaddings: channelsPaddings,
    selectedChannelBorderRadius: selectedChannelBorderRadius,
    channelsMargin: channelsMargin,
    onClick: function onClick() {
      return handleChangeActiveChannel(channel);
    }
  }, showAvatar && /*#__PURE__*/React__default.createElement(AvatarWrapper, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: channel.subject || (isDirectChannel && directChannelUser ? directChannelUser.firstName || directChannelUser.id : ''),
    image: channel.avatarUrl || (isDirectChannel && directChannelUser ? directChannelUser.avatarUrl : ''),
    size: 50,
    textSize: 16,
    setDefaultAvatar: isDirectChannel
  }), isDirectChannel && directChannelUser && hideUserPresence && (hideUserPresence(directChannelUser) ? '' : directChannelUser.presence && directChannelUser.presence.state === USER_PRESENCE_STATUS.ONLINE) && /*#__PURE__*/React__default.createElement(UserStatus, {
    backgroundColor: colors.primary
  })), /*#__PURE__*/React__default.createElement(ChannelInfo, {
    theme: theme,
    avatar: showAvatar,
    isMuted: channel.muted,
    statusWidth: statusWidth,
    uppercase: directChannelUser && hideUserPresence && hideUserPresence(directChannelUser)
  }, /*#__PURE__*/React__default.createElement("h3", null, channel.subject || (isDirectChannel && directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : '')), channel.muted && /*#__PURE__*/React__default.createElement(MutedIcon, {
    color: notificationsIsMutedIconColor
  }, notificationsIsMutedIcon || /*#__PURE__*/React__default.createElement(SvgUnmuteNotifications, null)), (lastMessage || !!typingIndicator || draftMessageText) && /*#__PURE__*/React__default.createElement(LastMessage, {
    markedAsUnread: !!(channel.unread || channel.newMessageCount && channel.newMessageCount > 0),
    unreadMentions: !!(channel.newMentionCount && channel.newMentionCount > 0)
  }, typingIndicator ? !isDirectChannel ? /*#__PURE__*/React__default.createElement(LastMessageAuthor, {
    theme: theme,
    typing: typingIndicator
  }, /*#__PURE__*/React__default.createElement("span", {
    ref: messageAuthorRef
  }, makeUsername(contactsMap[typingIndicator.from.id], typingIndicator.from, getFromContacts, true))) : null : draftMessageText ? /*#__PURE__*/React__default.createElement(DraftMessageTitle, null, "Draft") : channel.lastReactedMessage && channel.newReactions && channel.newReactions[0] ? lastMessage.state !== MESSAGE_STATUS.DELETE && (channel.newReactions[0].user && channel.newReactions[0].user.id === user.id || !isDirectChannel) && lastMessage.type !== 'system' && /*#__PURE__*/React__default.createElement(LastMessageAuthor, {
    theme: theme
  }, /*#__PURE__*/React__default.createElement("span", {
    ref: messageAuthorRef
  }, channel.newReactions[0].user.id === user.id ? 'You' : makeUsername(contactsMap[channel.newReactions[0].user.id], channel.newReactions[0].user, getFromContacts, true))) : lastMessage.user && lastMessage.state !== MESSAGE_STATUS.DELETE && (lastMessage.user && lastMessage.user.id === user.id || !isDirectChannel) && lastMessage.type !== 'system' && /*#__PURE__*/React__default.createElement(LastMessageAuthor, {
    theme: theme
  }, /*#__PURE__*/React__default.createElement("span", {
    ref: messageAuthorRef
  }, lastMessage.user.id === user.id ? 'You' : makeUsername(contactsMap[lastMessage.user.id], lastMessage.user, getFromContacts, true))), (isDirectChannel ? !typingIndicator && (draftMessageText || lastMessage.user && lastMessage.state !== MESSAGE_STATUS.DELETE && (channel.lastReactedMessage && channel.newReactions && channel.newReactions[0] ? channel.newReactions[0].user && channel.newReactions[0].user.id === user.id : lastMessage.user.id === user.id)) : typingIndicator || draftMessageText || lastMessage && lastMessage.state !== MESSAGE_STATUS.DELETE && lastMessage.type !== 'system') && /*#__PURE__*/React__default.createElement(Points, {
    color: draftMessageText && colors.red1
  }, ": "), /*#__PURE__*/React__default.createElement(LastMessageText, {
    withAttachments: !!(lastMessage && lastMessage.attachments && lastMessage.attachments.length && lastMessage.attachments[0].type !== attachmentTypes.link) && !typingIndicator,
    noBody: lastMessage && !lastMessage.body,
    deletedMessage: lastMessage && lastMessage.state === MESSAGE_STATUS.DELETE
  }, typingIndicator ? /*#__PURE__*/React__default.createElement(TypingIndicator, null, "typing...") : draftMessageText ? /*#__PURE__*/React__default.createElement(DraftMessageText, null, draftMessageText) : lastMessage.state === MESSAGE_STATUS.DELETE ? 'Message was deleted.' : lastMessage.type === 'system' ? (lastMessage.user && (lastMessage.user.id === user.id ? 'You ' : contactsMap[lastMessage.user.id] ? contactsMap[lastMessage.user.id].firstName : lastMessage.user.id)) + " " + (lastMessage.body === 'CC' ? 'created this channel' : lastMessage.body === 'CG' ? 'created this group' : lastMessage.body === 'AM' ? " added " + (lastMessageMetas && lastMessageMetas.m && lastMessageMetas.m.slice(0, 5).map(function (mem) {
    return mem === user.id ? ' You' : " " + systemMessageUserName(contactsMap[mem], mem);
  })) + " " + (lastMessageMetas && lastMessageMetas.m && lastMessageMetas.m.length > 5 ? "and " + (lastMessageMetas.m.length - 5) + " more" : '') : lastMessage.body === 'RM' ? " removed " + (lastMessageMetas && lastMessageMetas.m && lastMessageMetas.m.slice(0, 5).map(function (mem) {
    return mem === user.id ? ' You' : " " + systemMessageUserName(contactsMap[mem], mem);
  })) + " " + (lastMessageMetas && lastMessageMetas.m && lastMessageMetas.m.length > 5 ? "and " + (lastMessageMetas.m.length - 5) + " more" : '') : lastMessage.body === 'LG' ? 'Left this group' : '') : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, channel.lastReactedMessage && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, "Reacted", /*#__PURE__*/React__default.createElement(ReactionItem, null, channel.newReactions && channel.newReactions[0] && channel.newReactions[0].key), "to", ' "'), !!(lastMessage.attachments && lastMessage.attachments.length) && (lastMessage.attachments[0].type === attachmentTypes.image ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SvgPicture, null), lastMessage.body ? '' : 'Photo') : lastMessage.attachments[0].type === attachmentTypes.video ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SvgVideoCall, null), lastMessage.body ? '' : 'Video') : lastMessage.attachments[0].type === attachmentTypes.file ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SvgChoseFile, null), lastMessage.body ? '' : 'File') : lastMessage.attachments[0].type === attachmentTypes.voice ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SvgVoiceIcon, null), lastMessage.body ? '' : 'Voice') : null), !!(lastMessage && lastMessage.id) && MessageTextFormat({
    text: lastMessage.body,
    message: lastMessage,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts,
    isLastMessage: true
  }), channel.lastReactedMessage && '"')))), /*#__PURE__*/React__default.createElement(ChannelStatus, {
    ref: messageTimeAndStatusRef
  }, lastMessage && lastMessage.state !== MESSAGE_STATUS.DELETE && /*#__PURE__*/React__default.createElement(DeliveryIconCont, null, lastMessage && lastMessage.user && lastMessage.user.id === user.id && lastMessage.type !== 'system' && messageStatusIcon(lastMessage.deliveryStatus, 'ticks', undefined, colors.primary)), /*#__PURE__*/React__default.createElement(LastMessageDate, null, lastMessage && lastMessage.createdAt && lastMessageDateFormat(lastMessage.createdAt))), /*#__PURE__*/React__default.createElement(UnreadInfo, {
    bottom: !(lastMessage || !!typingIndicator || draftMessageText) ? '5px' : ''
  }, !!(channel.newMentionCount && channel.newMentionCount > 0) && /*#__PURE__*/React__default.createElement(UnreadMentionIconWrapper, {
    iconColor: colors.primary,
    rightMargin: !!(channel.newMessageCount || channel.unread)
  }, /*#__PURE__*/React__default.createElement(SvgUnreadMention, null)), !!(channel.newMessageCount || channel.unread) && /*#__PURE__*/React__default.createElement(UnreadCount, {
    backgroundColor: colors.primary,
    isMuted: channel.muted
  }, channel.newMessageCount ? channel.newMessageCount > 99 ? '99+' : channel.newMessageCount : '')));
};
var Container$2 = styled__default.div(_templateObject$4 || (_templateObject$4 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  background-color: ", ";\n  border-left: ", ";\n  // padding: selectedChannel ? '8px 16px 8px 13px' : '8px 16px'\n  padding: ", ";\n  margin: ", ";\n  border-radius: ", ";\n"])), function (props) {
  return props.selectedChannel ? props.selectedBackgroundColor || colors.primaryLight : 'inherit';
}, function (props) {
  return props.selectedChannel ? props.selectedChannelLeftBorder : null;
}, function (props) {
  return props.selectedChannel ? props.selectedChannelPaddings || props.channelsPaddings || '8px' : props.channelsPaddings || '8px';
}, function (props) {
  return props.channelsMargin || '0 8px';
}, function (props) {
  return props.selectedChannelBorderRadius || '12px';
});
var ChannelInfo = styled__default.div(_templateObject2$4 || (_templateObject2$4 = _taggedTemplateLiteralLoose(["\n  text-align: left;\n  margin-left: ", ";\n  width: 100%;\n  max-width: calc(100% - 62px);\n\n  h3 {\n    display: inline-block;\n    margin: 0;\n    font-size: 15px;\n    font-weight: 500;\n    text-overflow: ellipsis;\n    line-height: 18px;\n    letter-spacing: -0.2px;%;\n    max-width: ", ";\n    overflow: hidden;\n    white-space: nowrap;\n    color: ", ";\n    text-transform: ", ";\n  }\n"])), function (props) {
  return props.avatar && '12px';
}, function (props) {
  return "calc(100% - " + (props.statusWidth + (props.isMuted ? 28 : 4) + 2) + "px)";
}, function (props) {
  return props.theme === THEME.DARK ? colors.darkModeTextColor1 : colors.textColor1;
}, function (props) {
  return props.uppercase && 'uppercase';
});
var MutedIcon = styled__default.span(_templateObject3$3 || (_templateObject3$3 = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  & > svg {\n    height: 16px;\n    width: 16px;\n    margin-left: 5px;\n    color: ", ";\n  }\n"])), function (props) {
  return props.color || colors.borderColor2;
});
var LastMessage = styled__default.div(_templateObject4$3 || (_templateObject4$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  color: ", ";\n  max-width: ", ";\n\n  height: 20px;\n"])), colors.textColor1, function (props) {
  return props.markedAsUnread || props.unreadMentions ? "calc(100% - " + (props.markedAsUnread && props.unreadMentions ? 48 : 24) + "px)" : '100%';
});
var AvatarWrapper = styled__default.div(_templateObject5$2 || (_templateObject5$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  position: relative;\n"])));
var UserStatus = styled__default.span(_templateObject6$1 || (_templateObject6$1 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  width: 14px;\n  height: 14px;\n  right: 0;\n  bottom: 0;\n  border-radius: 50%;\n  background-color: ", ";\n  border: 2.5px solid #ffffff;\n  box-sizing: border-box;\n"])), function (props) {
  return props.backgroundColor || '#56E464';
});
var DraftMessageTitle = styled__default.span(_templateObject7$1 || (_templateObject7$1 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), colors.red1);
var DraftMessageText = styled__default.span(_templateObject8$1 || (_templateObject8$1 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n"])), colors.textColor2);
var LastMessageAuthor = styled__default.div(_templateObject9$1 || (_templateObject9$1 = _taggedTemplateLiteralLoose(["\n  max-width: 120px;\n  font-weight: 500;\n  font-style: ", ";\n  color: ", ";\n\n  & > span {\n    display: block;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    max-width: 100%;\n  }\n"])), function (props) {
  return props.typing && 'italic';
}, function (props) {
  return props.theme === THEME.DARK ? colors.darkModeTextColor1 : colors.textColor1;
});
var Points = styled__default.span(_templateObject10$1 || (_templateObject10$1 = _taggedTemplateLiteralLoose(["\n  margin-right: 4px;\n  color: ", ";\n"])), function (props) {
  return props.color;
});
var LastMessageText = styled__default.span(_templateObject11$1 || (_templateObject11$1 = _taggedTemplateLiteralLoose(["\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  color: ", ";\n  font-style: ", ";\n  transform: ", ";\n  //height: 20px;\n\n  > svg {\n    width: 16px;\n    height: 16px;\n    margin-right: 4px;\n    color: ", ";\n    //transform: ", ";\n    transform: translate(0px, 3px);\n  }\n"])), colors.textColor2, function (props) {
  return props.deletedMessage && 'italic';
}, function (props) {
  return props.withAttachments && 'translate(0px, -1px)';
}, colors.textColor2, function (props) {
  return props.withAttachments ? 'translate(0px, 3px)' : 'translate(0px, 2px)';
});
var ChannelStatus = styled__default.div(_templateObject12$1 || (_templateObject12$1 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  right: 16px;\n  top: 15px;\n  display: flex;\n  flex-wrap: wrap;\n  height: 42px;\n  margin-left: auto;\n"])));
var LastMessageDate = styled__default.span(_templateObject13$1 || (_templateObject13$1 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  font-size: 12px;\n  line-height: 16px;\n"])), colors.textColor2);
var DeliveryIconCont = styled__default.span(_templateObject14$1 || (_templateObject14$1 = _taggedTemplateLiteralLoose(["\n  margin-right: 6px;\n  line-height: 13px;\n"])));
var UnreadMentionIconWrapper = styled__default.span(_templateObject15$1 || (_templateObject15$1 = _taggedTemplateLiteralLoose(["\n  margin-right: ", ";\n  line-height: 13px;\n\n  & > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.rightMargin && '8px';
}, function (props) {
  return props.iconColor || colors.primary;
});
var TypingIndicator = styled__default.span(_templateObject16$1 || (_templateObject16$1 = _taggedTemplateLiteralLoose(["\n  font-style: italic;\n"])));
var ReactionItem = styled__default.span(_templateObject17$1 || (_templateObject17$1 = _taggedTemplateLiteralLoose(["\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n  padding: 0 3px;\n"])));
var UnreadInfo = styled__default.span(_templateObject18$1 || (_templateObject18$1 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: ", ";\n  right: 16px;\n  display: flex;\n  margin-top: 7px;\n  align-items: center;\n  flex: 0 0 auto;\n  margin-left: auto;\n"])), function (props) {
  return props.bottom || '11px';
});
var UnreadCount = styled__default.span(_templateObject19$1 || (_templateObject19$1 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  background-color: ", ";\n  padding: 0 4px;\n  font-size: ", ";\n  line-height: 20px;\n  min-width: ", ";\n  height: ", ";\n  text-align: center;\n  font-weight: 500;\n  color: ", ";\n  border-radius: 10px;\n  box-sizing: border-box;\n\n  /*", "*/\n"])), function (props) {
  return props.backgroundColor || colors.primary;
}, function (props) {
  return props.fontSize || '13px';
}, function (props) {
  return props.width || '20px';
}, function (props) {
  return props.height || '20px';
}, function (props) {
  return props.textColor || '#fff';
}, function (props) {
  return props.isMuted && 'background-color: #BEBFC7;';
});

var _templateObject$5, _templateObject2$5;
var SearchInputContainer = styled__default.div(_templateObject$5 || (_templateObject$5 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  width: 100%;\n  max-width: ", ";\n  box-sizing: border-box;\n  padding: ", ";\n  border-right: ", ";\n\n  & ", " {\n    ", ";\n  }\n"])), function (props) {
  return props.inline && 'calc(100% - 24px)';
}, function (props) {
  return !props.inline && '0 12px 16px';
}, function (props) {
  return !props.inline && "1px solid " + props.borderColor;
}, ClearTypedText, function (props) {
  return !props.inline && 'right: 20px';
});
var SearchInput = styled__default.input(_templateObject2$5 || (_templateObject2$5 = _taggedTemplateLiteralLoose(["\n  padding: 0 34px;\n  background: ", ";\n  color: ", ";\n  border-radius: ", ";\n  width: 100%;\n  border: none;\n  height: 36px;\n  outline: none;\n  box-sizing: border-box;\n  font-size: 15px;\n\n  &::placeholder {\n    font-style: normal;\n    font-weight: normal;\n    font-size: 15px;\n    //line-height: 22px;\n    color: ", ";\n    opacity: 1;\n  }\n"])), function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.color;
}, function (props) {
  return props.borderRadius || '30px';
}, colors.textColor2);

var ChannelSearch = function ChannelSearch(_ref) {
  var searchValue = _ref.searchValue,
      theme = _ref.theme,
      handleSearchValueChange = _ref.handleSearchValueChange,
      getMyChannels = _ref.getMyChannels,
      inline = _ref.inline,
      borderRadius = _ref.borderRadius,
      searchInputBackgroundColor = _ref.searchInputBackgroundColor,
      searchInputTextColor = _ref.searchInputTextColor;
  return /*#__PURE__*/React__default.createElement(SearchInputContainer, {
    inline: inline,
    borderColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(StyledSearchSvg, {
    left: !inline ? '22px' : ''
  }), /*#__PURE__*/React__default.createElement(SearchInput, {
    backgroundColor: searchInputBackgroundColor || (theme === THEME.DARK ? colors.hoverBackgroundColor : colors.primaryLight),
    color: searchInputTextColor || colors.textColor1,
    borderRadius: borderRadius,
    type: 'text',
    onChange: handleSearchValueChange,
    value: searchValue,
    placeholder: 'Search for channels'
  }), searchValue && /*#__PURE__*/React__default.createElement(ClearTypedText, {
    onClick: getMyChannels
  }));
};

var _templateObject$6, _templateObject2$6, _templateObject3$4;
var DropDownContainer = styled__default.div(_templateObject$6 || (_templateObject$6 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  height: ", ";\n  order: ", ";\n  margin: ", ";\n  ", ";\n"])), function (props) {
  return props.height ? props.height : '100%';
}, function (props) {
  return props.order === 0 || props.order ? props.order : 0;
}, function (props) {
  return props.margin;
}, function (props) {
  return props.center && " display: flex;\n      justify-content: center;\n    ";
});
var DropDownTriggerContainer = styled__default.div(_templateObject2$6 || (_templateObject2$6 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  cursor: pointer;\n  height: 100%;\n  width: 100%;\n  user-select: none;\n  background-color: transparent;\n  box-shadow: none;\n  border: none;\n  padding: 0;\n  outline: none !important;\n  -webkit-tap-highlight-color: transparent;\n  & svg {\n    color: ", ";\n  }\n  ", " ", ";\n"])), function (props) {
  return props.iconColor;
}, function (props) {
  return props.withIcon && "\n        // padding-right: 20px;\n\n        &::after {\n            content: \"\";\n            position: absolute;\n            width: 7px;\n            height: 7px;\n            border-width: 1px 1px 0 0;\n            border-color: " + (props.iconColor || 'black') + ";\n            border-style: solid;\n            top: calc(50% - 2px);\n            right: 14px;\n            transform: translateY(-50%) rotate(135deg);\n            transition: all 0.2s;\n        }\n    ";
}, function (props) {
  return props.isOpen && "\n        &::after {\n            transform: translateY(-50%) rotate(-45deg);\n            top: calc(50% + 2px);\n        }\n        ";
});
var DropDownBody = styled__default.div(_templateObject3$4 || (_templateObject3$4 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  z-index: 300;\n  min-width: 200px;\n  right: ", ";\n  left: ", ";\n  top: 100%;\n  display: flex;\n  direction: initial;\n  flex-direction: column;\n  background: ", ";\n  border-radius: 8px;\n  max-height: 220px;\n  overflow-y: auto;\n  box-shadow: 0.8px 0.8px 0 rgba(31, 35, 60, 0.06), 0 0 2px rgba(31, 35, 60, 0.08), 0 2px 6px rgba(31, 35, 60, 0.16);\n\n  & > * {\n    &:first-child {\n      margin-top: 5px;\n    }\n\n    &:first-child {\n      margin-bottom: 5px;\n    }\n  }\n\n  ", "\n"])), function (props) {
  return props.position !== 'left' && '0';
}, function (props) {
  return props.position === 'left' && '0';
}, function (props) {
  return props.backgroundColor || colors.backgroundColor;
}, function (props) {
  return props.position === 'top' ? "top: inherit;\n         bottom: 100%;" : props.position === 'topRight' ? "top: inherit;\n         right: inherit;\n         bottom: 100%" : props.position === 'right' || props.position === 'center' ? "right: inherit;" : props.position === 'left' ? "right: inherit;\n          left: 0;" : '';
});

var DropDown = function DropDown(_ref) {
  var trigger = _ref.trigger,
      position = _ref.position,
      withIcon = _ref.withIcon,
      iconColor = _ref.iconColor,
      margin = _ref.margin,
      isStatic = _ref.isStatic,
      forceClose = _ref.forceClose,
      isSelect = _ref.isSelect,
      dropDownState = _ref.dropDownState,
      watchToggleState = _ref.watchToggleState,
      height = _ref.height,
      children = _ref.children,
      theme = _ref.theme,
      order = _ref.order;

  var _useState = React.useState(false),
      isOpen = _useState[0],
      setIsOpen = _useState[1];

  var dropDownRef = React.useRef(null);
  var dropDownBodyRef = React.useRef(null);

  var toggleDropdown = function toggleDropdown() {
    setIsOpen(!isOpen);

    if (watchToggleState) {
      watchToggleState(!isOpen);
    }
  };

  var handleDropdownClicks = function handleDropdownClicks(e) {
    e.stopPropagation();

    if (isOpen) {
      if (!isStatic) {
        var dropDownElem = dropDownRef.current;
        var dropDownBodyElem = dropDownBodyRef.current;

        if (dropDownElem && !dropDownElem.contains(e.target)) {
          console.log('call toggle dropdown. .. ');
          toggleDropdown();
        }

        if (isSelect && dropDownBodyElem && dropDownBodyElem.contains(e.target)) {
          var listElement = dropDownBodyElem.getElementsByTagName('ul')[0];

          if (listElement && listElement.contains(e.target)) {
            console.log('call toggle dropdown. .. !!');
            toggleDropdown();
          }
        }
      }
    }
  };

  var handleScrolling = function handleScrolling(event) {
    event.stopPropagation();
  };

  useEventListener('click', handleDropdownClicks);
  useDidUpdate(function () {
    if (forceClose) {
      setIsOpen(false);
    }
  }, [forceClose]);
  React.useEffect(function () {
    if (dropDownState !== undefined) {
      setIsOpen(dropDownState);
    }
  }, [dropDownState]);
  return /*#__PURE__*/React__default.createElement(DropDownContainer, {
    theme: theme,
    order: order,
    margin: margin,
    className: 'dropdown-wrapper',
    center: position === 'center',
    ref: dropDownRef,
    height: height
  }, /*#__PURE__*/React__default.createElement(DropDownTriggerContainer, {
    onClick: function onClick(e) {
      e.stopPropagation();
      toggleDropdown();
    },
    withIcon: /*#__PURE__*/React__default.isValidElement(trigger) ? withIcon : true,
    isOpen: isOpen,
    className: "dropdown-trigger " + (isOpen ? 'open' : ''),
    iconColor: iconColor || (theme === THEME.DARK ? colors.white : '')
  }, /*#__PURE__*/React__default.isValidElement(trigger) ? trigger : /*#__PURE__*/React__default.createElement("span", null, trigger)), isOpen && /*#__PURE__*/React__default.createElement(DropDownBody, {
    backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    onScroll: handleScrolling,
    className: 'dropdown-body',
    ref: dropDownBodyRef,
    position: position
  }, children));
};

var _path$e;

function _extends$f() {
  _extends$f = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$f.apply(this, arguments);
}

function SvgCreateChannel(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$f({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$e || (_path$e = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M15.582 1.3c.31.117.517.414.517.745v2.833a3.448 3.448 0 010 6.71v2.831a.795.795 0 01-1.395.524c-.556-.636-1.531-1.238-2.857-1.68a13.047 13.047 0 00-1.935-.477v3.613a2.35 2.35 0 01-4.565.79l-.002-.005-1.788-5.122a4.33 4.33 0 012.024-8.16H7.2a16.675 16.675 0 001.837-.1 13.724 13.724 0 002.81-.6c1.325-.442 2.3-1.044 2.856-1.68a.795.795 0 01.878-.221zM8.322 5.46c-.368.022-.742.033-1.12.033H5.58a2.74 2.74 0 00-1.071 5.263M8.32 5.46v5.547a18.531 18.531 0 00-1.12-.034H5.58a2.73 2.73 0 01-1.07-.217m5.402.42V5.29c.87-.133 1.69-.329 2.439-.579a10.253 10.253 0 002.156-.988v9.019a10.257 10.257 0 00-2.156-.988c-.75-.25-1.57-.447-2.44-.58zm6.187-4.62V9.91a1.856 1.856 0 000-3.355zM8.32 12.6a16.92 16.92 0 00-1.12-.037H5.58c-.055 0-.11 0-.165-.003l1.43 4.095v.002a.76.76 0 001.475-.258V12.6z",
    fill: "#707388"
  })));
}

var _path$f;

function _extends$g() {
  _extends$g = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$g.apply(this, arguments);
}

function SvgCreateGroup(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$g({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$f || (_path$f = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.716 15.9h2.996a3.587 3.587 0 00-3.689-3.02c.01.085.031.175.065.259.35.862.567 1.792.628 2.76zM6.02 7.957a1.512 1.512 0 100-3.023 1.512 1.512 0 000 3.023zm8.15 0a1.511 1.511 0 100-3.023 1.511 1.511 0 000 3.023zM9.562 15.9a3.587 3.587 0 00-7.084 0h7.084zM6.02 9.557a3.112 3.112 0 100-6.224 3.112 3.112 0 000 6.224zm7.113 6.906c0 .55.418 1.037.967 1.037h4.22c.572 0 1.037-.464 1.037-1.037a5.187 5.187 0 00-5.848-5.145c-1.074.137-1.31 1.417-.904 2.421.34.841.528 1.76.528 2.724zm4.15-10.018a3.112 3.112 0 11-6.225 0 3.112 3.112 0 016.224 0zm-6.076 10.018a5.187 5.187 0 00-10.374 0c0 .573.465 1.037 1.038 1.037h8.298c.573 0 1.038-.464 1.038-1.037z",
    fill: "#707388"
  })));
}

var _path$g;

function _extends$h() {
  _extends$h = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$h.apply(this, arguments);
}

function SvgCreateChat(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$h({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$g || (_path$g = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 3.25a6.75 6.75 0 00-5.525 10.628 12.365 12.365 0 015.526-1.295c1.983 0 3.86.466 5.524 1.295a6.748 6.748 0 00-.752-8.651A6.75 6.75 0 0010 3.25zm6.323 12.05A8.249 8.249 0 004.166 4.166 8.25 8.25 0 1016.323 15.3zm-1.838-.256a10.872 10.872 0 00-4.485-.96h-.001a10.865 10.865 0 00-4.484.96 6.75 6.75 0 008.97 0zm-4.484-2.46l-.001.75v-.75zm-.001-6a1.75 1.75 0 100 3.5 1.75 1.75 0 000-3.5zm-2.298-.549a3.25 3.25 0 114.596 4.596 3.25 3.25 0 01-4.596-4.596z",
    fill: "#707388"
  })));
}

var _path$h, _path2$2, _path3$1;

function _extends$i() {
  _extends$i = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$i.apply(this, arguments);
}

function SvgAddChat(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$i({
    width: 24,
    height: 24,
    viewBox: "0 0 24.01 24.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$h || (_path$h = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4.128 2.179c.989-.529 1.962-.713 4.109-.713h7.66a1 1 0 110 2h-7.66c-2.041 0-2.615.182-3.165.476a2.86 2.86 0 00-1.196 1.196c-.294.55-.476 1.124-.476 3.165v7.66c0 2.041.182 2.615.476 3.165a2.86 2.86 0 001.196 1.196c.55.294 1.124.476 3.165.476h7.66c2.04 0 2.614-.182 3.165-.476a2.86 2.86 0 001.195-1.196c.295-.55.476-1.124.476-3.165v-7.66a1 1 0 012 0v7.66c0 2.147-.184 3.12-.712 4.108a4.86 4.86 0 01-2.016 2.016c-.989.53-1.962.713-4.109.713h-7.66c-2.146 0-3.12-.184-4.108-.713a4.86 4.86 0 01-2.016-2.016c-.528-.988-.712-1.961-.712-4.108v-7.66c0-2.147.184-3.12.712-4.108a4.86 4.86 0 012.016-2.016z",
    fill: "CurrentColor"
  })), _path2$2 || (_path2$2 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M20.769 3.43c.397.398.397 1.042 0 1.439l-8.475 8.475c-.376.376-1.492.981-2.333 1.409a.38.38 0 01-.514-.514c.427-.84 1.033-1.957 1.409-2.333l8.475-8.475a1.017 1.017 0 011.438 0z",
    fill: "CurrentColor"
  })), _path3$1 || (_path3$1 = /*#__PURE__*/React.createElement("path", {
    d: "M23.4 1.8a1 1 0 11-2 0 1 1 0 012 0z",
    fill: "CurrentColor"
  })));
}

var _path$i;

function _extends$j() {
  _extends$j = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$j.apply(this, arguments);
}

function SvgCross(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$j({
    width: 16,
    height: 16,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$i || (_path$i = /*#__PURE__*/React.createElement("path", {
    d: "M7.114 8L4.85 5.736a.626.626 0 11.886-.886L8 7.114l2.264-2.264a.626.626 0 11.886.886L8.886 8l2.264 2.264a.626.626 0 01-.886.886L8 8.886 5.736 11.15a.626.626 0 01-.886-.886L7.114 8z",
    fill: "#818C99"
  })));
}

var _path$j;

function _extends$k() {
  _extends$k = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$k.apply(this, arguments);
}

function SvgTick(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$k({
    width: 11,
    height: 9,
    viewBox: "0 0 10 10",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$j || (_path$j = /*#__PURE__*/React.createElement("path", {
    d: "M1.28 4.775a.75.75 0 00-1.06 1.06l2.722 2.723a.75.75 0 001.06 0l6.445-6.445a.75.75 0 10-1.06-1.06L3.471 6.967 1.28 4.775z",
    fill: "#fff"
  })));
}

var _templateObject$7, _templateObject2$7;

var CustomCheckbox = function CustomCheckbox(_ref) {
  var index = _ref.index,
      state = _ref.state,
      _onChange = _ref.onChange,
      checkedBackgroundColor = _ref.checkedBackgroundColor,
      backgroundColor = _ref.backgroundColor,
      tickColor = _ref.tickColor,
      borderRadius = _ref.borderRadius,
      disabled = _ref.disabled,
      size = _ref.size;
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(CustomLabel, {
    isChecked: state,
    size: size,
    checkedBackgroundColor: checkedBackgroundColor,
    backgroundColor: backgroundColor,
    tickColor: tickColor,
    borderRadius: borderRadius,
    htmlFor: "checkbox-" + index,
    disabled: disabled
  }, state && /*#__PURE__*/React__default.createElement(SvgTick, null)), /*#__PURE__*/React__default.createElement(Checkbox, {
    type: 'checkbox',
    disabled: disabled,
    id: "checkbox-" + index,
    checked: state,
    onChange: function onChange(e) {
      return _onChange(e);
    }
  }));
};
var CustomLabel = styled__default.label(_templateObject$7 || (_templateObject$7 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  width: ", ";\n  min-width: ", ";\n  height: ", ";\n  cursor: ", ";\n  border: ", ";\n  border-radius: ", ";\n  background-color: ", ";\n  opacity: ", ";\n\n  & > svg {\n    width: calc(100% - 4px);\n    height: calc(100% - 8px);\n  }\n"])), function (props) {
  return props.size || '12px';
}, function (props) {
  return props.size || '12px';
}, function (props) {
  return props.size || '12px';
}, function (props) {
  return !props.disabled && 'pointer';
}, function (props) {
  return props.isChecked ? 'none' : "1px solid " + colors.borderColor2;
}, function (props) {
  return props.borderRadius || '4px';
}, function (props) {
  return props.isChecked ? props.checkedBackgroundColor || colors.primary : props.backgroundColor || '#fff';
}, function (props) {
  return props.disabled && 0.4;
});
var Checkbox = styled__default.input(_templateObject2$7 || (_templateObject2$7 = _taggedTemplateLiteralLoose(["\n  display: none;\n"])));

var themeSelector = function themeSelector(store) {
  return store.ThemeReducer.theme;
};

var _templateObject$8;

var PopupContainer = function PopupContainer(_ref) {
  var children = _ref.children;
  React.useEffect(function () {
    var body = document.querySelector('body');

    if (body) {
      body.style.overflow = 'hidden';
    }

    return function () {
      if (body) {
        body.style.overflow = 'auto';
      }
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$3, null, children);
};
var Container$3 = styled__default.div(_templateObject$8 || (_templateObject$8 = _taggedTemplateLiteralLoose(["\n  direction: initial;\n  position: fixed;\n  top: 0;\n  left: 0;\n  //top: ", ";\n  //left: ", ";\n  z-index: 200;\n  //width: ", ";\n  //height: ", ";\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: rgba(0, 0, 0, 0.4);\n"])), function (props) {
  return props.top ? props.top + "px" : '0px';
}, function (props) {
  return props.left ? props.left + "px" : '0px';
}, function (props) {
  return props.width ? props.width + "px" : '0px';
}, function (props) {
  return props.height ? props.height + "px" : '0px';
});

var _templateObject$9, _templateObject2$8, _templateObject3$5, _templateObject4$4, _templateObject5$3, _templateObject6$2, _templateObject7$2, _templateObject8$2, _templateObject9$2, _templateObject10$2, _templateObject11$2;

var UsersPopup = function UsersPopup(_ref) {
  var channel = _ref.channel,
      toggleCreatePopup = _ref.toggleCreatePopup,
      actionType = _ref.actionType,
      getSelectedUsers = _ref.getSelectedUsers,
      memberIds = _ref.memberIds,
      creatChannelSelectedMembers = _ref.creatChannelSelectedMembers,
      popupHeight = _ref.popupHeight,
      selectIsRequired = _ref.selectIsRequired,
      popupWidth = _ref.popupWidth;
  var dispatch = reactRedux.useDispatch();
  var contactList = reactRedux.useSelector(contactListSelector);
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var usersList = reactRedux.useSelector(usersListSelector);
  var theme = reactRedux.useSelector(themeSelector);
  var getFromContacts = getShowOnlyContactUsers();
  var usersLoadingState = reactRedux.useSelector(usersLoadingStateSelector);
  var selectedMembersCont = React.useRef('');

  var _useState = React.useState(''),
      userSearchValue = _useState[0],
      setUserSearchValue = _useState[1];

  var _useState2 = React.useState(creatChannelSelectedMembers || []),
      selectedMembers = _useState2[0],
      setSelectedMembers = _useState2[1];

  var _useState3 = React.useState(0),
      usersContHeight = _useState3[0],
      setUsersContHeight = _useState3[1];

  var _useState4 = React.useState([]),
      filteredUsers = _useState4[0],
      setFilteredUsers = _useState4[1];

  var memberDisplayText = getChannelTypesMemberDisplayTextMap();
  var channelTypeRoleMap = getDefaultRolesByChannelTypesMap();
  var popupTitleText = channel && (memberDisplayText && memberDisplayText[channel.type] ? "Add " + memberDisplayText[channel.type] + "s" : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'Subscribers' : 'Members');

  var handleMembersListScroll = function handleMembersListScroll(event) {
    if (!userSearchValue && event.target.scrollHeight - event.target.scrollTop <= event.target.offsetHeight + 300) {
      if (!getFromContacts && usersLoadingState === LOADING_STATE.LOADED) {
        dispatch(loadMoreUsersAC(20));
      }
    }
  };

  var handleTypeSearchUser = function handleTypeSearchUser(event) {
    setUserSearchValue(event.currentTarget.value);
  };

  var handleUserSelect = function handleUserSelect(event, contact) {
    var newSelectedMembers = [].concat(selectedMembers);

    if (event.target.checked) {
      var role = channel ? channelTypeRoleMap && channelTypeRoleMap[channel.type] ? channelTypeRoleMap[channel.type] : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'subscriber' : 'participant' : 'participant';
      newSelectedMembers.push({
        id: contact.id,
        displayName: contact.displayName,
        avatarUrl: contact.avatarUrl,
        role: role
      });
    } else {
      var itemToDeleteIndex = newSelectedMembers.findIndex(function (member) {
        return member.id === contact.id;
      });

      if (itemToDeleteIndex >= 0) {
        newSelectedMembers.splice(itemToDeleteIndex, 1);
      }
    }

    setUserSearchValue('');
    setSelectedMembers(newSelectedMembers);
  };

  var removeMember = function removeMember(member) {
    var newSelectedMembers = [].concat(selectedMembers);
    var itemToDeleteIndex = newSelectedMembers.findIndex(function (m) {
      return m.id === member.id;
    });

    if (itemToDeleteIndex >= 0) {
      newSelectedMembers.splice(itemToDeleteIndex, 1);
    }

    setSelectedMembers(newSelectedMembers);
  };

  var handleCreateChannel = function handleCreateChannel(selectedUser) {
    if (actionType === 'createChat' && selectedUser) {
      var channelData = {
        metadata: '',
        label: '',
        type: CHANNEL_TYPE.DIRECT,
        members: [_extends({}, selectedUser, {
          role: 'owner'
        })]
      };
      dispatch(createChannelAC(channelData));
    } else {
      var selectedMembersList = selectedMembers.map(function (member) {
        return {
          id: member.id,
          role: member.role
        };
      });

      if (actionType === 'selectUsers' && getSelectedUsers) {
        getSelectedUsers(selectedMembersList, 'create');
      } else {
        console.log('call add members ... ', selectedMembersList);
        dispatch(addMembersAC(channel.id, selectedMembersList));
      }
    }

    toggleCreatePopup();
  };

  var handleAddMember = function handleAddMember(user) {
    handleCreateChannel(user);
  };

  var handleGoBack = function handleGoBack() {
    if (getSelectedUsers) {
      getSelectedUsers(selectedMembers, 'back');
    }
  };

  var handleClosePopup = function handleClosePopup() {
    toggleCreatePopup();
  };

  React.useEffect(function () {
    if (getFromContacts) {
      if (!userSearchValue) {
        setFilteredUsers(contactList.map(function (cont) {
          return cont.user;
        }));
      }
    } else {
      setFilteredUsers(usersList);
    }
  }, [contactList, usersList]);
  useDidUpdate(function () {
    if (getFromContacts) {
      if (userSearchValue) {
        var filteredContacts = contactList.filter(function (contact) {
          return contact.firstName && contact.firstName.toLowerCase().includes(userSearchValue.toLowerCase()) || contact.lastName && contact.lastName.toLowerCase().includes(userSearchValue.toLowerCase()) || contact.id.toLowerCase().includes(userSearchValue.toLowerCase());
        });
        setFilteredUsers(filteredContacts.map(function (cont) {
          return cont.user;
        }));
      } else {
        setFilteredUsers(contactList.map(function (cont) {
          return cont.user;
        }));
      }
    } else {
      dispatch(getUsersAC({
        query: userSearchValue,
        filter: 'all',
        limit: 50
      }));
    }
  }, [userSearchValue]);
  React.useEffect(function () {
    if (selectedMembersCont.current) {
      setUsersContHeight(selectedMembersCont.current.offsetHeight);
    } else {
      setUsersContHeight(0);
    }
  }, [selectedMembers]);
  React.useEffect(function () {
    if (getFromContacts) {
      dispatch(getContactsAC());
    } else {
      dispatch(getUsersAC({
        query: userSearchValue,
        filter: 'all',
        limit: 50
      }));
    }
  }, []);
  return /*#__PURE__*/React__default.createElement(PopupContainer, {
    theme: theme
  }, /*#__PURE__*/React__default.createElement(Popup, {
    maxHeight: popupHeight || '721px',
    width: popupWidth || '433px',
    maxWidth: popupWidth || '433px',
    height: popupHeight,
    padding: '0',
    display: 'flex',
    backgroundColor: theme === THEME.DARK ? colors.dark : colors.white,
    boxShadow: theme === THEME.DARK ? '0px 0px 30px rgba(255,255,255,0.1)' : ''
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '12px',
    paddingV: '24px',
    withFooter: actionType !== 'createChat'
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    color: colors.textColor2,
    onClick: handleClosePopup
  }), /*#__PURE__*/React__default.createElement(PopupName, {
    padding: '0 12px'
  }, actionType === 'createChat' ? 'Creat a new chat' : popupTitleText), /*#__PURE__*/React__default.createElement(SearchUserCont, {
    className: 'p-relative'
  }, /*#__PURE__*/React__default.createElement(StyledSearchSvg, null), /*#__PURE__*/React__default.createElement(SearchUsersInput, {
    height: '40px',
    onChange: handleTypeSearchUser,
    value: userSearchValue,
    placeholder: 'Search for users',
    type: 'text',
    widthBorder: theme !== THEME.DARK,
    backgroundColor: colors.backgroundColor,
    color: colors.textColor1
  }), userSearchValue && /*#__PURE__*/React__default.createElement(ClearTypedText, {
    color: colors.textColor1,
    onClick: function onClick() {
      return setUserSearchValue('');
    }
  })), actionType !== 'createChat' && selectedMembers.length !== 0 && /*#__PURE__*/React__default.createElement(SelectedMembersContainer, {
    ref: selectedMembersCont
  }, selectedMembers.map(function (member) {
    return /*#__PURE__*/React__default.createElement(SelectedMemberBubble, {
      backgroundColor: colors.backgroundColor,
      key: "selected-" + member.id
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      image: member.avatarUrl,
      name: member.displayName || member.id,
      size: 28,
      textSize: 12,
      setDefaultAvatar: true,
      border: '0.5px solid rgba(0, 0, 0, 0.1)'
    }), /*#__PURE__*/React__default.createElement(SelectedMemberName, {
      color: colors.textColor1
    }, member.displayName), /*#__PURE__*/React__default.createElement(StyledSubtractSvg, {
      onClick: function onClick() {
        return removeMember(member);
      }
    }));
  })), /*#__PURE__*/React__default.createElement(MembersContainer, {
    isAdd: actionType !== 'createChat',
    selectedMembersHeight: usersContHeight,
    onScroll: handleMembersListScroll
  }, filteredUsers.map(function (user) {
    if (actionType === 'addMembers' && memberIds && memberIds.includes(user.id)) {
      return null;
    }

    var isSelected = selectedMembers.findIndex(function (member) {
      return member.id === user.id;
    }) >= 0;
    var memberDisplayName = makeUsername(contactsMap[user.id], user, getFromContacts);
    return /*#__PURE__*/React__default.createElement(ListRow, {
      isAdd: actionType !== 'createChat',
      hoverBackground: colors.hoverBackgroundColor,
      key: user.id,
      onClick: function onClick() {
        return actionType === 'createChat' && handleAddMember(user);
      }
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      image: user.avatarUrl,
      name: user.firstName || user.id,
      size: 40,
      textSize: 16,
      setDefaultAvatar: true
    }), /*#__PURE__*/React__default.createElement(UserNamePresence, null, /*#__PURE__*/React__default.createElement(MemberName, {
      color: colors.textColor1
    }, memberDisplayName), /*#__PURE__*/React__default.createElement(SubTitle, null, user.presence && user.presence.state === USER_PRESENCE_STATUS.ONLINE ? 'Online' : user.presence && user.presence.lastActiveAt && userLastActiveDateFormat(user.presence.lastActiveAt))), actionType !== 'createChat' && /*#__PURE__*/React__default.createElement(CustomCheckbox, {
      index: user.id,
      state: isSelected,
      backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
      checkedBackgroundColor: colors.primary,
      onChange: function onChange(e) {
        return handleUserSelect(e, {
          id: user.id,
          displayName: memberDisplayName,
          avatarUrl: user.avatarUrl
        });
      },
      size: '18px'
    }));
  }))), actionType !== 'createChat' && /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor,
    marginTop: 'auto'
  }, actionType === 'selectUsers' ? /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: handleGoBack
  }, "Back") : /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: toggleCreatePopup
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.white,
    backgroundColor: colors.primary,
    borderRadius: '8px',
    disabled: selectIsRequired && selectedMembers.length === 0,
    onClick: function onClick() {
      return handleCreateChannel();
    }
  }, actionType === 'selectUsers' ? 'Create' : 'Add'))));
};
var List = styled__default.div(_templateObject$9 || (_templateObject$9 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  margin-top: 12px;\n  min-height: 150px;\n  box-sizing: border-box;\n"])));
var MembersContainer = styled__default(List)(_templateObject2$8 || (_templateObject2$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column;\n  //margin-top: 24px;\n  position: relative;\n  max-height: ", ";\n  overflow-y: auto;\n\n  //width: calc(100% + 16px);\n  padding-right: 16px;\n\n  /* width */\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  /* Track */\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  /* Handle */\n  &::-webkit-scrollbar-thumb {\n    background: #b6b6b6;\n    border-radius: 4px;\n  }\n\n  /* Handle on hover */\n  &::-webkit-scrollbar-thumb:hover {\n    background: #555;\n  }\n"])), function (props) {
  return "calc(100% - (" + ((props.isAdd ? 67 : 70) + props.selectedMembersHeight) + "px))";
});
var SearchUserCont = styled__default.div(_templateObject3$5 || (_templateObject3$5 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  margin: 24px 12px 0;\n\n  ", " {\n    top: 10px;\n    right: 11px;\n  }\n"])), ClearTypedText);
var SearchUsersInput = styled__default.input(_templateObject4$4 || (_templateObject4$4 = _taggedTemplateLiteralLoose(["\n  height: 40px;\n  width: 100%;\n  font-size: 14px;\n  border: ", ";\n  box-sizing: border-box;\n  border-radius: 8px;\n  padding-left: 36px;\n  color: ", ";\n  background-color: ", ";\n\n  &::placeholder {\n    color: ", ";\n    font-size: 14px;\n    opacity: 1;\n  }\n\n  &:focus {\n    outline: none;\n  }\n"])), function (props) {
  return props.widthBorder ? "1px solid " + colors.gray1 : 'none';
}, function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.backgroundColor || colors.backgroundColor;
}, colors.textColor2);
var ListRow = styled__default.div(_templateObject5$3 || (_templateObject5$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: space-between;\n  flex-direction: row;\n  align-items: center;\n  padding: 7px 12px;\n  cursor: ", ";\n  border-radius: 6px;\n  transition: all 0.2s;\n\n  &:hover {\n    background-color: ", ";\n  }\n\n  & ", " {\n    width: 10px;\n    height: 10px;\n  }\n"])), function (props) {
  return !props.isAdd && 'pointer';
}, function (props) {
  return !props.isAdd && (props.hoverBackground || colors.gray0);
}, UserStatus);
var UserNamePresence = styled__default.div(_templateObject6$2 || (_templateObject6$2 = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  max-width: calc(100% - 70px);\n  margin: 0 auto 0 8px;\n  line-height: 10px;\n"])));
var MemberName = styled__default.h4(_templateObject7$2 || (_templateObject7$2 = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-size: 15px;\n  font-weight: 500;\n  line-height: 16px;\n  color: ", ";\n  margin: 0;\n  max-width: calc(100% - 10px);\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n"])), function (props) {
  return props.color || colors.textColor1;
});
var SelectedMembersContainer = styled__default.div(_templateObject8$2 || (_templateObject8$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: flex-start;\n  flex-wrap: wrap;\n  width: 100%;\n  max-height: 85px;\n  overflow-x: hidden;\n  padding: 2px 12px 0;\n  box-sizing: border-box;\n  //flex: 0 0 auto;\n"])));
var SelectedMemberBubble = styled__default.div(_templateObject9$2 || (_templateObject9$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: space-between;\n  background: ", ";\n  border-radius: 16px;\n  align-items: center;\n  padding: 4px 10px 4px 0;\n  height: 28px;\n  margin: 8px 8px 0 0;\n  box-sizing: border-box;\n"])), function (props) {
  return props.backgroundColor;
});
var SelectedMemberName = styled__default.span(_templateObject10$2 || (_templateObject10$2 = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 16px;\n  margin-left: 8px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var StyledSubtractSvg = styled__default(SvgCross)(_templateObject11$2 || (_templateObject11$2 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  margin-left: 4px;\n  transform: translate(2px, 0);\n"])));

var _path$k;

function _extends$l() {
  _extends$l = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$l.apply(this, arguments);
}

function SvgCameraIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$l({
    width: 42,
    height: 42,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$k || (_path$k = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M11.55 11.55c1.206 0 2.119-.428 2.813-1.095.511-.49.899-1.124 1.164-1.559l.115-.186c.315-.505.542-.802.82-1.005.238-.172.624-.355 1.388-.355h6.3c.763 0 1.15.183 1.387.355.278.203.505.5.82 1.005l.116.186c.265.435.652 1.068 1.163 1.56.695.666 1.607 1.094 2.814 1.094 1.539 0 2.078.008 2.496.091a4.725 4.725 0 013.713 3.712c.083.418.09.958.09 2.497v7.245c0 1.79 0 3.038-.08 4.01-.078.953-.223 1.5-.434 1.915a4.725 4.725 0 01-2.065 2.065c-.415.212-.963.357-1.916.435-.971.079-2.22.08-4.01.08H13.753c-1.79 0-3.038-.001-4.01-.08-.953-.078-1.5-.224-1.915-.435a4.725 4.725 0 01-2.065-2.065c-.212-.415-.357-.962-.435-1.915-.079-.972-.08-2.22-.08-4.01v-7.242c0-1.542.007-2.083.09-2.501a4.725 4.725 0 013.711-3.71c.42-.084.96-.092 2.502-.092zm6.3-7.35c-1.337 0-2.394.342-3.24.958-.804.585-1.299 1.337-1.64 1.882l-.158.255c-.285.459-.434.7-.63.888-.126.12-.264.217-.632.217h-.183c-1.29 0-2.17 0-2.934.152a7.875 7.875 0 00-6.184 6.184c-.153.765-.153 1.644-.152 2.934V25.163c0 1.707 0 3.083.09 4.198.095 1.148.293 2.156.768 3.09a7.875 7.875 0 003.442 3.44c.932.476 1.94.674 3.089.768 1.115.091 2.491.091 4.198.091h14.628c1.707 0 3.084 0 4.199-.09 1.148-.095 2.156-.293 3.089-.768a7.875 7.875 0 003.441-3.442c.476-.933.674-1.94.768-3.089.09-1.115.09-2.491.09-4.198v-7.495c.001-1.288.001-2.166-.15-2.93a7.875 7.875 0 00-6.188-6.186c-.764-.152-1.641-.152-2.93-.152h-.181c-.369 0-.506-.096-.632-.217-.197-.189-.346-.43-.63-.888-.05-.078-.102-.163-.159-.255-.34-.545-.835-1.297-1.64-1.882-.846-.616-1.903-.958-3.24-.958h-6.3zm7.875 17.325a4.725 4.725 0 11-9.45 0 4.725 4.725 0 019.45 0zm3.15 0a7.875 7.875 0 11-15.75 0 7.875 7.875 0 0115.75 0z",
    fill: "CurrentColor"
  })));
}

var getCroppedImg = function getCroppedImg(imageSrc, pixelCrop, rotation, fileName) {
  try {
    if (rotation === void 0) {
      rotation = 0;
    }

    return Promise.resolve(createImage(imageSrc)).then(function (image) {
      var canvas = document.createElement('canvas');
      var ctx = canvas.getContext('2d');
      var maxSize = Math.max(image.width, image.height);
      var safeArea = 2 * (maxSize / 2 * Math.sqrt(2));
      canvas.width = safeArea;
      canvas.height = safeArea;
      ctx.translate(safeArea / 2, safeArea / 2);
      ctx.rotate(getRadianAngle(rotation));
      ctx.translate(-safeArea / 2, -safeArea / 2);
      ctx.drawImage(image, safeArea / 2 - image.width * 0.5, safeArea / 2 - image.height * 0.5);
      var data = ctx.getImageData(0, 0, safeArea, safeArea);
      canvas.width = pixelCrop.width;
      canvas.height = pixelCrop.height;
      ctx.putImageData(data, Math.round(0 - safeArea / 2 + image.width * 0.5 - pixelCrop.x), Math.round(0 - safeArea / 2 + image.height * 0.5 - pixelCrop.y));
      return new Promise(function (resolve) {
        canvas.toBlob(function (file) {
          var newFile = new File([file], fileName);
          resolve(newFile);
        }, 'image/jpeg');
      });
    });
  } catch (e) {
    return Promise.reject(e);
  }
};

var createImage = function createImage(url) {
  return new Promise(function (resolve, reject) {
    var image = new Image();
    image.addEventListener('load', function () {
      return resolve(image);
    });
    image.addEventListener('error', function (error) {
      return reject(error);
    });
    image.setAttribute('crossOrigin', 'anonymous');
    image.src = url;
  });
};

function getRadianAngle(degreeValue) {
  return degreeValue * Math.PI / 180;
}

var _templateObject$a, _templateObject2$9;

var ImageCrop = function ImageCrop(_ref) {
  var theme = _ref.theme,
      image = _ref.image,
      onAccept = _ref.onAccept,
      handleClosePopup = _ref.handleClosePopup;

  var _useState = React.useState(null),
      area = _useState[0],
      setArea = _useState[1];

  var _useStateComplex = useStateComplex({
    image: image.url,
    crop: {
      x: 0,
      y: 0
    },
    zoom: 1,
    aspect: 1
  }),
      state = _useStateComplex[0],
      setState = _useStateComplex[1];

  var onCropChange = function onCropChange(crop) {
    setState({
      crop: crop
    });
  };

  var onZoomChange = function onZoomChange(zoom) {
    setState({
      zoom: zoom
    });
  };

  var onCropComplete = React.useCallback(function (_croppedArea, croppedAreaPixels) {
    setArea(croppedAreaPixels);
  }, []);
  var returnCroppedImage = React.useCallback(function () {
    try {
      var _temp2 = _catch(function () {
        return Promise.resolve(getCroppedImg(state.image, area, 0, image.name)).then(function (imageFile) {
          onAccept(imageFile);
          handleClosePopup(true);
        });
      }, function (e) {
        console.error(e);
      });

      return Promise.resolve(_temp2 && _temp2.then ? _temp2.then(function () {}) : void 0);
    } catch (e) {
      return Promise.reject(e);
    }
  }, [area]);
  return /*#__PURE__*/React__default.createElement(PopupContainer, null, /*#__PURE__*/React__default.createElement(Popup, {
    theme: theme,
    backgroundColor: colors.backgroundColor,
    minWidth: '500px',
    maxWidth: '600px',
    padding: '0'
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '24px',
    paddingV: '24px'
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    onClick: handleClosePopup
  }), /*#__PURE__*/React__default.createElement(Row, {
    align: 'center'
  }, /*#__PURE__*/React__default.createElement(PopupName, null, "Crop image")), /*#__PURE__*/React__default.createElement("div", {
    className: 'crop-container'
  }, /*#__PURE__*/React__default.createElement(CropperWrapper, null, /*#__PURE__*/React__default.createElement(Cropper, {
    image: state.image,
    crop: state.crop,
    zoom: state.zoom,
    aspect: state.aspect,
    onCropChange: onCropChange,
    onZoomChange: onZoomChange,
    onCropComplete: onCropComplete,
    cropShape: 'round',
    showGrid: false
  })), /*#__PURE__*/React__default.createElement(Controls, {
    className: 'controls'
  }, /*#__PURE__*/React__default.createElement("input", {
    type: 'range',
    value: state.zoom,
    min: 1,
    max: 3,
    step: 0.1,
    "aria-labelledby": 'Zoom',
    onChange: function onChange(e) {
      onZoomChange(e.target.value);
    },
    className: 'zoom-range'
  })))), /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: function onClick() {
      return handleClosePopup();
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    backgroundColor: colors.primary,
    borderRadius: '8px',
    onClick: returnCroppedImage
  }, "Save"))));
};
var CropperWrapper = styled__default.div(_templateObject$a || (_templateObject$a = _taggedTemplateLiteralLoose(["\n  position: relative;\n  width: 100%;\n  height: 300px;\n  margin: 14px 0;\n"])));
var Controls = styled__default.div(_templateObject2$9 || (_templateObject2$9 = _taggedTemplateLiteralLoose(["\n  & > input {\n    width: 100%;\n    -webkit-appearance: none;\n    background-color: rgba(178, 182, 190, 0.4);\n    border-radius: 3px;\n\n    &::-webkit-slider-runnable-track {\n      height: 6px;\n      -webkit-appearance: none;\n      color: ", ";\n      margin-top: -1px;\n      border-radius: 3px;\n    }\n    &::-webkit-slider-thumb {\n      width: 16px;\n      -webkit-appearance: none;\n      height: 16px;\n      cursor: ew-resize;\n      background: ", ";\n      border-radius: 50%;\n      transform: translate(0, -5px);\n    }\n  }\n"])), colors.primary, colors.primary);

var _templateObject$b, _templateObject2$a, _templateObject3$6, _templateObject4$5, _templateObject5$4, _templateObject6$3, _templateObject7$3, _templateObject8$3, _templateObject9$3;
function CreateChannel(_ref) {
  var handleClose = _ref.handleClose,
      channelType = _ref.channelType,
      uriPrefixOnCreateChannel = _ref.uriPrefixOnCreateChannel,
      channelTypeRequiredFieldsMap = _ref.channelTypeRequiredFieldsMap,
      uploadPhotoIcon = _ref.uploadPhotoIcon,
      _ref$showSubject = _ref.showSubject,
      showSubject = _ref$showSubject === void 0 ? true : _ref$showSubject,
      _ref$showDescription = _ref.showDescription,
      showDescription = _ref$showDescription === void 0 ? true : _ref$showDescription,
      _ref$showUri = _ref.showUri,
      showUri = _ref$showUri === void 0 ? true : _ref$showUri,
      _ref$showUploadAvatar = _ref.showUploadAvatar,
      showUploadAvatar = _ref$showUploadAvatar === void 0 ? true : _ref$showUploadAvatar,
      withoutConfig = _ref.withoutConfig;
  var dispatch = reactRedux.useDispatch();
  var uriRegexp = /^[A-Za-z0-9]*$/;
  var fileUploader = React.useRef(null);
  var uriPrefixRef = React.useRef(null);
  var theme = reactRedux.useSelector(themeSelector);

  var _useState = React.useState(false),
      usersPopupVisible = _useState[0],
      setUsersPopupVisible = _useState[1];

  var _useState2 = React.useState(true),
      createGroupChannelPopupVisible = _useState2[0],
      setCreateGroupChannelPopupVisible = _useState2[1];

  var _useState3 = React.useState([]),
      selectedMembers = _useState3[0],
      setSelectedMembers = _useState3[1];

  var _useState4 = React.useState(''),
      subjectValue = _useState4[0],
      setSubjectValue = _useState4[1];

  var _useState5 = React.useState(''),
      URIValue = _useState5[0],
      setURIValue = _useState5[1];

  var _useState6 = React.useState(''),
      wrongUri = _useState6[0],
      setWrongUri = _useState6[1];

  var _useState7 = React.useState(true),
      nextButtonDisable = _useState7[0],
      setNextButtonDisable = _useState7[1];

  var _useState8 = React.useState(''),
      uriPrefixWidth = _useState8[0],
      setUriPrefixWidth = _useState8[1];

  var _useState9 = React.useState(''),
      metadataValue = _useState9[0],
      setMetadataValue = _useState9[1];

  var _useState10 = React.useState(false),
      cropPopup = _useState10[0],
      setCropPopup = _useState10[1];

  var _useStateComplex = useStateComplex({
    src: {},
    url: ''
  }),
      newAvatar = _useStateComplex[0],
      setNewAvatar = _useStateComplex[1];

  var channelTypeRoleMap = getDefaultRolesByChannelTypesMap();
  var createGroupChannel = channelType === CHANNEL_TYPE.GROUP || channelType === CHANNEL_TYPE.PRIVATE;
  var requiredFields = channelTypeRequiredFieldsMap && channelTypeRequiredFieldsMap[channelType];

  var toggleCreatePopup = function toggleCreatePopup() {
    setUsersPopupVisible(!usersPopupVisible);
    handleClose();
  };

  var handleAddMembersForCreateChannel = function handleAddMembersForCreateChannel(members, action) {
    setSelectedMembers(members);
    setCreateGroupChannelPopupVisible(true);

    if (action === 'create') {
      handleCreateChannel(members);
    } else {
      setUsersPopupVisible(!usersPopupVisible);
    }
  };

  var toggleCreateGroupChannelPopup = function toggleCreateGroupChannelPopup() {
    if (createGroupChannelPopupVisible) {
      setSubjectValue('');
      setURIValue('');
      setMetadataValue('');
      setSelectedMembers([]);
      setCropPopup(false);
      setNewAvatar({
        src: {},
        url: ''
      });
    }

    handleClose();
    setCreateGroupChannelPopupVisible(!createGroupChannelPopupVisible);
  };

  var GoToAddMember = function GoToAddMember() {
    if (requiredFields) {
      if (!(requiredFields.subject && !subjectValue || requiredFields.description && !metadataValue || requiredFields.uri && !URIValue)) {
        setUsersPopupVisible(true);
        setCreateGroupChannelPopupVisible(false);
      }
    } else {
      setUsersPopupVisible(true);
      setCreateGroupChannelPopupVisible(false);
    }
  };

  var handleCreateChannel = function handleCreateChannel(members) {
    var createChannelParams = {
      subject: subjectValue,
      metadata: {
        d: metadataValue
      },
      uri: URIValue,
      members: members,
      type: channelType,
      avatarFile: newAvatar.src.file
    };
    var membersToAdd = members;

    if (channelTypeRoleMap) {
      membersToAdd = members.map(function (mem) {
        return _extends({}, mem, {
          role: channelTypeRoleMap[channelType]
        });
      });
    } else {
      if (!createGroupChannel) {
        membersToAdd = members.map(function (mem) {
          return _extends({}, mem, {
            role: 'subscriber'
          });
        });
      }
    }

    if (requiredFields) {
      if (requiredFields.members && members.length > 0) {
        dispatch(createChannelAC(_extends({}, createChannelParams, {
          members: membersToAdd
        })));
        toggleCreateGroupChannelPopup();
      } else if (!requiredFields.members) {
        dispatch(createChannelAC(_extends({}, createChannelParams, {
          members: membersToAdd
        })));
        toggleCreateGroupChannelPopup();
      }
    } else {
      dispatch(createChannelAC(_extends({}, createChannelParams, {
        members: membersToAdd
      })));
      toggleCreateGroupChannelPopup();
    }
  };

  var handleTypeSubject = function handleTypeSubject(e) {
    setSubjectValue(e.currentTarget.value);
  };

  var handleTypeURI = function handleTypeURI(e) {
    checkURIRegexp(e);
    setURIValue(e.currentTarget.value);
  };

  var checkURIRegexp = function checkURIRegexp(e) {
    if (uriRegexp.test(e.currentTarget.value)) {
      if (e.currentTarget.value.length >= 5 && e.currentTarget.value.length <= 50) {
        setWrongUri('');
      } else {
        setWrongUri('short');
      }
    } else {
      setWrongUri('dontMatch');
    }
  };

  var handleTypeMetadata = function handleTypeMetadata(e) {
    setMetadataValue(e.currentTarget.value);
  };

  var handleSelectImage = function handleSelectImage() {
    var image = fileUploader.current.files[0];
    resizeImage(image).then(function (resizedFile) {
      setNewAvatar({
        url: URL.createObjectURL(resizedFile.blob),
        name: image.name
      });
      setCropPopup(true);
    });
  };

  var handleImageCrop = function handleImageCrop(image) {
    setNewAvatar({
      src: {
        file: image
      },
      url: URL.createObjectURL(image)
    });
    fileUploader.current.value = null;
  };

  var handleCloseCropPopup = function handleCloseCropPopup(cropped) {
    if (!cropped) {
      setNewAvatar({
        src: {},
        url: ''
      });
    }

    fileUploader.current.value = null;
    setCropPopup(false);
  };

  React.useEffect(function () {
    setUriPrefixWidth(uriPrefixRef.current && uriPrefixRef.current.getBoundingClientRect().width + 15);
  }, []);
  React.useEffect(function () {
    if (requiredFields) {
      if (requiredFields.subject && !subjectValue || requiredFields.description && !metadataValue || requiredFields.uri && !URIValue) {
        setNextButtonDisable(true);
      } else {
        setNextButtonDisable(false);
      }
    } else {
      setNextButtonDisable(false);
    }
  }, [subjectValue, createGroupChannel, URIValue]);
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, withoutConfig ? /*#__PURE__*/React__default.createElement(UsersPopup, {
    popupHeight: '540px',
    popupWidth: '520px',
    toggleCreatePopup: handleClose,
    actionType: 'createChat'
  }) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, usersPopupVisible && /*#__PURE__*/React__default.createElement(UsersPopup, {
    toggleCreatePopup: toggleCreatePopup,
    getSelectedUsers: handleAddMembersForCreateChannel,
    creatChannelSelectedMembers: selectedMembers,
    actionType: 'selectUsers',
    selectIsRequired: channelTypeRequiredFieldsMap && channelTypeRequiredFieldsMap[channelType] && channelTypeRequiredFieldsMap[channelType].members,
    channel: {
      type: channelType
    },
    popupHeight: '540px',
    popupWidth: '520px'
  }), createGroupChannelPopupVisible && /*#__PURE__*/React__default.createElement(PopupContainer, null, /*#__PURE__*/React__default.createElement(Popup, {
    backgroundColor: theme === THEME.DARK ? colors.dark : colors.white,
    boxShadow: theme === THEME.DARK ? '0px 0px 30px rgba(255,255,255,0.1)' : '',
    maxHeight: '600px',
    width: '520px',
    maxWidth: '520px',
    padding: '0'
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '24px',
    paddingV: '24px'
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    color: colors.textColor1,
    onClick: toggleCreateGroupChannelPopup
  }), /*#__PURE__*/React__default.createElement(PopupName, {
    color: colors.textColor1,
    marginBottom: '20px'
  }, "Create ", createGroupChannel ? 'Group' : 'Channel'), !createGroupChannel && /*#__PURE__*/React__default.createElement(CrateChannelTitle, null, "Create a Channel to post your content to a large audience."), showUploadAvatar && /*#__PURE__*/React__default.createElement(UploadChannelAvatar, null, newAvatar.url ? /*#__PURE__*/React__default.createElement(AvatarWrapper, null, /*#__PURE__*/React__default.createElement(Avatar, {
    image: newAvatar.url,
    size: 90,
    name: subjectValue
  }), /*#__PURE__*/React__default.createElement(RemoveSelectedAvatar, {
    onClick: function onClick() {
      return setNewAvatar({
        src: {},
        url: ''
      });
    }
  }, "Remove")) : /*#__PURE__*/React__default.createElement(UploadAvatarLabel, {
    iconColor: colors.primary,
    backgroundColor: colors.primaryLight,
    htmlFor: 'uploadImage'
  }, uploadPhotoIcon || /*#__PURE__*/React__default.createElement(SvgCameraIcon, null)), /*#__PURE__*/React__default.createElement(FileUploaderInput, {
    ref: fileUploader,
    type: 'file',
    accept: '.png,.jpeg,.jpg',
    id: 'uploadImage',
    onChange: handleSelectImage
  })), showSubject && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Label, {
    color: colors.textColor1
  }, " ", createGroupChannel ? 'Group' : 'Channel', " name"), /*#__PURE__*/React__default.createElement(CustomInput, {
    type: 'text',
    value: subjectValue,
    onChange: handleTypeSubject,
    placeholder: "Enter " + (createGroupChannel ? 'group' : 'channel') + " name",
    theme: theme,
    color: colors.textColor1
  })), showDescription && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Label, {
    color: colors.textColor1
  }, "Description"), /*#__PURE__*/React__default.createElement(CustomInput, {
    type: 'text',
    value: metadataValue,
    onChange: handleTypeMetadata,
    placeholder: "Enter " + (createGroupChannel ? 'group' : 'channel') + " description",
    theme: theme,
    color: colors.textColor1
  })), showUri && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Label, {
    color: colors.textColor1
  }, "URL"), /*#__PURE__*/React__default.createElement(UriInputWrapper, {
    uriPrefixWidth: uriPrefixWidth
  }, uriPrefixOnCreateChannel && /*#__PURE__*/React__default.createElement(UriPrefix, {
    ref: uriPrefixRef
  }, uriPrefixOnCreateChannel), /*#__PURE__*/React__default.createElement(CustomInput, {
    type: 'text',
    value: URIValue,
    onChange: handleTypeURI,
    onBlur: checkURIRegexp,
    placeholder: 'chan12',
    error: !!wrongUri,
    theme: theme,
    color: colors.textColor1
  }), !!wrongUri && /*#__PURE__*/React__default.createElement(InputErrorMessage, null, wrongUri === 'short' ? 'The name should be 5-50 characters long' : 'The name is invalid. Please provide na name from the allowed range of characters')), /*#__PURE__*/React__default.createElement(ChannelUriDescription, null, "Give a URL to your channel so you can share it with others inviting them to join. Choose a name from the allowed range: a-z, 0-9, and _(underscores) between 5-50 characters."))), /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: function onClick() {
      return handleClose();
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    backgroundColor: colors.primary,
    borderRadius: '8px',
    onClick: function onClick() {
      return GoToAddMember();
    },
    disabled: nextButtonDisable
  }, "Next"))), cropPopup && /*#__PURE__*/React__default.createElement(ImageCrop, {
    image: newAvatar,
    onAccept: handleImageCrop,
    handleClosePopup: function handleClosePopup(cropped) {
      return handleCloseCropPopup(cropped);
    }
  }))));
}
var CrateChannelTitle = styled__default.p(_templateObject$b || (_templateObject$b = _taggedTemplateLiteralLoose(["\n  font-size: 15px;\n  font-weight: 400;\n  line-height: 150%;\n  margin: 0 0 20px;\n  color: ", ";\n"])), colors.textColor2);
var UploadAvatarLabel = styled__default.label(_templateObject2$a || (_templateObject2$a = _taggedTemplateLiteralLoose(["\n  display: flex;\n  width: 90px;\n  height: 90px;\n  align-items: center;\n  justify-content: center;\n  background-color: ", ";\n  border-radius: 50%;\n  cursor: pointer;\n\n  & > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.backgroundColor || colors.backgroundColor;
}, function (props) {
  return props.iconColor;
});
var URILabel = styled__default.label(_templateObject3$6 || (_templateObject3$6 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 15px;\n  margin-top: 18px;\n  margin-bottom: 5px;\n"])));
var UploadChannelAvatar = styled__default.div(_templateObject4$5 || (_templateObject4$5 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n"])));
var FileUploaderInput = styled__default.input(_templateObject5$4 || (_templateObject5$4 = _taggedTemplateLiteralLoose(["\n  display: none;\n"])));
var RemoveSelectedAvatar = styled__default.span(_templateObject6$3 || (_templateObject6$3 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  margin-left: 16px;\n  cursor: pointer;\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 20px;\n  color: ", ";\n"])), colors.red1);
var ChannelUriDescription = styled__default.p(_templateObject7$3 || (_templateObject7$3 = _taggedTemplateLiteralLoose(["\n  margin-bottom: 8px;\n  font-weight: 400;\n  font-size: 13px;\n  line-height: 16px;\n  letter-spacing: -0.078px;\n  color: ", ";\n"])), colors.textColor2);
var UriInputWrapper = styled__default.div(_templateObject8$3 || (_templateObject8$3 = _taggedTemplateLiteralLoose(["\n  position: relative;\n\n  & > input {\n    padding-left: ", ";\n  }\n"])), function (props) {
  return props.uriPrefixWidth && props.uriPrefixWidth + "px";
});
var UriPrefix = styled__default.span(_templateObject9$3 || (_templateObject9$3 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: 15px;\n  top: 11px;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 15px;\n"])));

var _templateObject$c;

var CreateChannelButton = function CreateChannelButton(_ref) {
  var showSearch = _ref.showSearch,
      theme = _ref.theme,
      uriPrefixOnCreateChannel = _ref.uriPrefixOnCreateChannel,
      createChannelIcon = _ref.createChannelIcon,
      newChannelIcon = _ref.newChannelIcon,
      newGroupIcon = _ref.newGroupIcon,
      newChatIcon = _ref.newChatIcon,
      uploadPhotoIcon = _ref.uploadPhotoIcon;

  var _useState = React.useState(false),
      showAddMemberPopup = _useState[0],
      setShowAddMemberPopup = _useState[1];

  var _useState2 = React.useState(false),
      showCreateChannel = _useState2[0],
      setShowCreateChannel = _useState2[1];

  var _useState3 = React.useState('group'),
      creatingChannelType = _useState3[0],
      setCreatingChannelType = _useState3[1];

  var handleOpenCreateChannel = function handleOpenCreateChannel(channelType) {
    setCreatingChannelType(channelType);

    if (channelType === 'direct') {
      setShowAddMemberPopup(true);
    } else {
      setShowCreateChannel(true);
    }
  };

  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(DropDown, {
    forceClose: showAddMemberPopup || !!showCreateChannel,
    position: 'center',
    theme: theme,
    trigger: /*#__PURE__*/React__default.createElement(CreateDropdownButton, {
      hoverBackground: colors.primaryLight,
      leftAuto: !showSearch
    }, createChannelIcon || /*#__PURE__*/React__default.createElement(SvgAddChat, null))
  }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 1,
    textColor: colors.textColor1,
    hoverBackground: colors.hoverBackgroundColor,
    onClick: function onClick() {
      return handleOpenCreateChannel('broadcast');
    },
    iconWidth: '20px'
  }, newChannelIcon || /*#__PURE__*/React__default.createElement(SvgCreateChannel, null), "New channel"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 2,
    textColor: colors.textColor1,
    hoverBackground: colors.hoverBackgroundColor,
    onClick: function onClick() {
      return handleOpenCreateChannel('group');
    },
    iconWidth: '20px'
  }, newGroupIcon || /*#__PURE__*/React__default.createElement(SvgCreateGroup, null), "New group"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 3,
    textColor: colors.textColor1,
    hoverBackground: colors.hoverBackgroundColor,
    onClick: function onClick() {
      return handleOpenCreateChannel('direct');
    },
    iconWidth: '20px'
  }, newChatIcon || /*#__PURE__*/React__default.createElement(SvgCreateChat, null), "New chat"))), showAddMemberPopup && /*#__PURE__*/React__default.createElement(UsersPopup, {
    popupHeight: '540px',
    popupWidth: '520px',
    toggleCreatePopup: function toggleCreatePopup() {
      return setShowAddMemberPopup(false);
    },
    actionType: 'createChat'
  }), showCreateChannel && /*#__PURE__*/React__default.createElement(CreateChannel, {
    handleClose: function handleClose() {
      return setShowCreateChannel(false);
    },
    channelType: creatingChannelType,
    uriPrefixOnCreateChannel: uriPrefixOnCreateChannel,
    uploadPhotoIcon: uploadPhotoIcon
  }));
};
var CreateDropdownButton = styled__default.div(_templateObject$c || (_templateObject$c = _taggedTemplateLiteralLoose(["\n  //margin-left: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  overflow: hidden;\n  line-height: 55px;\n  margin-left: ", ";\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  transition: all 0.2s;\n  &:hover {\n    background-color: ", ";\n  }\n  & > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.leftAuto ? 'auto' : '12px';
}, function (props) {
  return props.hoverBackground || colors.primaryLight;
}, function (props) {
  return props.iconColor || colors.primary;
});

var _path$l;

function _extends$m() {
  _extends$m = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$m.apply(this, arguments);
}

function SvgArrowLeft(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$m({
    width: 32,
    height: 32,
    viewBox: "0 0 32.01 32.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$l || (_path$l = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M15.489 9.276a.941.941 0 010 1.33l-4.276 4.276H23.06a.941.941 0 110 1.883H11.213l4.276 4.275a.941.941 0 11-1.331 1.331L8.276 16.49a.941.941 0 010-1.331l5.882-5.882a.941.941 0 011.331 0z",
    fill: "#818C99"
  })));
}

var _path$m;

function _extends$n() {
  _extends$n = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$n.apply(this, arguments);
}

function SvgDevaultAvatar50(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$n({
    width: 48,
    height: 48,
    viewBox: "0 0 50 50",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$m || (_path$m = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M38.978 45.73A24.885 24.885 0 0125 50a24.89 24.89 0 01-15-4.998C3.928 40.44 0 33.179 0 25 0 11.193 11.193 0 25 0s25 11.193 25 25c0 8.63-4.372 16.238-11.022 20.73zM25 26.25c4.142 0 7.5-3.638 7.5-8.125S29.142 10 25 10c-4.142 0-7.5 3.638-7.5 8.125s3.358 8.125 7.5 8.125zM25 45a19.934 19.934 0 0013.908-5.628C36.682 33.877 31.294 30 25 30s-11.682 3.877-13.908 9.372A19.933 19.933 0 0025 45z",
    fill: "CurrentColor"
  })));
}

var _path$n;

function _extends$o() {
  _extends$o = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$o.apply(this, arguments);
}

function SvgNotifications(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$o({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$n || (_path$n = /*#__PURE__*/React.createElement("path", {
    d: "M10.246 1.75c3.449 0 5.924 2.816 5.924 6.47v1.375c0 .196.166.457.619.924l.232.236c.929.942 1.296 1.485 1.296 2.358 0 .382-.044.68-.23 1.037-.391.754-1.222 1.174-2.464 1.174H13.98c-.54 2.004-1.83 3.093-3.738 3.093-1.928 0-3.225-1.112-3.755-3.157l.016.064H4.861c-1.278 0-2.118-.432-2.493-1.212-.164-.341-.201-.618-.201-.998 0-.874.367-1.417 1.296-2.359.12-.12.174-.176.232-.236.453-.467.62-.728.62-.924V8.22c0-3.652 2.48-6.47 5.93-6.47zm2.114 13.575H8.125c.391 1.071 1.066 1.545 2.118 1.545 1.052 0 1.727-.474 2.118-1.545zM10.247 3.296c-2.55 0-4.385 2.085-4.385 4.924v1.375c0 .732-.335 1.257-1.055 2l-.242.246c-.642.65-.851.96-.851 1.273 0 .164.012.25.049.328.092.192.372.335 1.1.335h10.76c.705 0 .991-.144 1.093-.34.043-.082.056-.17.056-.323 0-.313-.21-.622-.851-1.273-.12-.12-.179-.181-.242-.246-.72-.743-1.055-1.268-1.055-2V8.22c0-2.84-1.83-4.924-4.377-4.924z",
    fill: "currentColor"
  })));
}

var _path$o;

function _extends$p() {
  _extends$p = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$p.apply(this, arguments);
}

function SvgLock(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$p({
    width: 20,
    height: 20,
    viewBox: "0 0 21 21",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$o || (_path$o = /*#__PURE__*/React.createElement("path", {
    d: "M10 2.5a4.167 4.167 0 014.166 4.167v1.666h.364c.743 0 1.012.078 1.284.223.271.145.485.358.63.63.145.272.222.541.222 1.284v4.893c0 .743-.077 1.013-.222 1.284a1.514 1.514 0 01-.63.63c-.272.146-.541.223-1.284.223H5.47c-.743 0-1.013-.077-1.284-.223a1.515 1.515 0 01-.63-.63c-.146-.271-.223-.54-.223-1.284V10.47c0-.743.077-1.012.223-1.284.145-.272.358-.485.63-.63.271-.145.54-.223 1.284-.223h.362l.001-1.666A4.167 4.167 0 0110 2.5zm0 1.667a2.5 2.5 0 00-2.5 2.5l-.001 1.666h5V6.667a2.5 2.5 0 00-2.5-2.5z",
    fill: "CurrentColor"
  })));
}

var _path$p;

function _extends$q() {
  _extends$q = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$q.apply(this, arguments);
}

function SvgLeave(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$q({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$p || (_path$p = /*#__PURE__*/React.createElement("path", {
    d: "M9.457 9.68h-7.03c-.47 0-.86.362-.86.82 0 .458.39.82.86.82h7.03l-1.56 1.477a.793.793 0 000 1.163.89.89 0 001.213 0l3.038-2.878h0l.006-.006h0a.799.799 0 00.248-.573v-.005a.784.784 0 00-.066-.313M9.457 9.68l2.88.505m-2.88-.505l-1.56-1.477a.793.793 0 010-1.163.89.89 0 011.213 0l3.038 2.878m-2.69-.238l2.69.238m.188.267s0 0 0 0l-.091.04.091-.04zm-.188-.267l-.069.073.069-.073h0zm-1.365 8.599h2.011c.82 0 1.488 0 2.03-.042.559-.043 1.06-.135 1.525-.36a3.805 3.805 0 001.705-1.616c.238-.443.336-.919.381-1.45.045-.514.045-1.146.045-1.923V7.874c0-.776 0-1.409-.045-1.923-.045-.53-.143-1.007-.381-1.45a3.805 3.805 0 00-1.705-1.615c-.466-.225-.966-.317-1.526-.36-.541-.043-1.208-.043-2.029-.042h-.003 0-2.008c-.47 0-.86.361-.86.82 0 .457.39.819.86.819h1.975c.865 0 1.462 0 1.926.036.454.036.704.1.888.19.41.197.744.513.952.9.093.173.16.408.198.837.038.438.038 1.003.038 1.823v5.182c0 .82 0 1.385-.038 1.824-.037.429-.105.664-.198.836-.208.387-.541.703-.952.901-.184.089-.434.154-.888.189-.464.036-1.061.036-1.926.036h-1.975c-.47 0-.86.362-.86.82 0 .458.39.82.86.82z",
    fill: "CurrentColor",
    stroke: "CurrentColor",
    strokeWidth: 0.2
  })));
}

var _templateObject$d, _templateObject2$b, _templateObject3$7;

var EditProfile = function EditProfile(_ref) {
  var handleCloseEditProfile = _ref.handleCloseEditProfile,
      user = _ref.user;
  var dispatch = reactRedux.useDispatch();

  var _useState = React.useState(user.firstName),
      firstName = _useState[0],
      setFirstName = _useState[1];

  var _useState2 = React.useState(user.lastName),
      lastName = _useState2[0],
      setLastName = _useState2[1];

  var handleTypeFirstName = function handleTypeFirstName(e) {
    setFirstName(e.target.value);
  };

  var handleTypeLastName = function handleTypeLastName(e) {
    setLastName(e.target.value);
  };

  var handleEditProfile = function handleEditProfile() {
    dispatch(updateProfileAC(user, firstName, lastName, '', '', undefined));
    handleCloseEditProfile();
  };

  return /*#__PURE__*/React__default.createElement(Container$4, null, /*#__PURE__*/React__default.createElement(EditAvatarCont, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: user.firstName || user.id,
    size: 144,
    image: user.avatarUrl,
    setDefaultAvatar: true
  })), /*#__PURE__*/React__default.createElement(EditProfileBody, null, /*#__PURE__*/React__default.createElement(Label, null, "Firstname"), /*#__PURE__*/React__default.createElement(CustomInput, {
    type: 'text',
    value: firstName,
    onChange: handleTypeFirstName,
    placeholder: 'Firstname'
  }), /*#__PURE__*/React__default.createElement(Label, null, "Lastname"), /*#__PURE__*/React__default.createElement(CustomInput, {
    type: 'text',
    value: lastName,
    onChange: handleTypeLastName,
    placeholder: 'Lastname'
  })), /*#__PURE__*/React__default.createElement(PopupFooter, null, /*#__PURE__*/React__default.createElement(Button, {
    onClick: handleCloseEditProfile,
    backgroundColor: colors.gray0,
    color: colors.textColor1,
    borderRadius: '8px'
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    onClick: handleEditProfile,
    backgroundColor: colors.primary,
    borderRadius: '8px',
    margin: '0 0 0 12px'
  }, "Save")));
};
var Container$4 = styled__default.div(_templateObject$d || (_templateObject$d = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 64px;\n  left: 0;\n  background-color: ", ";\n"])), colors.white);
var EditAvatarCont = styled__default.div(_templateObject2$b || (_templateObject2$b = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: center;\n  margin: 20px 0 24px;\n"])));
var EditProfileBody = styled__default.div(_templateObject3$7 || (_templateObject3$7 = _taggedTemplateLiteralLoose(["\n  padding: 0 16px;\n  margin-bottom: 16px;\n"])));

var _templateObject$e, _templateObject2$c, _templateObject3$8, _templateObject4$6, _templateObject5$5, _templateObject6$4;
var settingsPages = {
  profile: 'Profile',
  notifications: 'Notifications',
  about: 'About'
};

var ProfileSettings = function ProfileSettings(_ref) {
  var handleCloseProfile = _ref.handleCloseProfile;

  var _useState = React.useState(false),
      editProfileIsOpen = _useState[0],
      setEditProfileIsOpen = _useState[1];

  var _useState2 = React.useState(''),
      activeSettingPage = _useState2[0],
      setActiveSettingPage = _useState2[1];

  var user = reactRedux.useSelector(userSelector);

  var handleOpenEditProfile = function handleOpenEditProfile() {
    setActiveSettingPage(editProfileIsOpen ? '' : settingsPages.profile);
    setEditProfileIsOpen(!editProfileIsOpen);
  };

  return /*#__PURE__*/React__default.createElement(Container$5, null, /*#__PURE__*/React__default.createElement(SettingsHeader, null, /*#__PURE__*/React__default.createElement(ArrowLeftWrapper, {
    onClick: activeSettingPage === settingsPages.profile ? handleOpenEditProfile : handleCloseProfile
  }, /*#__PURE__*/React__default.createElement(SvgArrowLeft, null)), /*#__PURE__*/React__default.createElement(SectionHeader, null, activeSettingPage === settingsPages.profile ? 'Edit profile' : 'Settings')), /*#__PURE__*/React__default.createElement(ProfileInfo, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: user.firstName || user.id,
    size: 144,
    image: user.avatarUrl,
    setDefaultAvatar: true
  }), /*#__PURE__*/React__default.createElement(Username, null, user.firstName + " " + user.lastName), /*#__PURE__*/React__default.createElement(UserNumber, null, "+" + user.id)), /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    hoverBackground: 'none',
    iconWidth: '20px',
    textColor: colors.textColor1,
    iconColor: colors.textColor2,
    margin: '0 0 24px',
    onClick: handleOpenEditProfile
  }, /*#__PURE__*/React__default.createElement(SvgDevaultAvatar50, null), " Profile"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    hoverBackground: 'none',
    iconWidth: '20px',
    textColor: colors.textColor1,
    iconColor: colors.textColor2,
    margin: '0 0 24px'
  }, /*#__PURE__*/React__default.createElement(SvgNotifications, null), " Notifications"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    hoverBackground: 'none',
    iconWidth: '20px',
    textColor: colors.textColor1,
    iconColor: colors.textColor2,
    margin: '0 0 24px'
  }, /*#__PURE__*/React__default.createElement(SvgLock, null), " About"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    hoverBackground: 'none',
    iconWidth: '20px',
    textColor: colors.red1,
    iconColor: colors.red1,
    margin: '0 0 24px'
  }, /*#__PURE__*/React__default.createElement(SvgLeave, null), " Log Out")), editProfileIsOpen && /*#__PURE__*/React__default.createElement(EditProfile, {
    user: user,
    handleCloseEditProfile: handleOpenEditProfile
  }));
};
var Container$5 = styled__default.div(_templateObject$e || (_templateObject$e = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  background-color: ", ";\n  border-right: 1px solid ", ";\n"])), colors.white, colors.gray1);
var SettingsHeader = styled__default.div(_templateObject2$c || (_templateObject2$c = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  padding: 16px;\n  height: 64px;\n  border-bottom: 1px solid ", ";\n  box-sizing: border-box;\n"])), colors.gray1);
var ArrowLeftWrapper = styled__default.span(_templateObject3$8 || (_templateObject3$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  cursor: pointer;\n  margin-right: 12px;\n"])));
var ProfileInfo = styled__default.div(_templateObject4$6 || (_templateObject4$6 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  margin: 20px 0 24px;\n"])));
var Username = styled__default.h3(_templateObject5$5 || (_templateObject5$5 = _taggedTemplateLiteralLoose(["\n  margin: 16px 0 0;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  color: ", ";\n"])), colors.textColor1);
var UserNumber = styled__default.h4(_templateObject6$4 || (_templateObject6$4 = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  font-weight: 400;\n  font-size: 13px;\n  line-height: 16px;\n  letter-spacing: -0.078px;\n  color: ", ";\n"])), colors.textColor2);

var _templateObject$f, _templateObject2$d, _templateObject3$9, _templateObject4$7;

var ContactItem = function ContactItem(_ref) {
  var contact = _ref.contact,
      createChatWithContact = _ref.createChatWithContact,
      theme = _ref.theme,
      _ref$showAvatar = _ref.showAvatar,
      showAvatar = _ref$showAvatar === void 0 ? true : _ref$showAvatar,
      channelsPaddings = _ref.channelsPaddings,
      channelsMargin = _ref.channelsMargin;
  var getFromContacts = getShowOnlyContactUsers();
  var contactUserName = makeUsername(contact, undefined, getFromContacts);
  return /*#__PURE__*/React__default.createElement(Container$6, {
    theme: theme,
    channelsPaddings: channelsPaddings,
    channelsMargin: channelsMargin,
    onClick: function onClick() {
      return createChatWithContact(contact);
    }
  }, showAvatar && /*#__PURE__*/React__default.createElement(AvatarWrapper$1, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: contactUserName,
    image: contact.user.avatarUrl,
    size: 50,
    textSize: 16,
    setDefaultAvatar: true
  }), hideUserPresence && (hideUserPresence(contact.user) ? '' : contact.user.presence && contact.user.presence.state === USER_PRESENCE_STATUS.ONLINE) && /*#__PURE__*/React__default.createElement(UserStatus$1, {
    backgroundColor: colors.primary
  })), /*#__PURE__*/React__default.createElement(ChannelInfo$1, {
    theme: theme,
    avatar: showAvatar
  }, /*#__PURE__*/React__default.createElement("h3", null, contactUserName)));
};
var Container$6 = styled__default.div(_templateObject$f || (_templateObject$f = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  padding: ", ";\n  margin: ", ";\n"])), function (props) {
  return props.channelsPaddings || '8px';
}, function (props) {
  return props.channelsMargin || '0 8px';
});
var ChannelInfo$1 = styled__default.div(_templateObject2$d || (_templateObject2$d = _taggedTemplateLiteralLoose(["\n  text-align: left;\n  margin-left: ", ";\n  width: 100%;\n  max-width: calc(100% - 62px);\n\n  h3 {\n    display: inline-block;\n    margin: 0;\n    font-size: 15px;\n    font-weight: 500;\n    text-overflow: ellipsis;\n    line-height: 18px;\n    letter-spacing: -0.2px;%;\n    max-width: calc(100% - 2px);\n    overflow: hidden;\n    white-space: nowrap;\n    color: ", ";\n  }\n"])), function (props) {
  return props.avatar && '12px';
}, function (props) {
  return props.theme === THEME.DARK ? colors.darkModeTextColor1 : colors.textColor1;
});
var AvatarWrapper$1 = styled__default.div(_templateObject3$9 || (_templateObject3$9 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  position: relative;\n"])));
var UserStatus$1 = styled__default.span(_templateObject4$7 || (_templateObject4$7 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  width: 14px;\n  height: 14px;\n  right: 0;\n  bottom: 0;\n  border-radius: 50%;\n  background-color: ", ";\n  border: 2.5px solid #ffffff;\n  box-sizing: border-box;\n"])), function (props) {
  return props.backgroundColor || '#56E464';
});

var _templateObject$g, _templateObject2$e, _templateObject3$a, _templateObject4$8, _templateObject5$6, _templateObject6$5, _templateObject7$4, _templateObject8$4, _templateObject9$4, _templateObject10$3;

var ChannelList = function ChannelList(_ref) {
  var selectedChannelBackground = _ref.selectedChannelBackground,
      selectedChannelLeftBorder = _ref.selectedChannelLeftBorder,
      backgroundColor = _ref.backgroundColor,
      searchInputBackgroundColor = _ref.searchInputBackgroundColor,
      searchInputTextColor = _ref.searchInputTextColor,
      _ref$searchChannelsPo = _ref.searchChannelsPosition,
      searchChannelsPosition = _ref$searchChannelsPo === void 0 ? 'bottom' : _ref$searchChannelsPo,
      searchInputBorderRadius = _ref.searchInputBorderRadius,
      selectedChannelBorderRadius = _ref.selectedChannelBorderRadius,
      selectedChannelPaddings = _ref.selectedChannelPaddings,
      channelsPaddings = _ref.channelsPaddings,
      channelsMargin = _ref.channelsMargin,
      List = _ref.List,
      ListItem = _ref.ListItem,
      getActiveChannel = _ref.getActiveChannel,
      Profile = _ref.Profile,
      CreateChannel = _ref.CreateChannel,
      ChannelsTitle = _ref.ChannelsTitle,
      filter = _ref.filter,
      limit = _ref.limit,
      sort = _ref.sort,
      _ref$showAvatar = _ref.showAvatar,
      showAvatar = _ref$showAvatar === void 0 ? true : _ref$showAvatar,
      _ref$showSearch = _ref.showSearch,
      showSearch = _ref$showSearch === void 0 ? true : _ref$showSearch,
      _ref$showCreateChanne = _ref.showCreateChannelIcon,
      showCreateChannelIcon = _ref$showCreateChanne === void 0 ? true : _ref$showCreateChanne,
      uriPrefixOnCreateChannel = _ref.uriPrefixOnCreateChannel,
      onChannelDeleted = _ref.onChannelDeleted,
      onChannelCreated = _ref.onChannelCreated,
      onChannelHidden = _ref.onChannelHidden,
      onChannelVisible = _ref.onChannelVisible,
      onAddedToChannel = _ref.onAddedToChannel,
      notificationsIsMutedIcon = _ref.notificationsIsMutedIcon,
      notificationsIsMutedIconColor = _ref.notificationsIsMutedIconColor,
      createChannelIcon = _ref.createChannelIcon,
      newChannelIcon = _ref.newChannelIcon,
      newGroupIcon = _ref.newGroupIcon,
      newChatIcon = _ref.newChatIcon,
      uploadPhotoIcon = _ref.uploadPhotoIcon;
  var dispatch = reactRedux.useDispatch();
  var getFromContacts = getShowOnlyContactUsers();
  var theme = reactRedux.useSelector(themeSelector);
  var channelListRef = React.useRef(null);
  var channelsScrollRef = React.useRef(null);

  var _useState = React.useState(''),
      searchValue = _useState[0],
      setSearchValue = _useState[1];

  var connectionStatus = reactRedux.useSelector(connectionStatusSelector);
  var channels = reactRedux.useSelector(channelsSelector, reactRedux.shallowEqual) || [];
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var addedChannel = reactRedux.useSelector(addedChannelSelector);
  var closeSearchChannels = reactRedux.useSelector(closeSearchChannelSelector);
  var addedToChannel = reactRedux.useSelector(addedToChannelSelector);
  var deletedChannel = reactRedux.useSelector(deletedChannelSelector);
  var hiddenChannel = reactRedux.useSelector(hiddenChannelSelector);
  var visibleChannel = reactRedux.useSelector(visibleChannelSelector);
  var channelsHasNext = reactRedux.useSelector(channelsHasNextSelector) || false;
  var searchedChannels = reactRedux.useSelector(searchedChannelsSelector) || [];
  var channelsLoading = reactRedux.useSelector(channelsLoadingState) || {};
  var activeChannel = reactRedux.useSelector(activeChannelSelector) || {};

  var _useState2 = React.useState(false),
      listWidthIsSet = _useState2[0],
      setListWidthIsSet = _useState2[1];

  var _useState3 = React.useState(false),
      profileIsOpen = _useState3[0],
      setProfileIsOpen = _useState3[1];

  var handleSetChannelList = function handleSetChannelList(updatedChannels, isRemove) {
    if (isRemove) {
      var channelsMap = {};
      var makeMapFrom = isRemove ? updatedChannels : channels;
      var findIn = isRemove ? channels : updatedChannels;

      for (var i = 0; i < makeMapFrom.length; i++) {
        channelsMap[makeMapFrom[i].id] = true;
      }

      var channelsForAction = [];

      for (var j = 0; j < findIn.length; j++) {
        if (!channelsMap[findIn[j].id]) {
          channelsForAction.push(findIn[j]);
        }
      }

      channelsForAction.forEach(function (channelToDelete) {
        return removeChannelFromMap(channelToDelete.id);
      });
    }

    console.log('dispatch setChannel s.... ', updatedChannels);
    dispatch(setChannelsAC(updatedChannels));
  };

  var handleLoadMoreChannels = function handleLoadMoreChannels(count) {
    if (channelsLoading === LOADING_STATE.LOADED && !searchValue) {
      dispatch(loadMoreChannels(count));
    }
  };

  var handleAllChannelsListScroll = function handleAllChannelsListScroll(e) {
    if (!searchValue && channelsHasNext && e.target.scrollTop >= e.target.scrollHeight - e.target.offsetHeight - 200) {
      handleLoadMoreChannels();
    }
  };

  var handleChangeActiveChannel = function handleChangeActiveChannel(chan) {
    if (activeChannel.id !== chan.id) {
      dispatch(switchChannelActionAC(chan));
    }

    console.log('handleChangeActiveChannel .... searchValue... ', searchValue);
  };

  var handleCrateChatWithContact = function handleCrateChatWithContact(contact) {
    if (contact) {
      var channelData = {
        metadata: '',
        label: '',
        type: CHANNEL_TYPE.DIRECT,
        members: [_extends({}, contact, {
          role: 'owner'
        })]
      };
      dispatch(createChannelAC(channelData));
    }

    getMyChannels();
    console.log('handle crate channel with contact ... ', contact);
  };

  var handleSearchValueChange = function handleSearchValueChange(e) {
    setSearchValue(e.target.value);
  };

  var getMyChannels = function getMyChannels() {
    setSearchValue('');
  };

  var handleOpenProfile = function handleOpenProfile() {
    setProfileIsOpen(!profileIsOpen);
  };

  React.useEffect(function () {
    if (deletedChannel) {
      if (onChannelDeleted) {
        console.log('onChannelDeleted .... ', deletedChannel);
        onChannelDeleted(channels, deletedChannel, function (updatedChannels) {
          return handleSetChannelList(updatedChannels, true);
        });
      } else {
        removeChannelFromMap(deletedChannel.id);
        dispatch(removeChannelAC(deletedChannel.id));

        if (activeChannel.id === deletedChannel.id) {
          var _activeChannel = getLastChannelFromMap();

          dispatch(switchChannelActionAC(JSON.parse(JSON.stringify(_activeChannel))));
        }
      }

      dispatch(setChannelToRemoveAC(null));

      if (searchValue) {
        getMyChannels();
      }
    }
  }, [deletedChannel]);
  useDidUpdate(function () {
    if (connectionStatus === CONNECTION_STATUS.CONNECTED) {
      dispatch(getChannelsAC({
        filter: filter,
        limit: limit,
        sort: sort,
        search: ''
      }, false));
    }
  }, [connectionStatus]);
  useDidUpdate(function () {
    if (addedChannel) {
      if (onChannelCreated) {
        console.log('onChannelCreated .... ', addedChannel);
        onChannelCreated(channels, addedChannel, function (updatedChannels) {
          return handleSetChannelList(updatedChannels, false);
        });
      } else {
        console.log('dispatch addChannelAC 1 .... ', addedChannel);
        dispatch(addChannelAC(addedChannel));
      }

      dispatch(setChannelToAddAC(null));
    }
  }, [addedChannel]);
  React.useEffect(function () {
    if (addedToChannel) {
      if (onAddedToChannel) {
        console.log('onAddedToChannel .... ', addedToChannel);
        onAddedToChannel(channels, addedToChannel, function (updatedChannels) {
          return handleSetChannelList(updatedChannels, false);
        });
      } else {
        console.log('dispatch addChannelAC 2 .... ', addedToChannel);
        dispatch(addChannelAC(addedToChannel));
      }

      dispatch(setChannelToAddAC(null));
    }
  }, [addedToChannel]);
  React.useEffect(function () {
    if (hiddenChannel) {
      if (onChannelHidden) {
        console.log('onChannelHidden .... ', hiddenChannel);
        onChannelHidden(channels, hiddenChannel, function (updatedChannels) {
          return handleSetChannelList(updatedChannels, true);
        });
      } else {
        dispatch(removeChannelAC(hiddenChannel.id));
      }

      dispatch(setChannelToHideAC(null));
    }
  }, [hiddenChannel]);
  React.useEffect(function () {
    if (visibleChannel) {
      if (onChannelVisible) {
        onChannelVisible(channels, visibleChannel, function (updatedChannels) {
          return handleSetChannelList(updatedChannels, true);
        });
      } else {
        dispatch(addChannelAC(hiddenChannel));
      }

      dispatch(setChannelToUnHideAC(null));
    }
  }, [visibleChannel]);
  useDidUpdate(function () {
    if (searchValue) {
      dispatch(searchChannelsAC({
        filter: filter,
        limit: limit,
        sort: sort,
        search: searchValue
      }, contactsMap));
    } else {
      dispatch(setSearchedChannelsAC({
        chats_groups: [],
        channels: [],
        contacts: []
      }));
    }
  }, [searchValue]);
  useDidUpdate(function () {
    if (getActiveChannel) {
      getActiveChannel(activeChannel);
    }
  }, [activeChannel.id]);
  useDidUpdate(function () {
    if (closeSearchChannels) {
      getMyChannels();
      dispatch(setCloseSearchChannelsAC(false));
    }
  }, [closeSearchChannels]);
  React.useEffect(function () {
    if (uploadPhotoIcon) {
      setUploadImageIcon(uploadPhotoIcon);
    }

    dispatch(getChannelsAC({
      filter: filter,
      limit: limit,
      sort: sort,
      search: ''
    }, false));

    if (getFromContacts) {
      dispatch(getContactsAC());
    }
  }, []);
  useDidUpdate(function () {
    if (channels && channels.length) {
      if (!listWidthIsSet) {
        dispatch(setChannelListWithAC(channelListRef.current && channelListRef.current.clientWidth || 0));
        setListWidthIsSet(true);
      }
    } else {
      setListWidthIsSet(false);
    }

    console.log('channels. ...........................', channels);
  }, [channels]);
  return /*#__PURE__*/React__default.createElement(Container$7, {
    withCustomList: !!List,
    ref: channelListRef,
    backgroundColor: backgroundColor || (theme === THEME.DARK ? colors.darkModeSecondaryBackgroundColor : '')
  }, /*#__PURE__*/React__default.createElement(ChannelListHeader, {
    withCustomList: !!List,
    maxWidth: channelListRef.current && channelListRef.current.clientWidth || 0,
    borderColor: colors.backgroundColor
  }, Profile, showSearch && searchChannelsPosition === 'inline' ? /*#__PURE__*/React__default.createElement(ChannelSearch, {
    inline: true,
    borderRadius: searchInputBorderRadius,
    searchValue: searchValue,
    handleSearchValueChange: handleSearchValueChange,
    getMyChannels: getMyChannels,
    searchInputBackgroundColor: searchInputBackgroundColor,
    searchInputTextColor: searchInputTextColor
  }) : ChannelsTitle || /*#__PURE__*/React__default.createElement(ChatsTitle, {
    theme: theme
  }, "Chats"), showCreateChannelIcon && (CreateChannel || /*#__PURE__*/React__default.createElement(CreateChannelButton, {
    theme: theme,
    newChannelIcon: newChannelIcon,
    newGroupIcon: newGroupIcon,
    newChatIcon: newChatIcon,
    uploadPhotoIcon: uploadPhotoIcon,
    createChannelIcon: createChannelIcon,
    showSearch: showSearch,
    uriPrefixOnCreateChannel: uriPrefixOnCreateChannel
  }))), showSearch && searchChannelsPosition === 'bottom' && /*#__PURE__*/React__default.createElement(ChannelSearch, {
    searchValue: searchValue,
    theme: theme,
    borderRadius: searchInputBorderRadius,
    handleSearchValueChange: handleSearchValueChange,
    getMyChannels: getMyChannels,
    searchInputBackgroundColor: searchInputBackgroundColor,
    searchInputTextColor: searchInputTextColor
  }), List ? /*#__PURE__*/React__default.createElement(List, {
    channels: channels,
    searchedChannels: searchedChannels,
    activeChannel: activeChannel,
    setActiveChannel: handleChangeActiveChannel,
    loadMoreChannels: handleLoadMoreChannels,
    searchValue: searchValue
  }, !searchValue ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, channels.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      key: channel.id,
      contactsMap: contactsMap
    });
  })) : channelsLoading === LOADING_STATE.LOADED && searchValue ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !(searchedChannels.chats_groups && searchedChannels.chats_groups.length) && !(searchedChannels.channels && searchedChannels.channels.length) && !(searchedChannels.contacts && searchedChannels.contacts.length) ? /*#__PURE__*/React__default.createElement(NoData, null, "No channels found") : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !!(searchedChannels.chats_groups && searchedChannels.chats_groups.length) && /*#__PURE__*/React__default.createElement(DirectChannels, null, /*#__PURE__*/React__default.createElement(SearchedChannelsHeader, null, "Chats & Groups"), searchedChannels.chats_groups.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      key: channel.id,
      contactsMap: contactsMap
    });
  })), !!(searchedChannels.contacts && searchedChannels.contacts.length) && /*#__PURE__*/React__default.createElement(GroupChannels, null, /*#__PURE__*/React__default.createElement(SearchedChannelsHeader, null, "Contacts"), searchedChannels.contacts.map(function (contact) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      contact: contact,
      createChatWithContact: handleCrateChatWithContact,
      setActiveChannel: handleChangeActiveChannel,
      key: contact.id
    }) : /*#__PURE__*/React__default.createElement(ContactItem, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      contact: contact,
      createChatWithContact: handleCrateChatWithContact,
      key: contact.id,
      contactsMap: contactsMap
    });
  })), !!(searchedChannels.channels && searchedChannels.channels.length) && /*#__PURE__*/React__default.createElement(GroupChannels, null, /*#__PURE__*/React__default.createElement(SearchedChannelsHeader, null, "Channels"), searchedChannels.channels.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      key: channel.id,
      contactsMap: contactsMap
    });
  })))) : /*#__PURE__*/React__default.createElement(LoadingWrapper, null, /*#__PURE__*/React__default.createElement(UploadingIcon, {
    color: colors.textColor3
  }))) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !searchValue && /*#__PURE__*/React__default.createElement(ChannelsList, {
    ref: channelsScrollRef,
    onScroll: handleAllChannelsListScroll
  }, channels.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      key: channel.id,
      contactsMap: contactsMap
    });
  })), !!searchValue && (channelsLoading === LOADING_STATE.LOADED ? !searchedChannels.chats_groups.length && !searchedChannels.chats_groups.length ? /*#__PURE__*/React__default.createElement(NoData, null, "Nothing found for ", /*#__PURE__*/React__default.createElement("b", null, searchValue)) : /*#__PURE__*/React__default.createElement(SearchedChannels, null, !!searchedChannels.chats_groups.length && /*#__PURE__*/React__default.createElement(DirectChannels, null, /*#__PURE__*/React__default.createElement(SearchedChannelsHeader, null, "Chats & Groups"), searchedChannels.chats_groups.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      contactsMap: contactsMap,
      key: channel.id
    });
  })), !!searchedChannels.channels.length && /*#__PURE__*/React__default.createElement(GroupChannels, null, /*#__PURE__*/React__default.createElement(SearchedChannelsHeader, null, "Channels"), searchedChannels.channels.map(function (channel) {
    return ListItem ? /*#__PURE__*/React__default.createElement(ListItem, {
      channel: channel,
      setActiveChannel: handleChangeActiveChannel,
      key: channel.id
    }) : /*#__PURE__*/React__default.createElement(Channel, {
      theme: theme,
      selectedChannelLeftBorder: selectedChannelLeftBorder,
      selectedChannelBackground: selectedChannelBackground,
      selectedChannelBorderRadius: selectedChannelBorderRadius,
      selectedChannelPaddings: selectedChannelPaddings,
      channelsPaddings: channelsPaddings,
      channelsMargin: channelsMargin,
      notificationsIsMutedIcon: notificationsIsMutedIcon,
      notificationsIsMutedIconColor: notificationsIsMutedIconColor,
      showAvatar: showAvatar,
      channel: channel,
      key: channel.id,
      contactsMap: contactsMap
    });
  }))) : /*#__PURE__*/React__default.createElement(LoadingWrapper, null, /*#__PURE__*/React__default.createElement(UploadingIcon, {
    color: colors.textColor3
  })))), profileIsOpen && /*#__PURE__*/React__default.createElement(ProfileSettings, {
    handleCloseProfile: handleOpenProfile
  }));
};
var Container$7 = styled__default.div(_templateObject$g || (_templateObject$g = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  width: ", ";\n  min-width: ", ";\n  border-right: ", ";\n  background-color: ", ";\n  ", ";\n"])), function (props) {
  return props.withCustomList ? '' : '400px';
}, function (props) {
  return props.withCustomList ? '' : '400px';
}, function (props) {
  return props.withCustomList ? '' : "1px solid " + colors.backgroundColor;
}, function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.withCustomList ? '' : "\n    @media  " + device.laptopL + " {\n      width: 400px;\n      min-width: 400px;\n    }\n ";
});
var ChannelsList = styled__default.div(_templateObject2$e || (_templateObject2$e = _taggedTemplateLiteralLoose(["\n  overflow-y: auto;\n  width: 400px;\n  height: 100%;\n"])));
var SearchedChannels = styled__default.div(_templateObject3$a || (_templateObject3$a = _taggedTemplateLiteralLoose(["\n  height: calc(100vh - 123px);\n  overflow-x: hidden;\n"])));
var SearchedChannelsHeader = styled__default.p(_templateObject4$8 || (_templateObject4$8 = _taggedTemplateLiteralLoose(["\n  padding-left: 16px;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 14px;\n  color: ", ";\n"])), colors.textColor2);
var DirectChannels = styled__default.div(_templateObject5$6 || (_templateObject5$6 = _taggedTemplateLiteralLoose([""])));
var GroupChannels = styled__default.div(_templateObject6$5 || (_templateObject6$5 = _taggedTemplateLiteralLoose([""])));
var ChatsTitle = styled__default.h3(_templateObject7$4 || (_templateObject7$4 = _taggedTemplateLiteralLoose(["\n  font-family: Inter, sans-serif;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 20px;\n  line-height: 28px;\n  margin: 0 auto;\n  color: ", ";\n"])), function (props) {
  return props.theme === THEME.DARK ? colors.darkModeTextColor1 : colors.textColor1;
});
var NoData = styled__default.div(_templateObject8$4 || (_templateObject8$4 = _taggedTemplateLiteralLoose(["\n  text-align: center;\n  padding: 10px;\n  color: ", ";\n"])), colors.textColor2);
var LoadingWrapper = styled__default.div(_templateObject9$4 || (_templateObject9$4 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: calc(50% - 20px);\n  top: calc(50% - 20px);\n"])));
var ChannelListHeader = styled__default.div(_templateObject10$3 || (_templateObject10$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  flex-direction: row;\n  justify-content: space-between;\n  //justify-content: flex-end;\n  padding: 12px;\n  box-sizing: border-box;\n  max-width: ", ";\n  padding-left: ", ";\n  border-right: ", ";\n"])), function (props) {
  return props.maxWidth && props.maxWidth + "px";
}, function (props) {
  return props.withoutProfile && '52px';
}, function (props) {
  return props.withCustomList && "1px solid " + props.borderColor;
});

var _templateObject$h;
var detailsSwitcherTimeout;
function Chat(_ref) {
  var children = _ref.children,
      hideChannelList = _ref.hideChannelList,
      onActiveChannelUpdated = _ref.onActiveChannelUpdated;
  var dispatch = reactRedux.useDispatch();
  var channelListWidth = reactRedux.useSelector(channelListWidthSelector, reactRedux.shallowEqual);
  var channelDetailsIsOpen = reactRedux.useSelector(channelInfoIsOpenSelector, reactRedux.shallowEqual);
  var addedChannel = reactRedux.useSelector(addedToChannelSelector);
  var activeChannel = reactRedux.useSelector(activeChannelSelector);

  var _useState = React.useState(0),
      channelDetailsWidth = _useState[0],
      setChannelDetailsWidth = _useState[1];

  React.useEffect(function () {
    if (hideChannelList && !channelListWidth) {
      dispatch(setHideChannelListAC(true));
      dispatch(getChannelsAC({
        filter: {},
        limit: 1,
        sort: 'byLastMessage',
        search: ''
      }, false));
    }
  }, [channelListWidth]);
  React.useEffect(function () {
    if (onActiveChannelUpdated) {
      onActiveChannelUpdated(activeChannel);
    }
  }, [activeChannel]);
  useDidUpdate(function () {
    if (hideChannelList && (!activeChannel || !activeChannel.id) && addedChannel && addedChannel.id) {
      console.log('call set active channel. ... ', addedChannel);
      dispatch(setActiveChannelAC(addedChannel));
    }
  }, [addedChannel]);
  useDidUpdate(function () {
    if (channelDetailsIsOpen) {
      detailsSwitcherTimeout = setTimeout(function () {
        var detailsContainer = document.getElementById('channel_details_wrapper');

        if (detailsContainer) {
          setChannelDetailsWidth(detailsContainer.offsetWidth);
        }
      }, 1);
    } else {
      clearTimeout(detailsSwitcherTimeout);
      setChannelDetailsWidth(0);
    }
  }, [channelDetailsIsOpen]);
  return /*#__PURE__*/React__default.createElement(Container$8, {
    widthOffset: channelListWidth,
    channelDetailsWidth: channelDetailsWidth
  }, children);
}
var Container$8 = styled__default.div(_templateObject$h || (_templateObject$h = _taggedTemplateLiteralLoose(["\n  position: relative;\n  width: 100%;\n  max-width: ", ";\n  display: flex;\n  transition: all 0.1s;\n  flex-direction: column;\n"])), function (props) {
  return props.widthOffset || props.channelDetailsWidth ? "calc(100% - " + (props.widthOffset + (props.channelDetailsWidth ? props.channelDetailsWidth + 1 : 0)) + "px)" : '';
});

var _path$q;

function _extends$r() {
  _extends$r = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$r.apply(this, arguments);
}

function SvgInfo(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$r({
    width: 22,
    height: 22,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$q || (_path$q = /*#__PURE__*/React.createElement("path", {
    d: "M11 20.167a9.167 9.167 0 100-18.333 9.167 9.167 0 000 18.333zM11 14.667V11M11 7.334h.01",
    stroke: "CurrentColor",
    strokeWidth: 2,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })));
}

var _templateObject$i, _templateObject2$f, _templateObject3$b, _templateObject4$9, _templateObject5$7;
function ChatHeader(_ref) {
  var infoIcon = _ref.infoIcon,
      backgroundColor = _ref.backgroundColor,
      titleColor = _ref.titleColor,
      memberInfoTextColor = _ref.memberInfoTextColor,
      _ref$showMemberInfo = _ref.showMemberInfo,
      showMemberInfo = _ref$showMemberInfo === void 0 ? true : _ref$showMemberInfo;
  var dispatch = reactRedux.useDispatch();
  var ChatClient = getClient();
  var user = ChatClient.user;
  var getFromContacts = getShowOnlyContactUsers();
  var activeChannel = reactRedux.useSelector(activeChannelSelector);
  var theme = reactRedux.useSelector(themeSelector);
  var channelListHidden = reactRedux.useSelector(channelListHiddenSelector);
  var channelDetailsIsOpen = reactRedux.useSelector(channelInfoIsOpenSelector, reactRedux.shallowEqual);
  var isDirectChannel = activeChannel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && activeChannel.members.find(function (member) {
    return member.id !== user.id;
  });
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var memberDisplayText = getChannelTypesMemberDisplayTextMap();
  var displayMemberText = memberDisplayText && memberDisplayText[activeChannel.type] ? activeChannel.memberCount > 1 ? memberDisplayText[activeChannel.type] + "s" : memberDisplayText[activeChannel.type] : activeChannel.type === CHANNEL_TYPE.BROADCAST || activeChannel.type === CHANNEL_TYPE.PUBLIC ? activeChannel.memberCount > 1 ? 'subscribers' : 'subscriber' : activeChannel.memberCount > 1 ? 'members' : 'member';

  var channelDetailsOnOpen = function channelDetailsOnOpen() {
    dispatch(switchChannelInfoAC(!channelDetailsIsOpen));
  };

  var handleSwitchChannel = function handleSwitchChannel() {
    if (activeChannel.linkedFrom) {
      dispatch(switchChannelActionAC(_extends({}, activeChannel.linkedFrom, {
        backToLinkedChannel: true
      })));
    }
  };

  return /*#__PURE__*/React__default.createElement(Container$9, {
    background: backgroundColor,
    borderColor: colors.backgroundColor
  }, activeChannel.isLinkedChannel && /*#__PURE__*/React__default.createElement(BackButtonWrapper, {
    onClick: handleSwitchChannel,
    hoverBackground: colors.primaryLight
  }, /*#__PURE__*/React__default.createElement(SvgArrowLeft, null)), /*#__PURE__*/React__default.createElement(ChannelInfo$2, {
    onClick: !channelListHidden && channelDetailsOnOpen,
    clickable: !channelListHidden
  }, /*#__PURE__*/React__default.createElement(AvatarWrapper, null, (activeChannel.subject || isDirectChannel && directChannelUser) && /*#__PURE__*/React__default.createElement(Avatar, {
    name: activeChannel.subject || (isDirectChannel && directChannelUser ? directChannelUser.firstName || directChannelUser.id : ''),
    image: activeChannel.avatarUrl || (isDirectChannel && directChannelUser ? directChannelUser.avatarUrl : ''),
    size: 36,
    textSize: 13,
    setDefaultAvatar: isDirectChannel
  })), /*#__PURE__*/React__default.createElement(ChannelName, null, /*#__PURE__*/React__default.createElement(SectionHeader, {
    color: titleColor || colors.textColor1,
    theme: theme,
    uppercase: directChannelUser && hideUserPresence && hideUserPresence(directChannelUser)
  }, activeChannel.subject || (isDirectChannel && directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : '')), showMemberInfo && (isDirectChannel && directChannelUser ? /*#__PURE__*/React__default.createElement(SubTitle, {
    color: memberInfoTextColor
  }, hideUserPresence && hideUserPresence(directChannelUser) ? '' : directChannelUser.presence && (directChannelUser.presence.state === USER_PRESENCE_STATUS.ONLINE ? 'Online' : directChannelUser.presence.lastActiveAt && userLastActiveDateFormat(directChannelUser.presence.lastActiveAt))) : /*#__PURE__*/React__default.createElement(SubTitle, {
    color: memberInfoTextColor
  }, !activeChannel.subject && !isDirectChannel ? '' : activeChannel.memberCount + " " + displayMemberText + " ")))), !channelListHidden && /*#__PURE__*/React__default.createElement(ChanelInfo, {
    onClick: function onClick() {
      return channelDetailsOnOpen();
    },
    infoIconColor: channelDetailsIsOpen ? colors.primary : colors.textColor2
  }, infoIcon || /*#__PURE__*/React__default.createElement(SvgInfo, null)));
}
var Container$9 = styled__default.div(_templateObject$i || (_templateObject$i = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  height: 64px;\n  box-sizing: border-box;\n  border-bottom: 1px solid ", ";\n  background-color: ", ";\n"])), function (props) {
  return props.borderColor || colors.backgroundColor;
}, function (props) {
  return props.background;
});
var ChannelInfo$2 = styled__default.div(_templateObject2$f || (_templateObject2$f = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  width: 650px;\n  max-width: calc(100% - 70px);\n  cursor: ", ";\n  margin-right: auto;\n\n  & ", " {\n    width: 10px;\n    height: 10px;\n  }\n"])), function (props) {
  return props.clickable && 'pointer';
}, UserStatus);
var ChannelName = styled__default.div(_templateObject3$b || (_templateObject3$b = _taggedTemplateLiteralLoose(["\n  margin-left: 7px;\n  width: 100%;\n\n  & > ", " {\n    max-width: calc(100% - 8px);\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n"])), SectionHeader);
var ChanelInfo = styled__default.span(_templateObject4$9 || (_templateObject4$9 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n\n  > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.infoIconColor;
});
var BackButtonWrapper = styled__default.span(_templateObject5$7 || (_templateObject5$7 = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  cursor: pointer;\n  margin-right: 16px;\n  border-radius: 50%;\n  transition: all 0.2s;\n  &:hover {\n    background-color: ", ";\n  }\n"])), function (props) {
  return props.hoverBackground || colors.primaryLight;
});

var _templateObject$j;
var Container$a = styled__default.div(_templateObject$j || (_templateObject$j = _taggedTemplateLiteralLoose(["\n  text-align: center;\n  margin: ", ";\n  margin-bottom: ", ";\n  display: ", ";\n  align-items: center;\n  width: ", ";\n  height: 25px;\n  z-index: 5;\n  top: 0;\n  background: transparent;\n  div {\n    position: relative;\n    border-bottom: ", ";\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    background: transparent;\n    span {\n      position: absolute;\n      top: -12px;\n      font-style: normal;\n      font-weight: normal;\n      font-size: ", ";\n      color: ", ";\n      background: ", ";\n      //border: ", ";\n      box-sizing: border-box;\n      border-radius: ", ";\n      padding: 5px 16px;\n\n      &::before {\n        content: '';\n        position: absolute;\n        left: ", ";\n        top: 0;\n        height: 100%;\n        width: ", ";\n        background-color: ", ";\n      }\n\n      &::after {\n        content: '';\n        position: absolute;\n        right: ", ";\n        top: 0;\n        height: 100%;\n        width: ", ";\n        background-color: ", ";\n      }\n    }\n  }\n"])), function (props) {
  return props.noMargin ? '0 auto' : (props.marginTop || '16px') + " auto 0";
}, function (props) {
  return props.marginBottom || '0';
}, function (props) {
  return props.dividerVisibility ? 'flex' : 'none';
}, function (props) {
  return props.width || '100%';
}, function (props) {
  return props.dateDividerBorder;
}, function (props) {
  return props.dateDividerFontSize || '14px';
}, function (props) {
  return props.dateDividerTextColor || colors.textColor1;
}, function (props) {
  return props.dateDividerBackgroundColor;
}, function (props) {
  return props.dateDividerBorder || "1px solid " + colors.gray1;
}, function (props) {
  return props.dateDividerBorderRadius || '14px';
}, function (props) {
  return props.newMessagesSeparatorLeftRightSpaceWidth ? "-" + props.newMessagesSeparatorLeftRightSpaceWidth : '-12px';
}, function (props) {
  return props.newMessagesSeparatorLeftRightSpaceWidth ? "" + props.newMessagesSeparatorLeftRightSpaceWidth : '12px';
}, function (props) {
  return props.theme === THEME.DARK ? colors.dark : colors.white;
}, function (props) {
  return props.newMessagesSeparatorLeftRightSpaceWidth ? "-" + props.newMessagesSeparatorLeftRightSpaceWidth : '-12px';
}, function (props) {
  return props.newMessagesSeparatorLeftRightSpaceWidth ? "" + props.newMessagesSeparatorLeftRightSpaceWidth : '12px';
}, function (props) {
  return props.theme === THEME.DARK ? colors.dark : colors.white;
});
function MessageDivider(_ref) {
  var dividerText = _ref.dividerText,
      visibility = _ref.visibility,
      unread = _ref.unread,
      dateDividerFontSize = _ref.dateDividerFontSize,
      dateDividerTextColor = _ref.dateDividerTextColor,
      dateDividerBorder = _ref.dateDividerBorder,
      dateDividerBackgroundColor = _ref.dateDividerBackgroundColor,
      dateDividerBorderRadius = _ref.dateDividerBorderRadius,
      systemMessage = _ref.systemMessage,
      newMessagesSeparatorTextColor = _ref.newMessagesSeparatorTextColor,
      newMessagesSeparatorFontSize = _ref.newMessagesSeparatorFontSize,
      newMessagesSeparatorWidth = _ref.newMessagesSeparatorWidth,
      newMessagesSeparatorBorder = _ref.newMessagesSeparatorBorder,
      newMessagesSeparatorBorderRadius = _ref.newMessagesSeparatorBorderRadius,
      newMessagesSeparatorBackground = _ref.newMessagesSeparatorBackground,
      newMessagesSeparatorLeftRightSpaceWidth = _ref.newMessagesSeparatorLeftRightSpaceWidth,
      noMargin = _ref.noMargin,
      marginTop = _ref.marginTop,
      theme = _ref.theme,
      marginBottom = _ref.marginBottom;
  return /*#__PURE__*/React__default.createElement(Container$a, {
    className: unread ? 'unread' : 'divider',
    theme: theme,
    systemMessage: systemMessage,
    marginTop: marginTop,
    dividerVisibility: !visibility || unread,
    dateDividerFontSize: dateDividerFontSize || newMessagesSeparatorFontSize,
    dateDividerTextColor: dateDividerTextColor || newMessagesSeparatorTextColor || colors.textColor1,
    dateDividerBorder: dateDividerBorder || newMessagesSeparatorBorder,
    dateDividerBackgroundColor: dateDividerBackgroundColor || newMessagesSeparatorBackground || colors.backgroundColor,
    dateDividerBorderRadius: dateDividerBorderRadius || newMessagesSeparatorBorderRadius,
    width: newMessagesSeparatorWidth,
    newMessagesSeparatorLeftRightSpaceWidth: newMessagesSeparatorLeftRightSpaceWidth,
    noMargin: noMargin,
    marginBottom: marginBottom
  }, /*#__PURE__*/React__default.createElement("div", null, /*#__PURE__*/React__default.createElement("span", null, dividerText)));
}

var _path$r;

function _extends$s() {
  _extends$s = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$s.apply(this, arguments);
}

function SvgDownload(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$s({
    width: 32,
    height: 32,
    viewBox: "0 0 32.01 32.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$r || (_path$r = /*#__PURE__*/React.createElement("path", {
    d: "M17.5 3.5a1.5 1.5 0 00-3 0v13.379l-4.44-4.44a1.5 1.5 0 00-2.12 2.122l7 7a1.5 1.5 0 002.12 0l7-7a1.5 1.5 0 00-2.12-2.122l-4.44 4.44V3.5zM5.5 25a1.5 1.5 0 000 3h21a1.5 1.5 0 000-3h-21z",
    fill: "#fff"
  })));
}

var _path$s;

function _extends$t() {
  _extends$t = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$t.apply(this, arguments);
}

function SvgSliderButtonRight(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$t({
    width: 28,
    height: 28,
    viewBox: "0 0 28.01 28.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$s || (_path$s = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M9.846 5.763a1.75 1.75 0 012.475 0l7 7a1.75 1.75 0 010 2.474l-7 7a1.75 1.75 0 11-2.475-2.474L15.61 14 9.846 8.237a1.75 1.75 0 010-2.474z",
    fill: "#fff"
  })));
}

var _path$t;

function _extends$u() {
  _extends$u = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$u.apply(this, arguments);
}

function SvgSliderButtonLeft(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$u({
    width: 28,
    height: 28,
    viewBox: "0 0 28.01 28.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$t || (_path$t = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M18.154 5.763a1.75 1.75 0 00-2.475 0l-7 7a1.75 1.75 0 000 2.474l7 7a1.75 1.75 0 102.475-2.474L12.392 14l5.762-5.763a1.75 1.75 0 000-2.474z",
    fill: "#fff"
  })));
}

var ATTACHMENTS_CACHE = 'attachments-cache';
var isBrowser = typeof window !== 'undefined';
var cacheAvailable;

if (isBrowser) {
  cacheAvailable = 'caches' in window;
} else {
  cacheAvailable = 'caches' in global;
}

var setAttachmentToCache = function setAttachmentToCache(attachmentUrl, attachmentResponse) {
  if (cacheAvailable) {
    caches.open(ATTACHMENTS_CACHE).then(function (cache) {
      try {
        cache.put(attachmentUrl, attachmentResponse).then(function () {
          console.log('Cache success');
        })["catch"](function (e) {
          console.log('Error on cache attachment ... ', e);
          caches["delete"](attachmentUrl);
        });
        return Promise.resolve();
      } catch (e) {
        return Promise.reject(e);
      }
    });
  }
};
var getAttachmentUrlFromCache = function getAttachmentUrlFromCache(attachmentUrl) {
  if (cacheAvailable) {
    return caches.match(attachmentUrl).then(function (response) {
      try {
        if (response) {
          return Promise.resolve(response.blob()).then(URL.createObjectURL);
        } else {
          console.log('The image or video is not cached', attachmentUrl);
          return Promise.resolve(false);
        }
      } catch (e) {
        return Promise.reject(e);
      }
    });
  } else {
    console.error('Cache is not available');
    return new Promise(function (_resolve, reject) {
      return reject(new Error('Cache not available'));
    });
  }
};

var _path$u;

function _extends$v() {
  _extends$v = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$v.apply(this, arguments);
}

function SvgVideoPlayerPlay(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$v({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$u || (_path$u = /*#__PURE__*/React.createElement("path", {
    d: "M16.28 8.913c.793.48.793 1.692 0 2.172l-8.265 4.997c-.787.475-1.765-.126-1.765-1.086V5.002c0-.96.979-1.561 1.765-1.086l8.265 4.997z",
    fill: "#fff"
  })));
}

var _path$v;

function _extends$w() {
  _extends$w = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$w.apply(this, arguments);
}

function SvgVideoPlayerPause(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$w({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$v || (_path$v = /*#__PURE__*/React.createElement("path", {
    d: "M7.468 3.75c.446 0 .607.046.77.134.163.087.291.215.378.378.088.163.134.324.134.77v9.936c0 .446-.046.607-.134.77a.908.908 0 01-.378.378c-.163.088-.324.134-.77.134H6.282c-.446 0-.607-.046-.77-.134a.908.908 0 01-.378-.378c-.088-.162-.134-.324-.134-.77V5.032c0-.446.046-.607.134-.77a.909.909 0 01.378-.378c.163-.088.324-.134.77-.134h1.186zm6.25 0c.446 0 .607.046.77.134.163.087.291.215.378.378.088.163.134.324.134.77v9.936c0 .446-.046.607-.134.77a.908.908 0 01-.378.378c-.162.088-.324.134-.77.134h-1.186c-.446 0-.607-.046-.77-.134a.908.908 0 01-.378-.378c-.088-.162-.134-.324-.134-.77V5.032c0-.446.046-.607.134-.77a.908.908 0 01.378-.378c.162-.088.324-.134.77-.134h1.186z",
    fill: "#fff"
  })));
}

var _path$w;

function _extends$x() {
  _extends$x = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$x.apply(this, arguments);
}

function SvgVolume(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$x({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$w || (_path$w = /*#__PURE__*/React.createElement("path", {
    d: "M11.667 2.5c.46 0 .833.373.833.833v13.334c0 .46-.373.833-.833.833a2.062 2.062 0 01-1.433-.579L5.66 12.5H3.334c-.92 0-1.667-.746-1.667-1.667V9.167c0-.92.746-1.667 1.667-1.667h2.304l4.595-4.422c.385-.37.9-.578 1.434-.578zm4.487 2.786a.75.75 0 011.06 0 6.667 6.667 0 010 9.428.75.75 0 01-1.06-1.06 5.167 5.167 0 000-7.307.75.75 0 010-1.061zm-2.122 2.121a.75.75 0 011.061 0 3.667 3.667 0 010 5.186.75.75 0 01-1.06-1.06 2.167 2.167 0 000-3.065.75.75 0 010-1.06z",
    fill: "#fff"
  })));
}

var _path$x;

function _extends$y() {
  _extends$y = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$y.apply(this, arguments);
}

function SvgVolumeMute(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$y({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$x || (_path$x = /*#__PURE__*/React.createElement("path", {
    d: "M4.763 2.746l11.655 11.658a.833.833 0 01-1.1 1.248l-.078-.07-2.74-2.74v3.825c0 .427-.321.78-.736.827l-.097.006a2.062 2.062 0 01-1.433-.579L5.66 12.5H3.334c-.92 0-1.667-.746-1.667-1.667V9.167c0-.92.746-1.667 1.667-1.667h2.304l.775-.747-2.829-2.828a.833.833 0 011.179-1.179zm6.904-.246c.46 0 .833.373.833.833v4.8L8.812 4.445l1.421-1.367a2.068 2.068 0 011.274-.572l.16-.006z",
    fill: "#fff"
  })));
}

var _path$y;

function _extends$z() {
  _extends$z = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$z.apply(this, arguments);
}

function SvgFullscreen(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$z({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$y || (_path$y = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M11.875 3.344c0-.466.378-.844.844-.844h3.937c.466 0 .844.378.844.844V7.28a.844.844 0 01-1.688 0v-1.9l-3.434 3.434a.844.844 0 01-1.193-1.193l3.434-3.434h-1.9a.844.844 0 01-.844-.844zM8.815 11.185c.33.33.33.863 0 1.193l-3.434 3.434H7.28a.844.844 0 010 1.688H3.344a.844.844 0 01-.844-.844V12.72a.844.844 0 111.688 0v1.9l3.434-3.434a.844.844 0 011.193 0z",
    fill: "#fff"
  })));
}

var _path$z;

function _extends$A() {
  _extends$A = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$A.apply(this, arguments);
}

function SvgFullscreenExit(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$A({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$z || (_path$z = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M3.438 11.781c0-.466.377-.844.843-.844H8.22c.466 0 .844.378.844.844v3.938a.844.844 0 01-1.688 0v-1.9L3.94 17.252a.844.844 0 11-1.193-1.193l3.435-3.435h-1.9a.844.844 0 01-.844-.844zM17.253 2.747c.33.33.33.864 0 1.193l-3.435 3.435h1.899a.844.844 0 110 1.688h-3.936a.844.844 0 01-.844-.844V4.28a.844.844 0 011.688 0v1.9l3.435-3.434a.844.844 0 011.193 0z",
    fill: "#fff"
  })));
}

var _templateObject$k, _templateObject2$g, _templateObject3$c, _templateObject4$a, _templateObject5$8, _templateObject6$6, _templateObject7$5, _templateObject8$5, _templateObject9$5, _templateObject10$4, _templateObject11$3;
var timerInterval;

var VideoPlayer = function VideoPlayer(_ref) {
  var src = _ref.src,
      videoFileId = _ref.videoFileId,
      activeFileId = _ref.activeFileId;
  var containerRef = React.useRef(null);
  var videoRef = React.useRef(null);
  var progressRef = React.useRef(null);
  var volumeRef = React.useRef(null);

  var _useState = React.useState(false),
      playing = _useState[0],
      setPlaying = _useState[1];

  var _useState2 = React.useState(0),
      currentTime = _useState2[0],
      setCurrentTime = _useState2[1];

  var _useState3 = React.useState(0),
      videoTime = _useState3[0],
      setVideoTime = _useState3[1];

  var _useState4 = React.useState(false),
      isLoaded = _useState4[0],
      setIsLoaded = _useState4[1];

  var _useState5 = React.useState(0),
      progress = _useState5[0],
      setProgress = _useState5[1];

  var _useState6 = React.useState(0),
      volume = _useState6[0],
      setVolume = _useState6[1];

  var _useState7 = React.useState(0),
      volumePrevValue = _useState7[0],
      setVolumePrevValue = _useState7[1];

  var _useState8 = React.useState(false),
      isMuted = _useState8[0],
      setIsMuted = _useState8[1];

  var _useState9 = React.useState(false),
      isFullScreen = _useState9[0],
      setIsFullScreen = _useState9[1];

  var videoHandler = function videoHandler(control) {
    if (control === 'play') {
      videoRef.current && videoRef.current.play();
      setPlaying(true);
    } else if (control === 'pause') {
      videoRef.current && videoRef.current.pause();
      setPlaying(false);
    }
  };

  var handleProgressInputChange = function handleProgressInputChange(e) {
    var target = e.target;
    var val = target.value;
    setProgress(val);

    if (videoRef.current) {
      videoRef.current.currentTime = val / 100 * videoTime;
    }
  };

  var handleMuteUnmute = function handleMuteUnmute() {
    if (videoRef.current) {
      if (!isMuted) {
        setVolumePrevValue(volume);
        videoRef.current.volume = 0;
        setVolume(0);
      } else {
        videoRef.current.volume = volumePrevValue;
        setVolume(volumePrevValue);
      }

      setIsMuted(!isMuted);
    }
  };

  var handleVolumeInputChange = function handleVolumeInputChange(e) {
    var target = e.target;
    var val = target.value;

    if (val === '0') {
      setIsMuted(true);
    } else {
      setIsMuted(false);
    }

    setVolume(val);

    if (videoRef.current) {
      videoRef.current.volume = parseFloat(val);
    }
  };

  var handleOpenFullScreen = function handleOpenFullScreen() {
    if (containerRef.current) {
      if (isFullScreen) {
        document.exitFullscreen().then(function () {
          setIsFullScreen(false);
        });
      } else {
        containerRef.current.requestFullscreen().then(function () {
          setIsFullScreen(true);
        });
      }
    }
  };

  var handleVideoProgress = function handleVideoProgress(e) {
    if (e.currentTarget.readyState >= 2) {
      setIsLoaded(true);
    }
  };

  React.useEffect(function () {
    if (progressRef.current) {
      progressRef.current.style.backgroundSize = progress + "%";
    }
  }, [progress]);
  React.useEffect(function () {
    if (volumeRef.current) {
      volumeRef.current.style.backgroundSize = volume * 100 + "%";
    }
  }, [volume]);
  React.useEffect(function () {
    if (playing) {
      var videoDuration = videoRef.current ? videoRef.current.duration : '';
      timerInterval = setInterval(function () {
        if (videoRef.current && videoDuration) {
          var _videoRef$current, _videoRef$current2;

          setCurrentTime((_videoRef$current = videoRef.current) === null || _videoRef$current === void 0 ? void 0 : _videoRef$current.currentTime);
          setProgress(((_videoRef$current2 = videoRef.current) === null || _videoRef$current2 === void 0 ? void 0 : _videoRef$current2.currentTime) / videoDuration * 100);

          if (videoRef.current.paused) {
            videoRef.current.currentTime = 0;
            setProgress(0);
            setCurrentTime(videoRef.current.currentTime);
            setPlaying(false);
            clearInterval(timerInterval);
          }
        }
      }, 100);
    } else {
      clearInterval(timerInterval);
    }
  }, [playing]);
  React.useEffect(function () {
    if (videoFileId !== activeFileId) {
      if (videoRef.current) {
        videoRef.current.pause();
        setPlaying(false);
      }
    }
  }, [activeFileId]);
  React.useEffect(function () {
    var checkVideoInterval;

    if (videoRef.current) {
      checkVideoInterval = setInterval(function () {
        console.log('videoRef.current.readyState . . . . ', videoRef && videoRef.current && videoRef.current.readyState);

        if (videoRef.current && videoRef.current.readyState > 0) {
          setVideoTime(videoRef.current.duration);
          setVolume(videoRef.current.volume);
          setPlaying(true);
          videoRef.current.play();
          clearInterval(checkVideoInterval);
        }
      }, 500);
    }

    return function () {
      clearInterval(timerInterval);
      clearInterval(checkVideoInterval);
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(Component, {
    ref: containerRef,
    loaded: isLoaded,
    fullScreen: isFullScreen,
    className: 'custom_video_player'
  }, /*#__PURE__*/React__default.createElement("video", {
    onClick: function onClick() {
      return videoHandler(playing ? 'pause' : 'play');
    },
    id: 'video1',
    ref: videoRef,
    className: 'video',
    src: src,
    onLoadedData: handleVideoProgress
  }), isLoaded ? /*#__PURE__*/React__default.createElement(ControlsContainer, null, /*#__PURE__*/React__default.createElement(ProgressBlock, null, /*#__PURE__*/React__default.createElement(Progress, {
    ref: progressRef,
    onMouseDown: function onMouseDown(e) {
      return e.stopPropagation();
    },
    onChange: handleProgressInputChange,
    type: 'range',
    value: progress,
    min: '0',
    max: '100'
  })), playing ? /*#__PURE__*/React__default.createElement(PlayPauseWrapper, {
    onClick: function onClick() {
      return videoHandler('pause');
    }
  }, /*#__PURE__*/React__default.createElement(SvgVideoPlayerPause, null)) : /*#__PURE__*/React__default.createElement(PlayPauseWrapper, {
    onClick: function onClick() {
      return videoHandler('play');
    }
  }, /*#__PURE__*/React__default.createElement(SvgVideoPlayerPlay, null)), /*#__PURE__*/React__default.createElement(ControlTime, null, formatAudioVideoTime(currentTime), " / ", formatAudioVideoTime(videoTime)), /*#__PURE__*/React__default.createElement(VolumeController, null, /*#__PURE__*/React__default.createElement(VolumeIconWrapper, {
    onClick: handleMuteUnmute
  }, isMuted ? /*#__PURE__*/React__default.createElement(SvgVolumeMute, null) : /*#__PURE__*/React__default.createElement(SvgVolume, null)), /*#__PURE__*/React__default.createElement(VolumeSlide, {
    ref: volumeRef,
    onMouseDown: function onMouseDown(e) {
      return e.stopPropagation();
    },
    onChange: handleVolumeInputChange,
    type: 'range',
    value: volume,
    min: '0',
    max: '1',
    step: 'any'
  })), /*#__PURE__*/React__default.createElement(FullScreenWrapper, {
    onClick: handleOpenFullScreen
  }, isFullScreen ? /*#__PURE__*/React__default.createElement(SvgFullscreenExit, null) : /*#__PURE__*/React__default.createElement(SvgFullscreen, null))) : /*#__PURE__*/React__default.createElement(UploadCont, null, /*#__PURE__*/React__default.createElement(UploadingIcon, null)));
};
var Component = styled__default.div(_templateObject$k || (_templateObject$k = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: inline-flex;\n  & > video {\n    ", "\n  }\n\n  &::after {\n    content: ", ";\n    position: absolute;\n    bottom: 0;\n    height: 70px;\n    width: 100%;\n    background: linear-gradient(360deg, rgba(23, 25, 28, 0.8) 0%, rgba(23, 25, 28, 0) 100%);\n  }\n"])), function (props) {
  return props.fullScreen && "\n        max-width: inherit !important;\n        max-height: inherit !important;\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n    ";
}, function (props) {
  return props.loaded && '';
});
var UploadCont = styled__default.div(_templateObject2$g || (_templateObject2$g = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  min-height: 100px;\n  min-width: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])));
var PlayPauseWrapper = styled__default.span(_templateObject3$c || (_templateObject3$c = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  margin-right: 16px;\n  cursor: pointer;\n  @media (max-width: 768px) {\n    margin-right: 8px;\n    width: 18px;\n    height: 18px;\n    & > svg {\n      width: 18px;\n      height: 18px;\n    }\n  }\n  @media (max-width: 480px) {\n    margin-right: 8px;\n    width: 16px;\n    height: 16px;\n    & > svg {\n      width: 16px;\n      height: 16px;\n    }\n  }\n"])));
var ControlsContainer = styled__default.div(_templateObject4$a || (_templateObject4$a = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  width: calc(100% - 32px);\n  background: linear-gradient(360deg, rgba(23, 25, 28, 0.8) 0%, rgba(23, 25, 28, 0) 100%);\n  padding: 10px 16px 16px;\n  z-index: 20;\n\n  @media (max-width: 768px) {\n    width: calc(100% - 20px);\n    padding: 0 10px;\n  }\n"])));
var ControlTime = styled__default.span(_templateObject5$8 || (_templateObject5$8 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 20px;\n  letter-spacing: -0.2px;\n  @media (max-width: 768px) {\n    font-size: 14px;\n  }\n  @media (max-width: 480px) {\n    font-size: 12px;\n  }\n"])), colors.white);
var ProgressBlock = styled__default.div(_templateObject6$6 || (_templateObject6$6 = _taggedTemplateLiteralLoose(["\n  //background-color: rgba(255, 255, 255, 0.4);\n  margin-bottom: 6px;\n  border-radius: 15px;\n  width: 100%;\n  //height: 4px;\n  z-index: 30;\n  position: relative;\n"])));
var VolumeController = styled__default.div(_templateObject7$5 || (_templateObject7$5 = _taggedTemplateLiteralLoose(["\n  margin-left: auto;\n  display: flex;\n  align-items: center;\n"])));
var VolumeIconWrapper = styled__default.span(_templateObject8$5 || (_templateObject8$5 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  cursor: pointer;\n  @media (max-width: 768px) {\n    & > svg {\n      width: 18px;\n      height: 18px;\n    }\n  }\n  @media (max-width: 768px) {\n    & > svg {\n      width: 16px;\n      height: 16px;\n    }\n  }\n"])));
var VolumeSlide = styled__default.input(_templateObject9$5 || (_templateObject9$5 = _taggedTemplateLiteralLoose(["\n  -webkit-appearance: none;\n  margin-left: 8px;\n  width: 60px;\n  height: 4px;\n  background: rgba(255, 255, 255, 0.6);\n  border-radius: 5px;\n  background-image: linear-gradient(#fff, #fff);\n  //background-size: 70% 100%;\n  background-repeat: no-repeat;\n  cursor: pointer;\n\n  &::-webkit-slider-thumb {\n    visibility: hidden;\n    -webkit-appearance: none;\n    height: 1px;\n    width: 1px;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n  &::-moz-range-thumb {\n    visibility: hidden;\n    -webkit-appearance: none;\n    height: 16px;\n    width: 16px;\n    border-radius: 50%;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n\n  &::-ms-thumb {\n    visibility: hidden;\n    -webkit-appearance: none;\n    height: 1px;\n    width: 1px;\n    border-radius: 50%;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n  &::-webkit-slider-runnable-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n\n  &::-moz-range-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n  &::-ms-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n\n  @media (max-width: 768px) {\n    width: 50px;\n  }\n"])));
var Progress = styled__default.input(_templateObject10$4 || (_templateObject10$4 = _taggedTemplateLiteralLoose(["\n  -webkit-appearance: none;\n  margin-right: 15px;\n  width: 100%;\n  height: 4px;\n  background: rgba(255, 255, 255, 0.6);\n  border-radius: 5px;\n  background-image: linear-gradient(#fff, #fff);\n  //background-size: 70% 100%;\n  background-repeat: no-repeat;\n  cursor: pointer;\n\n  &::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    height: 16px;\n    width: 16px;\n    border-radius: 50%;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n  &::-moz-range-thumb {\n    -webkit-appearance: none;\n    height: 16px;\n    width: 16px;\n    border-radius: 50%;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n\n  &::-ms-thumb {\n    -webkit-appearance: none;\n    height: 16px;\n    width: 16px;\n    border-radius: 50%;\n    background: #fff;\n    cursor: pointer;\n    box-shadow: 0 0 2px 0 #555;\n    transition: all 0.3s ease-in-out;\n  }\n\n  &::-webkit-slider-thumb:hover {\n    background: #fff;\n  }\n  &::-moz-range-thumb:hover {\n    background: #fff;\n  }\n  &::-ms-thumb:hover {\n    background: #fff;\n  }\n\n  &::-webkit-slider-runnable-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n\n  &::-moz-range-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n  &::-ms-track {\n    -webkit-appearance: none;\n    box-shadow: none;\n    border: none;\n    background: transparent;\n    transition: all 0.3s ease-in-out;\n  }\n"])));
var FullScreenWrapper = styled__default.div(_templateObject11$3 || (_templateObject11$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  margin-left: 16px;\n  cursor: pointer;\n  @media (max-width: 768px) {\n    margin-left: 12px;\n    & > svg {\n      width: 18px;\n      height: 18px;\n    }\n  }\n  @media (max-width: 480px) {\n    margin-left: auto;\n    & > svg {\n      width: 16px;\n      height: 16px;\n    }\n  }\n"])));

var _templateObject$l, _templateObject2$h, _templateObject3$d, _templateObject4$b, _templateObject5$9, _templateObject6$7, _templateObject7$6, _templateObject8$6, _templateObject9$6, _templateObject10$5, _templateObject11$4, _templateObject12$2, _templateObject13$2, _templateObject14$2, _templateObject15$2;

var SliderPopup = function SliderPopup(_ref) {
  var channelId = _ref.channelId,
      setIsSliderOpen = _ref.setIsSliderOpen,
      mediaFiles = _ref.mediaFiles,
      currentMediaFile = _ref.currentMediaFile;
  var dispatch = reactRedux.useDispatch();
  var getFromContacts = getShowOnlyContactUsers();
  var ChatClient = getClient();
  var user = ChatClient.user;

  var _useState = React.useState(_extends({}, currentMediaFile)),
      currentFile = _useState[0],
      setCurrentFile = _useState[1];

  var _useState2 = React.useState({}),
      downloadingFilesMap = _useState2[0],
      setDownloadingFilesMap = _useState2[1];

  var _useState3 = React.useState([]),
      attachmentsList = _useState3[0],
      setAttachmentsList = _useState3[1];

  var _useState4 = React.useState(true),
      imageLoading = _useState4[0],
      setImageLoading = _useState4[1];

  var _useState5 = React.useState({}),
      downloadedFiles = _useState5[0],
      setDownloadedFiles = _useState5[1];

  var _useState6 = React.useState(),
      playedVideo = _useState6[0],
      setPlayedVideo = _useState6[1];

  var _useState7 = React.useState(true),
      nextButtonDisabled = _useState7[0],
      setNextButtonDisabled = _useState7[1];

  var _useState8 = React.useState(true),
      prevButtonDisabled = _useState8[0],
      setPrevButtonDisabled = _useState8[1];

  var _useState9 = React.useState(false),
      visibleSlide = _useState9[0],
      setVisibleSlide = _useState9[1];

  var customDownloader = getCustomDownloader();
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var attachments = reactRedux.useSelector(attachmentsForPopupSelector, reactRedux.shallowEqual) || [];
  var visibilityTimeout = React.useRef();
  var attachmentUserName = currentFile ? currentFile.user && makeUsername(contactsMap[currentFile.user.id], currentFile.user, getFromContacts && user.id !== currentFile.user.id) : '';

  var handleClosePopup = function handleClosePopup() {
    setAttachmentsList([]);
    setIsSliderOpen(false);
  };

  var downloadImage = function downloadImage(src, setToDownloadedFiles) {
    clearTimeout(visibilityTimeout.current);
    var image = new Image();
    image.src = src;

    image.onload = function () {
      if (setToDownloadedFiles) {
        var _extends2;

        setDownloadedFiles(_extends({}, downloadedFiles, (_extends2 = {}, _extends2[currentFile.id] = src, _extends2)));
        visibilityTimeout.current = setTimeout(function () {
          setVisibleSlide(true);
        }, 100);
      }

      setImageLoading(false);
    };
  };

  var handleCompleteDownload = function handleCompleteDownload(attachmentId, failed) {
    if (failed) {
      console.log('file download failed!');
    }

    var stateCopy = _extends({}, downloadingFilesMap);

    delete stateCopy[attachmentId];
    setDownloadingFilesMap(stateCopy);
  };

  var handleDownloadFile = function handleDownloadFile(attachment) {
    if (attachment.id) {
      setDownloadingFilesMap(function (prevState) {
        var _extends3;

        return _extends({}, prevState, (_extends3 = {}, _extends3[attachment.id] = {
          uploadPercent: 1
        }, _extends3));
      });
    }

    downloadFile(attachment, true, handleCompleteDownload, function (progress) {
      var loadedRes = progress.loaded && progress.loaded / progress.total;
      var uploadPercent = loadedRes && loadedRes * 100;
      setDownloadingFilesMap(function (prevState) {
        var _extends4;

        return _extends({}, prevState, (_extends4 = {}, _extends4[attachment.id] = {
          uploadPercent: uploadPercent
        }, _extends4));
      });
    });
  };

  var handleClicks = function handleClicks(e) {
    if (!e.target.closest('.custom_carousel_item') && !e.target.closest('.custom_carousel_arrow')) {
      handleClosePopup();
    }
  };

  useDidUpdate(function () {
    if (playedVideo) {
      var videoElem = document.getElementById(playedVideo);

      if (videoElem) {
        videoElem.pause();
      }
    }

    getAttachmentUrlFromCache(currentFile.url).then(function (cachedUrl) {
      if (currentFile) {
        if (cachedUrl) {
          if (!downloadedFiles[currentFile.id]) {
            setVisibleSlide(false);

            if (currentFile.type === 'image') {
              downloadImage(cachedUrl, true);
            } else {
              var _extends5;

              clearTimeout(visibilityTimeout.current);
              setDownloadedFiles(_extends({}, downloadedFiles, (_extends5 = {}, _extends5[currentFile.id] = cachedUrl, _extends5)));
              setPlayedVideo(currentFile.id);
              visibilityTimeout.current = setTimeout(function () {
                setVisibleSlide(true);
              }, 100);
            }
          } else {
            if (currentFile.type === 'image') {
              downloadImage(cachedUrl);
            } else {
              setVisibleSlide(true);
            }
          }
        } else {
          if (customDownloader) {
            customDownloader(currentFile.url, false).then(function (url) {
              try {
                return Promise.resolve(fetch(url)).then(function (response) {
                  setAttachmentToCache(currentFile.url, response);

                  if (currentFile.type === 'image') {
                    downloadImage(url, true);
                  } else {
                    var _extends6;

                    clearTimeout(visibilityTimeout.current);
                    setDownloadedFiles(_extends({}, downloadedFiles, (_extends6 = {}, _extends6[currentFile.id] = url, _extends6)));
                    setPlayedVideo(currentFile.id);
                    visibilityTimeout.current = setTimeout(function () {
                      setVisibleSlide(true);
                    }, 100);
                  }
                });
              } catch (e) {
                return Promise.reject(e);
              }
            })["catch"](function (e) {
              console.log('fail to download image...... ', e);
            });
          } else {
            if (!downloadedFiles[currentFile.id]) {
              setVisibleSlide(false);

              if (currentFile.type === 'image') {
                downloadImage(currentFile.url, true);
              } else {
                var _extends7;

                clearTimeout(visibilityTimeout.current);
                setDownloadedFiles(_extends({}, downloadedFiles, (_extends7 = {}, _extends7[currentFile.id] = currentFile.url, _extends7)));
                setPlayedVideo(currentFile.id);
                visibilityTimeout.current = setTimeout(function () {
                  setVisibleSlide(true);
                }, 100);
              }
            } else {
              if (currentFile.type === 'image') {
                downloadImage(cachedUrl);
              } else {
                setVisibleSlide(true);
              }
            }
          }
        }
      }
    });
  }, [currentFile]);
  useDidUpdate(function () {
    var currentMedia = attachmentsList.find(function (att) {
      return att.id === currentMediaFile.id;
    });
    setCurrentFile(currentMedia);

    if (currentMedia) {
      var indexOnList = attachmentsList.findIndex(function (item) {
        return item.id === currentMedia.id;
      });

      if (!attachmentsList[indexOnList + 1]) {
        setNextButtonDisabled(true);
      } else {
        setNextButtonDisabled(false);
      }

      if (!attachmentsList[indexOnList - 1]) {
        setPrevButtonDisabled(true);
      } else {
        setPrevButtonDisabled(false);
      }
    }
  }, [attachmentsList]);
  useDidUpdate(function () {
    setAttachmentsList(attachments || []);
  }, [attachments]);
  React.useEffect(function () {
    setImageLoading(true);

    if (customDownloader && currentMediaFile) {
      getAttachmentUrlFromCache(currentMediaFile.url).then(function (cachedUrl) {
        if (cachedUrl) {
          if (currentMediaFile.type === 'image') {
            downloadImage(cachedUrl);
          } else {
            var _extends8;

            setDownloadedFiles(_extends({}, downloadedFiles, (_extends8 = {}, _extends8[currentMediaFile.id] = cachedUrl, _extends8)));
            setPlayedVideo(currentMediaFile.id);
          }
        } else {
          if (customDownloader) {
            customDownloader(currentMediaFile.url, false).then(function (url) {
              try {
                return Promise.resolve(fetch(url)).then(function (response) {
                  setAttachmentToCache(currentMediaFile.url, response);

                  if (currentMediaFile.type === 'image') {
                    downloadImage(url);
                  } else {
                    var _extends9;

                    setDownloadedFiles(_extends({}, downloadedFiles, (_extends9 = {}, _extends9[currentMediaFile.id] = url, _extends9)));
                    setPlayedVideo(currentMediaFile.id);
                  }
                });
              } catch (e) {
                return Promise.reject(e);
              }
            });
          } else {
            downloadImage(currentMediaFile.url);
          }
        }
      });
    }

    if (currentMediaFile) {
      if (mediaFiles) {
        setAttachmentsList(mediaFiles);
      } else {
        dispatch(getAttachmentsAC(channelId, channelDetailsTabs.media, 35, queryDirection.NEAR, currentMediaFile.id, true));
      }
    }

    return function () {
      setAttachmentsList([]);
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$b, {
    draggable: false
  }, /*#__PURE__*/React__default.createElement(SliderHeader, {
    backgroundColor: colors.textColor1
  }, /*#__PURE__*/React__default.createElement(FileInfo, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: attachmentUserName,
    setDefaultAvatar: true,
    size: 36,
    image: currentFile && currentFile.user && currentFile.user.avatarUrl
  }), /*#__PURE__*/React__default.createElement(Info, null, /*#__PURE__*/React__default.createElement(UserName, null, attachmentUserName), /*#__PURE__*/React__default.createElement(FileDateAndSize, null, moment(currentFile && currentFile.createdAt).format('DD.MM.YYYY HH:mm'), ' ', /*#__PURE__*/React__default.createElement(FileSize, null, currentFile && currentFile.size && currentFile.size > 0 ? bytesToSize(currentFile.size, 1) : '')))), /*#__PURE__*/React__default.createElement(ActionDownload, {
    onClick: function onClick() {
      return handleDownloadFile(currentFile);
    }
  }, downloadingFilesMap[currentFile.id] ?
  /*#__PURE__*/
  React__default.createElement(ProgressWrapper, null, /*#__PURE__*/React__default.createElement(reactCircularProgressbar.CircularProgressbar, {
    minValue: 0,
    maxValue: 100,
    value: downloadingFilesMap[currentFile.id].uploadPercent || 0,
    backgroundPadding: 6,
    background: true,
    text: '',
    styles: {
      background: {
        fill: 'transparent'
      },
      path: {
        stroke: colors.white,
        strokeLinecap: 'butt',
        strokeWidth: '6px',
        transition: 'stroke-dashoffset 0.5s ease 0s',
        transform: 'rotate(0turn)',
        transformOrigin: 'center center'
      }
    }
  })) : /*#__PURE__*/React__default.createElement(SvgDownload, null)), /*#__PURE__*/React__default.createElement(Actions, null, /*#__PURE__*/React__default.createElement(ActionItem, {
    onClick: handleClosePopup
  }, /*#__PURE__*/React__default.createElement(SvgClose, null)))), /*#__PURE__*/React__default.createElement(SliderBody, {
    onClick: handleClicks
  }, attachmentsList && attachmentsList.length ?
  /*#__PURE__*/
  React__default.createElement(Carousel, {
    draggable: false,
    pagination: false,
    className: 'custom_carousel',
    initialActiveIndex: currentFile && attachmentsList.findIndex(function (item) {
      return item.id === currentFile.id;
    }),
    onChange: function onChange(_currentItem, pageIndex) {
      setImageLoading(true);
      setCurrentFile(attachmentsList[pageIndex]);

      if (!attachmentsList[pageIndex + 1]) {
        setNextButtonDisabled(true);
      } else {
        setNextButtonDisabled(false);
      }

      if (!attachmentsList[pageIndex - 1]) {
        setPrevButtonDisabled(true);
      } else {
        setPrevButtonDisabled(false);
      }
    },
    renderArrow: function renderArrow(_ref2) {
      var type = _ref2.type,
          _onClick = _ref2.onClick,
          isEdge = _ref2.isEdge;
      var pointer = type === 'PREV' ? /*#__PURE__*/React__default.createElement(SvgSliderButtonLeft, null) : /*#__PURE__*/React__default.createElement(SvgSliderButtonRight, null);
      var disabled = type === 'PREV' ? prevButtonDisabled : nextButtonDisabled;
      return /*#__PURE__*/React__default.createElement(ArrowButton, {
        className: 'custom_carousel_arrow',
        leftButton: type === 'PREV',
        type: 'button',
        backgroundColor: colors.textColor1,
        onClick: function onClick(e) {
          setImageLoading(true);
          e.preventDefault();

          _onClick();
        },
        disabled: isEdge,
        hide: disabled
      }, pointer);
    },
    isRTL: false
  }, attachmentsList.map(function (file) {
    return /*#__PURE__*/React__default.createElement(CarouselItem, {
      className: 'custom_carousel_item',
      key: file.id,
      draggable: false,
      visibleSlide: visibleSlide
    }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, file.type === 'image' ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !downloadedFiles[file.id] && imageLoading ? /*#__PURE__*/React__default.createElement(UploadCont$1, null, /*#__PURE__*/React__default.createElement(UploadingIcon, null)) : /*#__PURE__*/React__default.createElement("img", {
      draggable: false,
      src: downloadedFiles[file.id],
      alt: file.name
    })) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(VideoPlayer, {
      activeFileId: currentFile.id,
      videoFileId: file.id,
      src: downloadedFiles[file.id]
    }))));
  })) : /*#__PURE__*/React__default.createElement(UploadingIcon, null)));
};
var Container$b = styled__default.div(_templateObject$l || (_templateObject$l = _taggedTemplateLiteralLoose(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 100vh;\n  z-index: 999;\n"])));
var ProgressWrapper = styled__default.span(_templateObject2$h || (_templateObject2$h = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  width: 35px;\n  height: 35px;\n  animation: preloader 1.5s linear infinite;\n\n  @keyframes preloader {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n"])));
var SliderHeader = styled__default.div(_templateObject3$d || (_templateObject3$d = _taggedTemplateLiteralLoose(["\n  height: 60px;\n  background: ", ";\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0 16px;\n"])), function (props) {
  return props.backgroundColor || colors.textColor1;
});
var SliderBody = styled__default.div(_templateObject4$b || (_templateObject4$b = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  height: calc(100% - 60px);\n  background: rgba(0, 0, 0, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  & .custom_carousel {\n    height: 100%;\n\n    & .rec.rec-carousel,\n    & .rec.rec-slider {\n      height: 100% !important;\n    }\n  }\n  & .rec-carousel-item {\n    display: flex;\n    align-items: center;\n  }\n"])));
var FileInfo = styled__default.div(_templateObject5$9 || (_templateObject5$9 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  width: 40%;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 14px;\n  line-height: 14px;\n  color: ", ";\n"])), colors.white);
var Info = styled__default.div(_templateObject6$7 || (_templateObject6$7 = _taggedTemplateLiteralLoose(["\n  margin-left: 12px;\n"])));
var Actions = styled__default.div(_templateObject7$6 || (_templateObject7$6 = _taggedTemplateLiteralLoose(["\n  width: 40%;\n  display: flex;\n  justify-content: flex-end;\n  color: ", ";\n"])), colors.white);
var FileDateAndSize = styled__default.span(_templateObject8$6 || (_templateObject8$6 = _taggedTemplateLiteralLoose(["\n  font-weight: 400;\n  font-size: 13px;\n  line-height: 16px;\n  letter-spacing: -0.078px;\n  color: ", ";\n"])), colors.textColor2);
var FileSize = styled__default.span(_templateObject9$6 || (_templateObject9$6 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  margin-left: 12px;\n\n  &:after {\n    content: '';\n    position: absolute;\n    left: -10px;\n    top: 6px;\n    width: 4px;\n    height: 4px;\n    border-radius: 50%;\n    background-color: ", ";\n  }\n"])), colors.textColor2);
var UserName = styled__default.h4(_templateObject10$5 || (_templateObject10$5 = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  color: ", "\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n"])), colors.white);
var ActionItem = styled__default.span(_templateObject11$4 || (_templateObject11$4 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n"])));
var ActionDownload = styled__default.div(_templateObject12$2 || (_templateObject12$2 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  color: ", ";\n\n  & > svg {\n    width: 28px;\n    height: 28px;\n  }\n"])), colors.white);
var CarouselItem = styled__default.div(_templateObject13$2 || (_templateObject13$2 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  opacity: ", ";\n  img,\n  video {\n    //max-width: calc(100vw - 300px);\n    min-width: 280px;\n    max-width: 100%;\n    max-height: calc(100vh - 200px);\n    height: 100%;\n    @media (max-width: 480px) {\n      min-width: inherit;\n    }\n  }\n  img {\n    min-width: inherit;\n  }\n"])), function (props) {
  return props.visibleSlide ? 1 : 0;
});
var UploadCont$1 = styled__default.div(_templateObject14$2 || (_templateObject14$2 = _taggedTemplateLiteralLoose(["\n  //position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  min-height: 100px;\n  min-width: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])));
var ArrowButton = styled__default.button(_templateObject15$2 || (_templateObject15$2 = _taggedTemplateLiteralLoose(["\n  min-width: 60px;\n  max-width: 60px;\n  height: 60px;\n  margin-right: ", ";\n  margin-left: ", ";\n  background: ", ";\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  box-sizing: border-box;\n  border-radius: 50%;\n  line-height: 1px;\n  align-self: center;\n  outline: none;\n  cursor: pointer;\n  visibility: ", ";\n  @media (max-width: 768px) {\n    min-width: 36px;\n    max-width: 36px;\n    height: 36px;\n    margin-right: ", ";\n    margin-left: ", ";\n\n    & > svg {\n      width: 22px;\n      height: 22px;\n    }\n  }\n  @media (max-width: 450px) {\n    min-width: 32px;\n    max-width: 32px;\n    height: 32px;\n\n    & > svg {\n      width: 20px;\n      height: 20px;\n    }\n  }\n"])), function (props) {
  return !props.leftButton && '24px';
}, function (props) {
  return props.leftButton && '24px';
}, function (props) {
  return props.backgroundColor || colors.textColor1;
}, function (props) {
  return props.hide && 'hidden';
}, function (props) {
  return !props.leftButton && '4px';
}, function (props) {
  return props.leftButton && '4px';
});

var _path$A;

function _extends$B() {
  _extends$B = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$B.apply(this, arguments);
}

function SvgChoseMedia(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$B({
    width: 18,
    height: 18,
    viewBox: "0 0 19 19",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$A || (_path$A = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M3.614 2.052C4.366 1.65 5.107 1.5 6.798 1.5h4.404c1.691 0 2.432.15 3.184.552.672.36 1.203.89 1.562 1.562.402.752.552 1.493.552 3.184v4.404c0 1.691-.15 2.432-.552 3.184a3.763 3.763 0 01-1.562 1.562c-.752.402-1.493.552-3.184.552H6.798c-1.691 0-2.432-.15-3.184-.552a3.764 3.764 0 01-1.562-1.562c-.402-.752-.552-1.493-.552-3.184V6.798c0-1.691.15-2.432.552-3.184.36-.672.89-1.203 1.562-1.562zm7.16 7.07a.297.297 0 01.482.004l3.04 4.193c.101.139.074.335-.06.44a.297.297 0 01-.183.062h-9.57a.309.309 0 01-.304-.314c0-.07.022-.137.064-.192l2.22-2.954a.297.297 0 01.473-.008l1.528 1.861 2.31-3.092zM5.785 6.857a1.071 1.071 0 100-2.143 1.071 1.071 0 000 2.143z",
    fill: "CurrentColor"
  })));
}

var _path$B, _defs;

function _extends$C() {
  _extends$C = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$C.apply(this, arguments);
}

function SvgNoMessagesIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$C({
    width: 49,
    height: 49,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg",
    xmlnsXlink: "http://www.w3.org/1999/xlink"
  }, props), _path$B || (_path$B = /*#__PURE__*/React.createElement("path", {
    d: "M.5 48.36h48v-48H.5v48z",
    fill: "url(#noMessagesIcon_svg__pattern0)"
  })), _defs || (_defs = /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("pattern", {
    id: "noMessagesIcon_svg__pattern0",
    patternContentUnits: "objectBoundingBox",
    width: 1,
    height: 1
  }, /*#__PURE__*/React.createElement("use", {
    xlinkHref: "#noMessagesIcon_svg__image0_2070_42990",
    transform: "scale(.00625)"
  })), /*#__PURE__*/React.createElement("image", {
    id: "noMessagesIcon_svg__image0_2070_42990",
    width: 160,
    height: 160,
    xlinkHref: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAYAAACLz2ctAAAv5UlEQVR4nO19e5QdR3nnr6q6e0bSWI9hbMmSpVjm4beOZRm8azAhMYkDB/uwPnZCQryQgOPjeLPksUseG0zOOueEJEvYJJuAkxCwncCud5MTgoHkYCA8Ahg7BhPFEo7tINvyS0jWSPO6t7uq9g/duvruN19V971zZ0ay5zunz+2u7q5X/+r3Paput/LeY0VWZLlEL3cFVuTFLVnYUUotZz2WVe68805tjBm11o5WVTWWZdk6AGsArFFKrQIwqpQasdaOeO9HlVI5jvWdBgB/TCyACsCcUqpljGl57+e897Pe+2nv/QyAI8aYSQCz3vtW5/oXpVx//fUACADvuOOOZavMUkiWZbn3ftx7v0VrvVkpdbpzbqtSarPWelxrPZ5l2fqRkZH1SqkxpVShtc4BZN57o7WeN0LDoKVmjPe+uwGw3vvKe18CqLz3M977w53tkPf+kHPuOaXUPqXU0865pwE8qZQ6AGB2KfpluaULQK1fONo4z/PMObcFwNlKqbMBnK+13q613qaUOl1rPaa1NkopaK2hlALdB9BNA3r7hoNOAqFzLuwa773x3o900tc75zZ77+Gc6wLVOQfnnOuw5QHv/ePOue967/cqpb7jnHtYa/0YgJnF67XlkS4AjTHLWY8FiVJKA9iqlNqplHqlMeZipdS5ADZnWZYbY6C17gGbMWYe8KQNmD84qbmilKKMBwDRYwK2efvee+2cW9PZznTOvdZ7j6qqXIctH/be/7P3/j7v/beUUnsBTC9mvy6FnLQM6L0vlFIXAHitMea1xphLtNZbtNY6AI7+BsAFsHHmqwMhgB52FOrTA7qQFn4DK1LwcVCGNGstTdPOuQlr7YRz7jLn3I3OuUnn3L84577qvf8ygG8AeGZROnqR5aRyQpRSBsB5AN6gtf7hLMsuMcas01ojy7Ie0PF9aatTwWFQ0jTvffd651yPCo4BMAArpFHwUcBxMEqbtRbW2nUdMF5mrf0Fa+2j1tovO+c+A+BLAA4s+sMYkmT1lyy/KKVeAuCHjDHXaa1fl2XZeJZlXWajLMeZTwIdZ8OUDchZjw9UKY5KwQb02IQiAGPgY0xIAUiPjbX2Fc65V1RV9VNVVX3He/9pAJ/w3t8LoD3kxzFUOaFtQO/9dgA/box5S5ZlF+R5rijQKOvFwJhivZTa5eCjTEeZMKTRX1L/nn16HQefpI4D4ChLUgCGfXKsrbXndrabq6r6B+/9x7z3nwJwaJEf10ByQqpga+3LjTHvyLLsrcaYM7IsQ9go2FJApE5GuE5yOug+EGc+vs+lDoSJUI0IxhoV3APCqqq6x1VVhfRRa+2PWGt/pKqqb1lr/8J7/38APLnwJzQ8OaEA6Jw7C8DP5Hn+H/M8Pz3PcxF0eZ6LgKOqlXu+MXUrAY/3Reo4xXrhOAVKiRVTqlliPwo+CkZy3UVVVV1UluXN1to/995/FCcIEE8IAJZleZrW+p3GmBuzLNuW5zkC+ALDUfBJqjZcm2K8mMqlfSABMJyrkzoVHNtPATLGihR0AYRZlvUAMLCjcw5ZliHP8+1lWd5aVdXbrbUf6gDxe40e0iLJsgKw3W5nAK4zxvxqURQXBtBRdSv9cvajoKuz87ijwdtex34pCbYhv5fai+GYp3NVHUCntY6yYgBdAGBVVT3H1loYY3rOa62R5/lLq6r63aqqrnfO/Zb3/v9hmaYFly0OODc3d47W+r15nl+XZZkpiqILssByAXCS/RdAmAJfU8ciSFN7LyUcUCFN8pYlgEpsGLzoAEjnXLe9zrkuyAIDxliRgrHTzzuqqvqLsizfbK29FcC/DNToBciSh2FarVYG4O1Zlt1SFMVWbucFINK0mPMhebic5WKMNyjTNXFE6q7jYKMAlTxszoIUhIERtdaw1nYHJGe9ALqgkgMotdZGa/1jZVl+f1VVv+Oc+yCAuUadMQTpAlAaocOWVqu13Rjzm1mW/XiWZYqCTdokJ6MOfE1svLAvyUJMkVSMUFLB/ZYVwElDQQGE1PnqAKvHJg52YQBhAGXYN8ZsKsvy98qyfL33/pcB7B64I/qQJYsDTk9P/1CWZb9fFMW51NYL6pYyYUzlBvuvjvVSqnYxgBcTSR3zsjgYub1I75GuDdcHIAYwUkBSwIV+o6q4LEt6zxurqrqgLMtfAfDxoXcKkyVhwNnZ2XfleX5rURSnBKBxEKbAF5vR4MwHHLdl64C3lE5XKmwjqWN6rVRvzqxKqZ7ZlpAeVHLoK6qmpb4kAN2mlLqjqqoLOrbhoqnkRQXgzMzMKmPMrUVR/GKe56ooih6240CkAExNqcUcDaBezS6Hty+V3w8rSnnw+2NmCAVh3cbyyJRSvwbg5c65nwfw1NA6gciihWGmpqY2GmP+MM/z62hcL8aAlO2oqo2BL9Q5BkIuyw08Lk1YkZ/japo6LNRrTg3KIDFThpbVSb+uLMst1tp3ANg7nNYfl0Xxgqenp880xvx5URQ/UBQFAgCbMN9CWG851exCRGI0ei5IE3sxeMw8Dw6uoLIlUAv9eRmAu5xzbwPwzQGbKcrQGfDo0aPbjTF3FkXx6hT4eJyPMx8FoaQiQp0l1jtZgEclppr5NXWB7gCu1GANQWyaB9C7akcY0BeWZflx59z1AO5bSFupDJUBjxw5ckaWZR8piuLVFHh1Dofk3VLwpabQTnbgcakDonSeqmLgOAtKQAzAk/KjkxG8LzvlnV2W5Z1VVf0YgAcX0s4gXQByL6pfmZqaOtUYc1ue59/PgSfNaNB96pVJqvfFAj4q/QJRYsMQmgn70vX0vhCWCemSWQPgbO/9RzsgfHiBzRyOFzw9PT2qtf69PM/fyJ2MGPik9Xt8So17aEDzuN4LRVLOSjhfx4YUhFIe3ntkWdZjG/KyWdpF3vsPVlX1Fixw9fVQAKiUem9RFD9JbT4+q8FXr1CwSbG+lN1Hyl1A008+iTkrTUAYVDJdJxkTCtTAiHQqsLPg4Qedc79lrb0RgI1mViMLBuDs7OxPF0Xxbspu0jo+ycOljodk60mB5iAvNvAF6QeE0jXAfHUsrVmk4r2HMUa6/h3tdvtfAfz2gM1Z2FTc0aNHL8nz/DfyPNeDzuHGQi0r4ItLzD6sS6fqmJo1/J7AckEoCwLoTvl1nuuvlWX5AIDPDtKWgZ2Qqamplxhj3p/n+VYeXqHsFgMf93JTni6VFzv4qDRhQ66OOQsGCaoZOA40fk1Iz7KMrk1ca619X1mWewE80W8bugDk7nmdaK3fXRTFayXHIgBSKVXLfJLKjYUDVsA3X1IgBHr/REXTw74Espj9Z4zpMl9YZe2cQ57nFzvn3g3g5/qt/0AqeGpq6sqiKH5OiuPR0IoUWE4Fl7mzsQK4ZhIDIb+GC12cQJ8Ht/W4AxLOBRB2Qjg3tlqtvwdwdz9175sBp6en1+Z5/it5nq+iAKT/4ZDieRx0EghTnbUCxrT065xQNUvXE4ZzfGouADMErMMzDvZgnud5VVXvLsvyKwAON6133zagMeadWZa9TprBiHm9fAsdQYGXCjKvSDOpY0JJFfM4o8SE9Hz45X8X7Tzzy6uqegeA9zetc9cAkBwAvs3Ozp6dZdnPcqaTvN0Y29V5uDFZihXbL1Sp62P6XOgxf2bcaZQmE7Isu8k594q6V4wE6YsBtdY/k2XZS5v8TyPVAIn9aMMBeaXHoEvZX0zSjz0oLWzloRk6RxzmlmlckDsl1tqXdljwl5vUt1taXYxudnb2YmPMT9LgcYz5UnO4KfA1FW4Yr0hzidnaqWclPdeUBjTGvNU5d34TBuwCsI4ytdY/nWXZaXwGIxVQjh3zDlgoo0ne2gpAeyUGttQ5KWQTAyGL/W5RSr01RUJBGq0HnJ6evqgoiutiU2qpGY268MpSqNPFBuGJYBI0aaOknpWavwCBPivqGac8YmYHot1u/2hZln8K4N9SdeoCsKrif4w3xvx4lmWnSWpWGhUSMKXGxUB5ssnJyrIBkPyXnuegi6lnGqTugPClVVW9GcAHUnWo9YLLstymtf4PkqORivXFQErLCvsrsnwSG/wpFcyfszSt2tGU17hjrxwe3Ab03r/BGPNyvnyK70vAkxrRD/hOVmY5mSUVmeCkwkHJwAet9aUAXpcqL/lCmHa7PaK1viY2w5Fiu2HE/lZk6YWHv6T9mKfMN2NMrrV+s3QuSPLlRN77f2eMeY3k+UoOhmTv8QJXZHlEcj7ozAZPlzQXd0T4WxgoCRGT7Qfb7fb3Adgn1auLjPBWJboZY67UWq8OGXJHI6aKYyDldN5Exa6o4cElFYqKLV6Vlm7FohopJiQRk7OQUMNRairLcq3W+ooAtDpghYrWbbxhK7L0kprjpb91DooUE5QiIsaY1/NgdZDocqyqql6llNoR83Rjv03svtg0W6yxK7I4wtlR0kqSuuVml6SK2fbqdru9FcKC1VQc8AeNMaOSc0EZURoJTdgxpIWOOJmBtsA/dHXzkAblcgm1+ajtx68JvxJGCAOeqZS6FAIAxThgWZZrjDGXS6o35vHEmA+QX5wDyB1c98eahUjTB1o3tTfMqT6axyD5xtRkqjxelpSn9AvMf5aS2uVYMcYorfVl/XjB5ymldig1/4XfUkHhfnocKs49YKlRsQ4cJjNKHt+LWbhJRNNpv3N7kM+G0PtiDklnu6SqqjVg37cTA9FKqVdmWbY2NdcrFSqxH69g7L5+gLkix6WOLRfK1rFnQ89JdqFAVOd677fzenQBSCuptX5lClw83icxn1SxJtJvJ72YV7xIbW8CuNj5Js+rzraXNGBHDU8Erdqj0nnGZVmOa613pvR8St/TgqWGNAEkt1NSQlVFEzut7sHwvPj5prHLpdh4vZvWifcdlZgGSmmrFEmx++YBcN5yLKXUy5RS26UAM1exsdEQGlzHhNKIiXVerJP6kSYPLRYjq0tbbqlrG7XluEj2XjiOnZOeOf2NxAjPc85lIN8kkV7Pdp7Wem1qyq3OhqtL5x3RL6DqALBcAEk95Lp7hiF1qjMw4KADmJcTnifNkz/jgKEOkb28LMtxAM+FvKS/ZZ7fdNolxoocvKkGDFvq1GRT9d/Ptfy6fsI9/dQtJXxA1zkm/ZYnaTapvBQetNana62/DwSAPf8JsdYarfXLQ0ZNbIB+WDHVsGGKVO9+7q27JwXyfsqrY6yU+dK0rimRBls/gyKm3QD5HdQA1imlttPremxA59x6Y8xZknpMdUhdOs+nTupGcBPheQwD6E3sxn7rzevVRI0Okq90fwxsVKXG/i2Zeq4prQngTJoPtwE3A9hMaRRIf3tDKKBxZevU86BxK2rrDMPmGWZAnMtC8l1ovWKsJ10Tu45qgyb4UEqdRe/P2MVnKKVOEW5qxHj8PN/vxBjnNSzV+GEyYb8PK8UWKRXcT936rYd0bliDo05rhGfJr+F9nNKaSqnTrbVdT5j/MX2zUqqoo1WpUpQtYx1S11HDYKrwK4F3GB5nvx64pNaGURZ94MPybOteTiAREU+Pqd9AZlrrjVVVrQZwBJj/htQtsdALLTBWKFXBMXZMidSRTViQAi+I9Okqeo2kWlL15aomVl+eJrFok35JBcFj+Q8DhE3s3BTgpDzZdacBWIsOALuIabVaawFsljpZyijViDqWHJQhqfBZgfDZUloe/7hzakahadnhurAGLrwZTGv5BeCDCM8n1J+aRKFd/L5+6yANXkkkNduEnPj1Wuv1WutTwznqhKwFMM5Hd2yVSx3yUw3h+4N2GoAuyML/VZxzKMsSAFAUBZRSaLVa8/58LUX5ef1i6tSYY9+7A4B2uw0A3bfDeu+7X59s0g6JQWnbQt5KHfvGR1mWMObYd5UBoCxLkZl5W2Llc4k9E2rWxAZujGQYRkYBrA8HFIBjSqkNUqE0kzqqbZo+iHB1FraiKHD48GE88MAD2L17N773ve9BKYVNmzbh4osvxs6dO1EUBVqtVo8TxPNrooKKokC73cb999+P+++/H0899RS89zj11FNx0UUX4dJLL8Upp5zSHQR1YEgFs7U+9hfHZ555Bvfeey8eeeQRTE1NYc2aNdi+fTt27tyJs846q/sfHu4wpkwabkNK9ekn5BMbzILmHNFarwvXUCfkFGPMWg6yphQtVYo2aqFATIHvwQcfxO233449e/ag1WqF9sA5h7/+67/G5ZdfjhtuuAGbNm3CzMxM9+8HdTYfv6YoCuzbtw+33XYbvv71r6PdbncB7b3HJz/5SezYsQM33XQTzjvvvC4IaR/UATG0K8zDf/azn8Vdd92Fffv2ATge4M3zHJ/5zGdw5ZVX4k1vehOKokBZlo2jDDFNFAMeT4+RUIrRO6KVUmvDAWXA9TimhnsqIxUWc7n5Nf3YVYOo4QC+973vfXj22WexevVqjI2N9ZTfbrdx991348CBA7jlllswPj6Odrvd+AFR5nviiSfw3ve+Fw899BDGx8e7ZQUpyxL33Xcfnn76adx6660499xzuyo6VQatbygvyzJ84hOfwG233YayLLFq1aoehjPG4ODBg/jIRz6CAwcO4J3vfGf39Ri8/sPUQqF8nm/TMjq28pruMTm3FsCaMAJj6lby8lI0Titd17C687RT8zzH5OQk7rjjDjz33HM45ZRTuufoluc5TjvtNHzjG9/Axz72sVoTgjMRcPzDLbfffjseeughbNq0qWuDkTdIIMsynHbaadi/fz8+9KEPYWZmpmsr8r6RJDgWRVFg7969uPPOO1FVFdasWQPvj31KKzgkge2KosDdd9+NL3zhC8jzfJ6tFmtfE0k5NU0dHgpYcq8IwDXe+1VSIbywYXh7TQzkVCOVUnjggQfw8MMPY/Xq1d3FFHQABdFaY2xsDF/84hfx2GOPYXR0NJqvFHjPsgy7d+/G1772Naxbt04sh9Z3w4YN+Pa3v4177703aoPF2hyuv+eee3DgwAGMjo72vL87lOGc69p9VVXh85//PI4ePSqyYMyO72fQ0/J5XjSdlsf7iaR3VQefO+vpmZSxSgsdBiClfGPpoS579uzpfmaedzIfPKOjozh06BAeeughse68s3nH79mzB0eOHMHIyIjoCdL7syxDWZZ48MEHxbykYH2oc5ZlOHz4MPbu3dvzRvrwy4nAWos8z7Fv3z488cQTXRZMDdymQvOJ7dP2S/dH8uoSHV2SXyLyza8mdCud52lNjP4m5Rhj0G638fzzz0fzlR66cw4HDhzonpeYgoMwHB84cABKzZ+ajDG1UgrPPfdcj2NQ166Q/+TkJCYnJ3s+jxXy5MAPbZuZmcGhQ4e6ecX6gZcp7UvXpQZBTEPGGFcpVYRr6UyI6mwAjts2qYJiFaVGqtSBkhFb1wn8Ot6wVCCYAox+fKVODdFz0ndUJBXEyxrEUKdvD5CYMggFrdS2OuGOCgcalzp7sCnzeu+P/xuTXJN573WwL+oQTyvUL3CaXJfKMxjqGzdunPcn6Ni/+MJLtLds2QIgHoaImRlbtmzpeT8OZ0OJHbdt29b9mlDM9uPAtdZi3bp1mJiYgPe+pw28nNBmpRTGx8excePGbl5NBhhvf901HPwUJ7G+5Djq1KubUc+/4gAoeixt9ByVuhFTB6rUSOdpwSjfsWMHVq9e3fUGpY9kBzZptVrYunUrzj///HkfcU5JqPOFF16ITZs2odVq9ZTB/ztjjIG1FmNjY7j44osBQAyNhGMKTKWOzXaccsopuPjii6GUmvchIHqc5zlGR0fhnMM555yDM844oxubbNKfksQclib9FFPNAagkr65qpQCcATAXAx5Hu5TehAnr7I4meSmlUFUVduzYgUsvvRRVVWHVqlUYHR3FyMgIiqLAyMgIRkZGMDo62n0gV199NTZv3oxWq9XT0TxvflyWJc4880y84Q1v6Hqeo6OjKIqiu+V5jqIoYIzB9PQ0rrjiCuzcuRNVVUXtSn5M96+44gqcf/75qKoKq1evxujoaLeNYVu9ejW895iYmMAb3/hGFEXRnTPm+TXVUlIf1J2neVOwSfZqR7oRehqInvTeT6UMzBilSul1xm8/3hiVoHqstSiKAj/xEz+BmZkZPPzwwxgZGemGIULMbG5uDtZaXHvttbjqqqu687Qp4HHbKNjD1157LQ4dOoQvfvGLMMZgdHS053xZlpidncXll1+Ot73tbd0QCc9PahM93263sXHjRtxwww348Ic/jAMHDmDNmjXzBk1ZlhgbG8M111yDCy64AO12u+e9PSHPYUhop9RfoRy6+KNmoUQr7FAAHvbeH6UZxIBHP1jSxDGRKkzP9wNGat+0Wi1s2rQJN910E+655x7s3r0bU1NTsNaiqip473H66afj8ssvxxVXXNFlzhjrpMoqyxKrV6/GjTfeiLPOOgtf/epXcfDgwZ7vrG3YsAFvetObcNVVV2HdunU9ixL6UYEBhOeddx7e9a534Z577sFjjz2GmZkZAOhOxW3evBmve93rcOGFF3an/fpRm0GaOBGU1aR7Y/lFypgJ6RSAU977SQo+74/FmYIhba3tMkxNAaJxSsFIgUevjRnrPK8w0tvtNsbHx3HttdfiNa95Dfbv34/Dhw9DKYUNGzbgzDPPxMTEBKy1Xfso9Y89qSzgmGdaliVGRkZw9dVX47LLLsOjjz6KgwcPwlqL9evXY/v27V0nh84DNwVhOB/Yq6oqbNu2Dddffz2efPJJPPPMM5idnUVRFJiYmMC2bduwevXq7mDrZ7V5ncRMpTpnStKQFC+d80fDfTQMc9Q59zx7QTkA9GTAM+MFUd0vhQzofp1KSnUKcHyKLNhlW7Zs6QKA3hMeUAjs9ssQ9Nqg2icmJjAxMTHv2lBWEyegjv0DYxtjsH37dmzfvr3nfFD7YUDysiTtI7EVL5OzXVPm4+dieFFKzWdA59wRAIdoBpwNU+lSg+ho4KMz1flSgymLxEZgeMchv6YfT46WJdUrCAWaVF7sviYi2Vexz+lK/RqTOsBI+/SXOxb0ekn7SVjpHB/p1j/sbNiw4Yj3/kl+cRjxMSCG87FK8YrHwMpFCgNIqizYX1ytSraQlKdUZkro/U3ef1OXX2zAxsrsx0OV2t/vPbFnKKlaCQP8GgBt59xkuI7/KWk/Z7nIt0PmqWju/kujRzqmr3etkyYqqx+RmEaq6yB59VOfOhBy86VJ3v20IUUesXR+DS0vBVTnXAvkg9Y9kVjn3FPOuZa1tofZAvAoG3JGpK53UxU9iKRsj2HJYpbRJN86Fm96P82jadl16jWWHmNCAFxDHvXeHwgHPTMhzrnHrbWTKfbjLEiBGtJilZTO8cY27djFkH6dEyr9PJAmeQ3K9AvREJx961RtCpAxHDjnnvXeHwpl9gBQa/2U9/4JynSc9WJpKTsxYQ9EgTgoCw0DpP0Asd96xuzhhUqqzrFyUnWg6VJMWAIhP0+3oFUBPGuM6b6mtwtAYww2bNgw6Zx7JKVyOfvFwFg3engjm+ynZBC7bSHSL4B4+7lqXEi9B7E1Y3VL1YOfS5GNpCE72NgPoPs/hXnvB7TW7g3BZgqysNFzJNOefWmWJKTT/RhoYqGWlCzkAS6EaQctl6rZfm08qR48b2mfXxM7x9UnzafO1OAkJdzzGC2LvxkB3vt/ds5555ySABg2utyJesHUGQnHIWTBO0YKdqYC1IshC2VMHrKIxTlpOQvxmCVpokZT9zYFmkQ2KTLi13Xy7gHgvPVIHQA+y6mTgq+qqp79lI0oVZ42cCEdPKgslppOMVldHG+p7V3JHJKO60DYFHidbdJ7/6+0nHkMCOBx7/1u59wmCjKqegPI6Pq3wHKU8cJ+6CxplNHypWsX4pnGZBAVvxQimSJNr+fs2yT/QUBH0wAkQSjYg487575L6zDvOyHj4+Nz1tr7KdOlHA6azvclhyTlUUmdwtP6Yc6ULJWK52WlGLDOXuunn2ISyyv8SporZePReyRTjWnFPVrrg3QhsPilJOfcV5xzpXMup4AKTCgte+fMGFM5wRYM7CgFWnnnSGvbKEMOIkvJgLGyYvZi7L4m19TVIWbjpc5JzCaBLKTHIiXe+2/zekkqGADuc859xzl3gaRu6TEFXlC9YZ9uAXChYqnl8NwRoWAdlgzTFmsioT1S/pKzkhpgTVVsP+clEEo2vMSQlKQ48AgA2977f+Llil9KmpiYeM5a+6WU8yGlp1R1ajRJG60T7xDecSeCPRerh9SeJuoztqChHzXNzweJ9X0qPaZmOfPFHFHn3D7n3IM0SgLMX4xAK/n31tobjTEmrLcL7BZWFac+58BZMEhgvqC2Y0zI1RIP3NYtJBhUBo3v9asemzhCsTb2m58EzvC8UyTQxAaUbD3uB3R+v6G1fprXLfa1THjvv+yc+5a1dpdSquc1EAEM3B6k9l84ph1JVXAok3rNdZ0bgMe9ZN7Z/N7lkhgoY3VqEkOU8qsrL6ZZpGMpjJICV4z1uEa01n5Jqr/0oRoAwMTExPMHDx68Wym1iwKKBqEpGMNGARg6hQLRe98DttifZyjIaDiHgpBfn3pAg8ww9MuCTcrqtx792G3S+ZRtx485CGkeMbAF9ZuKhFhrn3XOfUWqY1QFd+QTzrmbnXMT0iwIZ7y6haE8PTSAgjV4yTGnQ5o94edjD6PO60yV1UQWyraSXdjkOprO460SAJuyYmyen6bX+QWd3y977/dIdRadkLCtX7/+m9bavwuzHSFDvvECpUpxhyQ2ClPOidSRqfpLD6iONfoVqayUHdm03Cbgi/ULPdevTVeneiUgUtBFAPlJAGKDpI8V9ohz7g5r7XXW2pGYupXYjbIaPUdfHxY6isYSad5NmIpeU8dY/Rj1sbJ4Pv2GUBbCkhx8PI2n14GRA1IiCJouORsN2O873vvPxdoUiwNSucc596mqqq5JAS/2d8c67zAAL1wb8qJ2X0ztUpUj2YR1AIsxVRPQN5Gm5febT+q4DoDU+5XCY5wJJY+WT07UgPFvAeyPta2WAcfHx/2hQ4f+2Dn3I9ba1cEjTtl2MTswNDzLMhGkfLlWEOo1Uwl2JAVhinWkB5caIIOGZJrKoAxM9yVThKdLIOPpkhqWYnsxFuQLVDrb8865/5tqU50TAgBYv3795yYnJ//SOXcDdUJoXBDoVb1BJEYMXnHoCM6CXB2HjabxB8NDNTFwpdTwQlX0MCSmvlNAi51PbeGaOhaUQMdZj6rcsixp+t0A7ku1t5YBgzjn/sBaeyWAbdTzpYDo961M0sPnsUHKbHyjIAu2JM+X1yWlbocNOKmOTUUCGz/mtnQ/AIwBL+X5ctCVZTnPCSXn5rz3t9e1s4kNCABYv3797iNHjvyhc+53wywHff0EMN/h4MxHg9Pe+54XKtJ/9lNVHGO7GBNK19ax4kKFA4wfc2A0AWTTc3UqWAJZjO3CvhBEbuR4BEB2wPg3AKLOR5DGDNhp1Aedc1c6514fQEhZUGvdA0ppVQztMMkO5Ko2ZmvSDucqmuaZepBUbfP69NkvyeOm90oDJJY3V6Wx86mwFrf5JMYLITjJxuNql9p+1tr/1aT90ZkQScbGxqaPHj36HmvthQA2poz+Om84HFPmozYhtSe5euUhmpRajgGWlrfYzgaXftmNmwmc9eh9EsBoesrms7Z3NQsPNkvAC2mM/f5MKfWPTfqi53vBTWTt2rVfP3r06O8C+B8SyGKgpJ0Q60h6joKMOyXc86X39wtCfh8VmrYYqpvXKVbHVJ/R6yX2C8d18T1+HGM7yfZjduA/N2U/oE8GJI39A+fcq5xzPxruk4DH02Ijmp8Pb4enLNhEHbM6du8Lx1K5KfajDzSm2qX765ydVH3rwJW6NqVqU+BrGlzmW1mW3Y2k/zaAx5ONJdKXDRhkzZo15czMzH+z1p4DYEeqs6QO47ZXkLDINYCQh1a4ag551r3rmTMcd0xCGq9vDJzU1kwBty4tdU1geulcDIBSnC/kwRmwqd0X25jKDUD8UwB/WdtQIo29YC6rVq16ZG5u7uedc3cB6L4oT3p4fOPp4ZiCj/5SkAXQUAeHz6RIbMPBx9ssMRy9h8dJY6o9Jf0wtlSeVIYEOKmP6blYgDkGvuBkBNBR1iMs+E3v/W8mO0CQgQEIACMjI19otVq3eO//mHZYygGJqYcsy3qOgw1I/+TunOthRg44aQamThVL7efXxvqm3z6TTJBUvjFNwvPjgOPnaJhFcjQo8GJxPg66qqrQbrcDOA9Za38JfajeII1mQlKS5/kHq6ra7pz7r0qpqC0ZU8189IYtxoLhl4d/gGN2rGQjSuo3iOQR0zpJzgqVJqwmpaccNek3dg0dJLGtbqot5lBwVcvZj2z/HcAXoh2RkAUxILn3NwBsdc69hb4pQcqbj9ogqXhVAFxYgU3Bwr3eGAC5SOck9RwDwEJDN3X3pcAbA104L9l9EvAiq1d6gCeFWtjv+wD8/kCdgAGdkHmZZNmMtfbnvffjzrkfpkzIHyrfD50SXoTOVXFgQ85+QQID8mnAUA4HLD2fYkZ6PR9AMTuSS12e/diQ0oAN6fRcbIYjtpBAWtcpsZ/EfGVZ/on3/pZopRvIglVwEKXUs977GwDcaa19bVCdweYAZKOYjtIAPgrIwKghP7p2MOxTVuDsxx+0pJZpekw9xkJHsbSYKqeAr+vzWDl8QITf2HRbKsTSNLgsMN/HvPf/BeSjM4PIUFQwkccBvE0pdaf3/jXUI+MPMICKqguuMsLnsGLqOFzLFzBIzgkVrn55uKffKT1J+PV1ajsFcMlkiQ1qPrjr7L069osA8i7v/X8C+dzCoDJsAMJ7/12l1FsB/Ilz7kq61CplKIdvoHnvu995CyAN+5T16D5Vy0od/4ZIzEbkajQIDx3RkIjEYPyelHcdO0/rlLqXp8fsP+7lcvUbA2BdrI8c3+m9/88g73leiAwdgABQVdXjeZ6/BcCt3vubvfeKxup4gJWP2MCM4UODdJ++kSGAjdqAFJwSIzZxTKS0GANxQNfZcZIXLalU3j/SMdUwKYeDh1nqgBYDo3Pu/c65XwcwF21kn7IoAASAdrt9GMDPjY6OWufcu+g7YWh50iimQKQAzLKs5z001DEJYKRgoOqUOikciBLTUUmFWlLqOcWItExJeP/Q9JTKpewXGI8yn2TrNdimrLW3APhAtCMGlKF4wSlRSt0F4B1KqTHgOMACkCQVQtVu6EiqksM1gQ3DPlXLNEYYW2HNWTHUgdW/dnDG1PMgg7qOAQPQaF+mmE8KtcQYjsf/OsePWGvfBeDTfTemgQzNC07Ivyil9gK4BJjvtfGHz0c1ZbwAtsB2FKQBjAF0HJQp8ElApEJtyXBMpU49x6SODfnglNQvtfViMT7OfjEVLAD10/6Ypyv+p3cYsugMOD09PTk2NvZtrfUlNJ2rFWkABPXKAUjfykXBRhlRsgNjMcQYCFP2Ykjndh1tF2fCmCfMnR/ufHDThTOeNLfLQZdiPyEc87xz7re9938IoPtdt8WQRbMBqXjv94SHHetc6SFQgPFOp/FByoDB3gmgpF4xV83URkw5KdJ+AFMMnBLYuLMisT89lqIHksrlrNdE9UbW8sFae49z7j0Avj74E28uSwJAAE8C8prBFBBpnJB3fvh/CVXL1DYMoAz7lAFjYKwDYMxBkVStpK45w3HhKjb8NgEf93LDPv2XWkolW2v3WWvfr5T6MwCztU90SLLoKhgAnHPfAzCnlBqVDHZp5Id0rjJDWgANBR0FHmU9DjwJfNRLpmXy8qV92h5aT66iKQClsE3YDzZdzMNNORspFpTmfa21U9baj+KYh/vYIhPRPFkSBjTGTCqlWgBGOZtIDyDs040Chz9EKSjNWS/mHdc5KKGuHHAcjE08ZW7rSjYfZ7wY+Kjdx9mvCRCttS3n3N967/8ngK/2/VCHJEsFwDmllI09SEktUYDSh8Lnfqk9KKlXzoSc+WILHWIAlOrPAcgZUGL4WHoKgJKzQWN8TRjROTdtrf2Uc+5PlFL/AKD5fzEWQZbKCfGeFEAfGjXmuYPC8ug+CAo8qpbDfXxWJObtGmNQVdU8UNI6NgFfqF8MiLRdsWMOTA62kCaBkKbHgOi9f8pa+zfe+79QSt2rlFq0uFs/siQ2IIBcKaXpgwbS7FfnKVKW4SCjsyThWg4mrY+9YDPUJWYD0vryOnLwSfu87il1Cxz/9rJk73HVmwJd5/7KWvtN7/1fOef+CsAjfT+5RZaB/hXXryilRgFkHASdc/OYj3uQsSB5eIAARPuOMh3NT6njL1iigyHkE44l5ks5IlQkFRvbJOYL7eNgpACLsaH3/t+895/z3n/Ce/8lAEeiFV1mWRIGVEqt01qPUJsMmM8Q9IHT8Atls5DG1RgN4XAng5+j4OLgpqAK5UrsRq+PmQy0flJ9Q/kUhJLTQb1iDrrOVjrnHvHe/6M/9i6+LyPxSrQTSZYKgBNa64KGS4D4siIA80AXru/kJz7YwOKUzST7L5zjy7ZonfggoJs0gOhxarBQtpNYkDNeZL/tvd/vvd/tvb/POfd1AN8CcAAnmSyJE6KU2kqnybgTIrFCuIYzVOqhh33qrFDJsmxmZmbmY0eOHHkiy7JTjTHrtNZbtNbfl2XZemPMmDFmRApYk7bMax8fPNQ0qLP7OCAZ0Kxzbtp7/6z3fp+19lEcn1vfA+BpADZlCpzo0verOQYRY8zL6DxujAG5AxHUL1Wh4T66X7d1Hmp7dHT014qi+P2Jie7fmLF///5R7/0GAC/RWm9USm1TSm1RSm0AsF5rvVZrPa6UOtUYM6aUypVSWmutOoNJKaUMAKOUUsaYHEDuva8AeKZqXSfNee/b3vuZzjblvT/qnDvsvX/ee/8MgCedc886555SSj0J4KBSqvuh5xeKLLoK3rp165gx5mwKQIkBOevRc1wd8ziaBDrqGVZVNWWM+YWpqak/4/Vbt27dHI4xydMAdvPzk5OTCsAogDEAq3CszwwApZTynd8Mx5wsUxTFmqIoVhljWkqpynuvOu3z3nvXAWbpvZ/z3s8qpWYAtKy1bRz7krgPgy301wtZugDMssXBolJqmzHm5Xmed//jwe0tyn4UnEFFBaE2IFVf9DydHegsNfqe9/7msizvGqT+IyMjHsfmRhvNjzrnMDc3tAXDL3hZ9PWAxphdeZ6fFv7zQUMiEsioug2qmjoXkvPBmS+scWu1Wk9Ya38GwN8tSuNWZMHSBWC7vTjmhdb61VmWITAgNeop46XCI5LDAsxfphTA12q10G63H7XWvg1Ao/fUrcjyyKJ6weecc85ElmWvDuALAKQilcu94pAmeY2U+cqyxNzcHObm5nY7594OYN7nQVfkxJJFVcFKqcuLojiPApDH0AILpgZALGZGma/dbqPVamFubu7eqqp+Cou4jHxFhieLCsA8z6/O81zTf7Rx9UuXTsVibDwQy1UuYb7PV1X1DgDfHXpjVmRRZNFU8K5du15RFMUPFUWBPM974n+hPL4YIRbD46tCJPDNzs7+lbX2ZgDPDrUhK7KosmhxQKXU1Xmeb8nzvAtAyfnoXDsPcMLKjp7YXlmWaLfbmJubs7Ozs39UVdV7cAJPuq+ILIuyGuZVr3rVhjzPfzQAj/5BSIrrSWqWrnELK37DfgDf7Ozs4Var9asAPrRYccwVWVxZlEC0UurNRVG8MjgfUuCZMx1Vq/R/C/S68IqwDvgearVav4SVGN9JLUO3AXft2rU+z/N3hqAzdTwkAKbe0ETVcABeq9Vyc3Nz/7vdbr8HwGNDqfSKLJsMHYBa67cXRXEZ93q5auX/0JLeVULPdZyN/XNzc79VVdWHMcQX5KzI8slQDadLLrnknDzPb6ZzvpLK7eOlODTE8qmyLN8L4J9e6BP0LybpAnAYD9UY84t5nr+M2n1S6KTu1WDU1mu1WgdardbvlWX5RxjCCxFX5MSSoQWid+3adU2e5z/NnQ4aw6NvXYq8c7gLvHa7Xc3Nzd3darV+B8DXFlS5FTlhZSgqeNeuXWdkWfbrWZYZynwhhpd6OQ7/4ElnOu3BVqv1gaqq7sISviZiRZZehuKEaK1/Kc/znWGmg/+XgToVKdabm5vbNzc396dlWf45gKdP5qXmK9JMFrwkf9euXVcZY36Wgo+r3Zi3S4D3eKvV+ngHeA+vOBkvHlmQE7Jz587TjDG/aowpwpIoAEmPlzCeb7Va326323d1Vis/Iv0BfEVe2NIF4CAPXyn1U0qpfx9bpcJZrwO+uXa7/ZWyLP+yLMtPA3huBXgvXlkQAJ1zZ/M/CwmMN1tV1f6qqvaWZflP1trPWWvvBzC7ompXZEEquCzLD3rvVznnzusw33RVVc9XVfVcVVWPe+8fLcvy35xzj3rvn1VK2bAwdUVWBADUYizFX5EVaSorxteKLKv8f6DknuJi0rpBAAAAAElFTkSuQmCC"
  }))));
}

var _path$C, _path2$3;

function _extends$D() {
  _extends$D = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$D.apply(this, arguments);
}

function SvgForward(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$D({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$C || (_path$C = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.764 7.12a.86.86 0 00-.86-.86h-7.63C3.77 6.26 1.8 8.36 1.8 10.88c0 2.519 1.97 4.62 4.473 4.62H7.96a.86.86 0 000-1.72H6.273c-1.49 0-2.754-1.266-2.754-2.9 0-1.635 1.265-2.901 2.754-2.901h7.631a.86.86 0 00.86-.86z",
    fill: "CurrentColor"
  })), _path2$3 || (_path2$3 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M11.16 2.75a.86.86 0 00-.003 1.216l3.182 3.192-3.182 3.192a.86.86 0 001.218 1.214l3.786-3.799a.86.86 0 000-1.214l-3.786-3.798a.86.86 0 00-1.216-.002z",
    fill: "CurrentColor"
  })));
}

var _circle, _path$D;

function _extends$E() {
  _extends$E = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$E.apply(this, arguments);
}

function SvgErrorIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$E({
    width: 32,
    height: 32,
    viewBox: "0 0 32.01 32.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle || (_circle = /*#__PURE__*/React.createElement("circle", {
    cx: 16,
    cy: 16,
    r: 12,
    stroke: "#FA4C56",
    strokeWidth: 2
  })), _path$D || (_path$D = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M16 9c.552 0 1 .537 1 1.2v6c0 .663-.448 1.2-1 1.2s-1-.537-1-1.2v-6c0-.663.448-1.2 1-1.2zM15 20.994c0-.55.445-.994.994-.994h.012a.994.994 0 110 1.988h-.012a.994.994 0 01-.994-.994z",
    fill: "#ED4D60"
  })));
}

var _path$E;

function _extends$F() {
  _extends$F = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$F.apply(this, arguments);
}

function SvgSelectionIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$F({
    width: 24,
    height: 24,
    viewBox: "0 0 24.01 24.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$E || (_path$E = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11zm5.749-13.501a1 1 0 00-1.414-1.414l-6.168 6.167-2.502-2.5a1 1 0 00-1.414 1.413l3.209 3.209a1 1 0 001.414 0l6.875-6.875z",
    fill: "CurrentColor"
  })));
}

var _path$F;

function _extends$G() {
  _extends$G = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$G.apply(this, arguments);
}

function SvgDeleteIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$G({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$F || (_path$F = /*#__PURE__*/React.createElement("path", {
    d: "M15.714 7.143v7.5a3.214 3.214 0 01-3.214 3.214h-5a3.214 3.214 0 01-3.214-3.214v-7.5h-.507a.922.922 0 01-.922-.922V5.178c0-1.085.88-1.964 1.964-1.964h1.18a2.144 2.144 0 011.856-1.071h4.286c.783 0 1.482.423 1.856 1.071h1.18c1.085 0 1.964.88 1.964 1.964v1.043a.922.922 0 01-.922.922h-.507zM15 5.714h.714v-.536a.536.536 0 00-.535-.535h-1.652a.714.714 0 01-.692-.537.715.715 0 00-.692-.535H7.857a.715.715 0 00-.692.535.714.714 0 01-.691.537H4.82a.536.536 0 00-.535.535v.536H15zM5.714 7.143v7.5c0 .986.8 1.785 1.786 1.785h5c.986 0 1.786-.8 1.786-1.785v-7.5H5.714z",
    fill: "#FA4C56"
  })));
}

var _path$G;

function _extends$H() {
  _extends$H = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$H.apply(this, arguments);
}

function SvgCheckCircle(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$H({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$G || (_path$G = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M9 2.6a6.4 6.4 0 100 12.8A6.4 6.4 0 009 2.6zm-5.657.743a8 8 0 1111.314 11.314A8 8 0 013.343 3.343zm8.623 3.491a.8.8 0 010 1.132l-3.2 3.2a.8.8 0 01-1.132 0l-1.6-1.6a.8.8 0 011.132-1.132L8.2 9.47l2.634-2.635a.8.8 0 011.132 0z",
    fill: "CurrentColor"
  })));
}

var _path$H;

function _extends$I() {
  _extends$I = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$I.apply(this, arguments);
}

function SvgReportIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$I({
    width: 18,
    height: 18,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$H || (_path$H = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.623 1.5h4.754c.51-.001.908.16 1.274.528l3.321 3.32c.362.361.53.756.528 1.275v4.754c.001.519-.166.914-.528 1.274l-3.32 3.321c-.36.362-.756.53-1.275.528H6.623a1.675 1.675 0 01-1.274-.528l-3.321-3.32a1.675 1.675 0 01-.528-1.275V6.623a1.675 1.675 0 01.528-1.274l3.32-3.321A1.675 1.675 0 016.624 1.5zm-.337 1.52L3.02 6.285c-.136.136-.155.183-.155.375v4.678c0 .19.019.239.155.375l3.267 3.267c.136.136.183.155.375.155h4.678c.192 0 .239-.019.375-.155l3.267-3.267c.136-.136.155-.186.155-.375V6.66c0-.192-.02-.24-.155-.375L11.714 3.02c-.137-.136-.184-.155-.375-.155H6.66c-.192 0-.241.021-.375.155zm3.472 9.01a.758.758 0 11-1.516 0 .758.758 0 011.516 0zm-.076-6.136a.682.682 0 00-1.364 0v3.94a.682.682 0 001.364 0v-3.94z",
    fill: "currentColor"
  })));
}

var _path$I;

function _extends$J() {
  _extends$J = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$J.apply(this, arguments);
}

function SvgEditIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$J({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$I || (_path$I = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M11.883 6.232l-7.531 7.53a.917.917 0 00-.269.65v1.422c0 .046.038.083.084.083h1.422a.917.917 0 00.648-.268l7.531-7.531-1.885-1.886zm1.06-1.06l1.886 1.885.943-.943a.5.5 0 000-.707l-1.179-1.179a.5.5 0 00-.707 0l-.943.943zm-9.652 7.53l9.534-9.534a2 2 0 012.829 0l1.178 1.178a2 2 0 010 2.829l-9.534 9.534a2.417 2.417 0 01-1.709.708H4.167a1.583 1.583 0 01-1.584-1.583V14.41c0-.64.255-1.256.708-1.709z",
    fill: "CurrentColor"
  })));
}

var _path$J;

function _extends$K() {
  _extends$K = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$K.apply(this, arguments);
}

function SvgResend(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$K({
    width: 17,
    height: 15,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$J || (_path$J = /*#__PURE__*/React.createElement("path", {
    d: "M15.913 7.425l-7.23-6.281a.1.1 0 00-.165.075v3.585a.101.101 0 01-.095.101c-.616.037-4.069.305-5.627 1.728C.894 8.371.966 12.608 1.02 13.726c.005.093.123.126.179.05.49-.66 2.003-2.597 3.359-3.243 1.268-.604 3.411-.476 3.872-.44a.097.097 0 01.089.098v3.59a.1.1 0 00.166.075l7.23-6.28a.1.1 0 000-.151z",
    stroke: "currentColor",
    strokeWidth: 1.4
  })));
}

var _path$K, _path2$4;

function _extends$L() {
  _extends$L = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$L.apply(this, arguments);
}

function SvgEmojiSmileIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$L({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$K || (_path$K = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 3.043a6.957 6.957 0 100 13.914 6.957 6.957 0 000-13.914zM1.667 10a8.333 8.333 0 1116.666 0 8.333 8.333 0 01-16.666 0zm4.97-2.293a1.07 1.07 0 112.14 0 1.07 1.07 0 01-2.14 0zm4.586 0a1.07 1.07 0 112.141 0 1.07 1.07 0 01-2.14 0z",
    fill: "CurrentColor"
  })), _path2$4 || (_path2$4 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.546 11.287a.714.714 0 01.977.26 2.865 2.865 0 004.955 0 .714.714 0 011.235.717 4.293 4.293 0 01-7.426 0 .714.714 0 01.26-.977z",
    fill: "CurrentColor"
  })));
}

var _path$L;

function _extends$M() {
  _extends$M = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$M.apply(this, arguments);
}

function SvgReplyIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$M({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$L || (_path$L = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.364 3.637a.75.75 0 010 1.06L4.31 6.75h9.439a4.5 4.5 0 110 9H10a.75.75 0 010-1.5h3.75a3 3 0 100-6H4.31l2.054 2.053a.75.75 0 01-1.061 1.061L1.97 8.031a.75.75 0 010-1.061l3.333-3.333a.75.75 0 011.06 0z",
    fill: "CurrentColor"
  })));
}

var _path$M;

function _extends$N() {
  _extends$N = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$N.apply(this, arguments);
}

function SvgCopyIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$N({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$M || (_path$M = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.121 3.564c-.497-.041-1.134-.042-2.042-.042H6.401a.72.72 0 010-1.439h5.71c.868 0 1.565 0 2.127.046.578.047 1.079.146 1.54.381a3.919 3.919 0 011.711 1.712c.235.46.334.961.382 1.54.046.562.046 1.258.046 2.127v5.71a.72.72 0 01-1.44 0V7.92c0-.908 0-1.545-.041-2.043-.04-.489-.115-.778-.229-1.002a2.48 2.48 0 00-1.083-1.083c-.224-.114-.514-.19-1.003-.23zM5.334 4.882h6.533c.424 0 .785 0 1.081.024.311.025.614.081.904.229.436.222.79.577 1.013 1.013.147.29.203.592.229.903.024.297.024.657.024 1.081v6.534c0 .424 0 .784-.024 1.08-.026.312-.082.615-.229.904a2.32 2.32 0 01-1.013 1.014c-.29.147-.593.203-.904.228-.296.024-.657.024-1.08.024H5.333c-.424 0-.785 0-1.081-.024-.311-.025-.614-.08-.904-.228a2.32 2.32 0 01-1.013-1.014c-.147-.29-.203-.592-.229-.903-.024-.296-.024-.657-.024-1.081V8.132c0-.424 0-.784.024-1.08.026-.312.082-.615.229-.904a2.319 2.319 0 011.013-1.013c.29-.148.593-.204.904-.229.296-.024.657-.024 1.08-.024zM4.37 6.34c-.222.018-.314.05-.367.076a.88.88 0 00-.384.385c-.027.052-.059.144-.077.367-.019.23-.02.532-.02.991v6.478c0 .46.001.761.02.992.018.222.05.314.077.367a.88.88 0 00.384.384c.053.027.145.058.367.076.23.02.532.02.992.02h6.477c.46 0 .761 0 .992-.02.222-.018.314-.05.367-.076a.88.88 0 00.384-.384c.027-.053.059-.145.077-.367.019-.231.02-.533.02-.992V8.16c0-.46-.001-.76-.02-.991-.018-.223-.05-.315-.077-.367a.88.88 0 00-.384-.385c-.053-.027-.145-.058-.367-.076-.23-.02-.532-.02-.992-.02H5.362c-.46 0-.761 0-.992.02z",
    fill: "CurrentColor"
  })));
}

var _path$N;

function _extends$O() {
  _extends$O = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$O.apply(this, arguments);
}

function SvgReplyInThreadIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$O({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$N || (_path$N = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.469 1.75h7.062c.674 0 1.225 0 1.672.037.463.037.882.118 1.273.317a3.25 3.25 0 011.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672v4.562c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.273a3.25 3.25 0 01-1.42 1.42c-.391.199-.81.28-1.273.317-.447.037-.998.037-1.671.037h-2.129c-.55 0-.72.004-.878.036a1.752 1.752 0 00-.444.156c-.143.073-.279.177-.708.52l-2.01 1.608a6.553 6.553 0 01-.441.334c-.129.085-.366.229-.67.23-.356 0-.692-.162-.914-.44-.19-.238-.226-.513-.24-.666-.015-.16-.015-.356-.015-.554v-1.229c-.358-.008-.655-.034-.924-.106a3.25 3.25 0 01-2.298-2.298c-.111-.415-.111-.896-.111-1.566V6.469c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 011.42-1.42c.391-.2.81-.28 1.273-.318.448-.037.998-.037 1.672-.037zm-1.55 1.532c-.37.03-.57.085-.713.159a1.75 1.75 0 00-.765.765c-.074.144-.13.343-.16.713-.03.38-.03.869-.03 1.581v5.167c0 .823.006 1.087.059 1.286a1.75 1.75 0 001.237 1.237c.199.054.463.06 1.286.06a.75.75 0 01.75.75v1.773l1.853-1.482.053-.042c.355-.285.614-.492.91-.643.26-.133.538-.23.825-.29.324-.066.657-.066 1.112-.066H13.5c.713 0 1.202 0 1.581-.032.37-.03.57-.085.713-.159a1.75 1.75 0 00.765-.764c.074-.145.13-.344.16-.714.03-.38.031-.869.031-1.581V6.5c0-.712 0-1.202-.032-1.58-.03-.371-.085-.57-.159-.714a1.75 1.75 0 00-.765-.765c-.144-.074-.343-.13-.713-.16-.38-.03-.868-.031-1.58-.031h-7c-.713 0-1.203 0-1.582.032zm.164 3.801a.75.75 0 01.75-.75H10a.75.75 0 010 1.5H5.833a.75.75 0 01-.75-.75zm0 2.917a.75.75 0 01.75-.75H12.5a.75.75 0 010 1.5H5.833a.75.75 0 01-.75-.75z",
    fill: "CurrentColor"
  })));
}

function usePermissions(myRole) {
  var dispatch = reactRedux.useDispatch();
  var rolesMap = reactRedux.useSelector(rolesMapSelector, reactRedux.shallowEqual);
  var myPermissions = myRole && rolesMap && rolesMap[myRole] ? rolesMap[myRole].permissions : [];

  var checkActionPermission = function checkActionPermission(actionName) {
    return myPermissions.includes(actionName);
  };

  React.useEffect(function () {
    dispatch(getRolesAC());
  }, []);
  return [checkActionPermission, myPermissions];
}

var _templateObject$m, _templateObject2$i, _templateObject3$e;
function MessageActions(_ref) {
  var editModeToggle = _ref.editModeToggle,
      channel = _ref.channel,
      handleResendMessage = _ref.handleResendMessage,
      handleOpenDeleteMessage = _ref.handleOpenDeleteMessage,
      handleOpenForwardMessage = _ref.handleOpenForwardMessage,
      handleCopyMessage = _ref.handleCopyMessage,
      handleReportMessage = _ref.handleReportMessage,
      messageStatus = _ref.messageStatus,
      handleReplyMessage = _ref.handleReplyMessage,
      isThreadMessage = _ref.isThreadMessage,
      rtlDirection = _ref.rtlDirection,
      showMessageReaction = _ref.showMessageReaction,
      showEditMessage = _ref.showEditMessage,
      showCopyMessage = _ref.showCopyMessage,
      showReplyMessage = _ref.showReplyMessage,
      showReplyMessageInThread = _ref.showReplyMessageInThread,
      showForwardMessage = _ref.showForwardMessage,
      showDeleteMessage = _ref.showDeleteMessage,
      showSelectMessage = _ref.showSelectMessage,
      showReportMessage = _ref.showReportMessage,
      reactionIcon = _ref.reactionIcon,
      editIcon = _ref.editIcon,
      copyIcon = _ref.copyIcon,
      replyIcon = _ref.replyIcon,
      replyInThreadIcon = _ref.replyInThreadIcon,
      deleteIcon = _ref.deleteIcon,
      selectIcon = _ref.selectIcon,
      allowEditDeleteIncomingMessage = _ref.allowEditDeleteIncomingMessage,
      reportIcon = _ref.reportIcon,
      reactionIconOrder = _ref.reactionIconOrder,
      editIconOrder = _ref.editIconOrder,
      copyIconOrder = _ref.copyIconOrder,
      replyIconOrder = _ref.replyIconOrder,
      replyInThreadIconOrder = _ref.replyInThreadIconOrder,
      forwardIcon = _ref.forwardIcon,
      forwardIconOrder = _ref.forwardIconOrder,
      deleteIconOrder = _ref.deleteIconOrder,
      selectIconOrder = _ref.selectIconOrder,
      reportIconOrder = _ref.reportIconOrder,
      reactionIconTooltipText = _ref.reactionIconTooltipText,
      editIconTooltipText = _ref.editIconTooltipText,
      copyIconTooltipText = _ref.copyIconTooltipText,
      replyIconTooltipText = _ref.replyIconTooltipText,
      replyInThreadIconTooltipText = _ref.replyInThreadIconTooltipText,
      forwardIconTooltipText = _ref.forwardIconTooltipText,
      deleteIconTooltipText = _ref.deleteIconTooltipText,
      selectIconTooltipText = _ref.selectIconTooltipText,
      reportIconTooltipText = _ref.reportIconTooltipText,
      myRole = _ref.myRole,
      isIncoming = _ref.isIncoming,
      messageActionIconsColor = _ref.messageActionIconsColor,
      handleOpenEmojis = _ref.handleOpenEmojis;
  var ChatClient = getClient();
  var user = ChatClient.user;

  var _usePermissions = usePermissions(myRole),
      checkActionPermission = _usePermissions[0];

  var theme = reactRedux.useSelector(themeSelector);
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });
  var editMessagePermitted = isIncoming ? checkActionPermission('editAnyMessage') : checkActionPermission('editOwnMessage');
  var replyMessagePermitted = isIncoming ? checkActionPermission('replyAnyMessage') : checkActionPermission('replyOwnMessage');
  var forwardMessagePermitted = checkActionPermission('forwardMessage');

  var handleOpenReaction = function handleOpenReaction(e) {
    e.stopPropagation();
    e.preventDefault();
    handleOpenEmojis();
  };

  return /*#__PURE__*/React__default.createElement(MessageActionsWrapper, {
    isThreadMessage: isThreadMessage,
    rtlDirection: rtlDirection
  }, /*#__PURE__*/React__default.createElement(EditMessageContainer, {
    backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    className: 'message_actions_cont '
  }, showMessageReaction && messageStatus !== MESSAGE_DELIVERY_STATUS.PENDING && checkActionPermission('addMessageReaction') && /*#__PURE__*/React__default.createElement(Action, {
    order: reactionIconOrder || 0,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: handleOpenReaction
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, reactionIconTooltipText || 'React'), reactionIcon || /*#__PURE__*/React__default.createElement(SvgEmojiSmileIcon, null)), showEditMessage && messageStatus !== MESSAGE_DELIVERY_STATUS.PENDING && (isIncoming ? allowEditDeleteIncomingMessage : true) && editMessagePermitted && (isDirectChannel && directChannelUser ? !isIncoming && directChannelUser.state !== USER_STATE.DELETED : true) && /*#__PURE__*/React__default.createElement(Action, {
    order: editIconOrder || 1,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return editModeToggle();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, editIconTooltipText || 'Edit Message'), editIcon || /*#__PURE__*/React__default.createElement(SvgEditIcon, null)), messageStatus === MESSAGE_DELIVERY_STATUS.PENDING && /*#__PURE__*/React__default.createElement(Action, {
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleResendMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, " Resend Message "), /*#__PURE__*/React__default.createElement(SvgResend, null)), !isThreadMessage && messageStatus !== MESSAGE_DELIVERY_STATUS.PENDING && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, showReplyMessage && replyMessagePermitted && (isDirectChannel && directChannelUser ? directChannelUser.state !== USER_STATE.DELETED : true) && /*#__PURE__*/React__default.createElement(Action, {
    order: replyIconOrder || 2,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleReplyMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, replyIconTooltipText || 'Reply'), replyIcon || /*#__PURE__*/React__default.createElement(SvgReplyIcon, null)), showReplyMessageInThread && replyMessagePermitted && /*#__PURE__*/React__default.createElement(Action, {
    order: replyInThreadIconOrder || 3,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleReplyMessage(true);
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, replyInThreadIconTooltipText || 'Reply in thread'), replyInThreadIcon || /*#__PURE__*/React__default.createElement(SvgReplyInThreadIcon, null))), showCopyMessage && /*#__PURE__*/React__default.createElement(Action, {
    order: copyIconOrder || 4,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleCopyMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, copyIconTooltipText || 'Copy'), copyIcon || /*#__PURE__*/React__default.createElement(SvgCopyIcon, null)), showForwardMessage && forwardMessagePermitted && messageStatus !== MESSAGE_DELIVERY_STATUS.PENDING && /*#__PURE__*/React__default.createElement(Action, {
    order: forwardIconOrder || 5,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleOpenForwardMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, forwardIconTooltipText || 'Forward Message'), forwardIcon || /*#__PURE__*/React__default.createElement(SvgForward, null)), showSelectMessage && /*#__PURE__*/React__default.createElement(Action, {
    order: selectIconOrder || 6,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleOpenDeleteMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, selectIconTooltipText || 'Select'), selectIcon || /*#__PURE__*/React__default.createElement(SvgCheckCircle, null)), showDeleteMessage && (channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? myRole === 'owner' || myRole === 'admin' : true) && /*#__PURE__*/React__default.createElement(Action, {
    order: deleteIconOrder || 7,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleOpenDeleteMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, deleteIconTooltipText || 'Delete Message'), deleteIcon || /*#__PURE__*/React__default.createElement(SvgDeleteIcon, null)), showReportMessage && messageStatus !== MESSAGE_DELIVERY_STATUS.PENDING && /*#__PURE__*/React__default.createElement(Action, {
    order: reportIconOrder || 8,
    iconColor: messageActionIconsColor || (theme === THEME.DARK ? colors.textColor3 : colors.textColor2),
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    onClick: function onClick() {
      return handleReportMessage();
    }
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, reportIconTooltipText || 'Report'), reportIcon || /*#__PURE__*/React__default.createElement(SvgReportIcon, null))));
}
var MessageActionsWrapper = styled__default.div(_templateObject$m || (_templateObject$m = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: ", ";\n  right: ", ";\n  direction: ", ";\n  top: -46px;\n  padding: 0 0 8px;\n  z-index: 200;\n"])), function (_ref2) {
  var isThreadMessage = _ref2.isThreadMessage,
      rtlDirection = _ref2.rtlDirection;
  return !rtlDirection && (isThreadMessage ? '8px' : '0');
}, function (_ref3) {
  var rtlDirection = _ref3.rtlDirection;
  return rtlDirection && '0';
}, function (props) {
  return props.rtlDirection ? 'initial' : '';
});
var EditMessageContainer = styled__default.div(_templateObject2$i || (_templateObject2$i = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  direction: ", ";\n  background-color: ", ";\n  box-sizing: border-box;\n  border-radius: 12px;\n  box-shadow: 0 0 2px rgba(17, 21, 57, 0.08), 0 0 24px rgba(17, 21, 57, 0.16);\n  //opacity: 0;\n  //visibility: hidden;\n  transition: all 0.2s;\n  z-index: 100;\n"])), function (props) {
  return props.rtlDirection && 'initial';
}, function (props) {
  return props.backgroundColor;
});
var Action = styled__default.div(_templateObject3$e || (_templateObject3$e = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  padding: 4px;\n  margin: 8px 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n  order: ", ";\n  color: ", ";\n  border-radius: 50%;\n\n  &:first-child {\n    margin-left: 8px;\n  }\n\n  &:last-child {\n    margin-right: 8px;\n  }\n\n  &:hover {\n    color: ", ";\n    background-color: ", ";\n\n    ", " {\n      display: block;\n    }\n  }\n"])), function (props) {
  return props.order || 1;
}, function (props) {
  return props.iconColor || colors.textColor2;
}, function (props) {
  return props.hoverIconColor || colors.primary;
}, function (props) {
  return props.hoverBackgroundColor || colors.backgroundColor;
}, ItemNote);

var _path$O;

function _extends$P() {
  _extends$P = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$P.apply(this, arguments);
}

function SvgCancel(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$P({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$O || (_path$O = /*#__PURE__*/React.createElement("path", {
    d: "M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z",
    fill: "#fff"
  })));
}

var _rect$1, _path$P;

function _extends$Q() {
  _extends$Q = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$Q.apply(this, arguments);
}

function SvgFileIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$Q({
    width: 40,
    height: 40,
    viewBox: "0 0 40.01 40.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$1 || (_rect$1 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 20,
    fill: "Transparent"
  })), _path$P || (_path$P = /*#__PURE__*/React.createElement("path", {
    d: "M22.48 10.097c.298.068.56.177.819.338.258.162.468.332 1.015.88l3.372 3.37c.547.548.717.758.879 1.016.161.258.27.521.338.818.069.297.097.565.097 1.34v7.295c0 1.337-.14 1.822-.4 2.311a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-9.31c-1.337 0-1.821-.14-2.31-.4a2.726 2.726 0 01-1.134-1.135c-.262-.489-.401-.974-.401-2.31v-11.31c0-1.337.14-1.821.4-2.31a2.726 2.726 0 011.135-1.134c.489-.262.973-.401 2.31-.401h5.296c.775 0 1.043.028 1.34.097zm-.68 1.827a.3.3 0 00-.3.3V16a.5.5 0 00.5.5h3.776a.3.3 0 00.212-.512l-3.976-3.976a.3.3 0 00-.212-.088z",
    fill: "#fff"
  })));
}

var _circle$1, _path$Q;

function _extends$R() {
  _extends$R = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$R.apply(this, arguments);
}

function SvgDeleteUpload(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$R({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle$1 || (_circle$1 = /*#__PURE__*/React.createElement("circle", {
    cx: 10,
    cy: 10,
    r: 9.3,
    fill: "CurrentColor",
    stroke: "#fff",
    strokeWidth: 1.4
  })), _path$Q || (_path$Q = /*#__PURE__*/React.createElement("path", {
    d: "M13.5 6.5l-7 7M6.5 6.5l7 7",
    stroke: "#fff",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })));
}

var _path$R;

function _extends$S() {
  _extends$S = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$S.apply(this, arguments);
}

function SvgUpload(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$S({
    width: 32,
    height: 32,
    viewBox: "0 0 32.01 32.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$R || (_path$R = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.5 20.5a1.5 1.5 0 003 0V7.121l4.44 4.44a1.5 1.5 0 002.12-2.122l-7-7a1.5 1.5 0 00-2.12 0l-7 7a1.5 1.5 0 002.12 2.122l4.44-4.44V20.5zm-9 4.5a1.5 1.5 0 000 3h21a1.5 1.5 0 000-3h-21z",
    fill: "#fff"
  })));
}

var _circle$2, _path$S;

function _extends$T() {
  _extends$T = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$T.apply(this, arguments);
}

function SvgPlayVideo(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$T({
    width: 56,
    height: 56,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle$2 || (_circle$2 = /*#__PURE__*/React.createElement("circle", {
    cx: 28,
    cy: 28,
    r: 28,
    fill: "#17191C",
    fillOpacity: 0.4
  })), _path$S || (_path$S = /*#__PURE__*/React.createElement("path", {
    d: "M38.048 26.262c1.27.767 1.27 2.706 0 3.473l-13.224 7.996c-1.258.76-2.824-.202-2.824-1.737V20.003c0-1.535 1.566-2.498 2.824-1.737l13.224 7.996z",
    fill: "#fff"
  })));
}

var getFrame3 = function getFrame3(video, time) {
  try {
    var canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var ctx = canvas.getContext('2d');

    if (time) {
      video.currentTime = time;
    }

    ctx.drawImage(video, 0, 0);
    return Promise.resolve(createImageThumbnail(null, canvas.toDataURL(), 10, 10));
  } catch (e) {
    return Promise.reject(e);
  }
};
var getFrame = function getFrame(videoSrc, time) {
  try {
    var video = document.createElement('video');
    video.src = videoSrc;
    return Promise.resolve(new Promise(function (resolve, reject) {
      if (videoSrc) {
        var b = setInterval(function () {
          if (video.readyState >= 3) {
            if (time) {
              video.currentTime = time;
            }

            var _calculateSize = calculateSize(video.videoWidth, video.videoHeight, 50, 50),
                newWidth = _calculateSize[0],
                newHeight = _calculateSize[1];

            var canvas = document.createElement('canvas');
            canvas.width = newWidth;
            canvas.height = newHeight;
            var ctx = canvas.getContext('2d');
            video.currentTime = 10;
            ctx.drawImage(video, 0, 0, newWidth, newHeight);
            var pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var binaryThumbHash = rgbaToThumbHash(pixels.width, pixels.height, pixels.data);
            var thumb = binaryToBase64(binaryThumbHash);
            console.log('generated thumb hash ... ', thumb);
            clearInterval(b);
            resolve({
              thumb: thumb,
              width: video.videoWidth,
              height: video.videoHeight
            });
          }
        }, 500);
      } else {
        reject(new Error('src not found'));
      }
    }));
  } catch (e) {
    return Promise.reject(e);
  }
};

var _templateObject$n, _templateObject2$j, _templateObject3$f, _templateObject4$c, _templateObject5$a, _templateObject6$8, _templateObject7$7;
var VideoPreview = /*#__PURE__*/React.memo(function VideoPreview(_ref) {
  var width = _ref.width,
      height = _ref.height,
      src = _ref.src,
      file = _ref.file,
      borderRadius = _ref.borderRadius,
      isPreview = _ref.isPreview,
      uploading = _ref.uploading,
      isRepliedMessage = _ref.isRepliedMessage,
      backgroundColor = _ref.backgroundColor,
      isDetailsView = _ref.isDetailsView,
      setVideoIsReadyToSend = _ref.setVideoIsReadyToSend;

  var _useState = React.useState(0),
      videoDuration = _useState[0],
      setVideoDuration = _useState[1];

  var _useState2 = React.useState(null),
      videoCurrentTime = _useState2[0],
      setVideoCurrentTime = _useState2[1];

  var _useState3 = React.useState(true),
      loading = _useState3[0],
      setLoading = _useState3[1];

  var _useState4 = React.useState(''),
      videoUrl = _useState4[0],
      setVideoUrl = _useState4[1];

  var videoRef = React.useRef(null);
  var attachmentThumb;
  var withPrefix = true;

  if (file.metadata && file.metadata.tmb) {
    if (file.metadata.tmb.length < 70) {
      attachmentThumb = base64ToToDataURL(file.metadata.tmb);
      withPrefix = false;
    } else {
      attachmentThumb = file.metadata && file.metadata.tmb;
    }
  }

  React.useEffect(function () {
    var checkVideoInterval;

    if (videoRef.current) {
      checkVideoInterval = setInterval(function () {
        try {
          var _temp4 = function () {
            if (videoRef.current && videoRef.current.readyState > 3) {
              var _temp5 = function _temp5() {
                clearInterval(checkVideoInterval);
              };

              setLoading(false);
              setVideoDuration(videoRef.current.duration);
              var minutes = Math.floor(videoRef.current.duration / 60);
              var seconds = Math.floor(videoRef.current.duration % 60);
              setVideoCurrentTime(minutes + ":" + (seconds < 10 ? "0" + seconds : seconds));

              var _temp6 = function () {
                if (isPreview) {
                  return Promise.resolve(getFrame3(videoRef.current, 0)).then(function (thumb) {
                    if (thumb) {
                      setVideoThumb(file.tid, _extends({}, thumb, {
                        duration: videoRef.current.duration
                      }));

                      if (setVideoIsReadyToSend) {
                        setVideoIsReadyToSend(file.tid);
                      }
                    }
                  });
                }
              }();

              return _temp6 && _temp6.then ? _temp6.then(_temp5) : _temp5(_temp6);
            }
          }();

          return Promise.resolve(_temp4 && _temp4.then ? _temp4.then(function () {}) : void 0);
        } catch (e) {
          return Promise.reject(e);
        }
      }, 1000);
    }

    return function () {
      return clearInterval(checkVideoInterval);
    };
  }, []);
  React.useEffect(function () {
    getAttachmentUrlFromCache(file.url).then(function (cachedUrl) {
      if (!videoUrl) {
        if (!cachedUrl && src) {
          setVideoUrl(src);
        } else if (cachedUrl) {
          setVideoUrl(cachedUrl);
        }
      }
    });
  }, [src]);
  return /*#__PURE__*/React__default.createElement(Component$1, {
    width: width,
    height: height,
    borderRadius: borderRadius,
    isRepliedMessage: isRepliedMessage,
    isPreview: isPreview,
    backgroundColor: backgroundColor,
    isDetailsView: isDetailsView
  }, !isPreview && loading && !uploading && /*#__PURE__*/React__default.createElement(UploadProgress, {
    isDetailsView: isDetailsView,
    isRepliedMessage: isRepliedMessage,
    borderRadius: borderRadius,
    backgroundImage: attachmentThumb,
    withPrefix: withPrefix
  }), /*#__PURE__*/React__default.createElement("video", {
    draggable: false,
    ref: videoRef,
    preload: 'auto',
    id: 'video',
    src: file.attachmentUrl || videoUrl
  }), videoCurrentTime && /*#__PURE__*/React__default.createElement(VideoControls, null, !isPreview && !!videoDuration && !isRepliedMessage && !uploading && !isDetailsView &&
  /*#__PURE__*/
  React__default.createElement(VideoPlayButton, null, /*#__PURE__*/React__default.createElement(SvgPlayVideo, null)), /*#__PURE__*/React__default.createElement(VideoTime, {
    isDetailsView: isDetailsView,
    isRepliedMessage: isPreview || isRepliedMessage
  }, !isRepliedMessage && !isPreview && /*#__PURE__*/React__default.createElement(SvgVideoCall, null), videoCurrentTime)));
});
var VideoControls = styled__default.div(_templateObject$n || (_templateObject$n = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])));
var VideoTime = styled__default.div(_templateObject2$j || (_templateObject2$j = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: ", ";\n  bottom: ", ";\n  left: ", ";\n  font-size: ", ";\n  display: flex;\n  align-items: center;\n  border-radius: 16px;\n  padding: ", ";\n  background-color: rgba(1, 1, 1, 0.3);\n  line-height: 14px;\n  color: ", ";\n\n  & > svg {\n    color: ", ";\n    margin-right: 4px;\n  }\n"])), function (props) {
  return props.isRepliedMessage ? '3px' : props.isDetailsView ? undefined : '8px';
}, function (props) {
  return props.isDetailsView ? '8px' : undefined;
}, function (props) {
  return props.isRepliedMessage ? '3px' : '8px';
}, function (props) {
  return props.isRepliedMessage ? '10px' : '12px';
}, function (props) {
  return props.isRepliedMessage ? '0 3px' : '4px 6px';
}, colors.white, colors.white);
var VideoPlayButton = styled__default.div(_templateObject3$f || (_templateObject3$f = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  visibility: ", ";\n"])), function (props) {
  return props.showOnHover && 'hidden';
});
var Component$1 = styled__default.div(_templateObject4$c || (_templateObject4$c = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  max-width: 100%;\n  max-height: 100%;\n  width: ", ";\n  height: ", ";\n  min-height: ", ";\n\n  ", ";\n  /*width: 100vw;\n  background-color: transparent;\n  margin-top: -50vw;\n  padding: 0 40px;\n  z-index: 20;*/\n\n  & > video {\n    max-width: 100%;\n    max-height: 100%;\n    width: ", ";\n    height: ", ";\n    min-height: ", ";\n    border: ", ";\n    object-fit: cover;\n    box-sizing: border-box;\n    border-radius: ", ";\n  }\n\n  &:hover {\n    & ", " {\n      visibility: visible;\n    }\n  }\n"])), function (props) {
  return props.width;
}, function (props) {
  return props.height;
}, function (props) {
  return !props.isRepliedMessage && !props.isPreview && !props.isDetailsView && '165px';
}, function (props) {
  return props.isRepliedMessage && 'margin-right: 8px';
}, function (props) {
  return props.width;
}, function (props) {
  return props.height;
}, function (props) {
  return !props.isRepliedMessage && !props.isPreview && '165px';
}, function (props) {
  return !props.isPreview && props.isRepliedMessage ? '0.5px solid rgba(0, 0, 0, 0.1)' : !props.isDetailsView && "2px solid " + props.backgroundColor;
}, function (props) {
  return props.borderRadius ? props.borderRadius : props.isRepliedMessage ? '4px' : '8px';
}, VideoPlayButton);
var DownloadFile = styled__default.a(_templateObject5$a || (_templateObject5$a = _taggedTemplateLiteralLoose(["\n  visibility: hidden;\n  opacity: 0;\n  margin-left: auto;\n  cursor: pointer;\n  transition: all 0.1s;\n"])));
var AttachmentFile = styled__default.div(_templateObject6$8 || (_templateObject6$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  position: relative;\n  align-items: center;\n  padding: 6px 12px;\n  width: 350px;\n  height: 70px;\n  background: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  margin-right: ", ";\n  margin-top: ", ";\n  border-radius: ", ";\n\n  &:hover ", " {\n    visibility: visible;\n    opacity: 1;\n  }\n\n  & > ", " svg {\n    width: 36px;\n    height: 36px;\n  }\n"])), function (props) {
  return props.background || '#ffffff';
}, function (props) {
  return props.border || "1px solid " + colors.gray1;
}, function (props) {
  return props.isPrevious && '16px';
}, function (props) {
  return !props.isPrevious && '8px';
}, function (props) {
  return props.borderRadius || '6px';
}, DownloadFile, AttachmentIconCont);
var AttachmentImg = styled__default.img(_templateObject7$7 || (_templateObject7$7 = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  border-radius: ", ";\n  object-fit: cover;\n"])), function (props) {
  return props.borderRadius || '6px';
});

var _circle$3, _path$T;

function _extends$U() {
  _extends$U = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$U.apply(this, arguments);
}

function SvgPlay(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$U({
    width: 32,
    height: 32,
    viewBox: "0 0 33 33",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle$3 || (_circle$3 = /*#__PURE__*/React.createElement("circle", {
    cx: 16,
    cy: 16,
    r: 16,
    fill: "CurrentColor"
  })), _path$T || (_path$T = /*#__PURE__*/React.createElement("path", {
    d: "M21.652 15.022c.714.432.714 1.522 0 1.954l-7.438 4.498c-.708.428-1.589-.114-1.589-.977v-8.995c0-.864.88-1.405 1.589-.977l7.438 4.497z",
    fill: "#fff"
  })));
}

var _circle$4, _path$U;

function _extends$V() {
  _extends$V = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$V.apply(this, arguments);
}

function SvgPause(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$V({
    width: 32,
    height: 32,
    viewBox: "0 0 33 33",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle$4 || (_circle$4 = /*#__PURE__*/React.createElement("circle", {
    cx: 16,
    cy: 16,
    r: 16,
    fill: "CurrentColor"
  })), _path$U || (_path$U = /*#__PURE__*/React.createElement("path", {
    d: "M13.721 10.375c.401 0 .547.042.694.12a.818.818 0 01.34.34c.078.147.12.293.12.694v8.942c0 .401-.042.547-.12.694a.818.818 0 01-.34.34c-.147.078-.293.12-.694.12h-1.067c-.401 0-.547-.042-.694-.12a.818.818 0 01-.34-.34c-.078-.147-.12-.293-.12-.694V11.53c0-.401.042-.547.12-.694a.818.818 0 01.34-.34c.147-.078.293-.12.694-.12h1.067zm5.625 0c.401 0 .547.042.694.12a.818.818 0 01.34.34c.078.147.12.293.12.694v8.942c0 .401-.042.547-.12.694a.818.818 0 01-.34.34c-.147.078-.293.12-.694.12H18.28c-.401 0-.547-.042-.694-.12a.818.818 0 01-.34-.34c-.078-.147-.12-.293-.12-.694V11.53c0-.401.042-.547.12-.694a.818.818 0 01.34-.34c.147-.078.293-.12.694-.12h1.067z",
    fill: "#fff"
  })));
}

var _templateObject$o, _templateObject2$k, _templateObject3$g, _templateObject4$d, _templateObject5$b, _templateObject6$9;

var AudioPlayer = function AudioPlayer(_ref) {
  var url = _ref.url,
      file = _ref.file;
  var recordingInitialState = {
    recordingSeconds: 0,
    recordingMilliseconds: 0,
    initRecording: false,
    mediaStream: null,
    mediaRecorder: null,
    audio: undefined
  };
  var dispatch = reactRedux.useDispatch();
  var playingAudioId = reactRedux.useSelector(playingAudioIdSelector);

  var _useState = React.useState(recordingInitialState),
      recording = _useState[0],
      setRecording = _useState[1];

  var _useState2 = React.useState(false),
      isRendered = _useState2[0],
      setIsRendered = _useState2[1];

  var _useState3 = React.useState(false),
      playAudio = _useState3[0],
      setPlayAudio = _useState3[1];

  var _useState4 = React.useState(''),
      currentTime = _useState4[0],
      setCurrentTime = _useState4[1];

  var _useState5 = React.useState(1),
      audioRate = _useState5[0],
      setAudioRate = _useState5[1];

  var wavesurfer = React.useRef(null);
  var wavesurferContainer = React.useRef(null);
  var intervalRef = React.useRef(null);

  var handleSetAudioRate = function handleSetAudioRate() {
    if (wavesurfer.current) {
      if (audioRate === 1) {
        setAudioRate(1.5);
        wavesurfer.current.setPlaybackRate(1.5);
      } else if (audioRate === 1.5) {
        setAudioRate(2);
        wavesurfer.current.audioRate = 2;
        wavesurfer.current.setPlaybackRate(2);
      } else {
        setAudioRate(1);
        wavesurfer.current.audioRate = 1;
        wavesurfer.current.setPlaybackRate(1);
      }
    }
  };

  var handlePlayPause = function handlePlayPause() {
    if (wavesurfer.current) {
      if (!wavesurfer.current.isPlaying()) {
        setPlayAudio(true);
        dispatch(setPlayingAudioIdAC("player_" + file.id));
        intervalRef.current = setInterval(function () {
          var currentTime = wavesurfer.current.getCurrentTime();

          if (currentTime >= 0) {
            setCurrentTime(formatAudioVideoTime(currentTime));
          }
        }, 10);
      } else {
        if (playingAudioId === file.id) {
          dispatch(setPlayingAudioIdAC(null));
        }
      }

      wavesurfer.current.playPause();
    }
  };

  useDidUpdate(function () {
    if (recording.mediaStream) {
      setRecording(_extends({}, recording, {
        mediaRecorder: new MediaRecorder(recording.mediaStream, {
          mimeType: 'audio/webm'
        })
      }));
    }
  }, [recording.mediaStream]);
  React.useEffect(function () {
    var MAX_RECORDER_TIME = 15;
    var recordingInterval = null;

    if (recording.initRecording) {
      recordingInterval = setInterval(function () {
        setRecording(function (prevState) {
          if (prevState.recordingSeconds === MAX_RECORDER_TIME && prevState.recordingMilliseconds === 0) {
            clearInterval(recordingInterval);
            return prevState;
          }

          if (prevState.recordingMilliseconds >= 0 && prevState.recordingMilliseconds < 99) {
            return _extends({}, prevState, {
              recordingMilliseconds: prevState.recordingMilliseconds + 1
            });
          }

          if (prevState.recordingMilliseconds === 99) {
            return _extends({}, prevState, {
              recordingSeconds: prevState.recordingSeconds + 1,
              recordingMilliseconds: 0
            });
          }

          return prevState;
        });
      }, 10);
    } else clearInterval(recordingInterval);

    return function () {
      return clearInterval(recordingInterval);
    };
  }, [recording.initRecording]);
  React.useEffect(function () {
    if (url && !isRendered) {
      var initWaveSurfer = function initWaveSurfer() {
        try {
          return Promise.resolve(new Promise(function (resolve) { resolve(_interopNamespace(require('wavesurfer.js'))); })).then(function (WaveSurfer) {
            wavesurfer.current = WaveSurfer["default"].create({
              container: wavesurferContainer.current,
              waveColor: colors.textColor2,
              skipLength: 0,
              progressColor: colors.primary,
              audioRate: audioRate,
              barWidth: 1,
              barHeight: 3,
              hideScrollbar: true,
              barRadius: 1.5,
              cursorWidth: 0,
              barGap: 2,
              barMinHeight: 1,
              height: 20
            });
            wavesurfer.current.load(url);
            wavesurfer.current.on('ready', function () {
              var audioDuration = wavesurfer.current.getDuration();
              setCurrentTime(formatAudioVideoTime(audioDuration));

              wavesurfer.current.drawBuffer = function (d) {
                console.log('filters --- ', d);
              };
            });
            wavesurfer.current.on('finish', function () {
              setPlayAudio(false);
              wavesurfer.current.seekTo(0);
              var audioDuration = wavesurfer.current.getDuration();
              setCurrentTime(formatAudioVideoTime(audioDuration));

              if (playingAudioId === file.id) {
                dispatch(setPlayingAudioIdAC(null));
              }

              clearInterval(intervalRef.current);
            });
            wavesurfer.current.on('pause', function () {
              setPlayAudio(false);

              if (playingAudioId === file.id) {
                dispatch(setPlayingAudioIdAC(null));
              }

              clearInterval(intervalRef.current);
            });
            wavesurfer.current.on('interaction', function () {
              var currentTime = wavesurfer.current.getCurrentTime();
              setCurrentTime(formatAudioVideoTime(currentTime));
            });
            setIsRendered(true);
          });
        } catch (e) {
          return Promise.reject(e);
        }
      };

      initWaveSurfer();
    }

    return function () {
      clearInterval(intervalRef.current);
    };
  }, [url]);
  React.useEffect(function () {
    if (playAudio && playingAudioId && playingAudioId !== "player_" + file.id && wavesurfer.current) {
      setPlayAudio(false);
      wavesurfer.current.pause();
    }
  }, [playingAudioId]);
  return /*#__PURE__*/React__default.createElement(Container$c, null, /*#__PURE__*/React__default.createElement(PlayPause, {
    onClick: handlePlayPause,
    iconColor: colors.primary
  }, playAudio ? /*#__PURE__*/React__default.createElement(SvgPause, null) : /*#__PURE__*/React__default.createElement(SvgPlay, null)), /*#__PURE__*/React__default.createElement(WaveContainer, null, /*#__PURE__*/React__default.createElement(AudioVisualization, {
    ref: wavesurferContainer
  }), /*#__PURE__*/React__default.createElement(AudioRate, {
    onClick: handleSetAudioRate
  }, audioRate, /*#__PURE__*/React__default.createElement("span", null, "X"))), /*#__PURE__*/React__default.createElement(Timer, null, currentTime));
};
var Container$c = styled__default.div(_templateObject$o || (_templateObject$o = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: flex-start;\n  width: 230px;\n  padding: 8px 12px;\n"])));
var PlayPause = styled__default.div(_templateObject2$k || (_templateObject2$k = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n\n  & > svg {\n    color: ", ";\n    display: flex;\n    width: 40px;\n    height: 40px;\n  }\n"])), function (props) {
  return props.iconColor || colors.primary;
});
var AudioVisualization = styled__default.div(_templateObject3$g || (_templateObject3$g = _taggedTemplateLiteralLoose(["\n  width: 100%;\n"])));
var AudioRate = styled__default.div(_templateObject4$d || (_templateObject4$d = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: ", ";\n  width: 30px;\n  min-width: 30px;\n  border-radius: 12px;\n  font-weight: 600;\n  font-size: 12px;\n  line-height: 14px;\n  color: ", ";\n  height: 18px;\n  box-sizing: border-box;\n  margin-left: 14px;\n  cursor: pointer;\n\n  & > span {\n    margin-top: auto;\n    line-height: 16px;\n    font-size: 9px;\n  }\n"])), colors.white, colors.textColor2);
var WaveContainer = styled__default.div(_templateObject5$b || (_templateObject5$b = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  display: flex;\n  margin-left: 8px;\n"])));
var Timer = styled__default.div(_templateObject6$9 || (_templateObject6$9 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: 59px;\n  bottom: 12px;\n  display: inline-block;\n  font-weight: 400;\n  font-size: 11px;\n  line-height: 12px;\n  color: ", ";\n"])), colors.textColor2);

var _templateObject$p, _templateObject2$l, _templateObject3$h, _templateObject4$e, _templateObject5$c, _templateObject6$a, _templateObject7$8, _templateObject8$7, _templateObject9$7, _templateObject10$6, _templateObject11$5, _templateObject12$3, _templateObject13$3;

var Attachment = function Attachment(_ref) {
  var attachment = _ref.attachment,
      _ref$isPreview = _ref.isPreview,
      isPreview = _ref$isPreview === void 0 ? false : _ref$isPreview,
      removeSelected = _ref.removeSelected,
      isRepliedMessage = _ref.isRepliedMessage,
      borderRadius = _ref.borderRadius,
      handleMediaItemClick = _ref.handleMediaItemClick,
      setVideoIsReadyToSend = _ref.setVideoIsReadyToSend,
      selectedFileAttachmentsIcon = _ref.selectedFileAttachmentsIcon,
      backgroundColor = _ref.backgroundColor,
      selectedFileAttachmentsBoxBorder = _ref.selectedFileAttachmentsBoxBorder,
      selectedFileAttachmentsTitleColor = _ref.selectedFileAttachmentsTitleColor,
      selectedFileAttachmentsSizeColor = _ref.selectedFileAttachmentsSizeColor,
      isDetailsView = _ref.isDetailsView,
      imageMinWidth = _ref.imageMinWidth,
      closeMessageActions = _ref.closeMessageActions,
      fileAttachmentWidth = _ref.fileAttachmentWidth,
      imageAttachmentMaxWidth = _ref.imageAttachmentMaxWidth,
      imageAttachmentMaxHeight = _ref.imageAttachmentMaxHeight,
      videoAttachmentMaxWidth = _ref.videoAttachmentMaxWidth,
      videoAttachmentMaxHeight = _ref.videoAttachmentMaxHeight;
  var dispatch = reactRedux.useDispatch();
  var attachmentCompilationState = reactRedux.useSelector(attachmentCompilationStateSelector) || {};
  var attachmentsUploadProgress = reactRedux.useSelector(attachmentsUploadProgressSelector) || {};
  var connectionStatus = reactRedux.useSelector(connectionStatusSelector);
  var theme = reactRedux.useSelector(themeSelector);
  var imageContRef = React.useRef(null);

  var _useState = React.useState(true),
      imageLoading = _useState[0],
      setImageLoading = _useState[1];

  var _useState2 = React.useState(false),
      downloadingFile = _useState2[0],
      setDownloadingFile = _useState2[1];

  var _useState3 = React.useState(''),
      attachmentUrl = _useState3[0],
      setAttachmentUrl = _useState3[1];

  var _useState4 = React.useState(3),
      progress = _useState4[0],
      setProgress = _useState4[1];

  var _useState5 = React.useState(),
      sizeProgress = _useState5[0],
      setSizeProgress = _useState5[1];

  var _useState6 = React.useState(true),
      isCached = _useState6[0],
      setIsCached = _useState6[1];

  var _useState7 = React.useState(false),
      downloadIsCancelled = _useState7[0],
      setDownloadIsCancelled = _useState7[1];

  var fileNameRef = React.useRef(null);
  var customDownloader = getCustomDownloader();
  var previewFileType = isPreview && attachment.data.type.split('/')[0];

  var _ref2 = attachment.metadata && attachment.metadata.szw && attachment.metadata.szh ? calculateRenderedImageWidth(attachment.metadata.szw, attachment.metadata.szh, attachment.type === attachmentTypes.image ? imageAttachmentMaxWidth : videoAttachmentMaxWidth, attachment.type === attachmentTypes.image ? imageAttachmentMaxHeight : videoAttachmentMaxHeight) : [],
      renderWidth = _ref2[0],
      renderHeight = _ref2[1];

  var isInUploadingState = attachmentCompilationState[attachment.tid] && (attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || attachmentCompilationState[attachment.tid] === UPLOAD_STATE.PAUSED);
  var attachmentThumb;
  var withPrefix = true;

  if (attachment.type !== attachmentTypes.voice && attachment.type !== attachmentTypes.link && attachment.metadata && attachment.metadata.tmb) {
    try {
      if (attachment.metadata.tmb.length < 70) {
        attachmentThumb = base64ToToDataURL(attachment.metadata.tmb);
        withPrefix = false;
      } else {
        attachmentThumb = attachment.metadata && attachment.metadata.tmb;
      }
    } catch (e) {
      console.log('error on get attachmentThumb', e);
    }
  }

  var downloadImage = function downloadImage(url) {
    var image = new Image();
    image.src = url;

    image.onload = function () {
      setAttachmentUrl(url);
      setDownloadingFile(false);
    };

    image.onerror = function () {
      console.error('Error on download image', url);
    };
  };

  var handlePauseResumeDownload = function handlePauseResumeDownload(e) {
    e.stopPropagation();

    if (downloadIsCancelled) {
      setDownloadIsCancelled(false);

      if (customDownloader) {
        customDownloader(attachment.url, false).then(function (url) {
          downloadImage(url);
        });
      } else {
        downloadImage(attachment.url);
      }
    } else {
      setAttachmentUrl('');
      console.log('set downlod is cancelled true');
      setDownloadIsCancelled(true);
    }
  };

  var handlePauseResumeUpload = function handlePauseResumeUpload(e) {
    e.stopPropagation();
    console.log('handlePauseResumeUpload. . . . .', handlePauseResumeUpload);

    if (downloadingFile) {
      handleStopStartDownloadFile(attachment);
    } else {
      if (attachmentCompilationState[attachment.tid]) {
        if (attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING) {
          dispatch(pauseAttachmentUploadingAC(attachment.tid));
        } else {
          dispatch(resumeAttachmentUploadingAC(attachment.tid));
        }
      }
    }
  };

  var handleMouseEvent = function handleMouseEvent(enter) {
    if (closeMessageActions) {
      closeMessageActions(enter);
    }
  };

  var handleCompleteDownload = function handleCompleteDownload(attachmentId) {
    if (attachmentId === attachment.id) {
      setDownloadingFile(false);
    }
  };

  var handleStopStartDownloadFile = function handleStopStartDownloadFile(att) {
    if (downloadingFile) {
      if (downloadIsCancelled) {
        setDownloadIsCancelled(false);

        if (att) {
          handleDownloadFileToDevice(att);
        } else {
          handleDownloadFile();
        }
      } else {
        setDownloadIsCancelled(true);
        var attachmentId = att ? att.id : attachment.id;
        cancelDownloadFile(attachmentId || '');
      }
    } else {
      setDownloadingFile(true);
      setDownloadIsCancelled(false);

      if (att) {
        handleDownloadFileToDevice(att);
      } else {
        handleDownloadFile();
      }
    }
  };

  var handleDownloadFileToDevice = function handleDownloadFileToDevice(attachment) {
    setDownloadingFile(true);
    setDownloadIsCancelled(false);
    downloadFile(attachment, true, handleCompleteDownload, function (progress) {
      var loadedRes = progress.loaded && progress.loaded / progress.total;
      var uploadPercent = loadedRes && loadedRes * 100;
      setProgress(uploadPercent > 3 ? uploadPercent : 3);
      setSizeProgress({
        loaded: progress.loaded || 0,
        total: progress.total || 0
      });
    });
  };

  var handleDownloadFile = function handleDownloadFile() {
    try {
      var _temp2 = function () {
        if (customDownloader) {
          if (!attachment.attachmentUrl) {
            setDownloadingFile(true);
          }

          var urlPromise = customDownloader(attachment.url, true, function (progress) {
            var loadedRes = progress.loaded && progress.loaded / progress.total;
            var uploadPercent = loadedRes && loadedRes * 100;
            setSizeProgress({
              loaded: progress.loaded || 0,
              total: progress.total || 0
            });
            setProgress(uploadPercent);
          });
          setDownloadFilePromise(attachment.id, urlPromise);
          return Promise.resolve(urlPromise).then(function (result) {
            var url = URL.createObjectURL(result.Body);
            setSizeProgress(undefined);
            return Promise.resolve(fetch(url)).then(function (response) {
              setAttachmentToCache(attachment.url, response);
              setIsCached(true);
              setDownloadingFile(false);
              setAttachmentUrl(url);
            });
          });
        } else {
          setAttachmentUrl(attachment.url);
          fetch(attachment.url).then(function (response) {
            try {
              setAttachmentToCache(attachment.url, response);
              setIsCached(true);
              return Promise.resolve();
            } catch (e) {
              return Promise.reject(e);
            }
          });
        }
      }();

      return Promise.resolve(_temp2 && _temp2.then ? _temp2.then(function () {}) : void 0);
    } catch (e) {
      return Promise.reject(e);
    }
  };

  React.useEffect(function () {
    if (downloadIsCancelled) {
      setAttachmentUrl('');
    }
  }, [attachmentUrl]);
  React.useEffect(function () {
    if (connectionStatus === CONNECTION_STATUS.CONNECTED && attachment.id && !(attachment.type === attachmentTypes.file || attachment.type === attachmentTypes.link)) {
      getAttachmentUrlFromCache(attachment.url).then(function (cachedUrl) {
        try {
          if (attachment.type === 'image' && !isPreview) {
            if (cachedUrl) {
              setAttachmentUrl(cachedUrl);
              setIsCached(true);
            } else {
              setIsCached(false);
              setDownloadingFile(true);

              if (customDownloader) {
                customDownloader(attachment.url, false).then(function (url) {
                  try {
                    downloadImage(url);
                    return Promise.resolve(fetch(url)).then(function (response) {
                      setAttachmentToCache(attachment.url, response);
                      setIsCached(true);
                    });
                  } catch (e) {
                    return Promise.reject(e);
                  }
                });
              } else {
                downloadImage(attachment.url);
                fetch(attachment.url).then(function (response) {
                  try {
                    setAttachmentToCache(attachment.url, response);
                    setIsCached(true);
                    return Promise.resolve();
                  } catch (e) {
                    return Promise.reject(e);
                  }
                });
              }
            }
          } else {
            if (cachedUrl) {
              setAttachmentUrl(cachedUrl);
              setIsCached(true);
            } else {
              setIsCached(false);
              handleDownloadFile();
            }
          }

          return Promise.resolve();
        } catch (e) {
          return Promise.reject(e);
        }
      })["catch"](function (e) {
        console.log('error on get attachment url from cache. .. ', e);

        if (customDownloader) {
          setDownloadingFile(true);
          customDownloader(attachment.url, false).then(function (url) {
            try {
              return Promise.resolve(fetch(url)).then(function (response) {
                setAttachmentToCache(attachment.url, response);
                setAttachmentUrl(url);
                setDownloadingFile(false);
              });
            } catch (e) {
              return Promise.reject(e);
            }
          });
        } else {
          setAttachmentUrl(attachment.url);
        }
      });
    }
  }, [attachment.id]);
  React.useEffect(function () {
    var attachmentIndex = attachment.tid || attachment.id;

    if (attachmentIndex && attachmentsUploadProgress[attachmentIndex]) {
      var uploadProgress = attachmentsUploadProgress[attachmentIndex];

      if (getCustomUploader()) {
        var uploadPercent = uploadProgress.progress && uploadProgress.progress * 100 > 3 ? uploadProgress.progress * 100 : 3;
        setProgress(uploadPercent);
        setSizeProgress({
          loaded: uploadProgress.uploaded || 0,
          total: uploadProgress.total || 0
        });
      } else {
        var _uploadPercent = uploadProgress.progress > 3 ? uploadProgress.progress : 3;

        setProgress(_uploadPercent);
        setSizeProgress({
          loaded: uploadProgress.uploaded || 0,
          total: uploadProgress.total || 0
        });
      }
    }
  }, [attachmentsUploadProgress]);
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, attachment.type === 'image' ? /*#__PURE__*/React__default.createElement(AttachmentImgCont, {
    draggable: false,
    onClick: function onClick() {
      return handleMediaItemClick && !isInUploadingState && !downloadingFile && handleMediaItemClick(attachment);
    },
    isPreview: isPreview,
    ref: imageContRef,
    borderRadius: borderRadius,
    backgroundImage: attachmentThumb,
    withPrefix: withPrefix,
    isRepliedMessage: isRepliedMessage,
    fitTheContainer: isDetailsView,
    width: !isPreview && !isRepliedMessage ? renderWidth : undefined,
    height: !isPreview && !isRepliedMessage && !isDetailsView ? renderHeight : undefined
  }, /*#__PURE__*/React__default.createElement(AttachmentImg$1, {
    draggable: false,
    backgroundColor: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight,
    src: attachment.attachmentUrl || attachmentUrl,
    borderRadius: borderRadius,
    imageMinWidth: imageMinWidth,
    isPreview: isPreview,
    isRepliedMessage: isRepliedMessage,
    withBorder: !isPreview && !isDetailsView,
    fitTheContainer: isDetailsView,
    imageMaxHeight: attachment.metadata && (attachment.metadata.szh > 400 ? '400px' : attachment.metadata.szh + "px"),
    onLoad: function onLoad() {
      return setImageLoading(false);
    }
  }), !isPreview && (isInUploadingState || imageLoading) ? /*#__PURE__*/React__default.createElement(UploadProgress, {
    backgroundImage: attachmentThumb,
    isRepliedMessage: isRepliedMessage,
    width: renderWidth,
    height: renderHeight,
    withBorder: !isPreview && !isDetailsView,
    backgroundColor: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight,
    isDetailsView: isDetailsView,
    imageMinWidth: imageMinWidth,
    withPrefix: withPrefix
  }, /*#__PURE__*/React__default.createElement(UploadPercent, {
    isRepliedMessage: isRepliedMessage,
    isDetailsView: isDetailsView
  }, isInUploadingState ? /*#__PURE__*/React__default.createElement(CancelResumeWrapper, {
    onClick: handlePauseResumeUpload
  }, attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING ? /*#__PURE__*/React__default.createElement(SvgCancel, null) : /*#__PURE__*/React__default.createElement(SvgUpload, null)) : !isCached && /*#__PURE__*/React__default.createElement(CancelResumeWrapper, {
    onClick: handlePauseResumeDownload
  }, downloadIsCancelled ? /*#__PURE__*/React__default.createElement(SvgDownload, null) : /*#__PURE__*/React__default.createElement(SvgCancel, null)), (!isCached || attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING) && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(ProgressWrapper$1, null, /*#__PURE__*/React__default.createElement(reactCircularProgressbar.CircularProgressbar, {
    minValue: 0,
    maxValue: 100,
    value: progress,
    backgroundPadding: 3,
    background: true,
    text: '',
    styles: {
      background: {
        fill: 'rgba(23, 25, 28, 0.40)'
      },
      path: {
        stroke: colors.white,
        strokeLinecap: 'butt',
        strokeWidth: '4px',
        transition: 'stroke-dashoffset 0.5s ease 0s',
        transform: 'rotate(0turn)',
        transformOrigin: 'center center'
      }
    }
  })), sizeProgress && /*#__PURE__*/React__default.createElement(SizeProgress, null, bytesToSize(sizeProgress.loaded, 1), " / ", bytesToSize(sizeProgress.total, 1))))) : null, isPreview && /*#__PURE__*/React__default.createElement(RemoveChosenFile, {
    color: theme === THEME.DARK ? colors.backgroundColor : colors.textColor3,
    onClick: function onClick() {
      return removeSelected && removeSelected(attachment.tid);
    }
  })) : attachment.type === 'video' ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !isPreview ? /*#__PURE__*/React__default.createElement(VideoCont, {
    onClick: function onClick() {
      return handleMediaItemClick && !downloadingFile && !isInUploadingState && (attachmentCompilationState[attachment.tid] ? attachmentCompilationState[attachment.tid] !== UPLOAD_STATE.FAIL || attachmentCompilationState[attachment.tid] !== UPLOAD_STATE.UPLOADING : true) && handleMediaItemClick(attachment);
    },
    isDetailsView: isDetailsView
  }, isInUploadingState || downloadingFile ? /*#__PURE__*/React__default.createElement(UploadProgress, {
    isDetailsView: isDetailsView,
    isRepliedMessage: isRepliedMessage,
    withPrefix: withPrefix,
    backgroundImage: attachmentThumb ? attachment.metadata.tmb : '',
    zIndex: 9
  }, /*#__PURE__*/React__default.createElement(UploadPercent, {
    isRepliedMessage: isRepliedMessage,
    isDetailsView: isDetailsView,
    backgroundColor: 'rgba(23, 25, 28, 0.40)'
  }, isInUploadingState ? /*#__PURE__*/React__default.createElement(CancelResumeWrapper, {
    onClick: handlePauseResumeUpload
  }, attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING ? /*#__PURE__*/React__default.createElement(SvgCancel, null) : /*#__PURE__*/React__default.createElement(SvgUpload, null)) : /*#__PURE__*/React__default.createElement(CancelResumeWrapper, {
    onClick: function onClick() {
      return handleStopStartDownloadFile();
    }
  }, downloadIsCancelled ? /*#__PURE__*/React__default.createElement(SvgDownload, null) : /*#__PURE__*/React__default.createElement(SvgCancel, null)), (attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || downloadingFile && !downloadIsCancelled) && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(ProgressWrapper$1, null, /*#__PURE__*/React__default.createElement(reactCircularProgressbar.CircularProgressbar, {
    minValue: 0,
    maxValue: 100,
    value: progress,
    backgroundPadding: 3,
    background: true,
    text: '',
    styles: {
      background: {
        fill: 'rgba(23, 25, 28, 0)'
      },
      path: {
        stroke: colors.white,
        strokeLinecap: 'butt',
        strokeWidth: '4px',
        transition: 'stroke-dashoffset 0.5s ease 0s',
        transform: 'rotate(0turn)',
        transformOrigin: 'center center'
      }
    }
  })), sizeProgress && !isRepliedMessage && /*#__PURE__*/React__default.createElement(SizeProgress, null, bytesToSize(sizeProgress.loaded, 1), " / ", bytesToSize(sizeProgress.total, 1))))) : null, /*#__PURE__*/React__default.createElement(VideoPreview, {
    theme: theme,
    width: isRepliedMessage ? '40px' : isDetailsView ? '100%' : (renderWidth || videoAttachmentMaxWidth || 420) + "px",
    height: isRepliedMessage ? '40px' : isDetailsView ? '100%' : (renderHeight || videoAttachmentMaxHeight || 240) + "px",
    file: attachment,
    src: attachmentUrl,
    isCachedFile: isCached,
    uploading: attachmentCompilationState[attachment.tid] && (attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || attachmentCompilationState[attachment.tid] === UPLOAD_STATE.PAUSED),
    borderRadius: isRepliedMessage ? '4px' : borderRadius,
    isRepliedMessage: isRepliedMessage,
    isDetailsView: isDetailsView,
    backgroundColor: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight
  })) : /*#__PURE__*/React__default.createElement(AttachmentImgCont, {
    isPreview: isPreview,
    backgroundColor: colors.defaultAvatarBackground
  }, /*#__PURE__*/React__default.createElement(VideoPreview, {
    width: '48px',
    height: '48px',
    file: attachment,
    src: attachment.attachmentUrl || attachmentUrl,
    borderRadius: borderRadius,
    setVideoIsReadyToSend: setVideoIsReadyToSend,
    backgroundColor: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight,
    isPreview: true
  }), /*#__PURE__*/React__default.createElement(RemoveChosenFile, {
    color: theme === THEME.DARK ? colors.backgroundColor : colors.textColor3,
    onClick: function onClick() {
      return removeSelected && removeSelected(attachment.tid);
    }
  }))) : attachment.type === attachmentTypes.voice ? /*#__PURE__*/React__default.createElement(AudioPlayer, {
    url: attachment.attachmentUrl || attachmentUrl,
    file: attachment
  }) : attachment.type === attachmentTypes.link ? null :
  /*#__PURE__*/
  React__default.createElement(AttachmentFile$1, {
    draggable: false,
    isPreview: isPreview,
    isUploading: attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || attachmentCompilationState[attachment.tid] === UPLOAD_STATE.PAUSED,
    borderRadius: borderRadius,
    background: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight,
    isRepliedMessage: isRepliedMessage,
    border: selectedFileAttachmentsBoxBorder || (theme === THEME.DARK ? 'none' : ''),
    width: fileAttachmentWidth
  }, attachmentThumb ? /*#__PURE__*/React__default.createElement(FileThumbnail, {
    src: withPrefix ? "data:image/jpeg;base64," + attachmentThumb : attachmentThumb
  }) :
  /*#__PURE__*/
  React__default.createElement(AttachmentIconCont, {
    backgroundColor: colors.primary,
    className: 'icon-warpper'
  }, previewFileType && previewFileType === 'video' ? /*#__PURE__*/React__default.createElement(VideoPreview, {
    file: attachment,
    backgroundColor: backgroundColor && backgroundColor !== 'inherit' ? backgroundColor : colors.primaryLight,
    width: '40px',
    height: '40px',
    src: attachment.attachmentUrl,
    setVideoIsReadyToSend: setVideoIsReadyToSend,
    isPreview: true
  }) : isPreview && attachment.attachmentUrl ? /*#__PURE__*/React__default.createElement(FileThumbnail, {
    src: attachment.attachmentUrl
  }) : attachmentCompilationState[attachment.tid] !== UPLOAD_STATE.UPLOADING && attachmentCompilationState[attachment.tid] !== UPLOAD_STATE.PAUSED && (selectedFileAttachmentsIcon || /*#__PURE__*/React__default.createElement(SvgFileIcon, null))), !isRepliedMessage && !isPreview && /*#__PURE__*/React__default.createElement(DownloadFile$1, {
    widthThumb: !!attachmentThumb,
    backgroundColor: attachmentThumb ? 'rgba(0,0,0,0.4)' : colors.primary,
    onClick: function onClick() {
      return handleStopStartDownloadFile(attachment);
    },
    onMouseEnter: function onMouseEnter() {
      return handleMouseEvent(true);
    },
    onMouseLeave: function onMouseLeave() {
      return handleMouseEvent(false);
    }
  }, !downloadingFile && /*#__PURE__*/React__default.createElement(SvgDownload, null)), !isRepliedMessage && !isPreview && (isInUploadingState || downloadingFile) ? /*#__PURE__*/React__default.createElement(UploadProgress, {
    fileAttachment: true,
    isDetailsView: isDetailsView
  }, /*#__PURE__*/React__default.createElement(UploadPercent, {
    fileAttachment: true,
    borderRadius: !(attachmentThumb || attachment.attachmentUrl && isPreview) ? '50%' : undefined,
    isDetailsView: isDetailsView,
    backgroundColor: downloadingFile ? '' : attachment.attachmentUrl || attachmentThumb ? 'rgba(0,0,0,0.4)' : colors.primary
  }, (isInUploadingState || downloadingFile) && /*#__PURE__*/React__default.createElement(CancelResumeWrapper, {
    onClick: handlePauseResumeUpload
  }, attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || downloadingFile ? /*#__PURE__*/React__default.createElement(SvgCancel, null) : isInUploadingState && /*#__PURE__*/React__default.createElement(SvgUpload, null)), (attachmentCompilationState[attachment.tid] === UPLOAD_STATE.UPLOADING || downloadingFile) && /*#__PURE__*/React__default.createElement(ProgressWrapper$1, null, /*#__PURE__*/React__default.createElement(reactCircularProgressbar.CircularProgressbar, {
    minValue: 0,
    maxValue: 100,
    value: progress,
    backgroundPadding: 6,
    background: true,
    text: '',
    styles: {
      background: {
        fill: 'transparent'
      },
      path: {
        stroke: colors.white,
        strokeLinecap: 'butt',
        strokeWidth: '4px',
        transition: 'stroke-dashoffset 0.5s ease 0s',
        transform: 'rotate(0turn)',
        transformOrigin: 'center center'
      }
    }
  })))) : null, !isRepliedMessage && /*#__PURE__*/React__default.createElement(AttachmentFileInfo, {
    isPreview: isPreview
  }, /*#__PURE__*/React__default.createElement(AttachmentName, {
    color: selectedFileAttachmentsTitleColor,
    ref: fileNameRef
  }, formatLargeText(isPreview ? attachment.data.name : attachment.name, fileAttachmentWidth ? fileAttachmentWidth / 12.5 : isPreview ? 18 : 30)), /*#__PURE__*/React__default.createElement(AttachmentSize, {
    color: selectedFileAttachmentsSizeColor
  }, (isInUploadingState || downloadingFile) && sizeProgress ? bytesToSize(sizeProgress.loaded, 1) + " \u2022 " + bytesToSize(sizeProgress.total, 1) : (attachment.data && attachment.data.size || attachment.size) && bytesToSize(isPreview ? attachment.data.size : +attachment.size))), isPreview && /*#__PURE__*/React__default.createElement(RemoveChosenFile, {
    color: theme === THEME.DARK ? colors.backgroundColor : colors.textColor3,
    onClick: function onClick() {
      return removeSelected && removeSelected(attachment.tid);
    }
  })));
};

var Attachment$1 = /*#__PURE__*/React__default.memo(Attachment, function (prevProps, nextProps) {
  return prevProps.attachment.url === nextProps.attachment.url && prevProps.attachment.id === nextProps.attachment.id && prevProps.handleMediaItemClick === nextProps.handleMediaItemClick && prevProps.attachment.attachmentUrl === nextProps.attachment.attachmentUrl;
});
var DownloadImage = styled__default.div(_templateObject$p || (_templateObject$p = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  visibility: hidden;\n  opacity: 0;\n  width: 28px;\n  height: 28px;\n  top: 12px;\n  right: 17px;\n  border-radius: 50%;\n  line-height: 35px;\n  text-align: center;\n  cursor: pointer;\n  background: #ffffff;\n  box-shadow: 0 4px 4px rgba(6, 10, 38, 0.2);\n  transition: all 0.1s;\n\n  & > svg {\n    width: 16px;\n  }\n"])));
var AttachmentImgCont = styled__default.div(_templateObject2$l || (_templateObject2$l = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  //flex-direction: column;\n  margin-right: ", ";\n  //max-width: 420px;\n  //max-height: 400px;\n  min-width: ", ";\n  height: ", ";\n\n  width: ", ";\n  max-width: 100%;\n  height: ", ";\n  max-height: 400px;\n  min-height: ", ";\n  cursor: pointer;\n\n  ", "\n\n  &:hover ", " {\n    visibility: visible;\n    opacity: 1;\n  }\n\n  ", "\n"])), function (props) {
  return props.isPreview ? '16px' : props.isRepliedMessage ? '8px' : '';
}, function (props) {
  return !props.isRepliedMessage && !props.fitTheContainer && '165px';
}, function (props) {
  return props.fitTheContainer && '100%';
}, function (props) {
  return props.fitTheContainer ? '100%' : props.isRepliedMessage ? '40px' : props.width && props.width + "px";
}, function (props) {
  return props.fitTheContainer ? '100%' : props.isRepliedMessage ? '40px' : props.height && props.height + "px";
}, function (props) {
  return props.height && '165px';
}, function (props) {
  return props.backgroundColor && "\n    background-color: " + props.backgroundColor + ";\n    border-radius: 8px;\n    justify-content: center;\n    align-items: center;\n     & > svg:first-child {\n      width: 40px;\n      height: 40px;\n      transform: translate(2px, 3px);\n    }\n  ";
}, DownloadImage, function (props) {
  return props.isPreview && "\n      width: 48px;\n      min-width: 48px;\n      height: 48px;\n  ";
});
var FileThumbnail = styled__default.img(_templateObject3$h || (_templateObject3$h = _taggedTemplateLiteralLoose(["\n  min-width: 40px;\n  max-width: 40px;\n  height: 40px;\n  object-fit: cover;\n  border-radius: 8px;\n"])));
var DownloadFile$1 = styled__default.span(_templateObject4$e || (_templateObject4$e = _taggedTemplateLiteralLoose(["\n  display: none;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  background-color: ", ";\n  min-width: 40px;\n  max-width: 40px;\n  height: 40px;\n  position: ", ";\n  border-radius: ", ";\n\n  & > svg {\n    width: 20px;\n    height: 20px;\n  }\n"])), function (props) {
  return props.backgroundColor || colors.primary;
}, function (props) {
  return props.widthThumb && 'absolute';
}, function (props) {
  return props.widthThumb ? '8px' : '50%';
});
var ProgressWrapper$1 = styled__default.span(_templateObject5$c || (_templateObject5$c = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  height: 100%;\n  animation: preloader 1.5s linear infinite;\n\n  @keyframes preloader {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n"])));
var SizeProgress = styled__default.span(_templateObject6$a || (_templateObject6$a = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: -26px;\n  background-color: rgba(0, 0, 0, 0.4);\n  color: ", ";\n  font-size: 12px;\n  border-radius: 12px;\n  padding: 3px 6px;\n  white-space: nowrap;\n"])), colors.white);
var AttachmentFile$1 = styled__default.div(_templateObject7$8 || (_templateObject7$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  position: relative;\n  align-items: center;\n  padding: ", ";\n  width: ", ";\n  //height: 70px;\n  background: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  margin-right: ", ";\n  border-radius: ", ";\n\n  ", "\n\n  & > ", " svg {\n    width: 40px;\n    height: 40px;\n  }\n"])), function (props) {
  return !props.isRepliedMessage && '8px 12px;';
}, function (props) {
  return !props.isRepliedMessage && (props.width ? props.width + "px" : '350px');
}, function (props) {
  return props.background;
}, function (props) {
  return props.border || "1px solid  " + colors.gray1;
}, function (props) {
  return props.isPreview ? '16px' : props.isRepliedMessage ? '8px' : '';
}, function (props) {
  return props.borderRadius || '6px';
}, function (props) {
  return !props.isRepliedMessage && !props.isPreview && !props.isUploading && "\n      &:hover " + DownloadFile$1 + " {\n        display: flex;\n      }\n\n      &:hover " + UploadPercent + " {\n        border-radius: 50%\n      }\n\n      &:hover " + FileThumbnail + " {\n      }\n        &:hover " + AttachmentIconCont + " {\n    display: none;\n  }\n  ";
}, AttachmentIconCont);
var RemoveChosenFile = styled__default(SvgDeleteUpload)(_templateObject8$7 || (_templateObject8$7 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  width: 20px;\n  height: 20px !important;\n  top: -11px;\n  right: -11px;\n  padding: 2px;\n  cursor: pointer;\n  color: ", ";\n  z-index: 4;\n"])), function (props) {
  return props.color || colors.textColor3;
});
var AttachmentName = styled__default.h3(_templateObject9$7 || (_templateObject9$7 = _taggedTemplateLiteralLoose(["\n  font-size: 15px;\n  font-weight: 500;\n  line-height: 18px;\n  color: ", ";\n  max-width: 275px;\n  white-space: nowrap;\n  margin: 0;\n"])), function (props) {
  return props.color || colors.textColor1;
});
var AttachmentSize = styled__default.span(_templateObject10$6 || (_templateObject10$6 = _taggedTemplateLiteralLoose(["\n  font-size: 13px;\n  color: ", ";\n  & > span {\n    color: ", ";\n    margin-left: 8px;\n  }\n"])), function (props) {
  return props.color || colors.textColor1;
}, colors.red1);
var AttachmentFileInfo = styled__default.div(_templateObject11$5 || (_templateObject11$5 = _taggedTemplateLiteralLoose(["\n  margin-left: 12px;\n  ", "\n"])), function (props) {
  return props.isPreview && "line-height: 14px;\n      max-width: calc(100% - 44px);\n  ";
});
var AttachmentImg$1 = styled__default.img(_templateObject12$3 || (_templateObject12$3 = _taggedTemplateLiteralLoose(["\n  position: ", ";\n  border-radius: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  max-width: 100%;\n  max-height: ", ";\n  width: ", ";\n  height: ", ";\n  min-height: ", ";\n  min-width: ", ";\n  object-fit: cover;\n  visibility: ", ";\n  z-index: 2;\n"])), function (props) {
  return props.absolute && 'absolute';
}, function (props) {
  return props.isRepliedMessage ? '4px' : props.borderRadius || '6px';
}, function (props) {
  return props.isRepliedMessage ? '0.5px solid rgba(0, 0, 0, 0.1)' : props.withBorder && "2px solid " + props.backgroundColor;
}, function (props) {
  return props.imageMaxHeight || '400px';
}, function (props) {
  return props.isRepliedMessage ? '40px' : props.isPreview ? '48px' : props.fitTheContainer ? '100%' : '';
}, function (props) {
  return props.isRepliedMessage ? '40px' : props.isPreview ? '48px' : props.fitTheContainer ? '100%' : '';
}, function (props) {
  return !props.isRepliedMessage && !props.isPreview && !props.fitTheContainer ? '165px' : props.isRepliedMessage ? '40px' : '';
}, function (props) {
  return !props.isRepliedMessage && !props.isPreview && !props.fitTheContainer ? props.imageMinWidth || '165px' : props.isRepliedMessage ? '40px' : '';
}, function (props) {
  return props.hidden && 'hidden';
});
var VideoCont = styled__default.div(_templateObject13$3 || (_templateObject13$3 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  cursor: pointer;\n  height: ", ";\n"])), function (props) {
  return props.isDetailsView && '100%';
});

var _templateObject$q, _templateObject2$m;

var CustomRadio$1 = function CustomRadio(_ref) {
  var index = _ref.index,
      state = _ref.state,
      _onChange = _ref.onChange,
      checkedBorder = _ref.checkedBorder,
      border = _ref.border,
      borderRadius = _ref.borderRadius,
      size = _ref.size,
      disabled = _ref.disabled;
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(CustomLabel$1, {
    isChecked: state,
    size: size,
    checkedBorder: checkedBorder,
    border: border,
    borderRadius: borderRadius,
    htmlFor: "radio-" + index
  }), /*#__PURE__*/React__default.createElement(Radio, {
    disabled: disabled,
    type: 'radio',
    id: "radio-" + index,
    checked: state,
    onChange: function onChange(e) {
      return _onChange(e);
    }
  }));
};
var CustomLabel$1 = styled__default.label(_templateObject$q || (_templateObject$q = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  width: ", ";\n  height: ", ";\n  cursor: pointer;\n  border: ", ";\n  border-radius: ", ";\n"])), function (props) {
  return props.size || '12px';
}, function (props) {
  return props.size || '12px';
}, function (props) {
  return props.isChecked ? props.checkedBorder || "6px solid " + colors.primary : props.border || "1px solid " + colors.textColor2;
}, function (props) {
  return props.borderRadius || '50%';
});
var Radio = styled__default.input(_templateObject2$m || (_templateObject2$m = _taggedTemplateLiteralLoose(["\n  display: none;\n"])));

var _templateObject$r, _templateObject2$n;

function ConfirmPopup(_ref) {
  var title = _ref.title,
      description = _ref.description,
      theme = _ref.theme,
      buttonText = _ref.buttonText,
      buttonTextColor = _ref.buttonTextColor,
      buttonBackground = _ref.buttonBackground,
      togglePopup = _ref.togglePopup,
      handleFunction = _ref.handleFunction,
      isDeleteMessage = _ref.isDeleteMessage,
      isIncomingMessage = _ref.isIncomingMessage,
      allowDeleteIncoming = _ref.allowDeleteIncoming,
      isDirectChannel = _ref.isDirectChannel,
      _ref$myRole = _ref.myRole,
      myRole = _ref$myRole === void 0 ? '' : _ref$myRole,
      loading = _ref.loading;

  var _usePermissions = usePermissions(myRole),
      checkActionPermission = _usePermissions[0];

  var _useState = React.useState(true),
      initialRender = _useState[0],
      setInitialRender = _useState[1];

  var deleteForEveryoneIsPermitted = isIncomingMessage ? allowDeleteIncoming && !isDirectChannel && checkActionPermission('deleteAnyMessage') : isDirectChannel || checkActionPermission('deleteOwnMessage');

  var _useState2 = React.useState(deleteForEveryoneIsPermitted ? 'forEveryone' : 'forMe'),
      deleteMessageOption = _useState2[0],
      setDeleteMessageOption = _useState2[1];

  var handleDelete = function handleDelete() {
    handleFunction(isDeleteMessage && deleteMessageOption);
    togglePopup();
  };

  var handleChoseDeleteOption = function handleChoseDeleteOption(e, option) {
    if (e.target.checked) {
      setDeleteMessageOption(option);
    }
  };

  React.useEffect(function () {
    setInitialRender(false);
  }, []);
  return /*#__PURE__*/React__default.createElement(PopupContainer, null, /*#__PURE__*/React__default.createElement(Popup, {
    theme: theme,
    backgroundColor: colors.backgroundColor,
    maxWidth: '520px',
    minWidth: '520px',
    isLoading: loading,
    padding: '0'
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '24px',
    paddingV: '24px'
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    color: colors.textColor1,
    onClick: function onClick() {
      return togglePopup();
    }
  }), /*#__PURE__*/React__default.createElement(PopupName, {
    color: colors.textColor1,
    isDelete: true,
    marginBottom: '20px'
  }, title), /*#__PURE__*/React__default.createElement(PopupDescription, null, description), isDeleteMessage && /*#__PURE__*/React__default.createElement(DeleteMessageOptions, null, deleteForEveryoneIsPermitted && /*#__PURE__*/React__default.createElement(DeleteOptionItem, {
    onClick: function onClick() {
      return setDeleteMessageOption('forEveryone');
    }
  }, /*#__PURE__*/React__default.createElement(CustomRadio$1, {
    index: '1',
    size: '18px',
    state: deleteMessageOption === 'forEveryone',
    onChange: function onChange(e) {
      return handleChoseDeleteOption(e, 'forEveryone');
    }
  }), "Delete for everyone"), /*#__PURE__*/React__default.createElement(DeleteOptionItem, {
    onClick: function onClick() {
      return setDeleteMessageOption('forMe');
    }
  }, /*#__PURE__*/React__default.createElement(CustomRadio$1, {
    index: '2',
    size: '18px',
    state: deleteMessageOption === 'forMe',
    onChange: function onChange(e) {
      return handleChoseDeleteOption(e, 'forMe');
    }
  }), "Delete for me"))), /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: function onClick() {
      return togglePopup();
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    backgroundColor: buttonBackground || colors.red1,
    color: buttonTextColor,
    borderRadius: '8px',
    onClick: handleDelete,
    disabled: initialRender
  }, buttonText || 'Delete'))));
}
var DeleteMessageOptions = styled__default.div(_templateObject$r || (_templateObject$r = _taggedTemplateLiteralLoose(["\n  margin-top: 14px;\n"])));
var DeleteOptionItem = styled__default.div(_templateObject2$n || (_templateObject2$n = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  font-size: 15px;\n  line-height: 160%;\n  color: ", ";\n  margin-bottom: 12px;\n\n  & > label {\n    margin-right: 10px;\n  }\n"])), colors.textColor2);

function useOnScreen(ref) {
  var _useState = React.useState(false),
      isIntersecting = _useState[0],
      setIntersecting = _useState[1];

  var observer = new IntersectionObserver(function (_ref) {
    var entry = _ref[0];
    return setIntersecting(entry.isIntersecting);
  });
  React.useEffect(function () {
    observer.observe(ref.current);
    return function () {
      observer.disconnect();
    };
  }, []);
  return isIntersecting;
}

var _templateObject$s, _templateObject2$o, _templateObject3$i, _templateObject4$f, _templateObject5$d, _templateObject6$b, _templateObject7$9, _templateObject8$8, _templateObject9$8, _templateObject10$7;

function ForwardMessagePopup(_ref) {
  var title = _ref.title,
      buttonText = _ref.buttonText,
      togglePopup = _ref.togglePopup,
      handleForward = _ref.handleForward,
      loading = _ref.loading;
  var ChatClient = getClient();
  var user = ChatClient.user;
  var dispatch = reactRedux.useDispatch();
  var channels = reactRedux.useSelector(channelsForForwardSelector) || [];
  var searchedChannels = reactRedux.useSelector(searchedChannelsForForwardSelector) || [];
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var getFromContacts = getShowOnlyContactUsers();
  var channelsLoading = reactRedux.useSelector(channelsLoadingStateForForwardSelector);
  var channelsHasNext = reactRedux.useSelector(channelsForForwardHasNextSelector);

  var _useState = React.useState(''),
      searchValue = _useState[0],
      setSearchValue = _useState[1];

  var _useState2 = React.useState(0),
      selectedChannelsContHeight = _useState2[0],
      setSelectedChannelsHeight = _useState2[1];

  var _useState3 = React.useState([]),
      selectedChannels = _useState3[0],
      setSelectedChannels = _useState3[1];

  var _useState4 = React.useState([]),
      channelIds = _useState4[0],
      setChannelIds = _useState4[1];

  var selectedChannelsContRef = React.useRef();

  var handleForwardMessage = function handleForwardMessage() {
    handleForward(channelIds);
    togglePopup();
  };

  var handleChannelListScroll = function handleChannelListScroll(event) {
    if (event.target.scrollTop >= event.target.scrollHeight - event.target.offsetHeight - 100) {
      if (channelsLoading === LOADING_STATE.LOADED && channelsHasNext) {
        dispatch(loadMoreChannelsForForward(15));
      }
    }
  };

  var handleChoseChannel = function handleChoseChannel(e, channelId) {
    if (e.target.checked) {
      setChannelIds(function (prevState) {
        return [].concat(prevState, [channelId]);
      });
    }
  };

  var handleSearchValueChange = function handleSearchValueChange(e) {
    var value = e.target.value;
    setSearchValue(value);
  };

  var getMyChannels = function getMyChannels() {
    setSearchValue('');
  };

  var handleChannelSelect = function handleChannelSelect(event, channel) {
    var newSelectedChannels = [].concat(selectedChannels);
    var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
    var directChannelUser = isDirectChannel && channel.members.find(function (member) {
      return member.id !== user.id;
    });

    if (event.target.checked && selectedChannels.length < 5) {
      newSelectedChannels.push({
        id: channel.id,
        displayName: channel.subject || (isDirectChannel && directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : '')
      });
    } else {
      var itemToDeleteIndex = newSelectedChannels.findIndex(function (chan) {
        return channel.id === chan.id;
      });

      if (itemToDeleteIndex >= 0) {
        newSelectedChannels.splice(itemToDeleteIndex, 1);
      }
    }

    setSearchValue('');
    setSelectedChannels(newSelectedChannels);
  };

  var removeChannel = function removeChannel(channel) {
    var newSelectedChannels = [].concat(selectedChannels);
    var itemToDeleteIndex = newSelectedChannels.findIndex(function (c) {
      return channel.id === c.id;
    });

    if (itemToDeleteIndex >= 0) {
      newSelectedChannels.splice(itemToDeleteIndex, 1);
    }

    setSelectedChannels(newSelectedChannels);
  };

  React.useEffect(function () {
    if (selectedChannelsContRef.current) {
      setSelectedChannelsHeight(selectedChannelsContRef.current.offsetHeight);
    } else {
      setSelectedChannelsHeight(0);
    }
  }, [selectedChannels]);
  React.useEffect(function () {
    dispatch(getChannelsForForwardAC());
    return function () {
      dispatch(setSearchedChannelsForForwardAC({
        chats_groups: [],
        channels: [],
        contacts: []
      }));
    };
  }, []);
  React.useEffect(function () {
    if (searchValue) {
      dispatch(searchChannelsForForwardAC({
        search: searchValue
      }, contactsMap));
    } else {
      dispatch(setSearchedChannelsForForwardAC({
        chats_groups: [],
        channels: [],
        contacts: []
      }));
    }
  }, [searchValue]);
  return /*#__PURE__*/React__default.createElement(PopupContainer, null, /*#__PURE__*/React__default.createElement(Popup, {
    maxWidth: '522px',
    minWidth: '522px',
    height: '540px',
    isLoading: loading,
    padding: '0'
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '24px',
    paddingV: '24px',
    withFooter: true
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    onClick: function onClick() {
      return togglePopup();
    }
  }), /*#__PURE__*/React__default.createElement(PopupName, {
    isDelete: true,
    marginBottom: '20px'
  }, title), /*#__PURE__*/React__default.createElement(ChannelSearch, {
    searchValue: searchValue,
    handleSearchValueChange: handleSearchValueChange,
    getMyChannels: getMyChannels
  }), /*#__PURE__*/React__default.createElement(SelectedChannelsContainer, {
    ref: selectedChannelsContRef
  }, selectedChannels.map(function (channel) {
    return /*#__PURE__*/React__default.createElement(SelectedChannelBuble, {
      key: "selected-" + channel.id
    }, /*#__PURE__*/React__default.createElement(SelectedChannelName, null, channel.displayName), /*#__PURE__*/React__default.createElement(StyledSubtractSvg$1, {
      onClick: function onClick() {
        return removeChannel(channel);
      }
    }));
  })), /*#__PURE__*/React__default.createElement(ForwardChannelsCont, {
    onScroll: handleChannelListScroll,
    selectedChannelsHeight: selectedChannelsContHeight
  }, searchValue ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !!(searchedChannels.chats_groups && searchedChannels.chats_groups.length) && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(ChannelsGroupTitle, {
    margin: '0 0 12px'
  }, "Chats & Groups"), searchedChannels.chats_groups.map(function (channel) {
    var isSelected = selectedChannels.findIndex(function (chan) {
      return chan.id === channel.id;
    }) >= 0;
    var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
    var directChannelUser = isDirectChannel && channel.members.find(function (member) {
      return member.id !== user.id;
    });
    return /*#__PURE__*/React__default.createElement(ChannelItem, {
      key: channel.id,
      onClick: function onClick(e) {
        return handleChoseChannel(e, channel.id);
      }
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      name: directChannelUser ? directChannelUser.firstName || directChannelUser.id : channel.subject || '',
      image: directChannelUser ? directChannelUser.avatarUrl : channel.avatarUrl,
      size: 40,
      textSize: 12,
      setDefaultAvatar: true
    }), /*#__PURE__*/React__default.createElement(ChannelInfo$3, null, /*#__PURE__*/React__default.createElement(ChannelTitle, null, isDirectChannel ? directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : 'Deleted User' : channel.subject), /*#__PURE__*/React__default.createElement(ChannelMembers, null, directChannelUser ? (hideUserPresence && hideUserPresence(directChannelUser) ? '' : directChannelUser.presence && directChannelUser.presence.state === USER_PRESENCE_STATUS.ONLINE) ? 'Online' : directChannelUser && directChannelUser.presence && directChannelUser.presence.lastActiveAt && userLastActiveDateFormat(directChannelUser.presence.lastActiveAt) : '')), /*#__PURE__*/React__default.createElement(CustomCheckbox, {
      index: channel.id,
      disabled: selectedChannels.length >= 5 && !isSelected,
      state: isSelected,
      onChange: function onChange(e) {
        return handleChannelSelect(e, channel);
      },
      size: '18px'
    }));
  })), !!(searchedChannels.channels && searchedChannels.channels.length) && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(ChannelsGroupTitle, null, "Channels"), searchedChannels.channels.map(function (channel) {
    var isSelected = selectedChannels.findIndex(function (chan) {
      return chan.id === channel.id;
    }) >= 0;
    return /*#__PURE__*/React__default.createElement(ChannelItem, {
      key: channel.id,
      onClick: function onClick(e) {
        return handleChoseChannel(e, channel.id);
      }
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      name: channel.subject || '',
      image: channel.avatarUrl,
      size: 40,
      textSize: 12,
      setDefaultAvatar: false
    }), /*#__PURE__*/React__default.createElement(ChannelInfo$3, null, /*#__PURE__*/React__default.createElement(ChannelTitle, null, channel.subject), /*#__PURE__*/React__default.createElement(ChannelMembers, null, channel.memberCount + " " + (channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? channel.memberCount > 1 ? 'subscribers' : 'subscriber' : channel.memberCount > 1 ? 'members' : 'member') + " ")), /*#__PURE__*/React__default.createElement(CustomCheckbox, {
      index: channel.id,
      disabled: selectedChannels.length >= 5 && !isSelected,
      state: isSelected,
      onChange: function onChange(e) {
        return handleChannelSelect(e, channel);
      },
      size: '18px'
    }));
  }))) : channels.map(function (channel) {
    var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
    var directChannelUser = isDirectChannel && channel.members.find(function (member) {
      return member.id !== user.id;
    });
    var isSelected = selectedChannels.findIndex(function (chan) {
      return chan.id === channel.id;
    }) >= 0;
    return /*#__PURE__*/React__default.createElement(ChannelItem, {
      key: channel.id,
      onClick: function onClick(e) {
        return handleChoseChannel(e, channel.id);
      }
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      name: channel.subject || (isDirectChannel && directChannelUser ? directChannelUser.firstName || directChannelUser.id : ''),
      image: channel.avatarUrl || (isDirectChannel && directChannelUser ? directChannelUser.avatarUrl : ''),
      size: 40,
      textSize: 12,
      setDefaultAvatar: isDirectChannel
    }), /*#__PURE__*/React__default.createElement(ChannelInfo$3, null, /*#__PURE__*/React__default.createElement(ChannelTitle, null, channel.subject || (isDirectChannel && directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : '')), /*#__PURE__*/React__default.createElement(ChannelMembers, null, isDirectChannel && directChannelUser ? (hideUserPresence && hideUserPresence(directChannelUser) ? '' : directChannelUser.presence && directChannelUser.presence.state === USER_PRESENCE_STATUS.ONLINE) ? 'Online' : directChannelUser && directChannelUser.presence && directChannelUser.presence.lastActiveAt && userLastActiveDateFormat(directChannelUser.presence.lastActiveAt) : channel.memberCount + " " + (channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? channel.memberCount > 1 ? 'subscribers' : 'subscriber' : channel.memberCount > 1 ? 'members' : 'member') + " ")), /*#__PURE__*/React__default.createElement(CustomCheckbox, {
      index: channel.id,
      disabled: selectedChannels.length >= 5 && !isSelected,
      state: isSelected,
      onChange: function onChange(e) {
        return handleChannelSelect(e, channel);
      },
      size: '18px'
    }));
  }))), /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: function onClick() {
      return togglePopup();
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    backgroundColor: colors.primary,
    borderRadius: '8px',
    onClick: handleForwardMessage
  }, buttonText || 'Forward'))));
}
var ForwardChannelsCont = styled__default.div(_templateObject$s || (_templateObject$s = _taggedTemplateLiteralLoose(["\n  overflow-y: auto;\n  margin-top: 16px;\n  max-height: ", ";\n  padding-right: 22px;\n"])), function (props) {
  return "calc(100% - " + (props.selectedChannelsHeight + 64) + "px)";
});
var ChannelItem = styled__default.div(_templateObject2$o || (_templateObject2$o = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  margin-bottom: 8px;\n"])));
var ChannelInfo$3 = styled__default.div(_templateObject3$i || (_templateObject3$i = _taggedTemplateLiteralLoose(["\n  margin-left: 12px;\n  margin-right: auto;\n  max-width: calc(100% - 74px);\n"])));
var ChannelsGroupTitle = styled__default.h4(_templateObject4$f || (_templateObject4$f = _taggedTemplateLiteralLoose(["\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 14px;\n  margin: ", ";\n  color: ", ";\n"])), function (props) {
  return props.margin || '20px 0 12px';
}, colors.textColor2);
var ChannelTitle = styled__default.h3(_templateObject5$d || (_templateObject5$d = _taggedTemplateLiteralLoose(["\n  margin: 0 0 2px;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  color: ", ";\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n"])), colors.textColor1);
var ChannelMembers = styled__default.h4(_templateObject6$b || (_templateObject6$b = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  font-weight: 400;\n  font-size: 14px;\n  line-height: 16px;\n  letter-spacing: -0.078px;\n  color: ", ";\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n"])), colors.textColor2);
var SelectedChannelsContainer = styled__default.div(_templateObject7$9 || (_templateObject7$9 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: flex-start;\n  flex-wrap: wrap;\n  width: 100%;\n  max-height: 85px;\n  overflow-x: hidden;\n  padding-top: 2px;\n  box-sizing: border-box;\n  //flex: 0 0 auto;\n"])));
var SelectedChannelBuble = styled__default.div(_templateObject8$8 || (_templateObject8$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: space-between;\n  background: ", ";\n  border-radius: 16px;\n  align-items: center;\n  padding: 4px 10px;\n  height: 26px;\n  margin: 8px 8px 0 0;\n  box-sizing: border-box;\n"])), colors.backgroundColor);
var SelectedChannelName = styled__default.span(_templateObject9$8 || (_templateObject9$8 = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 16px;\n  color: ", ";\n"])), colors.textColor1);
var StyledSubtractSvg$1 = styled__default(SvgCross)(_templateObject10$7 || (_templateObject10$7 = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  margin-left: 4px;\n  transform: translate(2px, 0);\n"])));

var LOADING_STATE$1 = {
  LOADING: 1,
  LOADED: 2
};
var USER_PRESENCE_STATUS$1 = {
  OFFLINE: 'offline',
  ONLINE: 'online'
};

var _templateObject$t, _templateObject2$p, _templateObject3$j, _templateObject4$g, _templateObject5$e, _templateObject6$c, _templateObject7$a, _templateObject8$9, _templateObject9$9, _templateObject10$8;
var reactionsPrevLength = 0;
function ReactionsPopup(_ref) {
  var messageId = _ref.messageId,
      handleReactionsPopupClose = _ref.handleReactionsPopupClose,
      handleAddDeleteEmoji = _ref.handleAddDeleteEmoji,
      bottomPosition = _ref.bottomPosition,
      reactionTotals = _ref.reactionTotals,
      reactionsDetailsPopupBorderRadius = _ref.reactionsDetailsPopupBorderRadius,
      reactionsDetailsPopupHeaderItemsStyle = _ref.reactionsDetailsPopupHeaderItemsStyle,
      rtlDirection = _ref.rtlDirection;
  var popupRef = React.useRef(null);
  var reactions = reactRedux.useSelector(reactionsListSelector, reactRedux.shallowEqual);
  var messageInputHeight = reactRedux.useSelector(sendMessageInputHeightSelector, reactRedux.shallowEqual);
  var reactionsHasNext = reactRedux.useSelector(reactionsHasNextSelector, reactRedux.shallowEqual);
  var reactionsLoadingState = reactRedux.useSelector(reactionsLoadingStateSelector, reactRedux.shallowEqual);
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var getFromContacts = getShowOnlyContactUsers();

  var _useState = React.useState('all'),
      activeTabKey = _useState[0],
      setActiveTabKey = _useState[1];

  var _useState2 = React.useState(''),
      popupVerticalPosition = _useState2[0],
      setPopupVerticalPosition = _useState2[1];

  var _useState3 = React.useState(0),
      popupHeight = _useState3[0],
      setPopupHeight = _useState3[1];

  var _useState4 = React.useState(false),
      calculateSizes = _useState4[0],
      setCalculateSizes = _useState4[1];

  var _useState5 = React.useState(false),
      closeIsApproved = _useState5[0],
      setCloseIsApproved = _useState5[1];

  var totalReactions = 0;
  console.log('reactionTotals. . . . ', reactionTotals);

  if (reactionTotals) {
    reactionTotals.forEach(function (summery) {
      totalReactions += summery.count;
    });
  }

  var user = getClient().user;
  var dispatch = reactRedux.useDispatch();

  var handleReactionsListScroll = function handleReactionsListScroll(event) {
    if (event.target.scrollTop >= event.target.scrollHeight - event.target.offsetHeight - 100 && reactionsHasNext) {
      if (reactionsLoadingState === LOADING_STATE$1.LOADED) {
        dispatch(loadMoreReactionsAC(15));
      }
    }
  };

  var handleClicks = function handleClicks(e) {
    if (e.target.closest('.reactions_popup')) {
      return;
    }

    if (closeIsApproved) {
      handleReactionsPopupClose();
    }
  };

  var handleGetReactions = function handleGetReactions(key) {
    dispatch(getReactionsAC(messageId, key));
    setActiveTabKey(key || 'all');
  };

  useEventListener('click', handleClicks);
  React.useEffect(function () {
    handleGetReactions();
    setCloseIsApproved(true);
    setCalculateSizes(true);
    return function () {
      dispatch(setReactionsListAC([], true));
    };
  }, [messageId]);
  React.useEffect(function () {
    if (!reactionTotals || !reactionTotals.length) {
      handleReactionsPopupClose();
    }
  }, [reactionTotals]);
  React.useEffect(function () {
    if (reactions && reactionsPrevLength < reactions.length) {
      var reactionsHeight = reactions.length * 44 + 45;

      if (reactionsHeight > popupHeight) {
        setPopupHeight(reactionsHeight);
      }

      reactionsPrevLength = reactions.length;
    } else {
      reactionsPrevLength = !reactions ? 0 : reactions.length;
    }

    if (reactions && reactions.length) {
      if (calculateSizes) {
        var botPost = bottomPosition - messageInputHeight - 40;

        var _reactionsHeight = reactions.length * 44 + 45;

        setPopupHeight(_reactionsHeight);
        setPopupVerticalPosition(botPost >= (_reactionsHeight > 320 ? 320 : _reactionsHeight) ? 'bottom' : 'top');
        setCalculateSizes(false);
      }
    }
  }, [reactions]);
  return /*#__PURE__*/React__default.createElement(Container$d, {
    ref: popupRef,
    popupVerticalPosition: popupVerticalPosition,
    className: 'reactions_popup',
    height: popupHeight,
    visible: !calculateSizes,
    rtlDirection: rtlDirection,
    borderRadius: reactionsDetailsPopupBorderRadius
  }, /*#__PURE__*/React__default.createElement(ReactionScoresCont, null, /*#__PURE__*/React__default.createElement(ReactionScoresList, {
    borderBottom: reactionsDetailsPopupHeaderItemsStyle !== 'bubbles'
  }, /*#__PURE__*/React__default.createElement(ReactionScoreItem, {
    bubbleStyle: reactionsDetailsPopupHeaderItemsStyle === 'bubbles',
    active: activeTabKey === 'all',
    activeColor: colors.primary,
    onClick: function onClick() {
      return handleGetReactions();
    }
  }, /*#__PURE__*/React__default.createElement("span", null, "All " + totalReactions)), reactionTotals.map(function (reaction) {
    return /*#__PURE__*/React__default.createElement(ReactionScoreItem, {
      bubbleStyle: reactionsDetailsPopupHeaderItemsStyle === 'bubbles',
      key: reaction.key,
      onClick: function onClick() {
        return handleGetReactions(reaction.key);
      },
      active: activeTabKey === reaction.key,
      activeColor: colors.primary
    }, /*#__PURE__*/React__default.createElement("span", null, /*#__PURE__*/React__default.createElement(TabKey, null, reaction.key), reaction.count));
  }))), /*#__PURE__*/React__default.createElement(ReactionsList, {
    onScroll: handleReactionsListScroll,
    popupHeight: popupHeight
  }, reactions.map(function (reaction) {
    return /*#__PURE__*/React__default.createElement(ReactionItem$1, {
      key: reaction.id
    }, /*#__PURE__*/React__default.createElement(AvatarWrapper, null, /*#__PURE__*/React__default.createElement(Avatar, {
      name: reaction.user.firstName || reaction.user.id,
      image: reaction.user.avatarUrl,
      size: 40,
      textSize: 14,
      setDefaultAvatar: true
    })), /*#__PURE__*/React__default.createElement(UserNamePresence$1, null, /*#__PURE__*/React__default.createElement(MemberName$1, null, makeUsername(reaction.user.id === user.id ? reaction.user : contactsMap[reaction.user.id], reaction.user, getFromContacts)), /*#__PURE__*/React__default.createElement(SubTitle, null, reaction.user.presence && reaction.user.presence.state === USER_PRESENCE_STATUS$1.ONLINE ? 'Online' : reaction.user.presence && reaction.user.presence.lastActiveAt && userLastActiveDateFormat(reaction.user.presence.lastActiveAt))), /*#__PURE__*/React__default.createElement(ReactionKey, {
      onClick: function onClick() {
        return handleAddDeleteEmoji(reaction.key);
      }
    }, reaction.key));
  })));
}
var Container$d = styled__default.div(_templateObject$t || (_templateObject$t = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  /*right: ", ";*/\n  right: ", ";\n  /*left: ", ";*/\n  left: ", ";\n  top: ", ";\n  bottom: ", ";\n  width: 340px;\n  height: ", "px;\n  //overflow: ", ";\n  overflow: hidden;\n  max-height: 320px;\n  background: #ffffff;\n  //border: 1px solid #dfe0eb;\n  box-shadow: 0 6px 24px -6px rgba(15, 34, 67, 0.12), 0px 1px 3px rgba(24, 23, 37, 0.14);\n  box-sizing: border-box;\n  //box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);\n  border-radius: ", ";\n  visibility: ", ";\n  transition: all 0.2s;\n\n  direction: initial;\n  z-index: 12;\n  &::after {\n    content: '';\n    position: absolute;\n    width: 12px;\n    height: 12px;\n\n    right: ", ";\n    left: ", ";\n    top: ", ";\n    bottom: ", ";\n    transform: rotate(45deg);\n    box-shadow: ", ";\n    border-radius: 2px;\n    visibility: ", ";\n    transition-delay: 150ms;\n    transition-property: visibility;\n\n    background: ", ";\n  }\n"])), function (props) {
  return props.popupHorizontalPosition === 'left' && (props.rtlDirection ? 'calc(100% - 80px)' : 0);
}, function (props) {
  return props.rtlDirection && 0;
}, function (props) {
  return props.popupHorizontalPosition === 'right' && (!props.rtlDirection ? 'calc(100% - 80px)' : 0);
}, function (props) {
  return !props.rtlDirection && 0;
}, function (props) {
  return props.popupVerticalPosition === 'bottom' && '100%';
}, function (props) {
  return props.popupVerticalPosition === 'top' && '42px';
}, function (props) {
  return props.height && props.height + 22;
}, function (props) {
  return !props.height && 'hidden';
}, function (props) {
  return props.borderRadius || '12px';
}, function (props) {
  return props.visible ? 'visible' : 'hidden';
}, function (props) {
  return props.popupHorizontalPosition === 'left' && '18px';
}, function (props) {
  return props.popupHorizontalPosition === 'right' && '18px';
}, function (props) {
  return props.popupVerticalPosition === 'bottom' && '-3px;';
}, function (props) {
  return props.popupVerticalPosition === 'top' && '-3px';
}, function (props) {
  return props.popupVerticalPosition === 'top' ? '4px 4px 5px -4px rgba(15, 34, 67, 0.12)' : '-4px -4px 5px -4px rgba(15, 34, 67, 0.12)';
}, function (props) {
  return props.visible ? 'visible' : 'hidden';
}, colors.white);
var UserNamePresence$1 = styled__default.div(_templateObject2$p || (_templateObject2$p = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  margin-left: 12px;\n"])));
var MemberName$1 = styled__default.h3(_templateObject3$j || (_templateObject3$j = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  max-width: calc(100% - 1px);\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  & > span {\n    color: #abadb7;\n  }\n"])));
var ReactionsList = styled__default.ul(_templateObject4$g || (_templateObject4$g = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  padding: 0;\n  overflow: ", ";\n  overflow-x: hidden;\n  list-style: none;\n  transition: all 0.2s;\n  height: calc(100% - 45px); ;\n"])), function (props) {
  return !props.popupHeight && 'hidden';
});
var ReactionScoresCont = styled__default.div(_templateObject5$e || (_templateObject5$e = _taggedTemplateLiteralLoose(["\n  max-width: 100%;\n  overflow-y: auto;\n"])));
var ReactionScoresList = styled__default.div(_templateObject6$c || (_templateObject6$c = _taggedTemplateLiteralLoose(["\n  display: flex;\n  border-bottom: ", ";\n  padding: 2px 8px 0;\n"])), function (props) {
  return props.borderBottom && "1px solid " + colors.gray1;
});
var TabKey = styled__default.span(_templateObject7$a || (_templateObject7$a = _taggedTemplateLiteralLoose([""])));
var ReactionScoreItem = styled__default.div(_templateObject8$9 || (_templateObject8$9 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  white-space: nowrap;\n  padding: ", ";\n  font-weight: 500;\n  font-size: 13px;\n  border-bottom: ", ";\n  color: ", ";\n  margin-bottom: -1px;\n  cursor: pointer;\n  & > span {\n    position: relative;\n    border: ", ";\n    padding: ", ";\n    border-radius: 16px;\n    height: 30px;\n    box-sizing: border-box;\n    font-family: Inter, sans-serif;\n    font-style: normal;\n    font-weight: 600;\n    font-size: 14px;\n    line-height: ", ";\n    background-color: ", ";\n    color: ", ";\n    ", "\n\n    & ", " {\n      font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n        twemoji mozilla, segoe ui symbol;\n      margin-right: 4px;\n      font-size: 15px;\n    }\n  }\n"])), function (props) {
  return props.bubbleStyle ? '12px 4px' : '12px';
}, function (props) {
  return !props.bubbleStyle && "1px solid " + colors.gray1;
}, function (props) {
  return props.active ? colors.textColor1 : colors.textColor2;
}, function (props) {
  return props.bubbleStyle && !props.active && "1px solid " + colors.gray1;
}, function (props) {
  return props.bubbleStyle && '6px 12px';
}, function (props) {
  return props.bubbleStyle ? '18px' : '30px';
}, function (props) {
  return props.active && props.bubbleStyle && colors.primary;
}, function (props) {
  return props.active && props.bubbleStyle && colors.white;
}, function (props) {
  return props.active && !props.bubbleStyle && "\n    &::after {\n    content: '';\n    position: absolute;\n    left: 0;\n    bottom: -13px;\n    width: 100%;\n    height: 2px;\n    background-color: " + (props.activeColor || colors.primary) + ";\n    border-radius: 2px;\n    }\n  ";
}, TabKey);
var ReactionKey = styled__default.span(_templateObject9$9 || (_templateObject9$9 = _taggedTemplateLiteralLoose(["\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n  font-size: 20px;\n  cursor: pointer;\n"])));
var ReactionItem$1 = styled__default.li(_templateObject10$8 || (_templateObject10$8 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  font-size: 15px;\n  padding: 6px 16px;\n  transition: all 0.2s;\n\n  & ", " {\n    width: 10px;\n    height: 10px;\n  }\n"])), UserStatus);

var _path$V;

function _extends$W() {
  _extends$W = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$W.apply(this, arguments);
}

function SvgEmojiAnimalIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$W({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$V || (_path$V = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M7.188 3.875a.813.813 0 100 1.625.813.813 0 000-1.625zm-2.313.813a2.312 2.312 0 114.625 0 2.312 2.312 0 01-4.625 0zm7.938-.813a.813.813 0 100 1.625.813.813 0 000-1.625zm-2.313.813a2.312 2.312 0 114.625 0 2.312 2.312 0 01-4.625 0zM3.437 7.624a.813.813 0 100 1.625.813.813 0 000-1.625zm-2.312.813a2.312 2.312 0 114.625 0 2.312 2.312 0 01-4.625 0zm15.438-.813a.813.813 0 100 1.625.813.813 0 000-1.625zm-2.313.813a2.312 2.312 0 114.625 0 2.312 2.312 0 01-4.625 0zm-6.393-.359a3.563 3.563 0 015.567 1.862c.193.672.643 1.24 1.252 1.582a3.25 3.25 0 01-1.548 6.102h-.002c-.435 0-.864-.086-1.265-.253a4.859 4.859 0 00-3.722 0h.001a3.28 3.28 0 01-1.265.253h-.003a3.25 3.25 0 01-1.548-6.101A2.657 2.657 0 006.576 9.94a3.563 3.563 0 011.28-1.862zM10 8.863a2.062 2.062 0 00-1.982 1.493 4.156 4.156 0 01-1.964 2.478l-.008.004a1.75 1.75 0 001.517 3.15l.001-.001a6.358 6.358 0 014.872 0h.001a1.75 1.75 0 001.516-3.15l-.007-.003a4.156 4.156 0 01-1.964-2.478A2.062 2.062 0 0010 8.863z",
    fill: "CurrentColor"
  })));
}

var _path$W, _path2$5, _path3$2;

function _extends$X() {
  _extends$X = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$X.apply(this, arguments);
}

function SvgEmojiFoodIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$X({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$W || (_path$W = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M12.143 7.855c0-.395.32-.714.714-.714.779 0 1.501.261 2.033.779.535.52.824 1.249.824 2.078a.714.714 0 11-1.428 0c0-.49-.165-.833-.392-1.054-.23-.224-.579-.375-1.037-.375a.714.714 0 01-.714-.714z",
    fill: "CurrentColor"
  })), _path2$5 || (_path2$5 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.083 2.222c-.616.616-.81 1.522-.797 2.367a6.008 6.008 0 00-1.905-.306c-3.438 0-5.952 2.45-5.952 5.858 0 1.644.588 3.698 1.574 5.35.968 1.622 2.465 3.08 4.378 3.08a5.98 5.98 0 002.62-.596 5.98 5.98 0 002.618.597c1.914 0 3.41-1.46 4.378-3.081.986-1.652 1.574-3.706 1.574-5.35 0-3.208-2.229-5.568-5.36-5.833.223-.434.307-.893.34-1.244.049-.518-.016-1.016-.09-1.528-.513-.072-1.01-.14-1.528-.09-.524.048-1.288.213-1.85.776zM7.38 5.712c-2.674 0-4.524 1.835-4.524 4.43 0 1.356.503 3.16 1.372 4.616.887 1.486 2.01 2.385 3.152 2.385.758 0 1.454-.178 2.075-.492a1.206 1.206 0 011.088 0 4.55 4.55 0 002.075.492c1.142 0 2.265-.899 3.152-2.385.869-1.456 1.372-3.26 1.372-4.617 0-2.594-1.85-4.43-4.524-4.43a4.57 4.57 0 00-2.073.493 1.206 1.206 0 01-1.09 0 4.551 4.551 0 00-2.075-.492zm3.341-1.437c.362-.026.776-.105 1.043-.37.265-.267.344-.682.37-1.043-.361.026-.776.104-1.042.37-.266.267-.345.681-.37 1.043z",
    fill: "CurrentColor"
  })), _path3$2 || (_path3$2 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M12.857 7.14a.714.714 0 000 1.43c.458 0 .807.15 1.037.374.227.221.392.565.392 1.054a.714.714 0 101.428 0c0-.83-.289-1.557-.824-2.078-.532-.518-1.254-.78-2.033-.78z",
    fill: "CurrentColor"
  })));
}

var _path$X;

function _extends$Y() {
  _extends$Y = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$Y.apply(this, arguments);
}

function SvgEmojiTravelIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$Y({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$X || (_path$X = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M13.763 2.458a2.6 2.6 0 013.748 3.604l-2.135 2.236a5.065 5.065 0 00-.188.204.076.076 0 00-.004.017l.004.03c.008.05.024.116.053.241l1.327 5.754.012.05c.044.189.096.412.079.639-.015.197-.07.39-.162.564-.106.202-.268.364-.406.5l-.036.037-.306.306c-.215.215-.409.408-.58.55-.175.147-.406.309-.705.362a1.46 1.46 0 01-1.124-.266c-.244-.18-.378-.429-.47-.638-.089-.204-.175-.464-.272-.752l-1.2-3.6-1.779 1.78a4.815 4.815 0 00-.172.178.076.076 0 00-.005.015l.001.027c.003.045.01.105.022.22l.141 1.27.005.045c.02.168.042.368.01.567a1.46 1.46 0 01-.172.49c-.1.176-.242.317-.362.437l-.032.032-.152.151-.018.019c-.166.166-.32.32-.46.438-.15.125-.338.258-.583.322a1.46 1.46 0 01-1.007-.1 1.49 1.49 0 01-.508-.43c-.114-.142-.236-.325-.366-.52l-1.22-1.83a4.929 4.929 0 00-.063-.09l-.009-.006a4.655 4.655 0 00-.077-.052l-1.829-1.22a7.783 7.783 0 01-.52-.365 1.492 1.492 0 01-.43-.509 1.46 1.46 0 01-.1-1.006c.065-.245.197-.434.323-.584.117-.14.272-.294.438-.46l.018-.018.152-.152.031-.032c.12-.12.262-.262.437-.362.152-.086.318-.145.49-.172a2.09 2.09 0 01.568.01l.044.005 1.27.141a4.747 4.747 0 00.247.023.075.075 0 00.015-.005 4.867 4.867 0 00.178-.172l1.78-1.78-3.6-1.199a9.48 9.48 0 01-.752-.272c-.209-.092-.457-.226-.638-.47a1.46 1.46 0 01-.265-1.124c.053-.298.215-.53.36-.705.143-.171.337-.365.552-.58l.02-.02.285-.285.037-.037c.136-.137.298-.3.5-.406a1.46 1.46 0 01.564-.161c.228-.018.45.034.64.078l.05.012 5.731 1.323a5.096 5.096 0 00.275.057.075.075 0 00.019-.005 5.146 5.146 0 00.199-.197l2.082-2.152zm2.728.948a1.216 1.216 0 00-1.734.014l-2.082 2.151-.036.037c-.132.137-.288.3-.483.407a1.46 1.46 0 01-.602.178c-.223.016-.442-.036-.627-.079l-.05-.011L5.146 4.78a5.06 5.06 0 00-.279-.059.077.077 0 00-.017.005 5.065 5.065 0 00-.205.197l-.285.285c-.243.243-.39.392-.487.508a.915.915 0 00-.063.083c0 .006.002.012.004.018.016.01.045.025.094.046.138.06.337.128.662.236l4.633 1.544a.692.692 0 01.27 1.146l-2.57 2.57-.032.032c-.12.12-.261.262-.436.362a1.459 1.459 0 01-.492.172 2.09 2.09 0 01-.567-.01l-.044-.005-1.27-.141a4.747 4.747 0 00-.247-.023.075.075 0 00-.015.005 4.867 4.867 0 00-.178.172l-.152.152c-.19.19-.301.302-.375.39a.735.735 0 00-.045.058c0 .008 0 .015.002.023.01.009.027.025.056.048.09.072.22.16.444.309l1.808 1.205.015.01a1.466 1.466 0 01.507.507l.01.016 1.206 1.807c.15.225.237.355.308.444.024.03.04.047.049.056a.076.076 0 00.022.002.723.723 0 00.059-.045c.087-.073.199-.184.39-.375l.151-.151a4.89 4.89 0 00.172-.178.077.077 0 00.005-.016v-.026a4.94 4.94 0 00-.023-.22l-.14-1.27-.006-.045a2.091 2.091 0 01-.01-.567 1.46 1.46 0 01.172-.491c.1-.175.242-.317.363-.437l.031-.031 2.57-2.57a.692.692 0 011.146.27L13.9 15.43c.109.325.175.523.236.662a.9.9 0 00.046.093.073.073 0 00.019.004.917.917 0 00.083-.063c.116-.096.264-.244.507-.486l.285-.285a5.078 5.078 0 00.197-.206.073.073 0 00.005-.017 5.042 5.042 0 00-.058-.279l-1.328-5.753-.011-.049c-.044-.184-.095-.401-.079-.624a1.46 1.46 0 01.152-.553c.1-.199.255-.36.386-.496l.034-.037 2.136-2.236a1.216 1.216 0 00-.02-1.7z",
    fill: "CurrentColor"
  })));
}

var _g, _defs$1;

function _extends$Z() {
  _extends$Z = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$Z.apply(this, arguments);
}

function SvgEmojiObjectIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$Z({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _g || (_g = /*#__PURE__*/React.createElement("g", {
    clipPath: "url(#emojiObjectIcon_svg__clip0_1048_8610)"
  }, /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 .917a.75.75 0 01.75.75V2.5a.75.75 0 01-1.5 0v-.833a.75.75 0 01.75-.75zM3.553 3.553a.75.75 0 011.06 0l.5.5a.75.75 0 11-1.06 1.061l-.5-.5a.75.75 0 010-1.06zm12.894 0a.75.75 0 010 1.061l-.5.5a.75.75 0 11-1.06-1.06l.5-.5a.75.75 0 011.06 0zM10 5.75a4.25 4.25 0 100 8.5 4.25 4.25 0 000-8.5zM4.25 10a5.75 5.75 0 118.167 5.22v1.447a2.417 2.417 0 01-4.834 0v-1.448A5.75 5.75 0 014.25 10zm4.833 5.678v.989a.917.917 0 101.834 0v-.99a5.795 5.795 0 01-1.834 0zM.917 10a.75.75 0 01.75-.75H2.5a.75.75 0 110 1.5h-.833a.75.75 0 01-.75-.75zm15.833 0a.75.75 0 01.75-.75h.833a.75.75 0 110 1.5H17.5a.75.75 0 01-.75-.75z",
    fill: "CurrentColor"
  }))), _defs$1 || (_defs$1 = /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("clipPath", {
    id: "emojiObjectIcon_svg__clip0_1048_8610"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "CurrentColor",
    d: "M0 0h20v20H0z"
  })))));
}

var _path$Y;

function _extends$_() {
  _extends$_ = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$_.apply(this, arguments);
}

function SvgEmojiSymbolsIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$_({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$Y || (_path$Y = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8.04 1.76a.75.75 0 01.616.863l-.548 3.294h5.146l.59-3.54a.75.75 0 111.48.246l-.55 3.294h2.31a.75.75 0 010 1.5h-2.56l-.86 5.167h2.586a.75.75 0 110 1.5h-2.837l-.59 3.54a.75.75 0 11-1.48-.247l.55-3.293H6.745l-.59 3.54a.75.75 0 11-1.48-.247l.55-3.293H2.083a.75.75 0 010-1.5h3.393l.86-5.167h-3.42a.75.75 0 110-1.5h3.67l.59-3.54a.75.75 0 01.864-.617zm-.182 5.657l-.862 5.167h5.146l.862-5.167H7.858z",
    fill: "CurrentColor"
  })));
}

var _path$Z;

function _extends$$() {
  _extends$$ = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$$.apply(this, arguments);
}

function SvgEmojiFlagicon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$$({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$Z || (_path$Z = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4.167 3.25a.917.917 0 00-.917.917v7.764c.288-.118.6-.181.917-.181h5.416a.75.75 0 01.53.22l.614.613h5.56L14.329 8.67a.75.75 0 010-.671l1.957-3.915H10.75V7.5a.75.75 0 01-1.5 0V3.25H4.167zm6.56-.667l-.613-.613a.75.75 0 00-.53-.22H4.166A2.417 2.417 0 001.75 4.167V17.5a.75.75 0 001.5 0v-3.333a.917.917 0 01.917-.917h5.106l.613.614c.141.14.332.22.53.22H17.5a.75.75 0 00.67-1.086l-2.332-4.665 2.333-4.664a.75.75 0 00-.671-1.086h-6.773z",
    fill: "CurrentColor"
  })));
}

var EMOJIS = [{
  key: 'People',
  array: [{
    key: 'face-smiling',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-affection',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'face-tongue',
    array: ['', '', '', '', '', '']
  }, {
    key: 'face-hand',
    array: ['', '', '', '']
  }, {
    key: 'face-neutral-skeptical',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-sleepy',
    array: ['', '', '', '', '']
  }, {
    key: 'face-unwell',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-hat',
    array: ['', '']
  }, {
    key: 'face-glasses',
    array: ['', '', '']
  }, {
    key: 'face-concerned',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-negative',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'face-costume',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'cat-face',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'monkey-face',
    array: ['', '', '']
  }, {
    key: 'emotion',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'hand-fingers-open',
    array: ['', '', '', '', '']
  }, {
    key: 'hand-fingers-partial',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'hand-single-finger',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hand-fingers-closed',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hands',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hand-prop',
    array: ['', '', '']
  }, {
    key: 'body-parts',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person-fantasy',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person-activity',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Animals',
  array: [{
    key: 'animal-mammal',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-bird',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-amphibian',
    array: ['']
  }, {
    key: 'animal-reptile',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'animal-marine',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-bug',
    array: ['', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'plant-flower',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'plant-other',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Food',
  array: [{
    key: 'food-fruit',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-vegetable',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-prepared',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-asian',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-marine',
    array: ['', '', '', '', '']
  }, {
    key: 'food-sweet',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'drink',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'dishware',
    array: ['', '', '', '', '', '', '']
  }]
}, {
  key: 'Travel',
  array: [{
    key: 'place-map',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'place-geographic',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'place-building',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'place-religious',
    array: ['', '', '', '', '', '']
  }, {
    key: 'place-other',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'transport-ground',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'transport-water',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'transport-air',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'hotel',
    array: ['', '']
  }, {
    key: 'time',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'sky weather',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Objects',
  array: [{
    key: 'event',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'award-medal',
    array: ['', '', '', '', '', '']
  }, {
    key: 'sport',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'game',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'arts crafts',
    array: ['', '', '', '', '']
  }, {
    key: 'clothing',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'sound',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'music',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'musical-instrument',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'phone',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'computer',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'light video',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'book-paper',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'money',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'mail',
    array: ['', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'writing',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'office',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'lock',
    array: ['', '', '', '', '', '']
  }, {
    key: 'tool',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'science',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'medical',
    array: ['', '', '', '', '']
  }, {
    key: 'household',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'other-object',
    array: ['', '', '', '']
  }]
}, {
  key: 'Flags',
  array: [{
    key: 'country-flag',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'subdivision-flag',
    array: ['', '', '']
  }]
}, {
  key: 'Symbols',
  array: [{
    key: 'transport-sign',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'warning',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'arrow',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'religion',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'zodiac',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'other-symbol',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}];

var _templateObject$u, _templateObject2$q, _templateObject3$k, _templateObject4$h, _templateObject5$f, _templateObject6$d, _templateObject7$b, _templateObject8$a;

var EmojiIcon = function EmojiIcon(_ref) {
  var collectionName = _ref.collectionName;

  switch (collectionName) {
    case 'People':
      return /*#__PURE__*/React__default.createElement(SvgEmojiSmileIcon, null);

    case 'Animals':
      return /*#__PURE__*/React__default.createElement(SvgEmojiAnimalIcon, null);

    case 'Food':
      return /*#__PURE__*/React__default.createElement(SvgEmojiFoodIcon, null);

    case 'Travel':
      return /*#__PURE__*/React__default.createElement(SvgEmojiTravelIcon, null);

    case 'Objects':
      return /*#__PURE__*/React__default.createElement(SvgEmojiObjectIcon, null);

    case 'Flags':
      return /*#__PURE__*/React__default.createElement(SvgEmojiFlagicon, null);

    case 'Symbols':
      return /*#__PURE__*/React__default.createElement(SvgEmojiSymbolsIcon, null);

    default:
      return null;
  }
};

function EmojisPopup(_ref2) {
  var handleAddEmoji = _ref2.handleAddEmoji,
      handleEmojiPopupToggle = _ref2.handleEmojiPopupToggle,
      rtlDirection = _ref2.rtlDirection,
      rightSide = _ref2.rightSide,
      bottomPosition = _ref2.bottomPosition,
      emojisContainerBorderRadius = _ref2.emojisContainerBorderRadius,
      _ref2$emojisCategoryI = _ref2.emojisCategoryIconsPosition,
      emojisCategoryIconsPosition = _ref2$emojisCategoryI === void 0 ? 'top' : _ref2$emojisCategoryI,
      fixEmojiCategoriesTitleOnTop = _ref2.fixEmojiCategoriesTitleOnTop,
      emojisPopupPosition = _ref2.emojisPopupPosition,
      relativePosition = _ref2.relativePosition;
  var theme = reactRedux.useSelector(themeSelector);

  var _useState = React.useState(false),
      rendered = _useState[0],
      setRendered = _useState[1];

  var _useState2 = React.useState('People'),
      activeCollection = _useState2[0],
      setActiveCollection = _useState2[1];

  var _useState3 = React.useState([]),
      collectionHeights = _useState3[0],
      setCollectionHeights = _useState3[1];

  var emojiContainerRef = React.useRef(null);
  var collectionsRef = React.useRef(EMOJIS.map(function (col) {
    return {
      collectionName: col.key,
      elem: /*#__PURE__*/React.createRef()
    };
  }));

  var handleEmojiListScroll = function handleEmojiListScroll() {
    var scrollPos = emojiContainerRef.current.scrollTop;

    if (collectionHeights[6] < scrollPos) {
      setActiveCollection('Symbols');
    } else if (collectionHeights[5] < scrollPos) {
      setActiveCollection('Flags');
    } else if (collectionHeights[4] < scrollPos) {
      setActiveCollection('Objects');
    } else if (collectionHeights[3] < scrollPos) {
      setActiveCollection('Travel');
    } else if (collectionHeights[2] < scrollPos) {
      setActiveCollection('Food');
    } else if (collectionHeights[1] < scrollPos) {
      setActiveCollection('Animals');
    } else {
      setActiveCollection('People');
    }
  };

  var chooseEmoji = function chooseEmoji(selectedEmoji) {
    handleAddEmoji(selectedEmoji);

    if (handleEmojiPopupToggle) {
      handleEmojiPopupToggle(false);
    }
  };

  var handleEmojiCollectionClick = function handleEmojiCollectionClick(mainCollection) {
    var collection = collectionsRef.current.find(function (el) {
      return el.collectionName === mainCollection;
    });
    var pos = collection.elem.current.offsetTop - 40;
    emojiContainerRef.current.scrollTo(0, pos);
  };

  React.useEffect(function () {
    setRendered(true);
    setTimeout(function () {
      if (emojiContainerRef.current) {
        var containerTop = emojiContainerRef.current.getBoundingClientRect().top + 10;
        var heights = collectionsRef.current.map(function (col) {
          return col.elem.current.getBoundingClientRect().top - 80 - containerTop;
        });
        setCollectionHeights(heights);
      }
    }, 300);
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$e, {
    backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    noBorder: theme === THEME.DARK,
    relativePosition: relativePosition,
    borderRadius: emojisContainerBorderRadius,
    rightSide: rightSide,
    id: 'emojisContainer',
    rtlDirection: rtlDirection,
    bottomPosition: bottomPosition,
    rendered: rendered,
    emojisPopupPosition: emojisPopupPosition
  }, emojisCategoryIconsPosition === 'top' && /*#__PURE__*/React__default.createElement(EmojiFooter, {
    borderColor: colors.hoverBackgroundColor,
    emojisCategoryIconsPosition: emojisCategoryIconsPosition
  }, EMOJIS.map(function (emoji) {
    return /*#__PURE__*/React__default.createElement(EmojiCollection, {
      activeCollection: activeCollection === emoji.key,
      key: "" + emoji.key,
      onClick: function onClick() {
        return handleEmojiCollectionClick(emoji.key);
      }
    }, /*#__PURE__*/React__default.createElement(EmojiIcon, {
      collectionName: emoji.key
    }));
  })), fixEmojiCategoriesTitleOnTop && /*#__PURE__*/React__default.createElement(EmojiHeader, {
    padding: emojisCategoryIconsPosition !== 'top' ? '10px 18px 6px' : ''
  }, getEmojisCategoryTitle(activeCollection)), /*#__PURE__*/React__default.createElement(EmojiSection, {
    ref: emojiContainerRef,
    onScroll: handleEmojiListScroll
  }, /*#__PURE__*/React__default.createElement(AllEmojis, null, EMOJIS.map(function (emojiBigCollection, bigColIndex) {
    var mainCollectionKey = emojiBigCollection.key;
    return /*#__PURE__*/React__default.createElement(React__default.Fragment, {
      key: mainCollectionKey
    }, !fixEmojiCategoriesTitleOnTop && /*#__PURE__*/React__default.createElement(EmojiHeader, {
      padding: '6px 8px 0'
    }, getEmojisCategoryTitle(mainCollectionKey)), emojiBigCollection.array.map(function (emojiSmallCollection, bigIndex) {
      var label = emojiSmallCollection.key;
      var array = emojiSmallCollection.array;
      return array.map(function (emoji, i) {
        return /*#__PURE__*/React__default.createElement(Emoji, {
          hoverBackgroundColor: colors.hoverBackgroundColor,
          key: "" + emoji,
          className: 'emoji-cont',
          onClick: function onClick() {
            return chooseEmoji(emoji);
          }
        }, bigIndex === 0 && i === 0 && /*#__PURE__*/React__default.createElement(CollectionPointer, {
          ref: collectionsRef.current[bigColIndex].elem,
          "data-emoji-sec": mainCollectionKey
        }), /*#__PURE__*/React__default.createElement("span", {
          className: 'emoji',
          role: 'img',
          "aria-label": label || '',
          "aria-hidden": label ? 'false' : 'true'
        }, emoji));
      });
    }));
  }))), emojisCategoryIconsPosition !== 'top' && /*#__PURE__*/React__default.createElement(EmojiFooter, null, EMOJIS.map(function (emoji) {
    return /*#__PURE__*/React__default.createElement(EmojiCollection, {
      activeCollection: activeCollection === emoji.key,
      key: "" + emoji.key,
      onClick: function onClick() {
        return handleEmojiCollectionClick(emoji.key);
      }
    }, /*#__PURE__*/React__default.createElement(EmojiIcon, {
      collectionName: emoji.key
    }));
  })));
}
var Container$e = styled__default.div(_templateObject$u || (_templateObject$u = _taggedTemplateLiteralLoose(["\n  position: ", ";\n  left: ", ";\n  right: ", ";\n  direction: ", ";\n  bottom: ", ";\n  width: 306px;\n  border: ", ";\n  box-sizing: border-box;\n  box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);\n  border-radius: ", ";\n  background: ", ";\n  z-index: 35;\n  //transform: scaleY(0);\n  height: 0;\n  overflow: hidden;\n  transform-origin: ", ";\n  transition: all 0.2s ease-in-out;\n  ", ";\n"])), function (props) {
  return props.relativePosition ? 'relative' : 'absolute';
}, function (props) {
  return props.rtlDirection ? '' : props.rightSide ? '' : '5px';
}, function (props) {
  return props.rtlDirection ? '0' : props.rightSide ? '65px' : '';
}, function (props) {
  return props.rtlDirection ? 'initial' : '';
}, function (props) {
  return props.bottomPosition;
}, function (props) {
  return props.noBorder ? 'none' : "1px solid " + colors.gray1;
}, function (props) {
  return props.borderRadius || '12px';
}, function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.emojisPopupPosition === 'bottom' ? '0 0' : '0 100%';
}, function (props) {
  return props.rendered && "\n    height: 225px;\n  ";
});
var EmojiHeader = styled__default.div(_templateObject2$q || (_templateObject2$q = _taggedTemplateLiteralLoose(["\n  align-items: flex-end;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 12px;\n  line-height: 22px;\n  text-transform: uppercase;\n  color: ", ";\n  display: flex;\n  padding: ", ";\n"])), colors.textColor2, function (props) {
  return props.padding || '6px 18px';
});
var EmojiSection = styled__default.div(_templateObject3$k || (_templateObject3$k = _taggedTemplateLiteralLoose(["\n  height: 180px;\n  overflow-x: hidden;\n\n  & ::selection {\n    color: inherit;\n    background: inherit;\n  }\n"])));
var EmojiCollection = styled__default.span(_templateObject4$h || (_templateObject4$h = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  & > * {\n    color: ", ";\n  }\n"])), function (props) {
  return props.activeCollection ? colors.primary : colors.textColor3;
});
var CollectionPointer = styled__default.span(_templateObject5$f || (_templateObject5$f = _taggedTemplateLiteralLoose([""])));
var AllEmojis = styled__default.ul(_templateObject6$d || (_templateObject6$d = _taggedTemplateLiteralLoose(["\n  overflow: hidden;\n  padding: 0 8px 8px;\n  margin: 0;\n"])));
var EmojiFooter = styled__default.div(_templateObject7$b || (_templateObject7$b = _taggedTemplateLiteralLoose(["\n  height: 42px;\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  border-top: ", ";\n  border-bottom: ", ";\n  padding: 0 10px;\n  & > span {\n    width: 100%;\n    text-align: center;\n  }\n"])), function (props) {
  return props.emojisCategoryIconsPosition !== 'top' && "1px solid " + (props.borderColor || colors.gray1);
}, function (props) {
  return props.emojisCategoryIconsPosition === 'top' && "1px solid " + (props.borderColor || colors.gray1);
});
var Emoji = styled__default.li(_templateObject8$a || (_templateObject8$a = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  width: 32px;\n  height: 32px;\n  margin: 0 2px;\n  display: inline-block;\n  box-sizing: border-box;\n  border-radius: 50%;\n  padding-top: 2px;\n  text-align: center;\n  background: transparent;\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n  & > * {\n    font-size: 22px;\n  }\n  &:hover {\n    background: ", ";\n  }\n"])), function (props) {
  return props.hoverBackgroundColor || colors.backgroundColor;
});

var _path$_;

function _extends$10() {
  _extends$10 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$10.apply(this, arguments);
}

function SvgPlus(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$10({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$_ || (_path$_ = /*#__PURE__*/React.createElement("path", {
    d: "M10 3.778c.43 0 .778.348.778.778v4.666h4.666a.778.778 0 110 1.556h-4.666v4.666a.778.778 0 11-1.556 0v-4.666H4.556a.778.778 0 110-1.556h4.666V4.556c0-.43.348-.778.778-.778z",
    fill: "#818C99"
  })));
}

var _templateObject$v, _templateObject2$r, _templateObject3$l;

function FrequentlyEmojis(_ref) {
  var handleAddEmoji = _ref.handleAddEmoji,
      handleEmojiPopupToggle = _ref.handleEmojiPopupToggle,
      frequentlyEmojis = _ref.frequentlyEmojis,
      rtlDirection = _ref.rtlDirection;
  var defaultEmojisMap = {
    '': {
      key: '',
      reacted: false
    },
    '': {
      key: '',
      reacted: false
    },
    '': {
      key: '',
      reacted: false
    },
    '': {
      key: '',
      reacted: false
    },
    '': {
      key: '',
      reacted: false
    },
    '': {
      key: '',
      reacted: false
    }
  };
  var theme = reactRedux.useSelector(themeSelector);

  var _useState = React.useState(false),
      rendered = _useState[0],
      setRendered = _useState[1];

  var _useState2 = React.useState([{
    key: '',
    reacted: false
  }, {
    key: '',
    reacted: false
  }, {
    key: '',
    reacted: false
  }, {
    key: '',
    reacted: false
  }, {
    key: '',
    reacted: false
  }, {
    key: '',
    reacted: false
  }]),
      emojis = _useState2[0],
      setEmojis = _useState2[1];

  var chooseEmoji = function chooseEmoji(selectedEmoji) {
    handleAddEmoji(selectedEmoji);

    if (handleEmojiPopupToggle) {
      handleEmojiPopupToggle(false);
    }
  };

  React.useEffect(function () {
    if (frequentlyEmojis && frequentlyEmojis.length > 0) {
      var sortedEmojis = [].concat(frequentlyEmojis).sort(function (a, b) {
        return b.createdAt - a.createdAt;
      });
      var defaultIsChanged = false;
      var uniqueEmojis = sortedEmojis.filter(function (emoji) {
        if (defaultEmojisMap[emoji.key]) {
          defaultEmojisMap[emoji.key].reacted = true;
          defaultIsChanged = true;
          return false;
        } else {
          return true;
        }
      });
      var uniqueEmojisList = uniqueEmojis.map(function (emoji) {
        return {
          key: emoji.key,
          reacted: true
        };
      });

      if (uniqueEmojisList.length || defaultIsChanged) {
        if (uniqueEmojisList.length > 6) {
          uniqueEmojisList.length = 6;
        }

        setEmojis(function (prevState) {
          return prevState.map(function (em) {
            return defaultEmojisMap[em.key];
          }).splice(0, 6 - uniqueEmojisList.length).concat(uniqueEmojisList);
        });
      }
    }

    setRendered(true);
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$f, {
    id: 'emojisContainer',
    backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    rendered: rendered,
    rightSide: rtlDirection
  }, emojis.map(function (emoji) {
    return /*#__PURE__*/React__default.createElement(EmojiItem, {
      hoverBackground: colors.hoverBackgroundColor,
      active: emoji.reacted,
      key: emoji.key,
      onClick: function onClick() {
        return chooseEmoji(emoji.key);
      }
    }, emoji.key);
  }), /*#__PURE__*/React__default.createElement(OpenMoreEmojis, {
    onClick: function onClick() {
      return handleEmojiPopupToggle(true);
    },
    iconBackgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    hoverBackground: colors.hoverBackgroundColor
  }, /*#__PURE__*/React__default.createElement(SvgPlus, null)));
}
var Container$f = styled__default.div(_templateObject$v || (_templateObject$v = _taggedTemplateLiteralLoose(["\n  transform: scale(0, 0);\n  transform-origin: ", ";\n  display: flex;\n  align-items: center;\n  padding: 6px;\n  background-color: ", ";\n  box-shadow: 0 3px 10px -4px rgba(0, 0, 0, 0.2);\n  border-radius: 24px;\n  overflow: hidden;\n  box-sizing: border-box;\n  transition: all 0.2s ease-in-out;\n  ", ";\n"])), function (props) {
  return props.rightSide ? '100% 100%' : '0 100%';
}, function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.rendered && "\n    transform: scale(1, 1);\n  ";
});
var EmojiItem = styled__default.span(_templateObject2$r || (_templateObject2$r = _taggedTemplateLiteralLoose(["\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 8px;\n  font-size: 28px;\n  line-height: 32px;\n  cursor: pointer;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  background-color: ", ";\n  &:hover {\n    background-color: ", ";\n  }\n"])), function (props) {
  return props.active && colors.backgroundColor;
}, function (props) {
  return props.hoverBackground || colors.backgroundColor;
});
var OpenMoreEmojis = styled__default.span(_templateObject3$l || (_templateObject3$l = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  background-color: ", ";\n  cursor: pointer;\n\n  & > svg {\n    color: ", ";\n    height: 18px;\n    width: 18px;\n  }\n  &:hover {\n    background-color: ", ";\n  }\n  border-radius: 50%;\n"])), function (props) {
  return props.iconBackgroundColor || colors.backgroundColor;
}, colors.textColor2, function (props) {
  return props.hoverBackground || colors.hoverBackgroundColor;
});

var _templateObject$w, _templateObject2$s, _templateObject3$m, _templateObject4$i, _templateObject5$g, _templateObject6$e, _templateObject7$c, _templateObject8$b, _templateObject9$a, _templateObject10$9, _templateObject11$6, _templateObject12$4, _templateObject13$4, _templateObject14$3, _templateObject15$3, _templateObject16$2, _templateObject17$2, _templateObject18$2, _templateObject19$2, _templateObject20$1, _templateObject21$1, _templateObject22$1, _templateObject23$1, _templateObject24$1, _templateObject25$1;

var Message = function Message(_ref) {
  var message = _ref.message,
      channel = _ref.channel,
      MessageActionsMenu = _ref.MessageActionsMenu,
      handleScrollToRepliedMessage = _ref.handleScrollToRepliedMessage,
      handleMediaItemClick = _ref.handleMediaItemClick,
      stopScrolling = _ref.stopScrolling,
      prevMessage = _ref.prevMessage,
      nextMessage = _ref.nextMessage,
      setLastVisibleMessageId = _ref.setLastVisibleMessageId,
      isUnreadMessage = _ref.isUnreadMessage,
      unreadMessageId = _ref.unreadMessageId,
      isThreadMessage = _ref.isThreadMessage,
      fontFamily = _ref.fontFamily,
      ownMessageOnRightSide = _ref.ownMessageOnRightSide,
      messageWidthPercent = _ref.messageWidthPercent,
      _ref$showSenderNameOn = _ref.showSenderNameOnDirectChannel,
      showSenderNameOnDirectChannel = _ref$showSenderNameOn === void 0 ? false : _ref$showSenderNameOn,
      _ref$showSenderNameOn2 = _ref.showSenderNameOnGroupChannel,
      showSenderNameOnGroupChannel = _ref$showSenderNameOn2 === void 0 ? true : _ref$showSenderNameOn2,
      _ref$showSenderNameOn3 = _ref.showSenderNameOnOwnMessages,
      showSenderNameOnOwnMessages = _ref$showSenderNameOn3 === void 0 ? true : _ref$showSenderNameOn3,
      _ref$messageStatusAnd = _ref.messageStatusAndTimePosition,
      messageStatusAndTimePosition = _ref$messageStatusAnd === void 0 ? 'onMessage' : _ref$messageStatusAnd,
      _ref$messageStatusDis = _ref.messageStatusDisplayingType,
      messageStatusDisplayingType = _ref$messageStatusDis === void 0 ? 'ticks' : _ref$messageStatusDis,
      _ref$ownMessageBackgr = _ref.ownMessageBackground,
      ownMessageBackground = _ref$ownMessageBackgr === void 0 ? colors.primaryLight : _ref$ownMessageBackgr,
      _ref$incomingMessageB = _ref.incomingMessageBackground,
      incomingMessageBackground = _ref$incomingMessageB === void 0 ? colors.backgroundColor : _ref$incomingMessageB,
      _ref$ownRepliedMessag = _ref.ownRepliedMessageBackground,
      ownRepliedMessageBackground = _ref$ownRepliedMessag === void 0 ? colors.ownRepliedMessageBackground : _ref$ownRepliedMessag,
      _ref$incomingRepliedM = _ref.incomingRepliedMessageBackground,
      incomingRepliedMessageBackground = _ref$incomingRepliedM === void 0 ? colors.incomingRepliedMessageBackground : _ref$incomingRepliedM,
      _ref$showOwnAvatar = _ref.showOwnAvatar,
      showOwnAvatar = _ref$showOwnAvatar === void 0 ? true : _ref$showOwnAvatar,
      _ref$showMessageStatu = _ref.showMessageStatus,
      showMessageStatus = _ref$showMessageStatu === void 0 ? true : _ref$showMessageStatu,
      showMessageTimeAndStatusOnlyOnHover = _ref.showMessageTimeAndStatusOnlyOnHover,
      _ref$showMessageTime = _ref.showMessageTime,
      showMessageTime = _ref$showMessageTime === void 0 ? true : _ref$showMessageTime,
      _ref$showMessageStatu2 = _ref.showMessageStatusForEachMessage,
      showMessageStatusForEachMessage = _ref$showMessageStatu2 === void 0 ? true : _ref$showMessageStatu2,
      _ref$showMessageTimeF = _ref.showMessageTimeForEachMessage,
      showMessageTimeForEachMessage = _ref$showMessageTimeF === void 0 ? true : _ref$showMessageTimeF,
      _ref$hoverBackground = _ref.hoverBackground,
      hoverBackground = _ref$hoverBackground === void 0 ? true : _ref$hoverBackground,
      _ref$messageReaction = _ref.messageReaction,
      messageReaction = _ref$messageReaction === void 0 ? true : _ref$messageReaction,
      _ref$editMessage = _ref.editMessage,
      editMessage = _ref$editMessage === void 0 ? true : _ref$editMessage,
      _ref$copyMessage = _ref.copyMessage,
      copyMessage = _ref$copyMessage === void 0 ? true : _ref$copyMessage,
      _ref$replyMessage = _ref.replyMessage,
      replyMessage = _ref$replyMessage === void 0 ? true : _ref$replyMessage,
      _ref$replyMessageInTh = _ref.replyMessageInThread,
      replyMessageInThread = _ref$replyMessageInTh === void 0 ? true : _ref$replyMessageInTh,
      _ref$deleteMessage = _ref.deleteMessage,
      deleteMessage = _ref$deleteMessage === void 0 ? true : _ref$deleteMessage,
      _ref$selectMessage = _ref.selectMessage,
      selectMessage = _ref$selectMessage === void 0 ? true : _ref$selectMessage,
      allowEditDeleteIncomingMessage = _ref.allowEditDeleteIncomingMessage,
      _ref$forwardMessage = _ref.forwardMessage,
      forwardMessage = _ref$forwardMessage === void 0 ? true : _ref$forwardMessage,
      _ref$reportMessage = _ref.reportMessage,
      reportMessage = _ref$reportMessage === void 0 ? true : _ref$reportMessage,
      reactionIcon = _ref.reactionIcon,
      editIcon = _ref.editIcon,
      copyIcon = _ref.copyIcon,
      replyIcon = _ref.replyIcon,
      replyInThreadIcon = _ref.replyInThreadIcon,
      forwardIcon = _ref.forwardIcon,
      deleteIcon = _ref.deleteIcon,
      selectIcon = _ref.selectIcon,
      starIcon = _ref.starIcon,
      staredIcon = _ref.staredIcon,
      reportIcon = _ref.reportIcon,
      reactionIconOrder = _ref.reactionIconOrder,
      _ref$openFrequentlyUs = _ref.openFrequentlyUsedReactions,
      openFrequentlyUsedReactions = _ref$openFrequentlyUs === void 0 ? true : _ref$openFrequentlyUs,
      editIconOrder = _ref.editIconOrder,
      copyIconOrder = _ref.copyIconOrder,
      replyIconOrder = _ref.replyIconOrder,
      replyInThreadIconOrder = _ref.replyInThreadIconOrder,
      forwardIconOrder = _ref.forwardIconOrder,
      deleteIconOrder = _ref.deleteIconOrder,
      selectIconOrder = _ref.selectIconOrder,
      starIconOrder = _ref.starIconOrder,
      reportIconOrder = _ref.reportIconOrder,
      reactionIconTooltipText = _ref.reactionIconTooltipText,
      editIconTooltipText = _ref.editIconTooltipText,
      copyIconTooltipText = _ref.copyIconTooltipText,
      replyIconTooltipText = _ref.replyIconTooltipText,
      replyInThreadIconTooltipText = _ref.replyInThreadIconTooltipText,
      forwardIconTooltipText = _ref.forwardIconTooltipText,
      deleteIconTooltipText = _ref.deleteIconTooltipText,
      selectIconTooltipText = _ref.selectIconTooltipText,
      starIconTooltipText = _ref.starIconTooltipText,
      reportIconTooltipText = _ref.reportIconTooltipText,
      messageActionIconsColor = _ref.messageActionIconsColor,
      fileAttachmentsIcon = _ref.fileAttachmentsIcon,
      _ref$reactionsDisplay = _ref.reactionsDisplayCount,
      reactionsDisplayCount = _ref$reactionsDisplay === void 0 ? 5 : _ref$reactionsDisplay,
      _ref$showEachReaction = _ref.showEachReactionCount,
      showEachReactionCount = _ref$showEachReaction === void 0 ? true : _ref$showEachReaction,
      showTotalReactionCount = _ref.showTotalReactionCount,
      reactionItemBorder = _ref.reactionItemBorder,
      reactionItemBorderRadius = _ref.reactionItemBorderRadius,
      reactionItemBackground = _ref.reactionItemBackground,
      reactionItemPadding = _ref.reactionItemPadding,
      reactionItemMargin = _ref.reactionItemMargin,
      reactionsFontSize = _ref.reactionsFontSize,
      reactionsContainerBoxShadow = _ref.reactionsContainerBoxShadow,
      reactionsContainerBorder = _ref.reactionsContainerBorder,
      reactionsContainerBorderRadius = _ref.reactionsContainerBorderRadius,
      reactionsContainerBackground = _ref.reactionsContainerBackground,
      reactionsContainerPadding = _ref.reactionsContainerPadding,
      reactionsContainerTopPosition = _ref.reactionsContainerTopPosition,
      reactionsDetailsPopupBorderRadius = _ref.reactionsDetailsPopupBorderRadius,
      reactionsDetailsPopupHeaderItemsStyle = _ref.reactionsDetailsPopupHeaderItemsStyle,
      fileAttachmentsBoxWidth = _ref.fileAttachmentsBoxWidth,
      fileAttachmentsBoxBorder = _ref.fileAttachmentsBoxBorder,
      fileAttachmentsTitleColor = _ref.fileAttachmentsTitleColor,
      fileAttachmentsSizeColor = _ref.fileAttachmentsSizeColor,
      imageAttachmentMaxWidth = _ref.imageAttachmentMaxWidth,
      imageAttachmentMaxHeight = _ref.imageAttachmentMaxHeight,
      videoAttachmentMaxWidth = _ref.videoAttachmentMaxWidth,
      videoAttachmentMaxHeight = _ref.videoAttachmentMaxHeight,
      emojisCategoryIconsPosition = _ref.emojisCategoryIconsPosition,
      emojisContainerBorderRadius = _ref.emojisContainerBorderRadius,
      fixEmojiCategoriesTitleOnTop = _ref.fixEmojiCategoriesTitleOnTop,
      sameUserMessageSpacing = _ref.sameUserMessageSpacing,
      differentUserMessageSpacing = _ref.differentUserMessageSpacing,
      selectedMessagesMap = _ref.selectedMessagesMap,
      contactsMap = _ref.contactsMap,
      openedMessageMenuId = _ref.openedMessageMenuId,
      tabIsActive = _ref.tabIsActive,
      connectionStatus = _ref.connectionStatus;
  var dispatch = reactRedux.useDispatch();
  var ChatClient = getClient();
  var user = ChatClient.user;
  var getFromContacts = getShowOnlyContactUsers();

  var _useState = React.useState(false),
      deletePopupOpen = _useState[0],
      setDeletePopupOpen = _useState[1];

  var _useState2 = React.useState(false),
      forwardPopupOpen = _useState2[0],
      setForwardPopupOpen = _useState2[1];

  var _useState3 = React.useState(false),
      reportPopupOpen = _useState3[0],
      setReportPopupOpen = _useState3[1];

  var _useState4 = React.useState(false),
      messageActionsShow = _useState4[0],
      setMessageActionsShow = _useState4[1];

  var _useState5 = React.useState(false),
      emojisPopupOpen = _useState5[0],
      setEmojisPopupOpen = _useState5[1];

  var _useState6 = React.useState(false),
      frequentlyEmojisOpen = _useState6[0],
      setFrequentlyEmojisOpen = _useState6[1];

  var _useState7 = React.useState(false),
      reactionsPopupOpen = _useState7[0],
      setReactionsPopupOpen = _useState7[1];

  var _useState8 = React.useState(0),
      reactionsPopupPosition = _useState8[0],
      setReactionsPopupPosition = _useState8[1];

  var _useState9 = React.useState(''),
      emojisPopupPosition = _useState9[0],
      setEmojisPopupPosition = _useState9[1];

  var _useState10 = React.useState({
    left: 0,
    right: 0
  }),
      reactionsPopupHorizontalPosition = _useState10[0],
      setReactionsPopupHorizontalPosition = _useState10[1];

  var messageItemRef = React.useRef();
  var isVisible = useOnScreen(messageItemRef);
  var reactionsCount = message.reactionTotals && message.reactionTotals.reduce(function (prevValue, currentValue) {
    return prevValue + currentValue.count;
  }, 0);
  var messageTextRef = React.useRef(null);
  var messageActionsTimeout = React.useRef(null);
  var messageUserID = message.user ? message.user.id : 'deleted';
  var prevMessageUserID = prevMessage ? prevMessage.user ? prevMessage.user.id : 'deleted' : null;
  var nextMessageUserID = nextMessage ? nextMessage.user ? nextMessage.user.id : 'deleted' : null;
  var current = moment(message.createdAt).startOf('day');
  var firstMessageInInterval = !(prevMessage && current.diff(moment(prevMessage.createdAt).startOf('day'), 'days') === 0) || (prevMessage === null || prevMessage === void 0 ? void 0 : prevMessage.type) === 'system';
  var lastMessageInInterval = !(nextMessage && current.diff(moment(nextMessage.createdAt).startOf('day'), 'days') === 0) || nextMessage.type === 'system';
  var messageTimeVisible = showMessageTime && (showMessageTimeForEachMessage || !nextMessage);
  var messageStatusVisible = !message.incoming && showMessageStatus && message.state !== MESSAGE_STATUS.DELETE && (showMessageStatusForEachMessage || !nextMessage);
  var withAttachments = message.attachments && message.attachments.length > 0;
  var notLinkAttachment = withAttachments && message.attachments.some(function (a) {
    return a.type !== attachmentTypes.link;
  });
  var parentNotLinkAttachment = message.parentMessage && message.parentMessage.attachments && message.parentMessage.attachments.some(function (a) {
    return a.type !== attachmentTypes.link;
  });
  var messageOwnerIsNotCurrentUser = !!(message.user && message.user.id !== user.id && message.user.id);
  var mediaAttachment = withAttachments && message.attachments.find(function (attachment) {
    return attachment.type === attachmentTypes.video || attachment.type === attachmentTypes.image;
  });
  var withMediaAttachment = !!mediaAttachment;
  var attachmentMetas = mediaAttachment && (isJSON(mediaAttachment.metadata) ? JSON.parse(mediaAttachment.metadata) : mediaAttachment.metadata);
  var renderAvatar = (isUnreadMessage || prevMessageUserID !== messageUserID || firstMessageInInterval) && !(channel.type === CHANNEL_TYPE.DIRECT && !showSenderNameOnDirectChannel) && !(!message.incoming && !showOwnAvatar);
  var borderRadius = message.incoming && incomingMessageBackground === 'inherit' ? '0px' : !message.incoming && ownMessageBackground === 'inherit' ? '0px' : !message.incoming && ownMessageOnRightSide ? prevMessageUserID !== messageUserID || firstMessageInInterval ? '16px 16px 4px 16px' : nextMessageUserID !== messageUserID || lastMessageInInterval ? '16px 4px 16px 16px' : '16px 4px 4px 16px' : prevMessageUserID !== messageUserID || firstMessageInInterval ? '16px 16px 16px 4px' : nextMessageUserID !== messageUserID || lastMessageInInterval ? '4px 16px 16px 16px' : '4px 16px 16px 4px';
  var showMessageSenderName = (isUnreadMessage || prevMessageUserID !== messageUserID || firstMessageInInterval) && (channel.type === CHANNEL_TYPE.DIRECT ? showSenderNameOnDirectChannel : showSenderNameOnGroupChannel) && (message.incoming || showSenderNameOnOwnMessages);
  var selectionIsActive = selectedMessagesMap && selectedMessagesMap.size > 0;
  var isSelectedMessage = selectedMessagesMap && selectedMessagesMap.get(message.id || message.tid);
  var tooManySelected = selectedMessagesMap && selectedMessagesMap.size >= 30;

  var toggleEditMode = function toggleEditMode() {
    dispatch(setMessageToEditAC(message));
    setMessageActionsShow(false);
  };

  var handleToggleDeleteMessagePopup = function handleToggleDeleteMessagePopup() {
    if (!message.deliveryStatus || message.deliveryStatus === MESSAGE_DELIVERY_STATUS.PENDING) {
      handleDeletePendingMessage();
    } else {
      setDeletePopupOpen(!deletePopupOpen);
    }

    setMessageActionsShow(false);
  };

  var handleToggleForwardMessagePopup = function handleToggleForwardMessagePopup() {
    setForwardPopupOpen(!forwardPopupOpen);
    setMessageActionsShow(false);
    stopScrolling(!forwardPopupOpen);
  };

  var _handleReplyMessage = function handleReplyMessage(threadReply) {
    if (threadReply) ; else {
      dispatch(setMessageForReplyAC(message));
    }

    setMessageActionsShow(false);
  };

  var handleToggleReportPopupOpen = function handleToggleReportPopupOpen() {
    setReportPopupOpen(!reportPopupOpen);
    setMessageActionsShow(false);
  };

  var handleSelectMessage = function handleSelectMessage(e) {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }

    if (isSelectedMessage) {
      if (selectedMessagesMap && selectedMessagesMap.size === 1) {
        dispatch(clearSelectedMessagesAC());
      } else {
        dispatch(removeSelectedMessageAC(message.id));
      }
    } else if (!tooManySelected) {
      dispatch(addSelectedMessageAC(message));
      setMessageActionsShow(false);
    }
  };

  var handleDeleteMessage = function handleDeleteMessage(deleteOption) {
    dispatch(deleteMessageAC(channel.id, message.id, deleteOption));
    setMessageActionsShow(false);
  };

  var handleResendMessage = function handleResendMessage() {
    var messageToResend = _extends({}, message);

    if (message.attachments && message.attachments.length) {
      messageToResend.attachments = message.attachments.map(function (att) {
        var pendingAttachment = getPendingAttachment(att.tid);
        return _extends({}, att, {
          data: new File([pendingAttachment.file], att.data.name)
        });
      });
    }

    dispatch(resendMessageAC(messageToResend, channel.id, connectionStatus));
    setMessageActionsShow(false);
  };

  var handleCopyMessage = function handleCopyMessage() {
    navigator.clipboard.writeText(messageTextRef.current.innerText);
    setMessageActionsShow(false);
  };

  var handleToggleReactionsPopup = function handleToggleReactionsPopup() {
    var _messageItemRef$curre;

    var reactionsContainer = document.getElementById(message.id + "_reactions_container}");
    var reactionsContPos = reactionsContainer && reactionsContainer.getBoundingClientRect();
    var bottomPos = (_messageItemRef$curre = messageItemRef.current) === null || _messageItemRef$curre === void 0 ? void 0 : _messageItemRef$curre.getBoundingClientRect().bottom;
    var offsetBottom = window.innerHeight - bottomPos;
    setReactionsPopupPosition(offsetBottom);
    setReactionsPopupHorizontalPosition({
      left: reactionsContainer ? reactionsContainer.getBoundingClientRect().left : 0,
      right: reactionsContPos ? window.innerWidth - reactionsContPos.left - reactionsContPos.width : 0
    });
    setReactionsPopupOpen(!reactionsPopupOpen);
  };

  var handleRemoveFailedAttachment = function handleRemoveFailedAttachment(attachmentId) {
    console.log('remove attachment .. ', attachmentId);
  };

  var handleMouseEnter = function handleMouseEnter() {
    if (message.state !== MESSAGE_STATUS.DELETE && !selectionIsActive) {
      messageActionsTimeout.current = setTimeout(function () {
        setMessageActionsShow(true);
        dispatch(setMessageMenuOpenedAC(message.id || message.tid));
      }, 450);
    }
  };

  var closeMessageActions = function closeMessageActions(close) {
    setMessageActionsShow(!close);

    if (close && !messageActionsShow && messageActionsTimeout.current) {
      clearTimeout(messageActionsTimeout.current);
    }
  };

  var handleMouseLeave = function handleMouseLeave() {
    clearTimeout(messageActionsTimeout.current);
    setMessageActionsShow(false);
  };

  var handleDeletePendingMessage = function handleDeletePendingMessage() {
    if (message.attachments && message.attachments.length) {
      var customUploader = getCustomUploader();
      message.attachments.forEach(function (att) {
        if (customUploader) {
          cancelUpload(att.tid);
          deletePendingAttachment(att.tid);
        }
      });
    }

    removeMessageFromMap(channel.id, message.id || message.tid);
    removeMessageFromAllMessages(message.id || message.tid);
    dispatch(deleteMessageFromListAC(message.id || message.tid));
  };

  var handleReactionAddDelete = function handleReactionAddDelete(selectedEmoji) {
    if (message.userReactions && message.userReactions.some(function (item) {
      return item.key === selectedEmoji;
    })) {
      dispatch(deleteReactionAC(channel.id, message.id, selectedEmoji, channel.lastReactedMessage && channel.lastReactedMessage.id === message.id));
    } else {
      var score = 1;
      var reason = 'mmm';
      var enforceUnique = false;
      dispatch(addReactionAC(channel.id, message.id, selectedEmoji, score, reason, enforceUnique));
    }

    setMessageActionsShow(false);
    setFrequentlyEmojisOpen(false);
  };

  var handleSendReadMarker = function handleSendReadMarker() {
    if (isVisible && message.incoming && !(message.userMarkers && message.userMarkers.length && message.userMarkers.find(function (marker) {
      return marker.name === MESSAGE_DELIVERY_STATUS.READ;
    })) && connectionStatus === CONNECTION_STATUS.CONNECTED) {
      console.log('send displayed marker for message ... ', message);
      dispatch(markMessagesAsReadAC(channel.id, [message.id]));
    }
  };

  var handleForwardMessage = function handleForwardMessage(channelIds) {
    if (channelIds && channelIds.length) {
      channelIds.forEach(function (channelId) {
        dispatch(forwardMessageAC(message, channelId, connectionStatus));
      });
    }
  };

  var MessageHeader = function MessageHeader() {
    return /*#__PURE__*/React__default.createElement(MessageHeaderCont, {
      isReplied: !!message.parentMessage,
      isForwarded: !!message.forwardingDetails,
      messageBody: !!message.body,
      withMediaAttachment: withMediaAttachment,
      withPadding: withAttachments && notLinkAttachment && (message.incoming ? incomingMessageBackground !== 'inherit' : ownMessageBackground !== 'inherit')
    }, showMessageSenderName && /*#__PURE__*/React__default.createElement(MessageOwner, {
      className: 'message-owner',
      color: colors.primary,
      rtlDirection: ownMessageOnRightSide && !message.incoming,
      clickable: messageOwnerIsNotCurrentUser,
      onClick: function onClick() {
        return handleCreateChat(messageOwnerIsNotCurrentUser && message.user);
      }
    }, message.user.id === user.id && message.user.firstName ? message.user.firstName + " " + message.user.lastName : makeUsername(contactsMap[message.user.id], message.user, getFromContacts)));
  };

  var handleClick = function handleClick(e) {
    var emojisContainer = document.getElementById('emojisContainer');
    var frequentlyEmojisContainer = document.getElementById('frequently_emojis_container');

    if (emojisContainer && !emojisContainer.contains(e.target)) {
      setEmojisPopupOpen(false);
    }

    if (frequentlyEmojisContainer && !frequentlyEmojisContainer.contains(e.target)) {
      setFrequentlyEmojisOpen(false);
    }
  };

  var handleOpenEmojis = function handleOpenEmojis() {
    if (openFrequentlyUsedReactions) {
      setFrequentlyEmojisOpen(true);
    } else {
      setEmojisPopupOpen(true);
    }
  };

  var handleCreateChat = function handleCreateChat(user) {
    if (user && !selectionIsActive) {
      dispatch(createChannelAC({
        metadata: '',
        type: CHANNEL_TYPE.DIRECT,
        members: [_extends({}, user, {
          role: 'owner'
        })]
      }, true));
    }
  };

  React.useEffect(function () {
    if (isVisible) {
      if (setLastVisibleMessageId) {
        setLastVisibleMessageId(message.id);
      }

      handleSendReadMarker();

      if (!channel.isLinkedChannel) {
        setMessageToVisibleMessagesMap(message);
      }
    } else {
      if (!channel.isLinkedChannel) {
        removeMessageFromVisibleMessagesMap(message);
      }
    }
  }, [isVisible]);
  useDidUpdate(function () {
    if (tabIsActive) {
      handleSendReadMarker();
    }
  }, [tabIsActive]);
  useDidUpdate(function () {
    if (connectionStatus === CONNECTION_STATUS.CONNECTED) {
      handleSendReadMarker();
    }
  }, [connectionStatus]);
  React.useEffect(function () {
    if (emojisPopupOpen) {
      var bottomPos = messageItemRef.current ? messageItemRef.current.getBoundingClientRect().bottom : 0;
      var offsetBottom = window.innerHeight - bottomPos;
      setEmojisPopupPosition(offsetBottom < 300 ? 'top' : 'bottom');
      setFrequentlyEmojisOpen(false);
    } else {
      setEmojisPopupPosition('');
    }
  }, [emojisPopupOpen]);
  useDidUpdate(function () {
    if (openedMessageMenuId && openedMessageMenuId !== message.id) {
      setMessageActionsShow(false);
    }
  }, [openedMessageMenuId]);
  React.useEffect(function () {
    document.addEventListener('mousedown', handleClick);
    return function () {
      document.removeEventListener('mousedown', handleClick);
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(MessageItem, {
    key: message.id || message.tid,
    rtl: ownMessageOnRightSide && !message.incoming,
    withAvatar: renderAvatar,
    hoverBackground: hoverBackground ? message.incoming ? incomingMessageBackground || 'rgb(238, 245, 255)' : ownMessageBackground || 'rgb(238, 245, 255)' : '',
    topMargin: (prevMessage === null || prevMessage === void 0 ? void 0 : prevMessage.type) === 'system' ? '0' : prevMessage && unreadMessageId === prevMessage.id ? '16px' : prevMessageUserID !== messageUserID || firstMessageInInterval ? differentUserMessageSpacing || '16px' : sameUserMessageSpacing || '8px',
    bottomMargin: message.reactionTotals && message.reactionTotals.length ? reactionsContainerTopPosition : '',
    ref: messageItemRef,
    selectMessagesIsActive: selectionIsActive,
    onClick: function onClick(e) {
      return selectionIsActive && handleSelectMessage(e);
    },
    className: 'MessageItem'
  }, selectionIsActive && message.state !== MESSAGE_STATUS.DELETE && /*#__PURE__*/React__default.createElement(SelectMessageWrapper, {
    activeColor: colors.primary,
    disabled: tooManySelected && !isSelectedMessage,
    onClick: handleSelectMessage
  }, isSelectedMessage ? /*#__PURE__*/React__default.createElement(SvgSelectionIcon, null) : /*#__PURE__*/React__default.createElement(EmptySelection, {
    disabled: tooManySelected
  })), renderAvatar && /*#__PURE__*/React__default.createElement(Avatar, {
    name: message.user && (message.user.firstName || messageUserID),
    image: message.user && message.user.avatarUrl,
    size: 32,
    textSize: 14,
    setDefaultAvatar: true,
    handleAvatarClick: function handleAvatarClick() {
      return handleCreateChat(message.user);
    }
  }), /*#__PURE__*/React__default.createElement(MessageContent, {
    selectionIsActive: selectionIsActive,
    messageWidthPercent: messageWidthPercent,
    rtl: ownMessageOnRightSide && !message.incoming,
    withAvatar: !(channel.type === CHANNEL_TYPE.DIRECT && !showSenderNameOnDirectChannel) && !(!message.incoming && !showOwnAvatar),
    className: 'messageContent'
  }, message.state === MESSAGE_STATUS.FAILED && /*#__PURE__*/React__default.createElement(FailedMessageIcon, {
    rtl: ownMessageOnRightSide && !message.incoming
  }, /*#__PURE__*/React__default.createElement(ErrorIconWrapper, null)), /*#__PURE__*/React__default.createElement(MessageBody, {
    className: 'messageBody',
    isSelfMessage: !message.incoming,
    isReplyMessage: !!(message.parentMessage && message.parentMessage.id && !isThreadMessage),
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    parentMessageIsVoice: message.parentMessage && message.parentMessage.attachments && message.parentMessage.attachments[0] && message.parentMessage.attachments[0].type === attachmentTypes.voice,
    ownMessageBackground: ownMessageBackground,
    incomingMessageBackground: incomingMessageBackground,
    borderRadius: borderRadius,
    withAttachments: notLinkAttachment,
    attachmentWidth: withAttachments ? mediaAttachment ? attachmentMetas && getSendAttachmentsAsSeparateMessages() && attachmentMetas.szw && calculateRenderedImageWidth(attachmentMetas.szw, attachmentMetas.szh, mediaAttachment.type === attachmentTypes.image ? imageAttachmentMaxWidth : videoAttachmentMaxWidth, mediaAttachment.type === attachmentTypes.image ? imageAttachmentMaxHeight : videoAttachmentMaxHeight)[0] || 420 : message.attachments[0].type === attachmentTypes.voice ? 254 : message.attachments[0].type === attachmentTypes.file ? fileAttachmentsBoxWidth : undefined : undefined,
    noBody: !message.body && !withAttachments,
    onMouseEnter: handleMouseEnter,
    onMouseLeave: handleMouseLeave
  }, showMessageSenderName && /*#__PURE__*/React__default.createElement(MessageHeader, null), !isThreadMessage && messageActionsShow && !selectionIsActive && !emojisPopupOpen && !frequentlyEmojisOpen && (MessageActionsMenu ? /*#__PURE__*/React__default.createElement(MessageActionsMenu, {
    message: message,
    channel: channel,
    isThreadMessage: isThreadMessage,
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    handleSetMessageForEdit: toggleEditMode,
    handleOpenDeleteMessage: handleToggleDeleteMessagePopup,
    handleCopyMessage: handleCopyMessage,
    handleOpenForwardMessage: handleToggleForwardMessagePopup,
    handleResendMessage: handleResendMessage,
    handleReplyMessage: function handleReplyMessage() {
      return _handleReplyMessage(false);
    },
    handleReportMessage: handleToggleReportPopupOpen,
    handleSelectMessage: handleSelectMessage,
    handleOpenEmojis: handleOpenEmojis
  }) : /*#__PURE__*/React__default.createElement(MessageActions, {
    messageFrom: message.user,
    channel: channel,
    editModeToggle: toggleEditMode,
    messageStatus: message.deliveryStatus || MESSAGE_DELIVERY_STATUS.PENDING,
    handleOpenDeleteMessage: handleToggleDeleteMessagePopup,
    handleCopyMessage: handleCopyMessage,
    handleDeletePendingMessage: handleDeletePendingMessage,
    handleOpenForwardMessage: handleToggleForwardMessagePopup,
    handleResendMessage: handleResendMessage,
    handleReplyMessage: _handleReplyMessage,
    handleReportMessage: handleToggleReportPopupOpen,
    handleOpenEmojis: handleOpenEmojis,
    selfMessage: message.user && messageUserID === user.id,
    isThreadMessage: isThreadMessage,
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    showMessageReaction: messageReaction,
    showEditMessage: editMessage && !message.forwardingDetails && !(message.attachments && message.attachments.length && message.attachments[0].type === attachmentTypes.voice),
    showCopyMessage: copyMessage && message.body,
    showReplyMessage: replyMessage,
    showReplyMessageInThread: replyMessageInThread,
    showForwardMessage: forwardMessage,
    showDeleteMessage: deleteMessage,
    showSelectMessage: selectMessage,
    showReportMessage: reportMessage,
    reactionIcon: reactionIcon,
    editIcon: editIcon,
    copyIcon: copyIcon,
    replyIcon: replyIcon,
    replyInThreadIcon: replyInThreadIcon,
    forwardIcon: forwardIcon,
    deleteIcon: deleteIcon,
    selectIcon: selectIcon,
    allowEditDeleteIncomingMessage: allowEditDeleteIncomingMessage,
    starIcon: starIcon,
    staredIcon: staredIcon,
    reportIcon: reportIcon,
    reactionIconOrder: reactionIconOrder,
    editIconOrder: editIconOrder,
    copyIconOrder: copyIconOrder,
    replyIconOrder: replyIconOrder,
    replyInThreadIconOrder: replyInThreadIconOrder,
    forwardIconOrder: forwardIconOrder,
    deleteIconOrder: deleteIconOrder,
    selectIconOrder: selectIconOrder,
    starIconOrder: starIconOrder,
    reportIconOrder: reportIconOrder,
    reactionIconTooltipText: reactionIconTooltipText,
    editIconTooltipText: editIconTooltipText,
    copyIconTooltipText: copyIconTooltipText,
    replyIconTooltipText: replyIconTooltipText,
    replyInThreadIconTooltipText: replyInThreadIconTooltipText,
    forwardIconTooltipText: forwardIconTooltipText,
    deleteIconTooltipText: deleteIconTooltipText,
    selectIconTooltipText: selectIconTooltipText,
    starIconTooltipText: starIconTooltipText,
    reportIconTooltipText: reportIconTooltipText,
    messageActionIconsColor: messageActionIconsColor,
    myRole: channel.userRole,
    isIncoming: message.incoming
  })), message.parentMessage && message.parentMessage.id && !isThreadMessage && /*#__PURE__*/React__default.createElement(ReplyMessageContainer, {
    withSenderName: showMessageSenderName,
    withBody: !!message.body,
    withAttachments: withAttachments && notLinkAttachment,
    leftBorderColor: colors.primary,
    backgroundColor: message.incoming ? incomingRepliedMessageBackground : ownRepliedMessageBackground,
    onClick: function onClick() {
      return handleScrollToRepliedMessage && !selectionIsActive && handleScrollToRepliedMessage(message.parentMessage.id);
    }
  }, message.parentMessage.attachments && !!message.parentMessage.attachments.length && message.parentMessage.attachments[0].type !== attachmentTypes.voice && parentNotLinkAttachment && message.parentMessage.attachments.map(function (attachment, index) {
    return /*#__PURE__*/React__default.createElement(Attachment$1, {
      key: attachment.tid || attachment.url,
      backgroundColor: message.incoming ? incomingMessageBackground : ownMessageBackground,
      attachment: _extends({}, attachment, {
        metadata: isJSON(attachment.metadata) ? JSON.parse(attachment.metadata) : attachment.metadata
      }),
      removeSelected: handleRemoveFailedAttachment,
      selectedFileAttachmentsIcon: fileAttachmentsIcon,
      isRepliedMessage: true,
      borderRadius: index === message.parentMessage.attachments.length - 1 ? borderRadius : '16px',
      selectedFileAttachmentsBoxBorder: fileAttachmentsBoxBorder,
      selectedFileAttachmentsTitleColor: fileAttachmentsTitleColor,
      selectedFileAttachmentsSizeColor: fileAttachmentsSizeColor,
      fileAttachmentWidth: fileAttachmentsBoxWidth,
      imageAttachmentMaxWidth: imageAttachmentMaxWidth,
      imageAttachmentMaxHeight: imageAttachmentMaxHeight,
      videoAttachmentMaxWidth: videoAttachmentMaxWidth,
      videoAttachmentMaxHeight: videoAttachmentMaxHeight
    });
  }), /*#__PURE__*/React__default.createElement(ReplyMessageBody, {
    rtlDirection: ownMessageOnRightSide && !message.incoming
  }, /*#__PURE__*/React__default.createElement(MessageOwner, {
    className: 'reply-message-owner',
    color: colors.primary,
    fontSize: '12px',
    rtlDirection: ownMessageOnRightSide && !message.incoming
  }, message.parentMessage.user.id === user.id ? 'You' : makeUsername(contactsMap[message.parentMessage.user.id], message.parentMessage.user, getFromContacts)), /*#__PURE__*/React__default.createElement(ReplyMessageText, {
    fontSize: '14px',
    lineHeight: '16px'
  }, !!message.parentMessage.attachments.length && message.parentMessage.attachments[0].type === attachmentTypes.voice && /*#__PURE__*/React__default.createElement(VoiceIconWrapper, {
    color: colors.primary
  }), message.parentMessage.state === MESSAGE_STATUS.DELETE ? /*#__PURE__*/React__default.createElement(MessageStatusDeleted, null, " Message was deleted. ") : message.parentMessage.body ? MessageTextFormat({
    text: message.parentMessage.body,
    message: message.parentMessage,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts,
    asSampleText: true
  }) : parentNotLinkAttachment && (message.parentMessage.attachments[0].type === attachmentTypes.image ? 'Photo' : message.parentMessage.attachments[0].type === attachmentTypes.video ? 'Video' : message.parentMessage.attachments[0].type === attachmentTypes.voice ? ' Voice' : 'File')))), message.forwardingDetails && message.forwardingDetails.user && message.user && message.forwardingDetails.user.id !== message.user.id && /*#__PURE__*/React__default.createElement(ForwardedTitle, {
    withPadding: withAttachments && notLinkAttachment,
    withAttachments: withAttachments,
    withMediaAttachment: withMediaAttachment,
    withBody: !!message.body,
    showSenderName: showMessageSenderName,
    leftPadding: message.incoming ? incomingMessageBackground !== 'inherit' : ownMessageBackground !== 'inherit',
    color: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgForward, null), "Forwarded message"), /*#__PURE__*/React__default.createElement(MessageText, {
    draggable: false,
    color: colors.textColor1,
    showMessageSenderName: showMessageSenderName,
    withPaddings: message.incoming ? incomingMessageBackground !== 'inherit' : ownMessageBackground !== 'inherit',
    withAttachment: notLinkAttachment && !!message.body,
    withMediaAttachment: withMediaAttachment,
    fontFamily: fontFamily,
    isForwarded: !!message.forwardingDetails
  }, /*#__PURE__*/React__default.createElement("span", {
    ref: messageTextRef
  }, MessageTextFormat({
    text: message.body,
    message: message,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts
  })), !withAttachments && message.state === MESSAGE_STATUS.DELETE ? /*#__PURE__*/React__default.createElement(MessageStatusDeleted, null, " Message was deleted. ") : '', messageStatusAndTimePosition === 'onMessage' && (!withAttachments || withAttachments && message.attachments[0].type === attachmentTypes.link) && (messageStatusVisible || messageTimeVisible) ? /*#__PURE__*/React__default.createElement(MessageStatusAndTime, {
    showOnlyOnHover: showMessageTimeAndStatusOnlyOnHover,
    leftMargin: true,
    isSelfMessage: !message.incoming
  }, message.state === MESSAGE_STATUS.EDIT ? /*#__PURE__*/React__default.createElement(MessageStatusUpdated, null, "edited") : '', messageTimeVisible && /*#__PURE__*/React__default.createElement(HiddenMessageTime, null, "" + moment(message.createdAt).format('HH:mm')), messageStatusVisible && /*#__PURE__*/React__default.createElement(MessageStatus, {
    iconColor: colors.primary
  }, messageStatusIcon(message.deliveryStatus, messageStatusDisplayingType))) : null), notLinkAttachment && messageStatusAndTimePosition === 'onMessage' && (messageStatusVisible || messageTimeVisible) && /*#__PURE__*/React__default.createElement(MessageStatusAndTime, {
    showOnlyOnHover: showMessageTimeAndStatusOnlyOnHover,
    withAttachment: true,
    leftMargin: true,
    isSelfMessage: !message.incoming,
    fileAttachment: message.attachments[0].type === 'file' || message.attachments[0].type === 'voice'
  }, message.state === MESSAGE_STATUS.EDIT ? /*#__PURE__*/React__default.createElement(MessageStatusUpdated, {
    color: message.attachments[0].type !== 'voice' && message.attachments[0].type !== 'file' ? colors.white : ''
  }, "edited") : '', messageTimeVisible && /*#__PURE__*/React__default.createElement(HiddenMessageTime, null, "" + moment(message.createdAt).format('HH:mm')), messageStatusVisible && messageStatusIcon(message.deliveryStatus, messageStatusDisplayingType, message.attachments[0].type !== 'voice' && message.attachments[0].type !== 'file' ? colors.white : '')), withAttachments && message.attachments.map(function (attachment) {
    return /*#__PURE__*/React__default.createElement(Attachment$1, {
      key: attachment.tid || attachment.url,
      handleMediaItemClick: selectionIsActive ? undefined : handleMediaItemClick,
      attachment: _extends({}, attachment, {
        metadata: isJSON(attachment.metadata) ? JSON.parse(attachment.metadata) : attachment.metadata
      }),
      removeSelected: handleRemoveFailedAttachment,
      imageMinWidth: message.parentMessage && message.parentMessage.attachments && message.parentMessage.attachments[0] && message.parentMessage.attachments[0].type === attachmentTypes.voice ? '210px' : undefined,
      borderRadius: ownMessageOnRightSide ? borderRadius : '16px',
      selectedFileAttachmentsIcon: fileAttachmentsIcon,
      backgroundColor: message.incoming ? incomingMessageBackground : ownMessageBackground,
      selectedFileAttachmentsBoxBorder: fileAttachmentsBoxBorder,
      selectedFileAttachmentsTitleColor: fileAttachmentsTitleColor,
      selectedFileAttachmentsSizeColor: fileAttachmentsSizeColor,
      closeMessageActions: closeMessageActions,
      fileAttachmentWidth: fileAttachmentsBoxWidth,
      imageAttachmentMaxWidth: imageAttachmentMaxWidth,
      imageAttachmentMaxHeight: imageAttachmentMaxHeight,
      videoAttachmentMaxWidth: videoAttachmentMaxWidth,
      videoAttachmentMaxHeight: videoAttachmentMaxHeight
    });
  }), emojisPopupOpen && emojisPopupPosition && /*#__PURE__*/React__default.createElement(EmojiContainer, {
    id: message.id + "_emoji_popup_container",
    position: emojisPopupPosition,
    rtlDirection: ownMessageOnRightSide && !message.incoming
  }, message.deliveryStatus && message.deliveryStatus !== MESSAGE_DELIVERY_STATUS.PENDING && /*#__PURE__*/React__default.createElement(EmojisPopup, {
    relativePosition: true,
    emojisPopupPosition: emojisPopupPosition,
    emojisCategoryIconsPosition: emojisCategoryIconsPosition,
    emojisContainerBorderRadius: emojisContainerBorderRadius,
    fixEmojiCategoriesTitleOnTop: fixEmojiCategoriesTitleOnTop,
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    handleEmojiPopupToggle: setEmojisPopupOpen,
    handleAddEmoji: handleReactionAddDelete
  })), frequentlyEmojisOpen && !emojisPopupOpen && /*#__PURE__*/React__default.createElement(FrequentlyEmojisContainer, {
    id: 'frequently_emojis_container',
    rtlDirection: ownMessageOnRightSide && !message.incoming
  }, /*#__PURE__*/React__default.createElement(FrequentlyEmojis, {
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    handleAddEmoji: handleReactionAddDelete,
    handleEmojiPopupToggle: setEmojisPopupOpen,
    frequentlyEmojis: message.userReactions
  }))), messageStatusAndTimePosition === 'bottomOfMessage' && (messageStatusVisible || messageTimeVisible) &&
  /*#__PURE__*/
  React__default.createElement(MessageStatusAndTime, {
    showOnlyOnHover: showMessageTimeAndStatusOnlyOnHover,
    isSelfMessage: !message.incoming,
    marginBottom: sameUserMessageSpacing,
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    bottomOfMessage: true
  }, message.state === MESSAGE_STATUS.EDIT ? /*#__PURE__*/React__default.createElement(MessageStatusUpdated, null, "edited") : '', messageTimeVisible && /*#__PURE__*/React__default.createElement(HiddenMessageTime, null, "" + moment(message.createdAt).format('HH:mm')), messageStatusVisible && /*#__PURE__*/React__default.createElement(MessageStatus, {
    iconColor: colors.primary
  }, messageStatusIcon(message.deliveryStatus, messageStatusDisplayingType))), message.replyCount && message.replyCount > 0 && !isThreadMessage && /*#__PURE__*/React__default.createElement(ThreadMessageCountContainer, {
    onClick: function onClick() {
      return _handleReplyMessage(true);
    }
  }, message.replyCount + " replies"), reactionsPopupOpen && /*#__PURE__*/React__default.createElement(ReactionsPopup, {
    bottomPosition: reactionsPopupPosition,
    horizontalPositions: reactionsPopupHorizontalPosition,
    reactionTotals: message.reactionTotals || [],
    messageId: message.id,
    handleReactionsPopupClose: handleToggleReactionsPopup,
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    handleAddDeleteEmoji: handleReactionAddDelete,
    reactionsDetailsPopupBorderRadius: reactionsDetailsPopupBorderRadius,
    reactionsDetailsPopupHeaderItemsStyle: reactionsDetailsPopupHeaderItemsStyle
  }), message.reactionTotals && message.reactionTotals.length && /*#__PURE__*/React__default.createElement(ReactionsContainer, {
    id: message.id + "_reactions_container",
    border: reactionsContainerBorder,
    boxShadow: reactionsContainerBoxShadow,
    borderRadius: reactionsContainerBorderRadius,
    topPosition: reactionsContainerTopPosition,
    padding: reactionsContainerPadding,
    backgroundColor: reactionsContainerBackground || colors.backgroundColor,
    rtlDirection: ownMessageOnRightSide && !message.incoming
  }, /*#__PURE__*/React__default.createElement(MessageReactionsCont, {
    rtlDirection: ownMessageOnRightSide && !message.incoming,
    onClick: handleToggleReactionsPopup
  }, message.reactionTotals.slice(0, reactionsDisplayCount || 5).map(function (summery) {
    return /*#__PURE__*/React__default.createElement(MessageReaction, {
      key: summery.key,
      color: colors.textColor1,
      self: !!message.userReactions.find(function (userReaction) {
        return userReaction.key === summery.key;
      }),
      border: reactionItemBorder,
      borderRadius: reactionItemBorderRadius,
      backgroundColor: reactionItemBackground || colors.backgroundColor,
      padding: reactionItemPadding,
      margin: reactionItemMargin,
      isLastReaction: reactionsCount === 1,
      fontSize: reactionsFontSize
    }, /*#__PURE__*/React__default.createElement(MessageReactionKey, null, summery.key, showEachReactionCount && /*#__PURE__*/React__default.createElement(ReactionItemCount, null, summery.count)));
  }), showTotalReactionCount && reactionsCount && reactionsCount > 1 && /*#__PURE__*/React__default.createElement(MessageReaction, {
    border: reactionItemBorder,
    color: colors.textColor1,
    borderRadius: reactionItemBorderRadius,
    backgroundColor: reactionItemBackground,
    padding: reactionItemPadding,
    margin: '0',
    fontSize: '12px'
  }, reactionsCount)))), deletePopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleDeleteMessage,
    togglePopup: handleToggleDeleteMessagePopup,
    buttonText: 'Delete',
    description: 'Who do you want to remove this message for?',
    isDeleteMessage: true,
    isIncomingMessage: message.incoming,
    myRole: channel.userRole,
    allowDeleteIncoming: allowEditDeleteIncomingMessage,
    isDirectChannel: channel.type === CHANNEL_TYPE.DIRECT,
    title: 'Delete message'
  }), forwardPopupOpen && /*#__PURE__*/React__default.createElement(ForwardMessagePopup, {
    handleForward: handleForwardMessage,
    togglePopup: handleToggleForwardMessagePopup,
    buttonText: 'Forward',
    title: 'Forward message'
  }));
};

var Message$1 = /*#__PURE__*/React__default.memo(Message, function (prevProps, nextProps) {
  return prevProps.message.deliveryStatus === nextProps.message.deliveryStatus && prevProps.message.state === nextProps.message.state && prevProps.message.userReactions === nextProps.message.userReactions && prevProps.message.body === nextProps.message.body && prevProps.message.reactionTotals === nextProps.message.reactionTotals && prevProps.message.attachments === nextProps.message.attachments && prevProps.message.userMarkers === nextProps.message.userMarkers && prevProps.prevMessage === nextProps.prevMessage && prevProps.nextMessage === nextProps.nextMessage && prevProps.selectedMessagesMap === nextProps.selectedMessagesMap && prevProps.contactsMap === nextProps.contactsMap && prevProps.connectionStatus === nextProps.connectionStatus && prevProps.openedMessageMenuId === nextProps.openedMessageMenuId && prevProps.tabIsActive === nextProps.tabIsActive;
});
var MessageReactionKey = styled__default.span(_templateObject$w || (_templateObject$w = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  align-items: center;\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n"])));
var ReactionItemCount = styled__default.span(_templateObject2$s || (_templateObject2$s = _taggedTemplateLiteralLoose(["\n  margin-left: 2px;\n  font-family: Inter, sans-serif;\n  font-weight: 400;\n  font-size: 14px;\n  line-height: 16px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var MessageReaction = styled__default.span(_templateObject3$m || (_templateObject3$m = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  //min-width: 23px;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  margin: ", ";\n  margin-right: ", ";\n  border: ", ";\n  border-color: ", ";\n  color: ", ";\n  box-sizing: border-box;\n  border-radius: ", ";\n  font-size: ", ";\n  line-height: ", ";\n  padding: ", ";\n  background-color: ", ";\n  white-space: nowrap;\n\n  &:last-child {\n    margin-right: 0;\n  }\n"])), function (props) {
  return props.margin || '0 8px 0 0';
}, function (props) {
  return props.isLastReaction && '0';
}, function (props) {
  return props.border;
}, function (props) {
  return props.self && colors.primary;
}, function (props) {
  return props.color;
}, function (props) {
  return props.borderRadius || '16px';
}, function (props) {
  return props.fontSize || '18px';
}, function (props) {
  return props.fontSize || '18px';
}, function (props) {
  return props.padding || '0';
}, function (props) {
  return props.backgroundColor;
});
var ThreadMessageCountContainer = styled__default.div(_templateObject4$i || (_templateObject4$i = _taggedTemplateLiteralLoose(["\n  position: relative;\n  color: ", ";\n  font-weight: 500;\n  font-size: 13px;\n  line-height: 15px;\n  margin: 12px;\n  cursor: pointer;\n\n  &::before {\n    content: '';\n    position: absolute;\n    left: -25px;\n    top: -21px;\n    width: 16px;\n    height: 26px;\n    border-left: 2px solid #cdcdcf;\n    border-bottom: 2px solid #cdcdcf;\n    border-radius: 0 0 0 14px;\n  }\n"])), colors.primary);
var FailedMessageIcon = styled__default.div(_templateObject5$g || (_templateObject5$g = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: -6px;\n  left: ", ";\n  right: ", ";\n  width: 20px;\n  height: 20px;\n"])), function (props) {
  return !props.rtl && '-24px';
}, function (props) {
  return props.rtl && '-24px';
});
var ErrorIconWrapper = styled__default(SvgErrorIcon)(_templateObject6$e || (_templateObject6$e = _taggedTemplateLiteralLoose(["\n  width: 20px;\n  height: 20px;\n"])));
var SelectMessageWrapper = styled__default.div(_templateObject7$c || (_templateObject7$c = _taggedTemplateLiteralLoose(["\n  display: flex;\n  padding: 10px;\n  position: absolute;\n  left: 4%;\n  bottom: calc(50% - 22px);\n  cursor: ", ";\n  & > svg {\n    color: ", ";\n    width: 24px;\n    height: 24px;\n  }\n"])), function (props) {
  return !props.disabled && 'pointer';
}, function (props) {
  return props.activeColor || colors.primary;
});
var EmptySelection = styled__default.span(_templateObject8$b || (_templateObject8$b = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  width: 24px;\n  height: 24px;\n  border: 1.5px solid ", ";\n  box-sizing: border-box;\n  border-radius: 50%;\n  transform: scale(0.92);\n  opacity: ", ";\n"])), colors.borderColor2, function (props) {
  return props.disabled && '0.5';
});
var ReactionsContainer = styled__default.div(_templateObject9$a || (_templateObject9$a = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  margin-left: ", ";\n  margin-right: ", ";\n\n  margin-top: 4px;\n  justify-content: flex-end;\n  border: ", ";\n  box-shadow: ", ";\n  filter: drop-shadow(0px 0px 2px rgba(17, 21, 57, 0.08));\n  border-radius: ", ";\n  background-color: ", ";\n  padding: ", ";\n  z-index: 9;\n  ", ";\n"])), function (props) {
  return props.rtlDirection && 'auto';
}, function (props) {
  return !props.rtlDirection && 'auto';
}, function (props) {
  return props.border;
}, function (props) {
  return props.boxShadow || '0px 4px 12px -2px rgba(17, 21, 57, 0.08)';
}, function (props) {
  return props.borderRadius || '16px';
}, function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.padding || '4px 8px';
}, function (props) {
  return props.topPosition && "\n      position: relative;\n      top: " + props.topPosition + ";\n  ";
});
var MessageReactionsCont = styled__default.div(_templateObject10$9 || (_templateObject10$9 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: inline-flex;\n  max-width: 300px;\n  //overflow-x: auto;\n  direction: ", ";\n  cursor: pointer;\n"])), function (props) {
  return props.rtlDirection && 'ltr';
});
var MessageHeaderCont = styled__default.div(_templateObject11$6 || (_templateObject11$6 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  padding: ", ";\n"])), function (props) {
  return props.withPadding && (props.isForwarded ? '8px 0 2px 12px' : !props.isReplied && !props.messageBody ? props.withMediaAttachment ? '8px 0 8px 12px' : '8px 0 0 12px' : '8px 0 0 12px');
});
var ReplyMessageContainer = styled__default.div(_templateObject12$4 || (_templateObject12$4 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  border-left: 2px solid ", ";\n  padding: 4px 6px;\n  position: relative;\n  //margin: ", ";\n  margin: ", ";\n  background-color: ", ";\n  border-radius: 0 4px 4px 0;\n  margin-top: ", ";\n  cursor: pointer;\n"])), function (props) {
  return props.leftBorderColor || '#b8b9c2';
}, function (props) {
  return props.withAttachments ? '8px 8px' : '0 0 8px';
}, function (props) {
  return props.withAttachments ? props.withBody ? '6px 12px 0' : '6px 12px 8px' : props.withSenderName ? '6px 0 8px' : '0 0 8px';
}, function (props) {
  return props.backgroundColor || colors.primaryLight;
}, function (props) {
  return !props.withSenderName && props.withAttachments && '8px';
});
var ReplyMessageBody = styled__default.div(_templateObject13$4 || (_templateObject13$4 = _taggedTemplateLiteralLoose(["\n  margin-top: auto;\n  margin-bottom: auto;\n  direction: ", ";\n  max-width: 100%;\n"])), function (props) {
  return props.rtlDirection ? 'initial' : '';
});
var ForwardedTitle = styled__default.h3(_templateObject14$3 || (_templateObject14$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  font-weight: 500;\n  font-size: 13px;\n  line-height: 16px;\n  color: ", ";\n  //margin: ", ";\n  margin: 0;\n  padding: ", ";\n  padding-top: ", ";\n  padding-bottom: ", ";\n  & > svg {\n    margin-right: 4px;\n    width: 16px;\n    height: 16px;\n    color: ", ";\n  }\n"])), function (props) {
  return props.color || colors.primary;
}, function (props) {
  return props.withAttachments && props.withBody ? '0' : '0 0 4px';
}, function (props) {
  return props.withPadding && (props.leftPadding ? '8px 0 0 12px' : '8px 0 0 ');
}, function (props) {
  return props.showSenderName && (props.withBody ? '4px' : '0');
}, function (props) {
  return props.withBody ? !props.withAttachments || props.showSenderName ? '4px' : props.withAttachments && !props.withPadding ? '4px' : '0' : props.withAttachments ? props.withMediaAttachment ? '8px' : '2px' : '4px';
}, function (props) {
  return props.color || colors.primary;
});
var MessageStatus = styled__default.span(_templateObject15$3 || (_templateObject15$3 = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  margin-left: 4px;\n  text-align: right;\n  transform: translate(0px, -1px);\n  height: 14px;\n  //visibility: ", ";\n"])), function (_ref2) {
  var lastMessage = _ref2.lastMessage;
  return lastMessage ? 'visible' : 'hidden';
});
var HiddenMessageTime = styled__default.span(_templateObject16$2 || (_templateObject16$2 = _taggedTemplateLiteralLoose(["\n  display: ", ";\n  font-weight: 400;\n  font-size: 12px;\n  color: ", ";\n"])), function (props) {
  return props.hide && 'none';
}, colors.textColor2);
var MessageStatusAndTime = styled__default.div(_templateObject17$2 || (_templateObject17$2 = _taggedTemplateLiteralLoose(["\n  visibility: ", ";\n  display: ", ";\n  align-items: flex-end;\n  border-radius: 16px;\n  padding: ", ";\n  background-color: ", ";\n  float: right;\n  line-height: 14px;\n  margin-right: ", ";\n  margin-left: ", ";\n  margin-bottom: ", ";\n  direction: ", ";\n  transform: translate(0px, 4px);\n  white-space: nowrap;\n  width: ", ";\n  justify-content: ", ";\n  & > svg {\n    margin-left: 4px;\n    transform: translate(0px, -1px);\n    height: 14px;\n  }\n\n  & > ", " {\n    color: ", ";\n  }\n\n  ", "\n"])), function (props) {
  return props.showOnlyOnHover && 'hidden';
}, function (props) {
  return props.hide ? 'none' : 'flex';
}, function (props) {
  return props.withAttachment && '4px 6px';
}, function (props) {
  return props.withAttachment && !props.fileAttachment && 'rgba(1, 1, 1, 0.3)';
}, function (props) {
  return props.rtlDirection && 'auto';
}, function (props) {
  return props.leftMargin && '12px';
}, function (props) {
  return props.marginBottom && '8px';
}, function (props) {
  return props.isSelfMessage ? 'initial' : '';
}, function (props) {
  return props.bottomOfMessage && '30px';
}, function (props) {
  return props.bottomOfMessage && props.rtlDirection && 'flex-end';
}, HiddenMessageTime, function (props) {
  return props.fileAttachment ? colors.textColor2 : props.withAttachment ? colors.white : '';
}, function (props) {
  return props.withAttachment && "\n    position: absolute;\n    z-index: 3;\n    right: " + (props.fileAttachment ? '6px' : '10px') + ";\n    bottom: " + (props.fileAttachment ? '9px' : '14px') + ";\n  ";
});
var MessageStatusUpdated = styled__default.span(_templateObject18$2 || (_templateObject18$2 = _taggedTemplateLiteralLoose(["\n  margin-right: 4px;\n  font-style: italic;\n  font-weight: 400;\n  font-size: 12px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
});
var MessageStatusDeleted = styled__default.span(_templateObject19$2 || (_templateObject19$2 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  font-style: italic;\n"])), colors.textColor2);
var MessageBody = styled__default.div(_templateObject20$1 || (_templateObject20$1 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  background-color: ", ";\n  //display: inline-block;\n  border-radius: ", ";\n  direction: ", ";\n  max-width: ", ";\n  padding: ", ";\n  //direction: ", ";\n  //overflow: ", ";\n  transition: all 0.3s;\n  transform-origin: right;\n"])), function (props) {
  return props.isSelfMessage ? props.ownMessageBackground : props.incomingMessageBackground;
}, function (props) {
  return props.borderRadius || '4px 16px 16px 4px';
}, function (props) {
  return props.rtlDirection ? 'initial' : '';
}, function (props) {
  return props.withAttachments ? props.attachmentWidth && props.attachmentWidth < 420 ? props.attachmentWidth < 165 ? props.isReplyMessage ? '210px' : '165px' : props.attachmentWidth + "px" : '420px' : '100%';
}, function (props) {
  return props.withAttachments ? props.isReplyMessage ? '1px 0 0 ' : '0' : props.isSelfMessage ? props.ownMessageBackground === 'inherit' ? '0' : '8px 12px' : props.incomingMessageBackground === 'inherit' ? ' 0' : '8px 12px';
}, function (props) {
  return props.isSelfMessage ? 'initial' : '';
}, function (props) {
  return props.noBody && 'hidden';
});
var MessageContent = styled__default.div(_templateObject21$1 || (_templateObject21$1 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  margin-left: ", ";\n  margin-right: ", ";\n  //transform: ", ";\n  max-width: ", ";\n\n  display: flex;\n  flex-direction: column;\n  pointer-events: ", ";\n"])), function (props) {
  return props.withAvatar && '13px';
}, function (props) {
  return props.withAvatar && '13px';
}, function (props) {
  return !props.withAvatar && (props.rtl ? 'translate(-32px,0)  ' : 'translate(32px,0)');
}, function (props) {
  return props.messageWidthPercent ? props.messageWidthPercent + "%" : '100%';
}, function (props) {
  return props.selectionIsActive && 'none';
});
var VoiceIconWrapper = styled__default(SvgVoiceIcon)(_templateObject22$1 || (_templateObject22$1 = _taggedTemplateLiteralLoose(["\n  transform: translate(0px, 3.5px);\n  color: ", ";\n"])), function (props) {
  return props.color || colors.primary;
});
var MessageItem = styled__default.div(_templateObject23$1 || (_templateObject23$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  position: relative;\n  margin-top: ", ";\n  margin-bottom: ", ";\n  padding: ", ";\n  padding-left: ", ";\n  padding-right: ", ";\n  //transition: all 0.2s;\n  width: 100%;\n  box-sizing: border-box;\n  transition: padding-left 0.2s;\n  cursor: ", ";\n  ", ";\n\n  &:hover {\n    background-color: ", ";\n  }\n\n  &:hover ", " {\n    display: inline-block;\n  }\n  &:hover ", " {\n    display: flex;\n    visibility: visible;\n  }\n\n  &:hover ", " {\n    visibility: visible;\n  }\n"])), function (props) {
  return props.topMargin || '12px';
}, function (props) {
  return props.bottomMargin;
}, function (props) {
  return props.selectMessagesIsActive ? '0 calc(4% + 52px)' : '0 4%';
}, function (props) {
  return !props.withAvatar && !props.rtl && "calc(4% + " + (props.selectMessagesIsActive ? '84px' : '32px') + ")";
}, function (props) {
  return !props.withAvatar && props.rtl && 'calc(4% + 32px)';
}, function (props) {
  return props.selectMessagesIsActive && 'pointer';
}, function (props) {
  return props.rtl && 'direction: rtl;';
}, function (props) {
  return props.hoverBackground || '';
}, HiddenMessageTime, MessageStatusAndTime, MessageStatus);
var EmojiContainer = styled__default.div(_templateObject24$1 || (_templateObject24$1 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: ", ";\n  right: ", ";\n  //top: ", ";\n  top: ", ";\n  bottom: ", ";\n  z-index: 99;\n"])), function (props) {
  return props.rtlDirection ? '' : '0';
}, function (props) {
  return props.rtlDirection && '0';
}, function (props) {
  return props.position === 'top' ? '-250px' : 'calc(100% + 6px)';
}, function (props) {
  return props.position === 'bottom' && 'calc(100% + 4px)';
}, function (props) {
  return props.position === 'top' && 'calc(100% + 4px)';
});
var FrequentlyEmojisContainer = styled__default.div(_templateObject25$1 || (_templateObject25$1 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: ", ";\n  right: ", ";\n  top: -50px;\n  z-index: 99;\n"])), function (props) {
  return props.rtlDirection ? '' : '0';
}, function (props) {
  return props.rtlDirection && '0';
});

var _templateObject$x, _templateObject2$t, _templateObject3$n, _templateObject4$j, _templateObject5$h, _templateObject6$f, _templateObject7$d, _templateObject8$c, _templateObject9$b, _templateObject10$a, _templateObject11$7;
var loading = false;
var loadFromServer = false;
var loadDirection = '';
var nextDisable = false;
var prevDisable = false;
var scrollToBottom = false;
var shouldLoadMessages;
var messagesIndexMap = {};

var CreateMessageDateDivider = function CreateMessageDateDivider(_ref) {
  var lastIndex = _ref.lastIndex,
      currentMessageDate = _ref.currentMessageDate,
      nextMessageDate = _ref.nextMessageDate,
      messagesHasNext = _ref.messagesHasNext,
      dateDividerFontSize = _ref.dateDividerFontSize,
      dateDividerTextColor = _ref.dateDividerTextColor,
      dateDividerBorder = _ref.dateDividerBorder,
      dateDividerBackgroundColor = _ref.dateDividerBackgroundColor,
      dateDividerBorderRadius = _ref.dateDividerBorderRadius,
      noMargin = _ref.noMargin,
      theme = _ref.theme,
      marginBottom = _ref.marginBottom,
      marginTop = _ref.marginTop;
  var today = moment().endOf('day');
  var current = moment(currentMessageDate).endOf('day');
  var differentDays = !(nextMessageDate && current.diff(moment(nextMessageDate).endOf('day'), 'days') === 0);
  var dividerText = '';

  if (differentDays && !today.diff(current, 'days')) {
    dividerText = 'Today';
  } else if (differentDays) {
    dividerText = moment().year() === moment(current).year() ? current.format('MMMM D') : current.format('MMMM D YYYY');
  }

  return !differentDays ? null : /*#__PURE__*/React__default.createElement(MessageDivider, {
    theme: theme,
    dividerText: dividerText,
    visibility: messagesHasNext && lastIndex,
    dateDividerFontSize: dateDividerFontSize,
    dateDividerTextColor: dateDividerTextColor,
    dateDividerBorder: dateDividerBorder,
    dateDividerBackgroundColor: dateDividerBackgroundColor,
    dateDividerBorderRadius: dateDividerBorderRadius,
    noMargin: noMargin,
    marginBottom: marginBottom,
    marginTop: marginTop
  });
};

var MessageList = function MessageList(_ref2) {
  var messages = _ref2.messages,
      fontFamily = _ref2.fontFamily,
      _ref2$ownMessageOnRig = _ref2.ownMessageOnRightSide,
      ownMessageOnRightSide = _ref2$ownMessageOnRig === void 0 ? true : _ref2$ownMessageOnRig,
      messageWidthPercent = _ref2.messageWidthPercent,
      messageStatusAndTimePosition = _ref2.messageStatusAndTimePosition,
      messageStatusDisplayingType = _ref2.messageStatusDisplayingType,
      showMessageStatus = _ref2.showMessageStatus,
      showMessageTimeAndStatusOnlyOnHover = _ref2.showMessageTimeAndStatusOnlyOnHover,
      showMessageTime = _ref2.showMessageTime,
      showMessageStatusForEachMessage = _ref2.showMessageStatusForEachMessage,
      showMessageTimeForEachMessage = _ref2.showMessageTimeForEachMessage,
      _ref2$ownMessageBackg = _ref2.ownMessageBackground,
      ownMessageBackground = _ref2$ownMessageBackg === void 0 ? colors.primaryLight : _ref2$ownMessageBackg,
      _ref2$incomingMessage = _ref2.incomingMessageBackground,
      incomingMessageBackground = _ref2$incomingMessage === void 0 ? colors.backgroundColor : _ref2$incomingMessage,
      _ref2$ownRepliedMessa = _ref2.ownRepliedMessageBackground,
      ownRepliedMessageBackground = _ref2$ownRepliedMessa === void 0 ? colors.ownRepliedMessageBackground : _ref2$ownRepliedMessa,
      _ref2$incomingReplied = _ref2.incomingRepliedMessageBackground,
      incomingRepliedMessageBackground = _ref2$incomingReplied === void 0 ? colors.incomingRepliedMessageBackground : _ref2$incomingReplied,
      _ref2$hoverBackground = _ref2.hoverBackground,
      hoverBackground = _ref2$hoverBackground === void 0 ? false : _ref2$hoverBackground,
      _ref2$showSenderNameO = _ref2.showSenderNameOnDirectChannel,
      showSenderNameOnDirectChannel = _ref2$showSenderNameO === void 0 ? false : _ref2$showSenderNameO,
      _ref2$showSenderNameO2 = _ref2.showSenderNameOnOwnMessages,
      showSenderNameOnOwnMessages = _ref2$showSenderNameO2 === void 0 ? false : _ref2$showSenderNameO2,
      _ref2$showSenderNameO3 = _ref2.showSenderNameOnGroupChannel,
      showSenderNameOnGroupChannel = _ref2$showSenderNameO3 === void 0 ? true : _ref2$showSenderNameO3,
      _ref2$showOwnAvatar = _ref2.showOwnAvatar,
      showOwnAvatar = _ref2$showOwnAvatar === void 0 ? false : _ref2$showOwnAvatar,
      MessageActionsMenu = _ref2.MessageActionsMenu,
      messageReaction = _ref2.messageReaction,
      editMessage = _ref2.editMessage,
      copyMessage = _ref2.copyMessage,
      replyMessage = _ref2.replyMessage,
      replyMessageInThread = _ref2.replyMessageInThread,
      forwardMessage = _ref2.forwardMessage,
      deleteMessage = _ref2.deleteMessage,
      selectMessage = _ref2.selectMessage,
      reportMessage = _ref2.reportMessage,
      reactionIcon = _ref2.reactionIcon,
      editIcon = _ref2.editIcon,
      copyIcon = _ref2.copyIcon,
      replyIcon = _ref2.replyIcon,
      replyInThreadIcon = _ref2.replyInThreadIcon,
      forwardIcon = _ref2.forwardIcon,
      deleteIcon = _ref2.deleteIcon,
      selectIcon = _ref2.selectIcon,
      _ref2$allowEditDelete = _ref2.allowEditDeleteIncomingMessage,
      allowEditDeleteIncomingMessage = _ref2$allowEditDelete === void 0 ? true : _ref2$allowEditDelete,
      starIcon = _ref2.starIcon,
      staredIcon = _ref2.staredIcon,
      reportIcon = _ref2.reportIcon,
      reactionIconOrder = _ref2.reactionIconOrder,
      openFrequentlyUsedReactions = _ref2.openFrequentlyUsedReactions,
      fixEmojiCategoriesTitleOnTop = _ref2.fixEmojiCategoriesTitleOnTop,
      emojisCategoryIconsPosition = _ref2.emojisCategoryIconsPosition,
      emojisContainerBorderRadius = _ref2.emojisContainerBorderRadius,
      reactionsDisplayCount = _ref2.reactionsDisplayCount,
      showEachReactionCount = _ref2.showEachReactionCount,
      showTotalReactionCount = _ref2.showTotalReactionCount,
      reactionItemBorder = _ref2.reactionItemBorder,
      reactionItemBorderRadius = _ref2.reactionItemBorderRadius,
      reactionItemBackground = _ref2.reactionItemBackground,
      reactionItemPadding = _ref2.reactionItemPadding,
      reactionItemMargin = _ref2.reactionItemMargin,
      reactionsFontSize = _ref2.reactionsFontSize,
      reactionsContainerBoxShadow = _ref2.reactionsContainerBoxShadow,
      reactionsContainerBorder = _ref2.reactionsContainerBorder,
      reactionsContainerBorderRadius = _ref2.reactionsContainerBorderRadius,
      reactionsContainerBackground = _ref2.reactionsContainerBackground,
      reactionsContainerPadding = _ref2.reactionsContainerPadding,
      reactionsContainerTopPosition = _ref2.reactionsContainerTopPosition,
      reactionsDetailsPopupBorderRadius = _ref2.reactionsDetailsPopupBorderRadius,
      _ref2$reactionsDetail = _ref2.reactionsDetailsPopupHeaderItemsStyle,
      reactionsDetailsPopupHeaderItemsStyle = _ref2$reactionsDetail === void 0 ? 'bubbles' : _ref2$reactionsDetail,
      editIconOrder = _ref2.editIconOrder,
      copyIconOrder = _ref2.copyIconOrder,
      replyIconOrder = _ref2.replyIconOrder,
      replyInThreadIconOrder = _ref2.replyInThreadIconOrder,
      forwardIconOrder = _ref2.forwardIconOrder,
      deleteIconOrder = _ref2.deleteIconOrder,
      selectIconOrder = _ref2.selectIconOrder,
      starIconOrder = _ref2.starIconOrder,
      reportIconOrder = _ref2.reportIconOrder,
      reactionIconTooltipText = _ref2.reactionIconTooltipText,
      editIconTooltipText = _ref2.editIconTooltipText,
      copyIconTooltipText = _ref2.copyIconTooltipText,
      replyIconTooltipText = _ref2.replyIconTooltipText,
      replyInThreadIconTooltipText = _ref2.replyInThreadIconTooltipText,
      forwardIconTooltipText = _ref2.forwardIconTooltipText,
      deleteIconTooltipText = _ref2.deleteIconTooltipText,
      selectIconTooltipText = _ref2.selectIconTooltipText,
      starIconTooltipText = _ref2.starIconTooltipText,
      reportIconTooltipText = _ref2.reportIconTooltipText,
      messageActionIconsColor = _ref2.messageActionIconsColor,
      dateDividerFontSize = _ref2.dateDividerFontSize,
      dateDividerTextColor = _ref2.dateDividerTextColor,
      dateDividerBorder = _ref2.dateDividerBorder,
      dateDividerBackgroundColor = _ref2.dateDividerBackgroundColor,
      dateDividerBorderRadius = _ref2.dateDividerBorderRadius,
      _ref2$showTopFixedDat = _ref2.showTopFixedDate,
      showTopFixedDate = _ref2$showTopFixedDat === void 0 ? true : _ref2$showTopFixedDat,
      inlineReactionIcon = _ref2.inlineReactionIcon,
      newMessagesSeparatorText = _ref2.newMessagesSeparatorText,
      newMessagesSeparatorFontSize = _ref2.newMessagesSeparatorFontSize,
      newMessagesSeparatorTextColor = _ref2.newMessagesSeparatorTextColor,
      newMessagesSeparatorWidth = _ref2.newMessagesSeparatorWidth,
      newMessagesSeparatorBorder = _ref2.newMessagesSeparatorBorder,
      newMessagesSeparatorBorderRadius = _ref2.newMessagesSeparatorBorderRadius,
      newMessagesSeparatorBackground = _ref2.newMessagesSeparatorBackground,
      newMessagesSeparatorTextLeftRightSpacesWidth = _ref2.newMessagesSeparatorTextLeftRightSpacesWidth,
      fileAttachmentsIcon = _ref2.fileAttachmentsIcon,
      fileAttachmentsBoxWidth = _ref2.fileAttachmentsBoxWidth,
      fileAttachmentsBoxBackground = _ref2.fileAttachmentsBoxBackground,
      fileAttachmentsBoxBorder = _ref2.fileAttachmentsBoxBorder,
      fileAttachmentsTitleColor = _ref2.fileAttachmentsTitleColor,
      fileAttachmentsSizeColor = _ref2.fileAttachmentsSizeColor,
      imageAttachmentMaxWidth = _ref2.imageAttachmentMaxWidth,
      imageAttachmentMaxHeight = _ref2.imageAttachmentMaxHeight,
      videoAttachmentMaxWidth = _ref2.videoAttachmentMaxWidth,
      videoAttachmentMaxHeight = _ref2.videoAttachmentMaxHeight,
      _ref2$attachmentsPrev = _ref2.attachmentsPreview,
      attachmentsPreview = _ref2$attachmentsPrev === void 0 ? true : _ref2$attachmentsPrev,
      sameUserMessageSpacing = _ref2.sameUserMessageSpacing,
      differentUserMessageSpacing = _ref2.differentUserMessageSpacing;
  var dispatch = reactRedux.useDispatch();
  var theme = reactRedux.useSelector(themeSelector);
  var getFromContacts = getShowOnlyContactUsers();
  var channel = reactRedux.useSelector(activeChannelSelector);
  var ChatClient = getClient();
  var user = ChatClient.user;
  var contactsMap = reactRedux.useSelector(contactsMapSelector, reactRedux.shallowEqual);
  var connectionStatus = reactRedux.useSelector(connectionStatusSelector, reactRedux.shallowEqual);
  var openedMessageMenuId = reactRedux.useSelector(openedMessageMenuSelector, reactRedux.shallowEqual);
  var tabIsActive = reactRedux.useSelector(tabIsActiveSelector, reactRedux.shallowEqual);
  var selectedMessagesMap = reactRedux.useSelector(selectedMessagesMapSelector);
  var scrollToNewMessage = reactRedux.useSelector(scrollToNewMessageSelector, reactRedux.shallowEqual);
  var scrollToRepliedMessage = reactRedux.useSelector(scrollToMessageSelector, reactRedux.shallowEqual);
  var browserTabIsActive = reactRedux.useSelector(browserTabIsActiveSelector, reactRedux.shallowEqual);
  var hasNextMessages = reactRedux.useSelector(messagesHasNextSelector, reactRedux.shallowEqual);
  var hasPrevMessages = reactRedux.useSelector(messagesHasPrevSelector, reactRedux.shallowEqual);
  var messagesLoading = reactRedux.useSelector(messagesLoadingState);
  var draggingSelector = reactRedux.useSelector(isDraggingSelector, reactRedux.shallowEqual);

  var _useState = React.useState(''),
      unreadMessageId = _useState[0],
      setUnreadMessageId = _useState[1];

  var _useState2 = React.useState(null),
      mediaFile = _useState2[0],
      setMediaFile = _useState2[1];

  var _useState3 = React.useState(null),
      isDragging = _useState3[0],
      setIsDragging = _useState3[1];

  var _useState4 = React.useState(null),
      showTopDate = _useState4[0],
      setShowTopDate = _useState4[1];

  var _useState5 = React.useState(false),
      stopScrolling = _useState5[0],
      setStopScrolling = _useState5[1];

  var hideTopDateTimeout = React.useRef(null);

  var _useState6 = React.useState(''),
      lastVisibleMessageId = _useState6[0],
      _setLastVisibleMessageId = _useState6[1];

  var _useState7 = React.useState(null),
      scrollToReply = _useState7[0],
      setScrollToReply = _useState7[1];

  var messageForReply = {};
  var messageList = React.useMemo(function () {
    return messages;
  }, [messages]);
  var attachmentsSelected = false;
  var messagesBoxRef = React.useRef(null);
  var messageTopDateRef = React.useRef(null);
  var scrollRef = React.useRef(null);

  var renderTopDate = function renderTopDate() {
    var dateLabels = document.querySelectorAll('.divider');
    var messageTopDate = messageTopDateRef.current;
    var text = '';

    for (var i = dateLabels.length - 1; i >= 0; i--) {
      var _dateLabel$firstChild;

      var dateLabel = dateLabels[i];
      var span = dateLabel === null || dateLabel === void 0 ? void 0 : (_dateLabel$firstChild = dateLabel.firstChild) === null || _dateLabel$firstChild === void 0 ? void 0 : _dateLabel$firstChild.firstChild;

      if (!text && scrollRef.current.scrollTop > dateLabel.offsetTop) {
        text = span && span.innerText;
        span.style.display = 'none';
      } else {
        span.style.display = 'block';
      }
    }

    if (text) {
      messageTopDate.innerText = text;
      messageTopDate.style.display = 'inline';
    } else {
      messageTopDate.style.display = 'none';
    }
  };

  var handleMessagesListScroll = function handleMessagesListScroll(event) {
    try {
      setShowTopDate(true);
      clearTimeout(hideTopDateTimeout.current);
      hideTopDateTimeout.current = setTimeout(function () {
        setShowTopDate(false);
      }, 1000);
      renderTopDate();
      var target = event.target;
      var forceLoadPrevMessages = false;

      if (-target.scrollTop + target.offsetHeight + 30 > target.scrollHeight) {
        forceLoadPrevMessages = true;
      }

      if (target.scrollTop === 0 && scrollToNewMessage.scrollToBottom && scrollToNewMessage.updateMessageList && messagesLoading !== LOADING_STATE.LOADING) {
        dispatch(getMessagesAC(channel, true));
      }

      if (scrollToReply) {
        target.scrollTop = scrollToReply;
      } else {
        if (target.scrollTop <= -50) {
          dispatch(showScrollToNewMessageButtonAC(true));
        } else {
          dispatch(showScrollToNewMessageButtonAC(false));
        }

        if (messagesIndexMap[lastVisibleMessageId] < 15 || forceLoadPrevMessages) {
          if (connectionStatus === CONNECTION_STATUS.CONNECTED && !scrollToNewMessage.scrollToBottom && hasPrevMessages) {
            if (messagesLoading === LOADING_STATE.LOADING || loading || prevDisable) {
              shouldLoadMessages = 'prev';
            } else {
              if (shouldLoadMessages === 'prev') {
                shouldLoadMessages = '';
              }

              loadDirection = 'prev';
              handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.PREV, LOAD_MAX_MESSAGE_COUNT);

              if (!getHasPrevCached()) {
                loadFromServer = true;
              }

              nextDisable = true;
            }
          }
        }

        if (messagesIndexMap[lastVisibleMessageId] > messages.length - 15) {
          if (connectionStatus === CONNECTION_STATUS.CONNECTED && !scrollToNewMessage.scrollToBottom && (hasNextMessages || getHasNextCached())) {
            if (messagesLoading === LOADING_STATE.LOADING || loading || nextDisable) {
              shouldLoadMessages = 'next';
            } else {
              if (shouldLoadMessages === 'next') {
                shouldLoadMessages = '';
              }

              loadDirection = 'next';
              prevDisable = true;
              handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.NEXT, LOAD_MAX_MESSAGE_COUNT);
            }
          }
        }

        if (messagesIndexMap[lastVisibleMessageId] > messages.length - 10) {
          nextDisable = false;
        }
      }

      return Promise.resolve();
    } catch (e) {
      return Promise.reject(e);
    }
  };

  var handleScrollToRepliedMessage = function handleScrollToRepliedMessage(messageId) {
    try {
      console.log('set prev disabled ............ . . . . 2. .');
      prevDisable = true;
      nextDisable = true;

      if (messages.findIndex(function (msg) {
        return msg.id === messageId;
      }) >= 10) {
        var repliedMessage = document.getElementById(messageId);

        if (repliedMessage) {
          scrollRef.current.scrollTop = repliedMessage.offsetTop - scrollRef.current.offsetHeight / 2;
          repliedMessage.classList.add('highlight');
          setTimeout(function () {
            repliedMessage.classList.remove('highlight');
            prevDisable = false;
            nextDisable = false;
          }, 1000);
        }
      } else {
        dispatch(getMessagesAC(channel, undefined, messageId));
      }

      return Promise.resolve();
    } catch (e) {
      return Promise.reject(e);
    }
  };

  var handleLoadMoreMessages = function handleLoadMoreMessages(direction, limit) {
    var lastMessageId = messages.length && messages[messages.length - 1].id;
    var firstMessageId = messages.length && messages[0].id;
    var hasPrevCached = getHasPrevCached();
    var hasNextCached = getHasNextCached();

    if (!loading && connectionStatus === CONNECTION_STATUS.CONNECTED) {
      if (direction === MESSAGE_LOAD_DIRECTION.PREV && firstMessageId && (hasPrevMessages || hasPrevCached)) {
        loading = true;
        dispatch(loadMoreMessagesAC(channel.id, limit, direction, firstMessageId, hasPrevMessages));
      } else if (direction === MESSAGE_LOAD_DIRECTION.NEXT && lastMessageId && (hasNextMessages || hasNextCached)) {
        loading = true;
        dispatch(loadMoreMessagesAC(channel.id, limit, direction, lastMessageId, hasNextMessages));
      }
    }
  };

  var handleDragIn = function handleDragIn(e) {
    e.preventDefault();

    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {
      var filesType = 'file';
      var fileList = Array.from(e.dataTransfer.items);
      fileList.forEach(function (file) {
        var fileType = file.type.split('/')[0];

        if (fileType === 'image' || fileType === 'video') {
          filesType = 'media';
        }
      });
      setIsDragging(filesType);
    }
  };

  var handleDragOver = function handleDragOver(e) {
    e.preventDefault();
    e.target && e.target.classList.add('dragover');
  };

  var handleDragOut = function handleDragOut(e) {
    if (e.target.classList.contains('dragover')) {
      e.target.classList.remove('dragover');
    }

    if (!e.relatedTarget || !e.relatedTarget.draggable) {
      setIsDragging(false);
    }
  };

  var handleDropFile = function handleDropFile(e) {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);

    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      var fileList = Object.values(e.dataTransfer.files);
      var attachmentsFiles = [];
      new Promise(function (resolve) {
        fileList.forEach(function (attachment, index) {
          var fileReader = new FileReader();

          fileReader.onload = function (event) {
            var file = event.target.result;
            attachmentsFiles.push({
              name: attachment.name,
              data: file,
              type: attachment.type
            });

            if (fileList.length - 1 === index) {
              resolve();
            }
          };

          fileReader.readAsDataURL(attachment);
        });
      }).then(function () {
        dispatch(setDraggedAttachments(attachmentsFiles, 'file'));
      });
      e.dataTransfer.clearData();
    }
  };

  var handleDropMedia = function handleDropMedia(e) {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
    var fileList = Array.from(e.dataTransfer.items);
    fileList.forEach(function (file) {
      var fileType = file.type.split('/')[0];
      console.log('file. .. . ', file.getAsFile());
      console.log('fileType. .. . ', fileType);
    });

    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      var _fileList = Object.values(e.dataTransfer.files);

      var attachmentsFiles = [];
      new Promise(function (resolve) {
        _fileList.forEach(function (attachment, index) {
          var fileReader = new FileReader();

          fileReader.onload = function (event) {
            var file = event.target.result;
            attachmentsFiles.push({
              name: attachment.name,
              data: file,
              type: attachment.type
            });

            if (_fileList.length - 1 === index) {
              resolve();
            }
          };

          fileReader.readAsDataURL(attachment);
        });
      }).then(function () {
        dispatch(setDraggedAttachments(attachmentsFiles, 'media'));
      });
      e.dataTransfer.clearData();
    }
  };

  React.useEffect(function () {
    if (scrollToRepliedMessage) {
      loading = false;
      scrollRef.current.style.scrollBehavior = 'inherit';
      var repliedMessage = document.getElementById(scrollToRepliedMessage);

      if (repliedMessage) {
        setScrollToReply(repliedMessage && repliedMessage.offsetTop - (channel.backToLinkedChannel ? 0 : 200));
        scrollRef.current.scrollTop = repliedMessage && repliedMessage.offsetTop - (channel.backToLinkedChannel ? 0 : 200);

        if (!channel.backToLinkedChannel) {
          repliedMessage && repliedMessage.classList.add('highlight');
        }

        setTimeout(function () {
          if (!channel.backToLinkedChannel) {
            var _repliedMessage = document.getElementById(scrollToRepliedMessage);

            _repliedMessage && _repliedMessage.classList.remove('highlight');
          }

          prevDisable = false;
          setScrollToReply(null);
          scrollRef.current.style.scrollBehavior = 'smooth';
        }, 800);
      }

      dispatch(setScrollToMessagesAC(null));
    }
  }, [scrollToRepliedMessage]);
  React.useEffect(function () {
    if (scrollToNewMessage.scrollToBottom) {
      if (scrollToNewMessage.isIncomingMessage) {
        if (scrollRef.current.scrollTop > -100) {
          scrollRef.current.scrollTop = 0;
        }
      } else {
        nextDisable = true;
        prevDisable = true;
        scrollRef.current.scrollTop = 0;
        dispatch(showScrollToNewMessageButtonAC(false));
        setTimeout(function () {
          prevDisable = false;
        }, 800);
      }
    }
  }, [scrollToNewMessage]);
  useDidUpdate(function () {
    if (isDragging) {
      setIsDragging(false);
    }
  }, [browserTabIsActive]);
  useDidUpdate(function () {
    if (!mediaFile && isDragging) {
      setIsDragging(false);
    }
  }, [mediaFile]);
  useDidUpdate(function () {
    if (!draggingSelector) {
      setIsDragging(false);
    }
  }, [draggingSelector]);
  React.useEffect(function () {
    setHasNextCached(false);
    setHasPrevCached(false);

    if (channel.backToLinkedChannel) {
      var visibleMessages = getVisibleMessagesMap();
      var visibleMessagesIds = Object.keys(visibleMessages);
      var messageId = visibleMessagesIds[visibleMessagesIds.length - 1];
      dispatch(getMessagesAC(channel, undefined, messageId));
      setUnreadMessageId(messageId);
    } else {
      if (!channel.isLinkedChannel) {
        clearVisibleMessagesMap();
      }

      dispatch(getMessagesAC(channel));

      if (channel.id) {
        if (channel.newMessageCount && channel.newMessageCount > 0) {
          setUnreadMessageId(channel.lastDisplayedMsgId);
        } else {
          setUnreadMessageId('');
        }
      }
    }

    if (selectedMessagesMap && selectedMessagesMap.size) {
      dispatch(clearSelectedMessagesAC());
    }

    nextDisable = false;
    prevDisable = false;
    scrollToBottom = true;
    setAllowEditDeleteIncomingMessage(allowEditDeleteIncomingMessage);
  }, [channel.id]);
  useDidUpdate(function () {
    if (!isDragging) {
      renderTopDate();
    }
  }, [isDragging]);
  React.useEffect(function () {
    if (loading) {
      if (loadDirection !== 'next') {
        var lastVisibleMessage = document.getElementById(lastVisibleMessageId);

        if (lastVisibleMessage) {
          scrollRef.current.style.scrollBehavior = 'inherit';
          scrollRef.current.scrollTop = lastVisibleMessage.offsetTop;
          scrollRef.current.style.scrollBehavior = 'smooth';
        }

        if (loadFromServer) {
          setTimeout(function () {
            loading = false;
            loadFromServer = false;
            nextDisable = false;

            if (shouldLoadMessages === 'prev' && messagesIndexMap[lastVisibleMessageId] < 15) {
              handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.PREV, LOAD_MAX_MESSAGE_COUNT);
            }

            if (shouldLoadMessages === 'next' && messagesIndexMap[lastVisibleMessageId] > messages.length - 15) {
              handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.NEXT, LOAD_MAX_MESSAGE_COUNT);
            }
          }, 50);
        } else {
          loading = false;

          if (shouldLoadMessages === 'prev') {
            handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.PREV, LOAD_MAX_MESSAGE_COUNT);
            shouldLoadMessages = '';
          }

          if (shouldLoadMessages === 'next') {
            handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.NEXT, LOAD_MAX_MESSAGE_COUNT);
            shouldLoadMessages = '';
          }
        }
      } else {
        var _lastVisibleMessage = document.getElementById(lastVisibleMessageId);

        if (_lastVisibleMessage) {
          scrollRef.current.style.scrollBehavior = 'inherit';
          scrollRef.current.scrollTop = _lastVisibleMessage.offsetTop - scrollRef.current.offsetHeight + _lastVisibleMessage.offsetHeight;
          scrollRef.current.style.scrollBehavior = 'smooth';
        }

        loading = false;
        prevDisable = false;

        if (shouldLoadMessages === 'prev') {
          handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.PREV, LOAD_MAX_MESSAGE_COUNT);
          shouldLoadMessages = '';
        }

        if (shouldLoadMessages === 'next') {
          handleLoadMoreMessages(MESSAGE_LOAD_DIRECTION.NEXT, LOAD_MAX_MESSAGE_COUNT);
          shouldLoadMessages = '';
        }
      }
    }

    if (scrollToNewMessage.scrollToBottom && messages.length) {
      setTimeout(function () {
        dispatch(scrollToNewMessageAC(false, false, false));
      }, 500);
    }

    renderTopDate();

    if (scrollToBottom) {
      dispatch(scrollToNewMessageAC(true));
      scrollToBottom = false;
    }

    console.log('messages...', messages);
  }, [messages]);
  useDidUpdate(function () {
    console.log('connection status is changed.. .... ', connectionStatus, 'channel  ... ', channel);

    if (connectionStatus === CONNECTION_STATUS.CONNECTED) {
      loading = false;
      prevDisable = false;
      nextDisable = false;
      clearMessagesMap();
      removeAllMessages();

      if (channel.id) {
        console.log('should get messages...');
        dispatch(getMessagesAC(channel));
      }
    }
  }, [connectionStatus]);
  React.useEffect(function () {
    if (channel.newMessageCount && channel.newMessageCount > 0 && getUnreadScrollTo()) {
      if (scrollRef.current) {
        scrollRef.current.style.scrollBehavior = 'inherit';
      }

      var lastReadMessageNode = document.getElementById(channel.lastDisplayedMsgId);

      if (lastReadMessageNode) {
        scrollRef.current.scrollTop = lastReadMessageNode.offsetTop;

        if (scrollRef.current) {
          scrollRef.current.style.scrollBehavior = 'smooth';
        }

        setUnreadScrollTo(false);
      }
    }
  });
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, isDragging && !(attachmentsPreview && mediaFile) && /*#__PURE__*/React__default.createElement(DragAndDropContainer, {
    id: 'draggingContainer',
    draggable: true,
    onDragLeave: handleDragOut,
    topOffset: scrollRef && scrollRef.current && scrollRef.current.offsetTop,
    height: scrollRef && scrollRef.current && scrollRef.current.offsetHeight
  }, /*#__PURE__*/React__default.createElement(DropAttachmentArea, {
    margin: '32px 32px 12px',
    draggable: true,
    onDrop: handleDropFile,
    onDragOver: handleDragOver
  }, /*#__PURE__*/React__default.createElement(IconWrapper, {
    draggable: true,
    iconColor: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgChoseFile, null)), "Drag & drop to send as file"), isDragging === 'media' && /*#__PURE__*/React__default.createElement(DropAttachmentArea, {
    draggable: true,
    onDrop: handleDropMedia,
    onDragOver: handleDragOver
  }, /*#__PURE__*/React__default.createElement(IconWrapper, {
    draggable: true,
    iconColor: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgChoseMedia, null)), "Drag & drop to send as media")), /*#__PURE__*/React__default.createElement(React__default.Fragment, null, showTopFixedDate && /*#__PURE__*/React__default.createElement(MessageTopDate, {
    visible: showTopDate,
    dateDividerFontSize: dateDividerFontSize,
    dateDividerTextColor: dateDividerTextColor || colors.textColor1,
    dateDividerBorder: dateDividerBorder,
    dateDividerBackgroundColor: dateDividerBackgroundColor || colors.backgroundColor,
    dateDividerBorderRadius: dateDividerBorderRadius,
    topOffset: scrollRef && scrollRef.current && scrollRef.current.offsetTop
  }, /*#__PURE__*/React__default.createElement("span", {
    ref: messageTopDateRef
  })), /*#__PURE__*/React__default.createElement(Container$g, {
    id: 'scrollableDiv',
    ref: scrollRef,
    stopScrolling: stopScrolling,
    onScroll: handleMessagesListScroll,
    onDragEnter: handleDragIn
  }, messages.length && messages.length > 0 ? /*#__PURE__*/React__default.createElement(MessagesBox, {
    enableResetScrollToCoords: false,
    replyMessage: messageForReply && messageForReply.id,
    attachmentsSelected: attachmentsSelected,
    ref: messagesBoxRef,
    className: 'messageBox'
  }, messageList.map(function (message, index) {
    var prevMessage = messages[index - 1];
    var nextMessage = messages[index + 1];
    var isUnreadMessage = !!(unreadMessageId && unreadMessageId === message.id && nextMessage) && !channel.backToLinkedChannel;
    var messageMetas = isJSON(message.metadata) ? JSON.parse(message.metadata) : message.metadata;
    messagesIndexMap[message.id] = index;
    return /*#__PURE__*/React__default.createElement(React__default.Fragment, {
      key: message.id || message.tid
    }, /*#__PURE__*/React__default.createElement(CreateMessageDateDivider, {
      noMargin: !isUnreadMessage && prevMessage && prevMessage.type === 'system' && message.type !== 'system',
      theme: theme,
      lastIndex: false,
      currentMessageDate: message.createdAt,
      nextMessageDate: prevMessage && prevMessage.createdAt,
      messagesHasNext: hasPrevMessages,
      dateDividerFontSize: dateDividerFontSize,
      dateDividerTextColor: dateDividerTextColor,
      dateDividerBorder: dateDividerBorder,
      dateDividerBackgroundColor: dateDividerBackgroundColor,
      dateDividerBorderRadius: dateDividerBorderRadius,
      marginBottom: prevMessage && prevMessage.type === 'system' && message.type !== 'system' ? '16px' : '0',
      marginTop: differentUserMessageSpacing
    }), message.type === 'system' ? /*#__PURE__*/React__default.createElement(MessageTopDate, {
      systemMessage: true,
      marginTop: message.type === 'system' && (differentUserMessageSpacing || '16px'),
      marginBottom: message.type === 'system' && nextMessage && nextMessage.type !== 'system' && (differentUserMessageSpacing || '16px'),
      visible: showTopFixedDate,
      dividerText: message.body,
      dateDividerFontSize: dateDividerFontSize,
      dateDividerTextColor: dateDividerTextColor || colors.textColor1,
      dateDividerBorder: dateDividerBorder,
      dateDividerBackgroundColor: dateDividerBackgroundColor || colors.backgroundColor,
      dateDividerBorderRadius: dateDividerBorderRadius
    }, /*#__PURE__*/React__default.createElement("span", null, message.incoming ? makeUsername(message.user && contactsMap[message.user.id], message.user, getFromContacts) : 'You', message.body === 'CC' ? ' created this channel ' : message.body === 'CG' ? ' created this group' : message.body === 'AM' ? " added " + (!!(messageMetas && messageMetas.m) && messageMetas.m.slice(0, 5).map(function (mem) {
      return mem === user.id ? 'You' : " " + systemMessageUserName(contactsMap[mem], mem);
    })) + " " + (messageMetas && messageMetas.m && messageMetas.m.length > 5 ? "and " + (messageMetas.m.length - 5) + " more" : '') : message.body === 'RM' ? " removed " + (messageMetas && messageMetas.m && messageMetas.m.slice(0, 5).map(function (mem) {
      return mem === user.id ? 'You' : " " + systemMessageUserName(contactsMap[mem], mem);
    })) + " " + (messageMetas && messageMetas.m && messageMetas.m.length > 5 ? "and " + (messageMetas.m.length - 5) + " more" : '') : message.body === 'LG' ? ' left the group' : '')) : /*#__PURE__*/React__default.createElement(MessageWrapper, {
      id: message.id
    }, /*#__PURE__*/React__default.createElement(Message$1, {
      message: _extends({}, message, {
        metadata: messageMetas
      }),
      channel: channel,
      stopScrolling: setStopScrolling,
      handleMediaItemClick: function handleMediaItemClick(attachment) {
        return setMediaFile(attachment);
      },
      handleScrollToRepliedMessage: handleScrollToRepliedMessage,
      prevMessage: prevMessage,
      nextMessage: nextMessage,
      isUnreadMessage: isUnreadMessage,
      unreadMessageId: unreadMessageId,
      setLastVisibleMessageId: function setLastVisibleMessageId(msgId) {
        return _setLastVisibleMessageId(msgId);
      },
      isThreadMessage: false,
      fontFamily: fontFamily,
      ownMessageOnRightSide: ownMessageOnRightSide,
      messageWidthPercent: messageWidthPercent,
      messageStatusAndTimePosition: messageStatusAndTimePosition,
      messageStatusDisplayingType: messageStatusDisplayingType,
      ownMessageBackground: ownMessageBackground,
      ownRepliedMessageBackground: ownRepliedMessageBackground,
      incomingMessageBackground: incomingMessageBackground,
      incomingRepliedMessageBackground: incomingRepliedMessageBackground,
      showMessageStatus: showMessageStatus,
      showMessageTimeAndStatusOnlyOnHover: showMessageTimeAndStatusOnlyOnHover,
      showMessageTime: showMessageTime,
      showMessageStatusForEachMessage: showMessageStatusForEachMessage,
      showMessageTimeForEachMessage: showMessageTimeForEachMessage,
      hoverBackground: hoverBackground,
      showOwnAvatar: showOwnAvatar,
      showSenderNameOnDirectChannel: showSenderNameOnDirectChannel,
      showSenderNameOnOwnMessages: showSenderNameOnOwnMessages,
      showSenderNameOnGroupChannel: showSenderNameOnGroupChannel,
      MessageActionsMenu: MessageActionsMenu,
      messageReaction: messageReaction,
      editMessage: editMessage,
      copyMessage: copyMessage,
      replyMessage: replyMessage,
      replyMessageInThread: replyMessageInThread,
      deleteMessage: deleteMessage,
      selectMessage: selectMessage,
      allowEditDeleteIncomingMessage: allowEditDeleteIncomingMessage,
      reportMessage: reportMessage,
      reactionIcon: reactionIcon,
      editIcon: editIcon,
      copyIcon: copyIcon,
      replyIcon: replyIcon,
      replyInThreadIcon: replyInThreadIcon,
      forwardIcon: forwardIcon,
      deleteIcon: deleteIcon,
      selectIcon: selectIcon,
      forwardMessage: forwardMessage,
      starIcon: starIcon,
      staredIcon: staredIcon,
      reportIcon: reportIcon,
      reactionIconOrder: reactionIconOrder,
      openFrequentlyUsedReactions: openFrequentlyUsedReactions,
      emojisCategoryIconsPosition: emojisCategoryIconsPosition,
      emojisContainerBorderRadius: emojisContainerBorderRadius,
      fixEmojiCategoriesTitleOnTop: fixEmojiCategoriesTitleOnTop,
      editIconOrder: editIconOrder,
      copyIconOrder: copyIconOrder,
      replyIconOrder: replyIconOrder,
      replyInThreadIconOrder: replyInThreadIconOrder,
      forwardIconOrder: forwardIconOrder,
      deleteIconOrder: deleteIconOrder,
      selectIconOrder: selectIconOrder,
      starIconOrder: starIconOrder,
      reportIconOrder: reportIconOrder,
      reactionIconTooltipText: reactionIconTooltipText,
      editIconTooltipText: editIconTooltipText,
      copyIconTooltipText: copyIconTooltipText,
      replyIconTooltipText: replyIconTooltipText,
      replyInThreadIconTooltipText: replyInThreadIconTooltipText,
      forwardIconTooltipText: forwardIconTooltipText,
      deleteIconTooltipText: deleteIconTooltipText,
      selectIconTooltipText: selectIconTooltipText,
      starIconTooltipText: starIconTooltipText,
      reportIconTooltipText: reportIconTooltipText,
      messageActionIconsColor: messageActionIconsColor,
      inlineReactionIcon: inlineReactionIcon,
      fileAttachmentsIcon: fileAttachmentsIcon,
      fileAttachmentsBoxWidth: fileAttachmentsBoxWidth,
      fileAttachmentsBoxBackground: fileAttachmentsBoxBackground,
      fileAttachmentsBoxBorder: fileAttachmentsBoxBorder,
      fileAttachmentsTitleColor: fileAttachmentsTitleColor,
      fileAttachmentsSizeColor: fileAttachmentsSizeColor,
      imageAttachmentMaxWidth: imageAttachmentMaxWidth,
      imageAttachmentMaxHeight: imageAttachmentMaxHeight,
      videoAttachmentMaxWidth: videoAttachmentMaxWidth,
      videoAttachmentMaxHeight: videoAttachmentMaxHeight,
      reactionsDisplayCount: reactionsDisplayCount,
      showEachReactionCount: showEachReactionCount,
      showTotalReactionCount: showTotalReactionCount,
      reactionItemBorder: reactionItemBorder,
      reactionItemBorderRadius: reactionItemBorderRadius,
      reactionItemBackground: reactionItemBackground,
      reactionItemPadding: reactionItemPadding,
      reactionItemMargin: reactionItemMargin,
      reactionsFontSize: reactionsFontSize,
      reactionsContainerBoxShadow: reactionsContainerBoxShadow,
      reactionsContainerBorder: reactionsContainerBorder,
      reactionsContainerBorderRadius: reactionsContainerBorderRadius,
      reactionsContainerPadding: reactionsContainerPadding,
      reactionsContainerBackground: reactionsContainerBackground,
      reactionsContainerTopPosition: reactionsContainerTopPosition,
      reactionsDetailsPopupBorderRadius: reactionsDetailsPopupBorderRadius,
      reactionsDetailsPopupHeaderItemsStyle: reactionsDetailsPopupHeaderItemsStyle,
      sameUserMessageSpacing: sameUserMessageSpacing,
      differentUserMessageSpacing: differentUserMessageSpacing,
      selectedMessagesMap: selectedMessagesMap,
      contactsMap: contactsMap,
      connectionStatus: connectionStatus,
      openedMessageMenuId: openedMessageMenuId,
      tabIsActive: tabIsActive
    })), isUnreadMessage ? /*#__PURE__*/React__default.createElement(MessageDivider, {
      theme: theme,
      newMessagesSeparatorTextColor: newMessagesSeparatorTextColor,
      newMessagesSeparatorFontSize: newMessagesSeparatorFontSize,
      newMessagesSeparatorWidth: newMessagesSeparatorWidth,
      newMessagesSeparatorBorder: newMessagesSeparatorBorder,
      newMessagesSeparatorBorderRadius: newMessagesSeparatorBorderRadius,
      newMessagesSeparatorBackground: newMessagesSeparatorBackground,
      newMessagesSeparatorLeftRightSpaceWidth: newMessagesSeparatorTextLeftRightSpacesWidth,
      dividerText: newMessagesSeparatorText || 'Unread Messages',
      marginTop: message.type === 'system' ? '0px' : '',
      marginBottom: message.type === 'system' ? '16px' : '0',
      unread: true
    }) : null);
  })) : messagesLoading === LOADING_STATE.LOADED && /*#__PURE__*/React__default.createElement(NoMessagesContainer, {
    color: colors.textColor1
  }, /*#__PURE__*/React__default.createElement(SvgNoMessagesIcon, null), /*#__PURE__*/React__default.createElement(NoMessagesTitle, {
    color: colors.textColor1
  }, "No Messages yet"), /*#__PURE__*/React__default.createElement(NoMessagesText, {
    color: colors.textColor2
  }, "No messages yet, start the chat")), attachmentsPreview && mediaFile && /*#__PURE__*/React__default.createElement(SliderPopup, {
    channelId: channel.id,
    setIsSliderOpen: setMediaFile,
    currentMediaFile: mediaFile
  }))));
};
var Container$g = styled__default.div(_templateObject$x || (_templateObject$x = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column-reverse;\n  //flex-direction: column;\n  flex-grow: 1;\n  position: relative;\n  //overflow: ", ";\n  overflow: auto;\n  scroll-behavior: smooth;\n  will-change: left, top;\n"])), function (props) {
  return props.stopScrolling ? 'hidden' : 'auto';
});
var EmptyDiv = styled__default.div(_templateObject2$t || (_templateObject2$t = _taggedTemplateLiteralLoose(["\n  height: 300px;\n"])));
var MessagesBox = styled__default.div(_templateObject3$n || (_templateObject3$n = _taggedTemplateLiteralLoose(["\n  //height: auto;\n  display: flex;\n  //flex-direction: column-reverse;\n  flex-direction: column;\n  padding-bottom: 20px;\n  //overflow: auto;\n  //scroll-behavior: unset;\n"])));
var MessageTopDate = styled__default.div(_templateObject4$j || (_templateObject4$j = _taggedTemplateLiteralLoose(["\n  position: ", ";\n  display: ", ";\n  justify-content: center;\n  width: 100%;\n  top: ", ";\n  left: 0;\n  margin-top: ", ";\n  margin-bottom: ", ";\n  text-align: center;\n  z-index: 10;\n  background: transparent;\n  opacity: ", ";\n  transition: all 0.2s ease-in-out;\n  span {\n    //display: ", ";\n    display: inline-block;\n    max-width: 380px;\n    font-style: normal;\n    font-weight: normal;\n    font-size: ", ";\n    color: ", ";\n    background: ", ";\n    border: ", ";\n    box-sizing: border-box;\n    border-radius: ", ";\n    padding: 5px 16px;\n    box-shadow: 0 0 2px rgba(0, 0, 0, 0.08), 0 2px 24px rgba(0, 0, 0, 0.08);\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n"])), function (props) {
  return props.systemMessage ? '' : 'absolute';
}, function (props) {
  return props.systemMessage && 'inline-flex';
}, function (props) {
  return props.topOffset ? props.topOffset + 22 + "px" : '22px';
}, function (props) {
  return props.marginTop;
}, function (props) {
  return props.marginBottom;
}, function (props) {
  return props.visible ? '1' : '0';
}, function (props) {
  return !props.systemMessage && 'none';
}, function (props) {
  return props.dateDividerFontSize || '14px';
}, function (props) {
  return props.dateDividerTextColor || colors.textColor1;
}, function (props) {
  return props.dateDividerBackgroundColor || '#ffffff';
}, function (props) {
  return props.dateDividerBorder;
}, function (props) {
  return props.dateDividerBorderRadius || '14px';
});
var DragAndDropContainer = styled__default.div(_templateObject5$h || (_templateObject5$h = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n  margin-bottom: -31px;\n  margin-top: -2px;\n\n  position: absolute;\n  left: 0;\n  top: ", ";\n  width: 100%;\n  height: ", ";\n  background-color: ", ";\n  z-index: 999;\n"])), function (props) {
  return props.topOffset ? props.topOffset + 2 + "px" : 0;
}, function (props) {
  return props.height ? props.height + 30 + "px" : '100%';
}, colors.white);
var IconWrapper = styled__default.span(_templateObject6$f || (_templateObject6$f = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 64px;\n  width: 64px;\n  background-color: ", ";\n  border-radius: 50%;\n  text-align: center;\n  margin-bottom: 16px;\n  transition: all 0.3s;\n  pointer-events: none;\n  & > svg {\n    color: ", ";\n    width: 32px;\n    height: 32px;\n  }\n"])), colors.backgroundColor, function (props) {
  return props.iconColor || colors.primary;
});
var DropAttachmentArea = styled__default.div(_templateObject7$d || (_templateObject7$d = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  height: 100%;\n  border: 1px dashed ", ";\n  border-radius: 16px;\n  margin: ", ";\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  color: ", ";\n  transition: all 0.1s;\n\n  &.dragover {\n    background-color: ", ";\n\n    ", " {\n      background-color: ", ";\n    }\n  }\n"])), colors.textColor2, function (props) {
  return props.margin || '12px 32px 32px';
}, colors.textColor1, colors.backgroundColor, IconWrapper, colors.white);
var MessageWrapper = styled__default.div(_templateObject8$c || (_templateObject8$c = _taggedTemplateLiteralLoose(["\n  &.highlight {\n    & .messageBody {\n      transform: scale(1.1);\n      background-color: #d5d5d5;\n    }\n  }\n"])));
var NoMessagesContainer = styled__default.div(_templateObject9$b || (_templateObject9$b = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var NoMessagesTitle = styled__default.h4(_templateObject10$a || (_templateObject10$a = _taggedTemplateLiteralLoose(["\n  margin: 12px 0 8px;\n  font-family: Inter, sans-serif;\n  text-align: center;\n  font-size: 20px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 24px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var NoMessagesText = styled__default.p(_templateObject11$7 || (_templateObject11$7 = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  text-align: center;\n  font-feature-settings: 'clig' off, 'liga' off;\n  font-family: Inter, sans-serif;\n  font-size: 15px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 20px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});

var MessagesContainer = function MessagesContainer(_ref) {
  var fontFamily = _ref.fontFamily,
      _ref$ownMessageOnRigh = _ref.ownMessageOnRightSide,
      ownMessageOnRightSide = _ref$ownMessageOnRigh === void 0 ? true : _ref$ownMessageOnRigh,
      messageWidthPercent = _ref.messageWidthPercent,
      messageStatusAndTimePosition = _ref.messageStatusAndTimePosition,
      messageStatusDisplayingType = _ref.messageStatusDisplayingType,
      showMessageStatus = _ref.showMessageStatus,
      showMessageTimeAndStatusOnlyOnHover = _ref.showMessageTimeAndStatusOnlyOnHover,
      showMessageTime = _ref.showMessageTime,
      showMessageStatusForEachMessage = _ref.showMessageStatusForEachMessage,
      showMessageTimeForEachMessage = _ref.showMessageTimeForEachMessage,
      _ref$ownMessageBackgr = _ref.ownMessageBackground,
      ownMessageBackground = _ref$ownMessageBackgr === void 0 ? colors.primaryLight : _ref$ownMessageBackgr,
      _ref$incomingMessageB = _ref.incomingMessageBackground,
      incomingMessageBackground = _ref$incomingMessageB === void 0 ? colors.backgroundColor : _ref$incomingMessageB,
      ownRepliedMessageBackground = _ref.ownRepliedMessageBackground,
      incomingRepliedMessageBackground = _ref.incomingRepliedMessageBackground,
      _ref$hoverBackground = _ref.hoverBackground,
      hoverBackground = _ref$hoverBackground === void 0 ? false : _ref$hoverBackground,
      _ref$showSenderNameOn = _ref.showSenderNameOnDirectChannel,
      showSenderNameOnDirectChannel = _ref$showSenderNameOn === void 0 ? false : _ref$showSenderNameOn,
      _ref$showSenderNameOn2 = _ref.showSenderNameOnOwnMessages,
      showSenderNameOnOwnMessages = _ref$showSenderNameOn2 === void 0 ? false : _ref$showSenderNameOn2,
      _ref$showSenderNameOn3 = _ref.showSenderNameOnGroupChannel,
      showSenderNameOnGroupChannel = _ref$showSenderNameOn3 === void 0 ? true : _ref$showSenderNameOn3,
      _ref$showOwnAvatar = _ref.showOwnAvatar,
      showOwnAvatar = _ref$showOwnAvatar === void 0 ? false : _ref$showOwnAvatar,
      MessageActionsMenu = _ref.MessageActionsMenu,
      messageReaction = _ref.messageReaction,
      editMessage = _ref.editMessage,
      copyMessage = _ref.copyMessage,
      replyMessage = _ref.replyMessage,
      replyMessageInThread = _ref.replyMessageInThread,
      forwardMessage = _ref.forwardMessage,
      deleteMessage = _ref.deleteMessage,
      selectMessage = _ref.selectMessage,
      reportMessage = _ref.reportMessage,
      reactionIcon = _ref.reactionIcon,
      editIcon = _ref.editIcon,
      copyIcon = _ref.copyIcon,
      replyIcon = _ref.replyIcon,
      replyInThreadIcon = _ref.replyInThreadIcon,
      forwardIcon = _ref.forwardIcon,
      deleteIcon = _ref.deleteIcon,
      selectIcon = _ref.selectIcon,
      _ref$allowEditDeleteI = _ref.allowEditDeleteIncomingMessage,
      allowEditDeleteIncomingMessage = _ref$allowEditDeleteI === void 0 ? true : _ref$allowEditDeleteI,
      starIcon = _ref.starIcon,
      staredIcon = _ref.staredIcon,
      reportIcon = _ref.reportIcon,
      reactionIconOrder = _ref.reactionIconOrder,
      openFrequentlyUsedReactions = _ref.openFrequentlyUsedReactions,
      fixEmojiCategoriesTitleOnTop = _ref.fixEmojiCategoriesTitleOnTop,
      emojisCategoryIconsPosition = _ref.emojisCategoryIconsPosition,
      emojisContainerBorderRadius = _ref.emojisContainerBorderRadius,
      reactionsDisplayCount = _ref.reactionsDisplayCount,
      showEachReactionCount = _ref.showEachReactionCount,
      showTotalReactionCount = _ref.showTotalReactionCount,
      reactionItemBorder = _ref.reactionItemBorder,
      reactionItemBorderRadius = _ref.reactionItemBorderRadius,
      reactionItemBackground = _ref.reactionItemBackground,
      reactionItemPadding = _ref.reactionItemPadding,
      reactionItemMargin = _ref.reactionItemMargin,
      reactionsFontSize = _ref.reactionsFontSize,
      reactionsContainerBoxShadow = _ref.reactionsContainerBoxShadow,
      reactionsContainerBorder = _ref.reactionsContainerBorder,
      reactionsContainerBorderRadius = _ref.reactionsContainerBorderRadius,
      reactionsContainerBackground = _ref.reactionsContainerBackground,
      reactionsContainerPadding = _ref.reactionsContainerPadding,
      reactionsContainerTopPosition = _ref.reactionsContainerTopPosition,
      reactionsDetailsPopupBorderRadius = _ref.reactionsDetailsPopupBorderRadius,
      _ref$reactionsDetails = _ref.reactionsDetailsPopupHeaderItemsStyle,
      reactionsDetailsPopupHeaderItemsStyle = _ref$reactionsDetails === void 0 ? 'bubbles' : _ref$reactionsDetails,
      editIconOrder = _ref.editIconOrder,
      copyIconOrder = _ref.copyIconOrder,
      replyIconOrder = _ref.replyIconOrder,
      replyInThreadIconOrder = _ref.replyInThreadIconOrder,
      forwardIconOrder = _ref.forwardIconOrder,
      deleteIconOrder = _ref.deleteIconOrder,
      selectIconOrder = _ref.selectIconOrder,
      starIconOrder = _ref.starIconOrder,
      reportIconOrder = _ref.reportIconOrder,
      reactionIconTooltipText = _ref.reactionIconTooltipText,
      editIconTooltipText = _ref.editIconTooltipText,
      copyIconTooltipText = _ref.copyIconTooltipText,
      replyIconTooltipText = _ref.replyIconTooltipText,
      replyInThreadIconTooltipText = _ref.replyInThreadIconTooltipText,
      forwardIconTooltipText = _ref.forwardIconTooltipText,
      deleteIconTooltipText = _ref.deleteIconTooltipText,
      selectIconTooltipText = _ref.selectIconTooltipText,
      starIconTooltipText = _ref.starIconTooltipText,
      reportIconTooltipText = _ref.reportIconTooltipText,
      messageActionIconsColor = _ref.messageActionIconsColor,
      dateDividerFontSize = _ref.dateDividerFontSize,
      dateDividerTextColor = _ref.dateDividerTextColor,
      dateDividerBorder = _ref.dateDividerBorder,
      dateDividerBackgroundColor = _ref.dateDividerBackgroundColor,
      dateDividerBorderRadius = _ref.dateDividerBorderRadius,
      _ref$showTopFixedDate = _ref.showTopFixedDate,
      showTopFixedDate = _ref$showTopFixedDate === void 0 ? true : _ref$showTopFixedDate,
      inlineReactionIcon = _ref.inlineReactionIcon,
      newMessagesSeparatorText = _ref.newMessagesSeparatorText,
      newMessagesSeparatorFontSize = _ref.newMessagesSeparatorFontSize,
      newMessagesSeparatorTextColor = _ref.newMessagesSeparatorTextColor,
      newMessagesSeparatorWidth = _ref.newMessagesSeparatorWidth,
      newMessagesSeparatorBorder = _ref.newMessagesSeparatorBorder,
      newMessagesSeparatorBorderRadius = _ref.newMessagesSeparatorBorderRadius,
      newMessagesSeparatorBackground = _ref.newMessagesSeparatorBackground,
      newMessagesSeparatorTextLeftRightSpacesWidth = _ref.newMessagesSeparatorTextLeftRightSpacesWidth,
      fileAttachmentsIcon = _ref.fileAttachmentsIcon,
      fileAttachmentsBoxWidth = _ref.fileAttachmentsBoxWidth,
      fileAttachmentsBoxBackground = _ref.fileAttachmentsBoxBackground,
      fileAttachmentsBoxBorder = _ref.fileAttachmentsBoxBorder,
      fileAttachmentsTitleColor = _ref.fileAttachmentsTitleColor,
      fileAttachmentsSizeColor = _ref.fileAttachmentsSizeColor,
      imageAttachmentMaxWidth = _ref.imageAttachmentMaxWidth,
      imageAttachmentMaxHeight = _ref.imageAttachmentMaxHeight,
      videoAttachmentMaxWidth = _ref.videoAttachmentMaxWidth,
      videoAttachmentMaxHeight = _ref.videoAttachmentMaxHeight,
      _ref$attachmentsPrevi = _ref.attachmentsPreview,
      attachmentsPreview = _ref$attachmentsPrevi === void 0 ? true : _ref$attachmentsPrevi,
      sameUserMessageSpacing = _ref.sameUserMessageSpacing,
      differentUserMessageSpacing = _ref.differentUserMessageSpacing;
  var messages = reactRedux.useSelector(activeChannelMessagesSelector) || [];
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(MessageList, {
    messages: messages,
    fontFamily: fontFamily,
    ownMessageOnRightSide: ownMessageOnRightSide,
    messageWidthPercent: messageWidthPercent,
    messageStatusAndTimePosition: messageStatusAndTimePosition,
    messageStatusDisplayingType: messageStatusDisplayingType,
    showMessageStatus: showMessageStatus,
    showMessageTimeAndStatusOnlyOnHover: showMessageTimeAndStatusOnlyOnHover,
    showMessageTime: showMessageTime,
    showMessageStatusForEachMessage: showMessageStatusForEachMessage,
    showMessageTimeForEachMessage: showMessageTimeForEachMessage,
    ownMessageBackground: ownMessageBackground,
    incomingMessageBackground: incomingMessageBackground,
    ownRepliedMessageBackground: ownRepliedMessageBackground,
    incomingRepliedMessageBackground: incomingRepliedMessageBackground,
    hoverBackground: hoverBackground,
    showSenderNameOnDirectChannel: showSenderNameOnDirectChannel,
    showSenderNameOnOwnMessages: showSenderNameOnOwnMessages,
    showSenderNameOnGroupChannel: showSenderNameOnGroupChannel,
    showOwnAvatar: showOwnAvatar,
    MessageActionsMenu: MessageActionsMenu,
    messageReaction: messageReaction,
    editMessage: editMessage,
    copyMessage: copyMessage,
    replyMessage: replyMessage,
    replyMessageInThread: replyMessageInThread,
    forwardMessage: forwardMessage,
    deleteMessage: deleteMessage,
    selectMessage: selectMessage,
    reportMessage: reportMessage,
    reactionIcon: reactionIcon,
    editIcon: editIcon,
    copyIcon: copyIcon,
    replyIcon: replyIcon,
    replyInThreadIcon: replyInThreadIcon,
    forwardIcon: forwardIcon,
    deleteIcon: deleteIcon,
    selectIcon: selectIcon,
    allowEditDeleteIncomingMessage: allowEditDeleteIncomingMessage,
    starIcon: starIcon,
    staredIcon: staredIcon,
    reportIcon: reportIcon,
    reactionIconOrder: reactionIconOrder,
    openFrequentlyUsedReactions: openFrequentlyUsedReactions,
    fixEmojiCategoriesTitleOnTop: fixEmojiCategoriesTitleOnTop,
    emojisCategoryIconsPosition: emojisCategoryIconsPosition,
    emojisContainerBorderRadius: emojisContainerBorderRadius,
    reactionsDisplayCount: reactionsDisplayCount,
    showEachReactionCount: showEachReactionCount,
    showTotalReactionCount: showTotalReactionCount,
    reactionItemBorder: reactionItemBorder,
    reactionItemBorderRadius: reactionItemBorderRadius,
    reactionItemBackground: reactionItemBackground,
    reactionItemPadding: reactionItemPadding,
    reactionItemMargin: reactionItemMargin,
    reactionsFontSize: reactionsFontSize,
    reactionsContainerBoxShadow: reactionsContainerBoxShadow,
    reactionsContainerBorder: reactionsContainerBorder,
    reactionsContainerBorderRadius: reactionsContainerBorderRadius,
    reactionsContainerBackground: reactionsContainerBackground,
    reactionsContainerPadding: reactionsContainerPadding,
    reactionsContainerTopPosition: reactionsContainerTopPosition,
    reactionsDetailsPopupBorderRadius: reactionsDetailsPopupBorderRadius,
    reactionsDetailsPopupHeaderItemsStyle: reactionsDetailsPopupHeaderItemsStyle,
    editIconOrder: editIconOrder,
    copyIconOrder: copyIconOrder,
    replyIconOrder: replyIconOrder,
    replyInThreadIconOrder: replyInThreadIconOrder,
    forwardIconOrder: forwardIconOrder,
    deleteIconOrder: deleteIconOrder,
    selectIconOrder: selectIconOrder,
    starIconOrder: starIconOrder,
    reportIconOrder: reportIconOrder,
    reactionIconTooltipText: reactionIconTooltipText,
    editIconTooltipText: editIconTooltipText,
    copyIconTooltipText: copyIconTooltipText,
    replyIconTooltipText: replyIconTooltipText,
    replyInThreadIconTooltipText: replyInThreadIconTooltipText,
    forwardIconTooltipText: forwardIconTooltipText,
    deleteIconTooltipText: deleteIconTooltipText,
    selectIconTooltipText: selectIconTooltipText,
    starIconTooltipText: starIconTooltipText,
    reportIconTooltipText: reportIconTooltipText,
    messageActionIconsColor: messageActionIconsColor,
    dateDividerFontSize: dateDividerFontSize,
    dateDividerTextColor: dateDividerTextColor,
    dateDividerBorder: dateDividerBorder,
    dateDividerBackgroundColor: dateDividerBackgroundColor,
    dateDividerBorderRadius: dateDividerBorderRadius,
    showTopFixedDate: showTopFixedDate,
    inlineReactionIcon: inlineReactionIcon,
    newMessagesSeparatorText: newMessagesSeparatorText,
    newMessagesSeparatorFontSize: newMessagesSeparatorFontSize,
    newMessagesSeparatorTextColor: newMessagesSeparatorTextColor,
    newMessagesSeparatorWidth: newMessagesSeparatorWidth,
    newMessagesSeparatorBorder: newMessagesSeparatorBorder,
    newMessagesSeparatorBorderRadius: newMessagesSeparatorBorderRadius,
    newMessagesSeparatorBackground: newMessagesSeparatorBackground,
    newMessagesSeparatorTextLeftRightSpacesWidth: newMessagesSeparatorTextLeftRightSpacesWidth,
    fileAttachmentsIcon: fileAttachmentsIcon,
    fileAttachmentsBoxWidth: fileAttachmentsBoxWidth,
    fileAttachmentsBoxBackground: fileAttachmentsBoxBackground,
    fileAttachmentsBoxBorder: fileAttachmentsBoxBorder,
    fileAttachmentsTitleColor: fileAttachmentsTitleColor,
    fileAttachmentsSizeColor: fileAttachmentsSizeColor,
    imageAttachmentMaxWidth: imageAttachmentMaxWidth,
    imageAttachmentMaxHeight: imageAttachmentMaxHeight,
    videoAttachmentMaxWidth: videoAttachmentMaxWidth,
    videoAttachmentMaxHeight: videoAttachmentMaxHeight,
    attachmentsPreview: attachmentsPreview,
    sameUserMessageSpacing: sameUserMessageSpacing,
    differentUserMessageSpacing: differentUserMessageSpacing
  }));
};

function convertMentionElement(domNode) {
  var textContent = domNode.textContent;

  if (textContent !== null) {
    var node = $createMentionNode(textContent);
    return {
      node: node
    };
  }

  return null;
}

var MentionNode = /*#__PURE__*/function (_TextNode) {
  _inherits(MentionNode, _TextNode);

  var _super = _createSuper(MentionNode);

  function MentionNode(mention, text, key) {
    var _this;

    _classCallCheck(this, MentionNode);

    _this = _super.call(this, text != null ? text : mention.name, key);
    _this.__mention = mention;
    _this.mentionId = mention.id;
    return _this;
  }

  _createClass(MentionNode, [{
    key: "exportJSON",
    value: function exportJSON() {
      return _extends({}, _get(_getPrototypeOf(MentionNode.prototype), "exportJSON", this).call(this), {
        mentionName: this.__mention.id,
        type: 'mention',
        version: 1
      });
    }
  }, {
    key: "createDOM",
    value: function createDOM(config) {
      var dom = _get(_getPrototypeOf(MentionNode.prototype), "createDOM", this).call(this, config);

      dom.className = 'mention';
      return dom;
    }
  }, {
    key: "exportDOM",
    value: function exportDOM() {
      var element = document.createElement('span');
      element.setAttribute('data-lexical-mention', 'true');
      element.textContent = this.__text;
      return {
        element: element
      };
    }
  }, {
    key: "isTextEntity",
    value: function isTextEntity() {
      return true;
    }
  }, {
    key: "canInsertTextBefore",
    value: function canInsertTextBefore() {
      return false;
    }
  }, {
    key: "canInsertTextAfter",
    value: function canInsertTextAfter() {
      return false;
    }
  }], [{
    key: "getType",
    value: function getType() {
      return 'mention';
    }
  }, {
    key: "clone",
    value: function clone(node) {
      return new MentionNode(node.__mention, node.__text, node.__key);
    }
  }, {
    key: "importJSON",
    value: function importJSON(serializedNode) {
      var node = $createMentionNode(serializedNode.mentionName);
      node.setTextContent(serializedNode.text);
      node.setFormat(serializedNode.format);
      node.setDetail(serializedNode.detail);
      node.setMode(serializedNode.mode);
      node.setStyle(serializedNode.style);
      return node;
    }
  }, {
    key: "importDOM",
    value: function importDOM() {
      return {
        span: function span(domNode) {
          if (!domNode.hasAttribute('data-lexical-mention')) {
            return null;
          }

          return {
            conversion: convertMentionElement,
            priority: 1
          };
        }
      };
    }
  }]);

  return MentionNode;
}(lexical.TextNode);
function $createMentionNode(mention) {
  var mentionNode = new MentionNode(mention, mention.name);
  mentionNode.setMode('segmented').toggleDirectionless();
  return lexical.$applyNodeReplacement(mentionNode);
}

var _templateObject$y, _templateObject2$u, _templateObject3$o, _templateObject4$k, _templateObject5$i;
var PUNCTUATION = '\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%\'"~=<>_:;';
var NAME = '\\b[A-Z][^\\s' + PUNCTUATION + ']';
var DocumentMentionsRegex = {
  NAME: NAME,
  PUNCTUATION: PUNCTUATION
};
var PUNC = DocumentMentionsRegex.PUNCTUATION;
var TRIGGERS = ['@'].join('');
var VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\s]';
var VALID_JOINS = '(?:' + '\\.[ |$]|' + ' |' + '[' + PUNC + ']|' + ')';
var LENGTH_LIMIT = 75;
var AtSignMentionsRegex = new RegExp('(^|\\s|\\()(' + '[' + TRIGGERS + ']' + '((?:' + VALID_CHARS + VALID_JOINS + '){0,' + LENGTH_LIMIT + '})' + ')$');
var ALIAS_LENGTH_LIMIT = 50;
var AtSignMentionsRegexAliasRegex = new RegExp('(^|\\s|\\()(' + '[' + TRIGGERS + ']' + '((?:' + VALID_CHARS + '){0,' + ALIAS_LENGTH_LIMIT + '})' + ')$');
var SUGGESTION_LIST_LENGTH_LIMIT = 50;
var mentionsCache = new Map();
var membersMap = {};

function useMentionLookupService(mentionString, contactsMap, userId, getFromContacts) {
  var members = reactRedux.useSelector(activeChannelMembersSelector, reactRedux.shallowEqual);

  var _useState = React.useState([]),
      results = _useState[0],
      setResults = _useState[1];

  var membersMapMemo = React.useMemo(function () {
    return members.reduce(function (acc, member) {
      acc[member.id] = member;
      return acc;
    }, {});
  }, [members]);
  membersMap = membersMapMemo;
  React.useEffect(function () {
    var cachedResults = mentionsCache.get(mentionString);

    if (mentionString == null) {
      setResults([]);
      return;
    }

    if (cachedResults === null) {
      return;
    } else if (cachedResults !== undefined) {
      setResults(cachedResults);
      return;
    }

    mentionsCache.set(mentionString, null);
    var searchedMembers = [].concat(members).filter(function (member) {
      var displayName = makeUsername(contactsMap[member.id], member, getFromContacts);
      return displayName && member.id !== userId && displayName.split(' ').find(function (namePart) {
        return namePart[0] === '~' ? namePart.slice(1).toLowerCase().startsWith(mentionString.toLowerCase()) : namePart.toLowerCase().startsWith(mentionString.toLowerCase());
      });
    }).map(function (member) {
      var displayName = makeUsername(contactsMap[member.id], member, getFromContacts);
      return {
        avatar: member.avatarUrl,
        name: displayName,
        id: member.id,
        presence: member.presence
      };
    });
    mentionsCache.set(mentionString, searchedMembers);
    setResults(searchedMembers);
  }, [mentionString]);
  return results;
}

function checkForAtSignMentions(text, minMatchLength) {
  var match = AtSignMentionsRegex.exec(text);

  if (match === null) {
    match = AtSignMentionsRegexAliasRegex.exec(text);
  }

  if (match !== null) {
    var maybeLeadingWhitespace = match[1];
    var matchingString = match[3];

    if (matchingString.length >= minMatchLength) {
      return {
        leadOffset: match.index + maybeLeadingWhitespace.length,
        matchingString: matchingString,
        replaceableString: match[2]
      };
    }
  }

  return null;
}

function getPossibleQueryMatch(text) {
  return checkForAtSignMentions(text, 0);
}

var MentionTypeaheadOption = /*#__PURE__*/function (_MenuOption) {
  _inherits(MentionTypeaheadOption, _MenuOption);

  var _super = _createSuper(MentionTypeaheadOption);

  function MentionTypeaheadOption(name, id, presence, avatarUrl) {
    var _this;

    _classCallCheck(this, MentionTypeaheadOption);

    _this = _super.call(this, name);
    _this.name = name;
    _this.id = id;
    _this.presence = presence;
    _this.avatarUrl = avatarUrl;
    return _this;
  }

  return _createClass(MentionTypeaheadOption);
}(LexicalTypeaheadMenuPlugin.MenuOption);

function MentionsTypeaheadMenuItem(_ref) {
  var index = _ref.index,
      isSelected = _ref.isSelected,
      onClick = _ref.onClick,
      onMouseEnter = _ref.onMouseEnter,
      option = _ref.option;
  var className = 'item';

  if (isSelected) {
    className += ' selected';
  }

  return /*#__PURE__*/React__default.createElement(MemberItem, {
    key: option.key,
    tabIndex: -1,
    className: className,
    ref: option.setRefElement,
    role: 'option',
    isActiveItem: isSelected,
    id: 'typeahead-item-' + index,
    onMouseEnter: onMouseEnter,
    activeBackgroundColor: colors.hoverBackgroundColor,
    onClick: onClick
  }, /*#__PURE__*/React__default.createElement(AvatarWrapper, null, /*#__PURE__*/React__default.createElement(Avatar, {
    name: option.name,
    image: option.avatarUrl,
    size: 32,
    textSize: 14,
    setDefaultAvatar: true
  })), /*#__PURE__*/React__default.createElement(UserNamePresence$2, null, /*#__PURE__*/React__default.createElement(MemberName$2, {
    color: colors.textColor1
  }, option.name), /*#__PURE__*/React__default.createElement(SubTitle, null, option.presence && option.presence.state === USER_PRESENCE_STATUS.ONLINE ? 'Online' : option.presence && option.presence.lastActiveAt && userLastActiveDateFormat(option.presence.lastActiveAt))));
}

function MentionsPlugin(_ref2) {
  var contactsMap = _ref2.contactsMap,
      userId = _ref2.userId,
      getFromContacts = _ref2.getFromContacts,
      setMentionMember = _ref2.setMentionMember;

  var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo[0];

  var _useState2 = React.useState(null),
      queryString = _useState2[0],
      setQueryString = _useState2[1];

  var results = useMentionLookupService(queryString, contactsMap, userId, getFromContacts);
  var checkForSlashTriggerMatch = LexicalTypeaheadMenuPlugin.useBasicTypeaheadTriggerMatch('/', {
    minLength: 0
  });
  var options = React.useMemo(function () {
    return results.map(function (result) {
      return new MentionTypeaheadOption(result.name, result.id, result.presence, result.avatar);
    }).slice(0, SUGGESTION_LIST_LENGTH_LIMIT);
  }, [results]);
  var onSelectOption = React.useCallback(function (selectedOption, nodeToReplace, closeMenu) {
    setMentionMember(membersMap[selectedOption.id]);
    editor.update(function () {
      var mentionNode = $createMentionNode(_extends({}, selectedOption, {
        name: "@" + selectedOption.name
      }));

      if (nodeToReplace) {
        var replacedNode = nodeToReplace.replace(mentionNode);
        console.log('replacedNode.... . .>>>> >', replacedNode);
        var appendedNode = replacedNode.insertAfter(lexical.$createTextNode(' '));
        appendedNode.select();
      }

      closeMenu();
    });
  }, [editor]);
  var checkForMentionMatch = React.useCallback(function (text) {
    var slashMatch = checkForSlashTriggerMatch(text, editor);

    if (slashMatch !== null) {
      return null;
    }

    return getPossibleQueryMatch(text);
  }, [checkForSlashTriggerMatch, editor]);
  return /*#__PURE__*/React__default.createElement(LexicalTypeaheadMenuPlugin.LexicalTypeaheadMenuPlugin, {
    onQueryChange: setQueryString,
    onSelectOption: onSelectOption,
    triggerFn: checkForMentionMatch,
    options: options,
    menuRenderFn: function menuRenderFn(anchorElementRef, _ref3) {
      var selectedIndex = _ref3.selectedIndex,
          selectOptionAndCleanUp = _ref3.selectOptionAndCleanUp,
          setHighlightedIndex = _ref3.setHighlightedIndex;
      return anchorElementRef.current && results.length ? /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/React__default.createElement(MentionsContainer, {
        className: 'typeahead-popover mentions-menu'
      }, /*#__PURE__*/React__default.createElement(MentionsList, null, options.map(function (option, i) {
        return /*#__PURE__*/React__default.createElement(MentionsTypeaheadMenuItem, {
          index: i,
          isSelected: selectedIndex === i,
          onClick: function onClick() {
            setHighlightedIndex(i);
            selectOptionAndCleanUp(option);
          },
          onMouseEnter: function onMouseEnter() {
            setHighlightedIndex(i);
          },
          key: option.key,
          option: option
        });
      }))), anchorElementRef.current) : null;
    }
  });
}
var MentionsContainer = styled__default.div(_templateObject$y || (_templateObject$y = _taggedTemplateLiteralLoose(["\n  position: relative;\n  animation: fadeIn 0.2s ease-in-out;\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n"])));
var MentionsList = styled__default.ul(_templateObject2$u || (_templateObject2$u = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: 100%;\n  width: 300px;\n  transition: all 0.2s;\n  overflow: auto;\n  max-height: 240px;\n  z-index: 99;\n  padding: 2px 0 0;\n  background: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);\n  border-radius: 6px;\n  visibility: ", ";\n"])), function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.withBorder && "1px solid " + colors.borderColor;
}, function (props) {
  return props.hidden ? 'hidden' : 'visible';
});
var MemberItem = styled__default.li(_templateObject3$o || (_templateObject3$o = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  font-size: 15px;\n  padding: 6px 16px;\n  transition: all 0.2s;\n  cursor: pointer;\n  background-color: ", ";\n\n  & ", " {\n    width: 10px;\n    height: 10px;\n  }\n"])), function (props) {
  return props.isActiveItem && (props.activeBackgroundColor || colors.hoverBackgroundColor);
}, UserStatus);
var UserNamePresence$2 = styled__default.div(_templateObject4$k || (_templateObject4$k = _taggedTemplateLiteralLoose(["\n  width: 100%;\n  margin-left: 12px;\n"])));
var MemberName$2 = styled__default.h3(_templateObject5$i || (_templateObject5$i = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  max-width: calc(100% - 1px);\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 18px;\n  letter-spacing: -0.2px;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});

var _path$$;

function _extends$11() {
  _extends$11 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$11.apply(this, arguments);
}

function SvgBold(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$11({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$$ || (_path$$ = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.35 3.029A1.1 1.1 0 005 4.1v10a1.1 1.1 0 001.35 1.072c.08.018.164.028.25.028h3.429c1.998 0 3.671-1.583 3.671-3.6a3.566 3.566 0 00-1.596-2.969c.38-.588.596-1.294.596-2.031 0-1.904-1.444-3.6-3.408-3.6H6.6c-.086 0-.17.01-.25.029zm3.41 7.138a3.318 3.318 0 01-.468.033H7.2V13h2.829c.842 0 1.471-.656 1.471-1.4 0-.744-.63-1.4-1.471-1.4a1.1 1.1 0 01-.268-.033zM7.2 8h2.092c.586 0 1.208-.542 1.208-1.4 0-.858-.622-1.4-1.208-1.4H7.2V8z",
    fill: "CurrentColor"
  })));
}

var _path$10;

function _extends$12() {
  _extends$12 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$12.apply(this, arguments);
}

function SvgItalic(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$12({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$10 || (_path$10 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M9.984 3.2H8a.8.8 0 000 1.6h1.024l-1.68 8.4H6a.8.8 0 100 1.6h4a.8.8 0 000-1.6H8.976l1.68-8.4H12a.8.8 0 000-1.6H9.984z",
    fill: "CurrentColor"
  })));
}

var _g$1;

function _extends$13() {
  _extends$13 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$13.apply(this, arguments);
}

function SvgStrikethrough(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$13({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _g$1 || (_g$1 = /*#__PURE__*/React.createElement("g", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    fill: "CurrentColor"
  }, /*#__PURE__*/React.createElement("path", {
    d: "M8.565 4.766c1.043-.104 1.987.287 2.447 1.138a.75.75 0 101.32-.713c-.821-1.519-2.44-2.064-3.915-1.918-2.504.248-3.581 2.265-3.144 3.93.228.868.738 1.423 1.342 1.797h4.835a4.345 4.345 0 00-.457-.205c-.514-.196-1.105-.325-1.634-.44l-.314-.07c-1.343-.301-2.097-.611-2.32-1.462-.197-.748.227-1.898 1.84-2.057zM12.937 11H11.38c.195.497.15 1.007-.113 1.392-.285.418-.943.858-2.277.858-2.072 0-2.685-1.118-2.762-1.428a.75.75 0 10-1.455.363c.255 1.021 1.503 2.565 4.217 2.565 1.656 0 2.867-.56 3.517-1.513.466-.685.582-1.486.43-2.237z"
  }), /*#__PURE__*/React.createElement("path", {
    d: "M2.7 9a.8.8 0 01.8-.8h11a.8.8 0 010 1.6h-11a.8.8 0 01-.8-.8z"
  }))));
}

var _path$11;

function _extends$14() {
  _extends$14 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$14.apply(this, arguments);
}

function SvgMono(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$14({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$11 || (_path$11 = /*#__PURE__*/React.createElement("path", {
    d: "M4.98 14.753A.826.826 0 014.37 15a.882.882 0 01-.624-.247.882.882 0 01-.247-.624V3.87c0-.24.082-.444.247-.608A.853.853 0 014.37 3c.581 0 1.003.258 1.266.773l3.238 6.28c0 .01.006.015.017.015.01 0 .016-.005.016-.016l3.222-6.247c.274-.537.712-.805 1.315-.805.252 0 .466.088.641.263a.873.873 0 01.263.641v10.192a.873.873 0 01-.263.641.872.872 0 01-.64.263.873.873 0 01-.642-.263.873.873 0 01-.263-.641V6.14c0-.011-.005-.017-.016-.017s-.017.006-.017.017l-2.433 4.833c-.252.493-.646.74-1.183.74s-.932-.247-1.184-.74L5.275 6.14c0-.011-.005-.017-.016-.017s-.017.006-.017.017v7.989c0 .24-.087.45-.263.624z",
    fill: "CurrentColor"
  })));
}

var _g$2;

function _extends$15() {
  _extends$15 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$15.apply(this, arguments);
}

function SvgUnderline(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$15({
    width: 18,
    height: 18,
    viewBox: "0 0 18.01 18.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _g$2 || (_g$2 = /*#__PURE__*/React.createElement("g", {
    fill: "CurrentColor"
  }, /*#__PURE__*/React.createElement("path", {
    d: "M13 9c0 2.79-1.368 4.184-4.105 4.184S4.789 11.79 4.789 9V2.384c0-.242.085-.447.253-.616a.864.864 0 01.632-.268c.242 0 .447.09.615.268a.814.814 0 01.269.616V9.08c0 .926.19 1.6.568 2.021.39.421.99.632 1.8.632s1.406-.21 1.784-.632c.39-.421.585-1.095.585-2.021V2.353a.82.82 0 01.252-.6.82.82 0 01.6-.253.82.82 0 01.6.253.82.82 0 01.253.6V9z"
  }), /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4 15.71a.79.79 0 01.79-.789h8.42a.79.79 0 110 1.579H4.79a.79.79 0 01-.79-.79z"
  }))));
}

var _templateObject$z, _templateObject2$v;
function mergeRegister() {
  for (var _len = arguments.length, func = new Array(_len), _key = 0; _key < _len; _key++) {
    func[_key] = arguments[_key];
  }

  return function () {
    func.forEach(function (f) {
      return f();
    });
  };
}
function getDOMRangeRect(nativeSelection, rootElement) {
  var domRange = nativeSelection.getRangeAt(0);
  var rect;

  if (nativeSelection.anchorNode === rootElement) {
    var inner = rootElement;

    while (inner.firstElementChild != null) {
      inner = inner.firstElementChild;
    }

    rect = inner.getBoundingClientRect();
  } else {
    rect = domRange.getBoundingClientRect();
  }

  return rect;
}
var VERTICAL_GAP = 10;
var HORIZONTAL_OFFSET = 40;
function setFloatingElemPosition(targetRect, floatingElem, anchorElem, verticalGap, horizontalOffset) {
  if (verticalGap === void 0) {
    verticalGap = VERTICAL_GAP;
  }

  if (horizontalOffset === void 0) {
    horizontalOffset = HORIZONTAL_OFFSET;
  }

  var scrollerElem = anchorElem.parentElement;

  if (targetRect === null || !scrollerElem) {
    floatingElem.style.opacity = '0';
    floatingElem.style.transform = 'translate(-10000px, -10000px)';
    return;
  }

  var floatingElemRect = floatingElem.getBoundingClientRect();
  var anchorElementRect = anchorElem.getBoundingClientRect();
  var top = floatingElemRect.height - targetRect.height + verticalGap;
  var menuWidthHalf = floatingElemRect.width / 2;
  var selectionWidthHalf = targetRect.width / 2;
  var left = targetRect.left - anchorElementRect.left + horizontalOffset - menuWidthHalf + selectionWidthHalf;
  floatingElem.style.opacity = '1';
  floatingElem.style.transform = "translate(" + left + "px, " + -top + "px)";
}
function getSelectedNode(selection) {
  var anchor = selection.anchor;
  var focus = selection.focus;
  var anchorNode = selection.anchor.getNode();
  var focusNode = selection.focus.getNode();

  if (anchorNode === focusNode) {
    return anchorNode;
  }

  var isBackward = selection.isBackward();

  if (isBackward) {
    return focus ? anchorNode : focusNode;
  } else {
    return anchor ? anchorNode : focusNode;
  }
}

function TextFormatFloatingToolbar(_ref) {
  var editor = _ref.editor,
      anchorElem = _ref.anchorElem,
      isBold = _ref.isBold,
      isItalic = _ref.isItalic,
      isUnderline = _ref.isUnderline,
      isCode = _ref.isCode,
      isStrikethrough = _ref.isStrikethrough;
  var popupCharStylesEditorRef = React.useRef(null);
  console.log('popupCharStylesEditorRef >>>>>> : ', popupCharStylesEditorRef);
  console.log('editor <<< >>> >>>>: ', editor);

  function mouseMoveListener(e) {
    if (popupCharStylesEditorRef !== null && popupCharStylesEditorRef !== void 0 && popupCharStylesEditorRef.current && (e.buttons === 1 || e.buttons === 3)) {
      if (popupCharStylesEditorRef.current.style.pointerEvents !== 'none') {
        var x = e.clientX;
        var y = e.clientY;
        var elementUnderMouse = document.elementFromPoint(x, y);

        if (!popupCharStylesEditorRef.current.contains(elementUnderMouse)) {
          popupCharStylesEditorRef.current.style.pointerEvents = 'none';
        }
      }
    }
  }

  function mouseUpListener(e) {
    if (popupCharStylesEditorRef !== null && popupCharStylesEditorRef !== void 0 && popupCharStylesEditorRef.current) {
      if (popupCharStylesEditorRef.current.style.pointerEvents !== 'auto') {
        popupCharStylesEditorRef.current.style.pointerEvents = 'auto';
      }
    }
  }

  React.useEffect(function () {
    if (popupCharStylesEditorRef !== null && popupCharStylesEditorRef !== void 0 && popupCharStylesEditorRef.current) {
      document.addEventListener('mousemove', mouseMoveListener);
      document.addEventListener('mouseup', mouseUpListener);
      return function () {
        document.removeEventListener('mousemove', mouseMoveListener);
        document.removeEventListener('mouseup', mouseUpListener);
      };
    }
  }, [popupCharStylesEditorRef]);
  var updateTextFormatFloatingToolbar = React.useCallback(function () {
    var selection = lexical.$getSelection();
    var popupCharStylesEditorElem = popupCharStylesEditorRef.current;
    var nativeSelection = window.getSelection();

    if (popupCharStylesEditorElem === null) {
      return;
    }

    var rootElement = editor.getRootElement();

    if (selection !== null && nativeSelection !== null && !nativeSelection.isCollapsed && rootElement !== null && rootElement.contains(nativeSelection.anchorNode)) {
      var rangeRect = getDOMRangeRect(nativeSelection, rootElement);
      setFloatingElemPosition(rangeRect, popupCharStylesEditorElem, anchorElem);
    }
  }, [editor, anchorElem]);
  React.useEffect(function () {
    var scrollerElem = anchorElem.parentElement;

    var update = function update() {
      editor.getEditorState().read(function () {
        updateTextFormatFloatingToolbar();
      });
    };

    window.addEventListener('resize', update);

    if (scrollerElem) {
      scrollerElem.addEventListener('scroll', update);
    }

    return function () {
      window.removeEventListener('resize', update);

      if (scrollerElem) {
        scrollerElem.removeEventListener('scroll', update);
      }
    };
  }, [editor, updateTextFormatFloatingToolbar, anchorElem]);
  React.useEffect(function () {
    editor.getEditorState().read(function () {
      updateTextFormatFloatingToolbar();
    });
    return mergeRegister(editor.registerUpdateListener(function (_ref2) {
      var editorState = _ref2.editorState;
      editorState.read(function () {
        updateTextFormatFloatingToolbar();
      });
    }), editor.registerCommand(lexical.SELECTION_CHANGE_COMMAND, function () {
      updateTextFormatFloatingToolbar();
      return false;
    }, lexical.COMMAND_PRIORITY_LOW));
  }, [editor, updateTextFormatFloatingToolbar]);
  return /*#__PURE__*/React__default.createElement(FloatingTextFormatPopup, {
    ref: popupCharStylesEditorRef,
    className: 'floating-text-format-popup'
  }, editor.isEditable() && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Action$1, {
    type: 'button',
    onClick: function onClick() {
      editor.dispatchCommand(lexical.FORMAT_TEXT_COMMAND, 'bold');
    },
    "aria-label": 'Format text as bold',
    iconColor: colors.textColor2,
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    isActive: isBold
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, "Bold"), /*#__PURE__*/React__default.createElement(SvgBold, null)), /*#__PURE__*/React__default.createElement(Action$1, {
    iconColor: colors.textColor2,
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    isActive: isItalic,
    type: 'button',
    onClick: function onClick() {
      editor.dispatchCommand(lexical.FORMAT_TEXT_COMMAND, 'italic');
    },
    "aria-label": 'Format text as italics'
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, "Italic"), /*#__PURE__*/React__default.createElement(SvgItalic, null)), /*#__PURE__*/React__default.createElement(Action$1, {
    iconColor: colors.textColor2,
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    isActive: isStrikethrough,
    type: 'button',
    onClick: function onClick() {
      editor.dispatchCommand(lexical.FORMAT_TEXT_COMMAND, 'strikethrough');
    },
    "aria-label": 'Format text with a strikethrough'
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, " Strikethrough "), /*#__PURE__*/React__default.createElement(SvgStrikethrough, null)), /*#__PURE__*/React__default.createElement(Action$1, {
    type: 'button',
    iconColor: colors.textColor2,
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    isActive: isCode,
    onClick: function onClick() {
      editor.dispatchCommand(lexical.FORMAT_TEXT_COMMAND, 'code');
    },
    "aria-label": 'Insert code block'
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, "Monospace"), /*#__PURE__*/React__default.createElement(SvgMono, null)), /*#__PURE__*/React__default.createElement(Action$1, {
    type: 'button',
    iconColor: colors.textColor2,
    hoverBackgroundColor: colors.hoverBackgroundColor,
    hoverIconColor: colors.primary,
    isActive: isUnderline,
    onClick: function onClick() {
      editor.dispatchCommand(lexical.FORMAT_TEXT_COMMAND, 'underline');
    },
    "aria-label": 'Insert code block'
  }, /*#__PURE__*/React__default.createElement(ItemNote, {
    direction: 'top'
  }, "Underline"), /*#__PURE__*/React__default.createElement(SvgUnderline, null))));
}

function useFloatingTextFormatToolbar(editor, anchorElem) {
  var _useState = React.useState(false),
      isText = _useState[0],
      setIsText = _useState[1];

  var _useState2 = React.useState(false),
      isBold = _useState2[0],
      setIsBold = _useState2[1];

  var _useState3 = React.useState(false),
      isItalic = _useState3[0],
      setIsItalic = _useState3[1];

  var _useState4 = React.useState(false),
      isUnderline = _useState4[0],
      setIsUnderline = _useState4[1];

  var _useState5 = React.useState(false),
      isStrikethrough = _useState5[0],
      setIsStrikethrough = _useState5[1];

  var _useState6 = React.useState(false),
      isSubscript = _useState6[0],
      setIsSubscript = _useState6[1];

  var _useState7 = React.useState(false),
      isSuperscript = _useState7[0],
      setIsSuperscript = _useState7[1];

  var _useState8 = React.useState(false),
      isCode = _useState8[0],
      setIsCode = _useState8[1];

  var handleClick = function handleClick(e) {
    if (!e.target.closest('.rich_text_editor')) {
      setIsText(false);
    }
  };

  var updatePopup = React.useCallback(function () {
    editor.getEditorState().read(function () {
      if (editor.isComposing()) {
        return;
      }

      var selection = lexical.$getSelection();
      var nativeSelection = window.getSelection();
      var rootElement = editor.getRootElement();

      if (nativeSelection !== null && (!lexical.$isRangeSelection(selection) || rootElement === null || !rootElement.contains(nativeSelection.anchorNode))) {
        setIsText(false);
        return;
      }

      if (!lexical.$isRangeSelection(selection)) {
        return;
      }

      var node = getSelectedNode(selection);
      setIsBold(selection.hasFormat('bold'));
      setIsItalic(selection.hasFormat('italic'));
      setIsUnderline(selection.hasFormat('underline'));
      setIsStrikethrough(selection.hasFormat('strikethrough'));
      setIsSubscript(selection.hasFormat('subscript'));
      setIsSuperscript(selection.hasFormat('superscript'));
      setIsCode(selection.hasFormat('code'));

      if (selection.getTextContent() !== '') {
        setIsText(lexical.$isTextNode(node));
      } else {
        setIsText(false);
      }

      var rawTextContent = selection.getTextContent().replace(/\n/g, '');

      if (!selection.isCollapsed() && rawTextContent === '') {
        setIsText(false);
      }
    });
  }, [editor]);
  useEventListener('click', handleClick);
  React.useEffect(function () {
    document.addEventListener('selectionchange', updatePopup);
    return function () {
      document.removeEventListener('selectionchange', updatePopup);
    };
  }, [updatePopup]);
  React.useEffect(function () {
    return mergeRegister(editor.registerUpdateListener(function () {
      updatePopup();
    }), editor.registerRootListener(function () {
      if (editor.getRootElement() === null) {
        setIsText(false);
      }
    }));
  }, [editor, updatePopup]);

  if (!isText) {
    return null;
  }

  return /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/React__default.createElement(TextFormatFloatingToolbar, {
    editor: editor,
    anchorElem: anchorElem,
    isBold: isBold,
    isItalic: isItalic,
    isStrikethrough: isStrikethrough,
    isSubscript: isSubscript,
    isSuperscript: isSuperscript,
    isUnderline: isUnderline,
    isCode: isCode
  }), anchorElem);
}

function FloatingTextFormatToolbarPlugin(_ref3) {
  var _ref3$anchorElem = _ref3.anchorElem,
      anchorElem = _ref3$anchorElem === void 0 ? document.body : _ref3$anchorElem;

  var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo[0];

  return useFloatingTextFormatToolbar(editor, anchorElem);
}
var FloatingTextFormatPopup = styled__default.div(_templateObject$z || (_templateObject$z = _taggedTemplateLiteralLoose(["\n  display: flex;\n  background: #fff;\n  vertical-align: middle;\n  position: absolute;\n  top: 0;\n  left: 0;\n  opacity: 0;\n  box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.3);\n  border-radius: 8px;\n  transition: opacity 0.5s;\n  padding: 12px;\n  will-change: transform;\n  z-index: 99;\n\n  & button.popup-item {\n    border: 0;\n    display: flex;\n    background: none;\n    border-radius: 10px;\n    padding: 8px;\n    cursor: pointer;\n    vertical-align: middle;\n  }\n  & button.popup-item:disabled {\n    cursor: not-allowed;\n  }\n  & button.popup-item.spaced {\n    margin-right: 2px;\n  }\n  & button.popup-item i.format {\n    background-size: contain;\n    height: 18px;\n    width: 18px;\n    margin-top: 2px;\n    vertical-align: -0.25em;\n    display: flex;\n    opacity: 0.6;\n  }\n\n  & button.popup-item:disabled i.format {\n    opacity: 0.2;\n  }\n  & button.popup-item.active {\n    background-color: rgba(223, 232, 250, 0.3);\n  }\n  & button.popup-item.active i {\n    opacity: 1;\n  }\n  & .popup-item:hover:not([disabled]) {\n    background-color: #eee;\n  }\n  & select.popup-item {\n    border: 0;\n    display: flex;\n    background: none;\n    border-radius: 10px;\n    padding: 8px;\n    vertical-align: middle;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    width: 70px;\n    font-size: 14px;\n    color: #777;\n    text-overflow: ellipsis;\n  }\n  & select.code-language {\n    text-transform: capitalize;\n    width: 130px;\n  }\n\n  & .popup-item .text {\n    display: flex;\n    line-height: 20px;\n    vertical-align: middle;\n    font-size: 14px;\n    color: #777;\n    text-overflow: ellipsis;\n    width: 70px;\n    overflow: hidden;\n    height: 20px;\n    text-align: left;\n  }\n\n  & .popup-item .icon {\n    display: flex;\n    width: 20px;\n    height: 20px;\n    user-select: none;\n    margin-right: 8px;\n    line-height: 16px;\n    background-size: contain;\n  }\n  & i.chevron-down {\n    margin-top: 3px;\n    width: 16px;\n    height: 16px;\n    display: flex;\n    user-select: none;\n  }\n  & i.chevron-down.inside {\n    width: 16px;\n    height: 16px;\n    display: flex;\n    margin-left: -25px;\n    margin-top: 11px;\n    margin-right: 10px;\n    pointer-events: none;\n  }\n  & .divider {\n    width: 1px;\n    background-color: #eee;\n    margin: 0 4px;\n  }\n  @media (max-width: 1024px) {\n    & button.insert-comment {\n      display: none;\n    }\n  }\n"])));
var Action$1 = styled__default.button(_templateObject2$v || (_templateObject2$v = _taggedTemplateLiteralLoose(["\n  border: 0;\n  display: flex;\n  background-color: inherit;\n  vertical-align: middle;\n  position: relative;\n  padding: 3px;\n  margin-right: 10px;\n  //margin: 8px 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: ", ";\n  border-radius: 50%;\n  ", "\n\n  &:last-child {\n    margin-right: 0;\n  }\n\n  &:hover {\n    color: ", ";\n    background-color: ", ";\n\n    ", " {\n      display: block;\n    }\n  }\n"])), function (props) {
  return props.iconColor || colors.textColor2;
}, function (props) {
  return props.isActive && "\n    color: " + (props.hoverIconColor || colors.primary) + ";\n    background-color: " + (props.hoverBackgroundColor || colors.backgroundColor) + ";\n  ";
}, function (props) {
  return props.hoverIconColor || colors.primary;
}, function (props) {
  return props.hoverBackgroundColor || colors.backgroundColor;
}, ItemNote);

function EditMessagePlugin(_ref) {
  var editMessage = _ref.editMessage,
      contactsMap = _ref.contactsMap,
      getFromContacts = _ref.getFromContacts,
      setMentionedMember = _ref.setMentionedMember;

  var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo[0];

  useDidUpdate(function () {
    if (editMessage) {
      if (editMessage.mentionedUsers && editMessage.mentionedUsers.length) {
        setMentionedMember(editMessage.mentionedUsers);
      }

      editor.update(function () {
        var rootNode = lexical.$getRoot();
        lexical.$getRoot().clear();
        var paragraphNode = lexical.$createParagraphNode();
        var textPart = editMessage.body;
        var nextPartIndex;

        if (editMessage.bodyAttributes && editMessage.bodyAttributes.length) {
          var combinedAttributes = combineMessageAttributes(editMessage.bodyAttributes);
          combinedAttributes.forEach(function (attribute, index) {
            var attributeOffset = attribute.offset;
            var firstPart = "" + (textPart ? textPart === null || textPart === void 0 ? void 0 : textPart.substring(nextPartIndex || 0, attributeOffset) : '');
            var secondPart = "" + (textPart ? textPart === null || textPart === void 0 ? void 0 : textPart.substring(attributeOffset + attribute.length) : '');
            nextPartIndex = attribute.offset + attribute.length;

            if (attribute.type === 'mention') {
              var mentionUser = editMessage.mentionedUsers.find(function (mention) {
                return mention.id === attribute.metadata;
              });

              if (mentionUser) {
                var userDisplayName = makeUsername(contactsMap[mentionUser.id], mentionUser, getFromContacts);
                var mentionNodeParams = new MentionTypeaheadOption("@" + userDisplayName, mentionUser.id || '', mentionUser.presence, mentionUser.avatarUrl || '');
                var mentionNode = $createMentionNode(mentionNodeParams);

                if (firstPart) {
                  paragraphNode.append(lexical.$createTextNode(firstPart));
                }

                paragraphNode.append(mentionNode);
              }
            } else {
              if (firstPart) {
                paragraphNode.append(lexical.$createTextNode(firstPart));
              }

              console.log('attribute. . . ..  ', attribute);
              var textNode = lexical.$createTextNode(textPart.slice(attributeOffset, attributeOffset + attribute.length));

              switch (attribute.type) {
                case 'bold':
                  {
                    textNode.toggleFormat('bold');
                    break;
                  }

                case 'italic':
                  {
                    textNode.toggleFormat('italic');
                    break;
                  }

                case 'strikethrough':
                  {
                    textNode.toggleFormat('strikethrough');
                    break;
                  }

                case 'monospace':
                  {
                    textNode.toggleFormat('code');
                    break;
                  }

                case 'underline':
                  {
                    textNode.toggleFormat('underline');
                    break;
                  }

                default:
                  {
                    var typeArray = attribute.type.split(' ');

                    if (typeArray.length > 1) {
                      typeArray.forEach(function (type) {
                        textNode.toggleFormat(type === 'monospace' ? 'code' : type);
                      });
                    }
                  }
              }

              paragraphNode.append(textNode);
            }

            if (index === combinedAttributes.length - 1) {
              if (secondPart) {
                paragraphNode.append(lexical.$createTextNode(secondPart));
              } else {
                paragraphNode.append(lexical.$createTextNode(' '));
              }
            }

            rootNode.append(paragraphNode);
            rootNode.selectEnd();
          });
        } else {
          paragraphNode.append(lexical.$createTextNode(editMessage.body));
          rootNode.append(paragraphNode);
        }
      });
    }
  }, [editMessage]);
  return null;
}

function useFormatMessage(editor, editorState, setMessageBodyAttributes, setMessageText, messageToEdit) {
  useDidUpdate(function () {
    if (editorState) {
      editorState.read(function () {
        var rootNode = lexical.$getRoot();
        var messageText = rootNode.getTextContent();
        var parsedEditorState = editorState.toJSON();
        var offsetView = offset.$createOffsetView(editor);
        var offsetList = Array.from(offsetView._offsetMap.values());
        var messageBodyAttributes = [];

        if (parsedEditorState.root && parsedEditorState.root.children && parsedEditorState.root.children.length && (parsedEditorState.root.children[0].children.length > 1 || parsedEditorState.root.children[0].children[0] && parsedEditorState.root.children[0].children[0].type === 'mention')) {
          var currentOffsetDiff = 0;
          var newMessageText = messageText;
          parsedEditorState.root.children[0].children.forEach(function (child, index) {
            if (child.type === 'mention') {
              var offset = offsetList[index].start;
              var length = offsetList[index].end - offsetList[index].start;
              var mentionId = "@" + child.mentionName;
              var idLength = mentionId.length;
              newMessageText = "" + newMessageText.slice(0, offset + currentOffsetDiff) + mentionId + newMessageText.slice(offset + currentOffsetDiff + length);
              var menIndex = offset + currentOffsetDiff;
              currentOffsetDiff += idLength - length;
              messageBodyAttributes.push({
                type: 'mention',
                metadata: child.mentionName,
                offset: menIndex,
                length: idLength
              });
            } else {
              var attributeTypes = bodyAttributesMapByType[child.format];

              if (attributeTypes) {
                var _offset = offsetList[index].start;

                var _length = offsetList[index].end - offsetList[index].start;

                var attIndex = _offset + currentOffsetDiff;

                if (attributeTypes.length > 1) {
                  attributeTypes.forEach(function (attributeType) {
                    messageBodyAttributes.push({
                      type: attributeType,
                      offset: attIndex,
                      length: _length
                    });
                  });
                } else {
                  messageBodyAttributes.push({
                    type: attributeTypes[0],
                    offset: attIndex,
                    length: _length
                  });
                }
              }
            }
          });

          if (messageText) {
            setMessageText(newMessageText);
            setMessageBodyAttributes(messageBodyAttributes);
          } else {
            setMessageText(messageToEdit ? messageToEdit.body : '');
          }
        }
      });
    }
  }, [editor, editorState]);
}

function FormatMessagePlugin(_ref) {
  var editorState = _ref.editorState,
      setMessageBodyAttributes = _ref.setMessageBodyAttributes,
      setMessageText = _ref.setMessageText,
      messageToEdit = _ref.messageToEdit;

  var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo[0];

  useFormatMessage(editor, editorState, setMessageBodyAttributes, setMessageText, messageToEdit);
  return null;
}

var _circle$5, _path$12;

function _extends$16() {
  _extends$16 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$16.apply(this, arguments);
}

function SvgSend(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$16({
    width: 32,
    height: 32,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _circle$5 || (_circle$5 = /*#__PURE__*/React.createElement("circle", {
    cx: 16,
    cy: 16,
    r: 16,
    fill: "currentColor"
  })), _path$12 || (_path$12 = /*#__PURE__*/React.createElement("path", {
    d: "M10.953 18.945c-.545 1.46-.888 2.485-1.028 3.076-.439 1.856-.758 2.274.879 1.392 1.637-.882 9.56-5.251 11.329-6.222 2.304-1.266 2.335-1.167-.124-2.511-1.873-1.024-9.704-5.279-11.205-6.115-1.501-.835-1.318-.464-.879 1.392.142.6.49 1.634 1.043 3.105a3.143 3.143 0 002.35 1.98l4.595.88a.079.079 0 010 .155l-4.606.88a3.143 3.143 0 00-2.354 1.988z",
    fill: "#fff"
  })));
}

var _path$13;

function _extends$17() {
  _extends$17 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$17.apply(this, arguments);
}

function SvgEye(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$17({
    width: 25,
    height: 24,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$13 || (_path$13 = /*#__PURE__*/React.createElement("path", {
    d: "M12.5 5c6 0 10 5.6 10 7 0 1.4-4 7-10 7s-10-5.6-10-7c0-1.4 4-7 10-7zm0 2a5 5 0 100 10 5 5 0 000-10zm.001 2.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5z",
    fill: "CurrentColor"
  })));
}

var _path$14;

function _extends$18() {
  _extends$18 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$18.apply(this, arguments);
}

function SvgAddAttachment(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$18({
    width: 24,
    height: 24,
    viewBox: "0 0 24.01 24.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$14 || (_path$14 = /*#__PURE__*/React.createElement("path", {
    d: "M12 1.714c5.68 0 10.286 4.605 10.286 10.286 0 5.68-4.605 10.286-10.286 10.286C6.32 22.286 1.714 17.68 1.714 12 1.714 6.32 6.32 1.714 12 1.714zm0 1.715a8.571 8.571 0 100 17.143 8.571 8.571 0 000-17.143zm0 3.428c.473 0 .857.384.857.857v3.429h3.429a.857.857 0 010 1.714h-3.429v3.429a.857.857 0 11-1.714 0v-3.429H7.714a.857.857 0 110-1.714h3.429V7.714c0-.473.384-.857.857-.857z",
    fill: "CurrentColor"
  })));
}

var _path$15;

function _extends$19() {
  _extends$19 = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$19.apply(this, arguments);
}

function SvgErrorCircle(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$19({
    width: 25,
    height: 24,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$15 || (_path$15 = /*#__PURE__*/React.createElement("path", {
    d: "M12.5 1.714c5.68 0 10.286 4.605 10.286 10.286 0 5.68-4.605 10.285-10.286 10.285C6.82 22.285 2.214 17.68 2.214 12 2.214 6.319 6.82 1.714 12.5 1.714zm0 1.714a8.571 8.571 0 100 17.143 8.571 8.571 0 000-17.143zm0 11.657a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4zm.063-8.228c.204 0 .332.032.443.091.112.06.2.148.26.26.06.111.091.24.091.443v5.269c0 .204-.032.331-.091.443a.623.623 0 01-.26.26c-.111.059-.24.09-.443.09h-.126c-.204 0-.332-.031-.443-.09a.624.624 0 01-.26-.26c-.06-.112-.091-.24-.091-.443V7.65c0-.203.032-.33.091-.442.06-.112.148-.2.26-.26.111-.06.24-.091.443-.091h.126z",
    fill: "#FFB73D"
  })));
}

var EMOJIS$1 = [{
  key: 'People',
  array: [{
    key: 'face-smiling',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-affection',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'face-tongue',
    array: ['', '', '', '', '', '']
  }, {
    key: 'face-hand',
    array: ['', '', '', '']
  }, {
    key: 'face-neutral-skeptical',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-sleepy',
    array: ['', '', '', '', '']
  }, {
    key: 'face-unwell',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-hat',
    array: ['', '']
  }, {
    key: 'face-glasses',
    array: ['', '', '']
  }, {
    key: 'face-concerned',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'face-negative',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'face-costume',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'cat-face',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'monkey-face',
    array: ['', '', '']
  }, {
    key: 'emotion',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'hand-fingers-open',
    array: ['', '', '', '', '']
  }, {
    key: 'hand-fingers-partial',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'hand-single-finger',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hand-fingers-closed',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hands',
    array: ['', '', '', '', '', '']
  }, {
    key: 'hand-prop',
    array: ['', '', '']
  }, {
    key: 'body-parts',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person-fantasy',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'person-activity',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Animals',
  array: [{
    key: 'animal-mammal',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-bird',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-amphibian',
    array: ['']
  }, {
    key: 'animal-reptile',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'animal-marine',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'animal-bug',
    array: ['', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'plant-flower',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'plant-other',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Food',
  array: [{
    key: 'food-fruit',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-vegetable',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-prepared',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-asian',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'food-marine',
    array: ['', '', '', '', '']
  }, {
    key: 'food-sweet',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'drink',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'dishware',
    array: ['', '', '', '', '', '', '']
  }]
}, {
  key: 'Travel',
  array: [{
    key: 'place-map',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'place-geographic',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'place-building',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'place-religious',
    array: ['', '', '', '', '', '']
  }, {
    key: 'place-other',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'transport-ground',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'transport-water',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'transport-air',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'hotel',
    array: ['', '']
  }, {
    key: 'time',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'sky weather',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}, {
  key: 'Objects',
  array: [{
    key: 'event',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'award-medal',
    array: ['', '', '', '', '', '']
  }, {
    key: 'sport',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'game',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'arts crafts',
    array: ['', '', '', '', '']
  }, {
    key: 'clothing',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'sound',
    array: ['', '', '', '', '', '', '', '', '']
  }, {
    key: 'music',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'musical-instrument',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'phone',
    array: ['', '', '', '', '', '', '']
  }, {
    key: 'computer',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'light video',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'book-paper',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'money',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'mail',
    array: ['', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'writing',
    array: ['', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'office',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'lock',
    array: ['', '', '', '', '', '']
  }, {
    key: 'tool',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'science',
    array: ['', '', '', '', '', '', '', '']
  }, {
    key: 'medical',
    array: ['', '', '', '', '']
  }, {
    key: 'household',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'other-object',
    array: ['', '', '', '']
  }]
}, {
  key: 'Flags',
  array: [{
    key: 'country-flag',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'subdivision-flag',
    array: ['', '', '']
  }]
}, {
  key: 'Symbols',
  array: [{
    key: 'transport-sign',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'warning',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'arrow',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'religion',
    array: ['', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'zodiac',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '']
  }, {
    key: 'other-symbol',
    array: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
  }]
}];

var _templateObject$A, _templateObject2$w, _templateObject3$p, _templateObject4$l, _templateObject5$j, _templateObject6$g, _templateObject7$e, _templateObject8$d;

var EmojiIcon$1 = function EmojiIcon(_ref) {
  var collectionName = _ref.collectionName;

  switch (collectionName) {
    case 'People':
      return /*#__PURE__*/React__default.createElement(SvgEmojiSmileIcon, null);

    case 'Animals':
      return /*#__PURE__*/React__default.createElement(SvgEmojiAnimalIcon, null);

    case 'Food':
      return /*#__PURE__*/React__default.createElement(SvgEmojiFoodIcon, null);

    case 'Travel':
      return /*#__PURE__*/React__default.createElement(SvgEmojiTravelIcon, null);

    case 'Objects':
      return /*#__PURE__*/React__default.createElement(SvgEmojiObjectIcon, null);

    case 'Flags':
      return /*#__PURE__*/React__default.createElement(SvgEmojiFlagicon, null);

    case 'Symbols':
      return /*#__PURE__*/React__default.createElement(SvgEmojiSymbolsIcon, null);

    default:
      return null;
  }
};

function EmojisPopup$1(_ref2) {
  var handleAddEmoji = _ref2.handleAddEmoji,
      handleEmojiPopupToggle = _ref2.handleEmojiPopupToggle,
      rtlDirection = _ref2.rtlDirection,
      rightSide = _ref2.rightSide,
      bottomPosition = _ref2.bottomPosition,
      emojisContainerBorderRadius = _ref2.emojisContainerBorderRadius,
      _ref2$emojisCategoryI = _ref2.emojisCategoryIconsPosition,
      emojisCategoryIconsPosition = _ref2$emojisCategoryI === void 0 ? 'top' : _ref2$emojisCategoryI,
      fixEmojiCategoriesTitleOnTop = _ref2.fixEmojiCategoriesTitleOnTop,
      emojisPopupPosition = _ref2.emojisPopupPosition,
      relativePosition = _ref2.relativePosition,
      leftPosition = _ref2.leftPosition;
  console.log('EmojisPopup leftPosition', leftPosition);
  var theme = reactRedux.useSelector(themeSelector);
  var richTextEditor;

  try {
    var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
        editor = _useLexicalComposerCo[0];

    richTextEditor = editor;
  } catch (e) {
    console.log('error getting editor', e);
  }

  var _useState = React.useState(false),
      rendered = _useState[0],
      setRendered = _useState[1];

  var _useState2 = React.useState('People'),
      activeCollection = _useState2[0],
      setActiveCollection = _useState2[1];

  var _useState3 = React.useState([]),
      collectionHeights = _useState3[0],
      setCollectionHeights = _useState3[1];

  var emojiContainerRef = React.useRef(null);
  var collectionsRef = React.useRef(EMOJIS$1.map(function (col) {
    return {
      collectionName: col.key,
      elem: /*#__PURE__*/React.createRef()
    };
  }));

  var handleEmojiListScroll = function handleEmojiListScroll() {
    var scrollPos = emojiContainerRef.current.scrollTop;

    if (collectionHeights[6] < scrollPos) {
      setActiveCollection('Symbols');
    } else if (collectionHeights[5] < scrollPos) {
      setActiveCollection('Flags');
    } else if (collectionHeights[4] < scrollPos) {
      setActiveCollection('Objects');
    } else if (collectionHeights[3] < scrollPos) {
      setActiveCollection('Travel');
    } else if (collectionHeights[2] < scrollPos) {
      setActiveCollection('Food');
    } else if (collectionHeights[1] < scrollPos) {
      setActiveCollection('Animals');
    } else {
      setActiveCollection('People');
    }
  };

  var chooseEmoji = function chooseEmoji(selectedEmoji) {
    if (richTextEditor) {
      richTextEditor.update(function () {
        var selection = lexical.$getSelection();

        if (!lexical.$isRangeSelection(selection)) {
          console.log('close.  ...............................>>>>>>> ');
          return;
        }

        selection.insertNodes([lexical.$createTextNode(selectedEmoji)]);
      });

      if (handleAddEmoji) {
        handleAddEmoji(selectedEmoji);
      }
    }

    if (handleEmojiPopupToggle) {
      handleEmojiPopupToggle(false);
    }
  };

  var handleEmojiCollectionClick = function handleEmojiCollectionClick(mainCollection) {
    var collection = collectionsRef.current.find(function (el) {
      return el.collectionName === mainCollection;
    });
    var pos = collection.elem.current.offsetTop - 40;
    emojiContainerRef.current.scrollTo(0, pos);
  };

  React.useEffect(function () {
    setRendered(true);
    setTimeout(function () {
      if (emojiContainerRef.current) {
        var containerTop = emojiContainerRef.current.getBoundingClientRect().top + 10;
        var heights = collectionsRef.current.map(function (col) {
          return col.elem.current.getBoundingClientRect().top - 80 - containerTop;
        });
        setCollectionHeights(heights);
      }
    }, 300);
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$h, {
    backgroundColor: theme === THEME.DARK ? colors.backgroundColor : colors.white,
    noBorder: theme === THEME.DARK,
    relativePosition: relativePosition,
    borderRadius: emojisContainerBorderRadius,
    rightSide: rightSide,
    id: 'emojisContainer',
    rtlDirection: rtlDirection,
    bottomPosition: bottomPosition,
    leftPosition: leftPosition,
    rendered: rendered,
    emojisPopupPosition: emojisPopupPosition
  }, emojisCategoryIconsPosition === 'top' && /*#__PURE__*/React__default.createElement(EmojiFooter$1, {
    borderColor: colors.hoverBackgroundColor,
    emojisCategoryIconsPosition: emojisCategoryIconsPosition
  }, EMOJIS$1.map(function (emoji) {
    return /*#__PURE__*/React__default.createElement(EmojiCollection$1, {
      activeCollection: activeCollection === emoji.key,
      key: "" + emoji.key,
      onClick: function onClick() {
        return handleEmojiCollectionClick(emoji.key);
      }
    }, /*#__PURE__*/React__default.createElement(EmojiIcon$1, {
      collectionName: emoji.key
    }));
  })), fixEmojiCategoriesTitleOnTop && /*#__PURE__*/React__default.createElement(EmojiHeader$1, {
    padding: emojisCategoryIconsPosition !== 'top' ? '10px 18px 6px' : ''
  }, getEmojisCategoryTitle(activeCollection)), /*#__PURE__*/React__default.createElement(EmojiSection$1, {
    ref: emojiContainerRef,
    onScroll: handleEmojiListScroll
  }, /*#__PURE__*/React__default.createElement(AllEmojis$1, null, EMOJIS$1.map(function (emojiBigCollection, bigColIndex) {
    var mainCollectionKey = emojiBigCollection.key;
    return /*#__PURE__*/React__default.createElement(React__default.Fragment, {
      key: mainCollectionKey
    }, !fixEmojiCategoriesTitleOnTop && /*#__PURE__*/React__default.createElement(EmojiHeader$1, {
      padding: '6px 8px 0'
    }, getEmojisCategoryTitle(mainCollectionKey)), emojiBigCollection.array.map(function (emojiSmallCollection, bigIndex) {
      var label = emojiSmallCollection.key;
      var array = emojiSmallCollection.array;
      return array.map(function (emoji, i) {
        return /*#__PURE__*/React__default.createElement(Emoji$1, {
          hoverBackgroundColor: colors.hoverBackgroundColor,
          key: "" + emoji,
          className: 'emoji-cont',
          onClick: function onClick() {
            return chooseEmoji(emoji);
          }
        }, bigIndex === 0 && i === 0 && /*#__PURE__*/React__default.createElement(CollectionPointer$1, {
          ref: collectionsRef.current[bigColIndex].elem,
          "data-emoji-sec": mainCollectionKey
        }), /*#__PURE__*/React__default.createElement("span", {
          className: 'emoji',
          role: 'img',
          "aria-label": label || '',
          "aria-hidden": label ? 'false' : 'true'
        }, emoji));
      });
    }));
  }))), emojisCategoryIconsPosition !== 'top' && /*#__PURE__*/React__default.createElement(EmojiFooter$1, null, EMOJIS$1.map(function (emoji) {
    return /*#__PURE__*/React__default.createElement(EmojiCollection$1, {
      activeCollection: activeCollection === emoji.key,
      key: "" + emoji.key,
      onClick: function onClick() {
        return handleEmojiCollectionClick(emoji.key);
      }
    }, /*#__PURE__*/React__default.createElement(EmojiIcon$1, {
      collectionName: emoji.key
    }));
  })));
}
var Container$h = styled__default.div(_templateObject$A || (_templateObject$A = _taggedTemplateLiteralLoose(["\n  position: ", ";\n  left: ", ";\n  right: ", ";\n  direction: ", ";\n  bottom: ", ";\n  width: 306px;\n  border: ", ";\n  box-sizing: border-box;\n  box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);\n  border-radius: ", ";\n  background: ", ";\n  z-index: 35;\n  //transform: scaleY(0);\n  height: 0;\n  overflow: hidden;\n  transform-origin: ", ";\n  transition: all 0.2s ease-in-out;\n  ", ";\n"])), function (props) {
  return props.leftPosition ? 'fixed' : props.relativePosition ? 'relative' : 'absolute';
}, function (props) {
  return props.leftPosition || (props.rtlDirection ? '' : props.rightSide ? '' : '5px');
}, function (props) {
  return props.rtlDirection ? '0' : props.rightSide ? '65px' : '';
}, function (props) {
  return props.rtlDirection ? 'initial' : '';
}, function (props) {
  return props.bottomPosition;
}, function (props) {
  return props.noBorder ? 'none' : "1px solid " + colors.gray1;
}, function (props) {
  return props.borderRadius || '12px';
}, function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.emojisPopupPosition === 'bottom' ? '0 0' : '0 100%';
}, function (props) {
  return props.rendered && "\n    height: 225px;\n  ";
});
var EmojiHeader$1 = styled__default.div(_templateObject2$w || (_templateObject2$w = _taggedTemplateLiteralLoose(["\n  align-items: flex-end;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 12px;\n  line-height: 22px;\n  text-transform: uppercase;\n  color: ", ";\n  display: flex;\n  padding: ", ";\n"])), colors.textColor2, function (props) {
  return props.padding || '6px 18px';
});
var EmojiSection$1 = styled__default.div(_templateObject3$p || (_templateObject3$p = _taggedTemplateLiteralLoose(["\n  height: 180px;\n  overflow-x: hidden;\n\n  & ::selection {\n    color: inherit;\n    background: inherit;\n  }\n"])));
var EmojiCollection$1 = styled__default.span(_templateObject4$l || (_templateObject4$l = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  & > * {\n    color: ", ";\n  }\n"])), function (props) {
  return props.activeCollection ? colors.primary : colors.textColor3;
});
var CollectionPointer$1 = styled__default.span(_templateObject5$j || (_templateObject5$j = _taggedTemplateLiteralLoose([""])));
var AllEmojis$1 = styled__default.ul(_templateObject6$g || (_templateObject6$g = _taggedTemplateLiteralLoose(["\n  overflow: hidden;\n  padding: 0 8px 8px;\n  margin: 0;\n"])));
var EmojiFooter$1 = styled__default.div(_templateObject7$e || (_templateObject7$e = _taggedTemplateLiteralLoose(["\n  height: 42px;\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  border-top: ", ";\n  border-bottom: ", ";\n  padding: 0 10px;\n  & > span {\n    width: 100%;\n    text-align: center;\n  }\n"])), function (props) {
  return props.emojisCategoryIconsPosition !== 'top' && "1px solid " + (props.borderColor || colors.gray1);
}, function (props) {
  return props.emojisCategoryIconsPosition === 'top' && "1px solid " + (props.borderColor || colors.gray1);
});
var Emoji$1 = styled__default.li(_templateObject8$d || (_templateObject8$d = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  width: 32px;\n  height: 32px;\n  margin: 0 2px;\n  display: inline-block;\n  box-sizing: border-box;\n  border-radius: 50%;\n  padding-top: 2px;\n  text-align: center;\n  background: transparent;\n  font-family: apple color emoji, segoe ui emoji, noto color emoji, android emoji, emojisymbols, emojione mozilla,\n    twemoji mozilla, segoe ui symbol;\n  & > * {\n    font-size: 22px;\n  }\n  &:hover {\n    background: ", ";\n  }\n"])), function (props) {
  return props.hoverBackgroundColor || colors.backgroundColor;
});

var CAN_USE_DOM = typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';

var _templateObject$B, _templateObject2$x, _templateObject3$q, _templateObject4$m, _templateObject5$k, _templateObject6$h, _templateObject7$f, _templateObject8$e, _templateObject9$c, _templateObject10$b, _templateObject11$8, _templateObject12$5, _templateObject13$5, _templateObject14$4, _templateObject15$4, _templateObject16$3, _templateObject17$3, _templateObject18$3, _templateObject19$3, _templateObject20$2, _templateObject21$2, _templateObject22$2, _templateObject23$2, _templateObject24$2, _templateObject25$2, _templateObject26$1, _templateObject27$1, _templateObject28$1, _templateObject29$1, _templateObject30$1, _templateObject31$1, _templateObject32$1, _templateObject33$1;

function MyCustomAutoFocusPlugin() {
  var _useLexicalComposerCo = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo[0];

  React.useEffect(function () {
    editor.focus();
  }, [editor]);
  return null;
}

function ClearEditorPlugin(_ref) {
  var shouldClearEditor = _ref.shouldClearEditor,
      setEditorCleared = _ref.setEditorCleared;

  var _useLexicalComposerCo2 = LexicalComposerContext.useLexicalComposerContext(),
      editor = _useLexicalComposerCo2[0];

  useDidUpdate(function () {
    if (shouldClearEditor.clear) {
      editor.update(function () {
        var rootNode = lexical.$getRoot();
        rootNode.clear();

        if (shouldClearEditor.draftMessage) {
          var paragraphNode = lexical.$createParagraphNode();
          paragraphNode.append(lexical.$createTextNode(shouldClearEditor.draftMessage.text));
          editor.setEditorState(shouldClearEditor.draftMessage.editorState);
        }

        setEditorCleared();
      });
    }
  }, [shouldClearEditor]);
  return null;
}

function onError(error) {
  console.error(error);
}

var prevActiveChannelId;

var SendMessageInput = function SendMessageInput(_ref2) {
  var handleAttachmentSelected = _ref2.handleAttachmentSelected,
      handleSendMessage = _ref2.handleSendMessage,
      _ref2$disabled = _ref2.disabled,
      disabled = _ref2$disabled === void 0 ? false : _ref2$disabled,
      sendIconOrder = _ref2.sendIconOrder,
      _ref2$inputOrder = _ref2.inputOrder,
      inputOrder = _ref2$inputOrder === void 0 ? 1 : _ref2$inputOrder,
      _ref2$showAddEmojis = _ref2.showAddEmojis,
      showAddEmojis = _ref2$showAddEmojis === void 0 ? true : _ref2$showAddEmojis,
      AddEmojisIcon = _ref2.AddEmojisIcon,
      _ref2$emojiIcoOrder = _ref2.emojiIcoOrder,
      emojiIcoOrder = _ref2$emojiIcoOrder === void 0 ? 2 : _ref2$emojiIcoOrder,
      _ref2$showAddAttachme = _ref2.showAddAttachments,
      showAddAttachments = _ref2$showAddAttachme === void 0 ? true : _ref2$showAddAttachme,
      AddAttachmentsIcon = _ref2.AddAttachmentsIcon,
      _ref2$attachmentIcoOr = _ref2.attachmentIcoOrder,
      attachmentIcoOrder = _ref2$attachmentIcoOr === void 0 ? 0 : _ref2$attachmentIcoOr,
      CustomTypingIndicator = _ref2.CustomTypingIndicator,
      margin = _ref2.margin,
      border = _ref2.border,
      minHeight = _ref2.minHeight,
      borderRadius = _ref2.borderRadius,
      inputBorderRadius = _ref2.inputBorderRadius,
      backgroundColor = _ref2.backgroundColor,
      inputBackgroundColor = _ref2.inputBackgroundColor,
      inputCustomClassname = _ref2.inputCustomClassname,
      _ref2$inputAutofocus = _ref2.inputAutofocus,
      inputAutofocus = _ref2$inputAutofocus === void 0 ? true : _ref2$inputAutofocus,
      inputPaddings = _ref2.inputPaddings,
      selectedAttachmentsBorderRadius = _ref2.selectedAttachmentsBorderRadius,
      selectedFileAttachmentsIcon = _ref2.selectedFileAttachmentsIcon,
      selectedFileAttachmentsBoxBackground = _ref2.selectedFileAttachmentsBoxBackground,
      selectedFileAttachmentsBoxBorder = _ref2.selectedFileAttachmentsBoxBorder,
      selectedFileAttachmentsTitleColor = _ref2.selectedFileAttachmentsTitleColor,
      selectedFileAttachmentsSizeColor = _ref2.selectedFileAttachmentsSizeColor,
      replyMessageIcon = _ref2.replyMessageIcon,
      editMessageIcon = _ref2.editMessageIcon,
      sendAttachmentSeparately = _ref2.sendAttachmentSeparately,
      _ref2$allowMentionUse = _ref2.allowMentionUser,
      allowMentionUser = _ref2$allowMentionUse === void 0 ? true : _ref2$allowMentionUse,
      textSelectionBackgroundColor = _ref2.textSelectionBackgroundColor;
  var dispatch = reactRedux.useDispatch();
  var ChatClient = getClient();
  var user = ChatClient.user;
  var channelDetailsIsOpen = reactRedux.useSelector(channelInfoIsOpenSelector, reactRedux.shallowEqual);
  var theme = reactRedux.useSelector(themeSelector);
  var getFromContacts = getShowOnlyContactUsers();
  var activeChannel = reactRedux.useSelector(activeChannelSelector);
  var messageToEdit = reactRedux.useSelector(messageToEditSelector);
  var messageForReply = reactRedux.useSelector(messageForReplySelector);
  var draggedAttachments = reactRedux.useSelector(draggedAttachmentsSelector);
  var selectedMessagesMap = reactRedux.useSelector(selectedMessagesMapSelector);
  var isDirectChannel = activeChannel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && activeChannel.members.find(function (member) {
    return member.id !== user.id;
  });
  var disableInput = disabled || directChannelUser && hideUserPresence && hideUserPresence(directChannelUser);
  var isBlockedUserChat = directChannelUser && directChannelUser.blocked;
  var isDeletedUserChat = directChannelUser && directChannelUser.state === USER_STATE.DELETED;
  var messageContRef = React.useRef(null);

  var _usePermissions = usePermissions(activeChannel.userRole),
      checkActionPermission = _usePermissions[0];

  var _useState = React.useState(false),
      listenerIsAdded = _useState[0],
      setListenerIsAdded = _useState[1];

  var _useState2 = React.useState(''),
      messageText = _useState2[0],
      setMessageText = _useState2[1];

  var _useState3 = React.useState(''),
      editMessageText = _useState3[0],
      setEditMessageText = _useState3[1];

  var _useState4 = React.useState({}),
      readyVideoAttachments = _useState4[0],
      setReadyVideoAttachments = _useState4[1];

  var _useState5 = React.useState(false),
      showChooseAttachmentType = _useState5[0],
      setShowChooseAttachmentType = _useState5[1];

  var _useState6 = React.useState(false),
      isEmojisOpened = _useState6[0],
      setIsEmojisOpened = _useState6[1];

  var _useState7 = React.useState(false),
      emojisInRightSide = _useState7[0],
      setEmojisInRightSide = _useState7[1];

  var _useState8 = React.useState(0),
      emojisPopupLeftPosition = _useState8[0],
      setEmojisPopupLeftPosition = _useState8[1];

  var _useState9 = React.useState(0),
      emojisPopupBottomPosition = _useState9[0],
      setEmojisPopupBottomPosition = _useState9[1];

  var _useState10 = React.useState(false),
      addAttachmentsInRightSide = _useState10[0],
      setAddAttachmentsInRightSide = _useState10[1];

  var _useState11 = React.useState({
    clear: false
  }),
      shouldClearEditor = _useState11[0],
      setShouldClearEditor = _useState11[1];

  var _useState12 = React.useState([]),
      messageBodyAttributes = _useState12[0],
      setMessageBodyAttributes = _useState12[1];

  var _useState13 = React.useState([]),
      mentionedMembers = _useState13[0],
      setMentionedMembers = _useState13[1];

  var _useState14 = React.useState(''),
      browser = _useState14[0],
      setBrowser = _useState14[1];

  var _useState15 = React.useState(),
      inputContainerHeight = _useState15[0],
      setInputContainerHeight = _useState15[1];

  var selectedText = React.useRef(null);

  var _useState16 = React.useState(),
      typingTimout = _useState16[0],
      setTypingTimout = _useState16[1];

  var _useState17 = React.useState(),
      inTypingStateTimout = _useState17[0],
      setInTypingStateTimout = _useState17[1];

  var _useState18 = React.useState(false),
      inTypingState = _useState18[0],
      setInTypingState = _useState18[1];

  var _useState19 = React.useState(false),
      sendMessageIsActive = _useState19[0],
      setSendMessageIsActive = _useState19[1];

  var _useState20 = React.useState([]),
      attachments = _useState20[0],
      setAttachments = _useState20[1];

  var _useState21 = React.useState(false),
      forwardPopupOpen = _useState21[0],
      setForwardPopupOpen = _useState21[1];

  var _useState22 = React.useState(false),
      deletePopupOpen = _useState22[0],
      setDeletePopupOpen = _useState22[1];

  var _useState23 = React.useState(false),
      isIncomingMessage = _useState23[0],
      setIsIncomingMessage = _useState23[1];

  var typingIndicator = reactRedux.useSelector(typingIndicatorSelector(activeChannel.id));
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var connectionStatus = reactRedux.useSelector(connectionStatusSelector, reactRedux.shallowEqual);
  var fileUploader = React.useRef(null);
  var inputWrapperRef = React.useRef(null);
  var messageInputRef = React.useRef(null);
  var emojiBtnRef = React.useRef(null);
  var addAttachmentsBtnRef = React.useRef(null);
  var editorRef = React.useRef(null);

  var _useState24 = React.useState(),
      realEditorState = _useState24[0],
      setRealEditorState = _useState24[1];

  var _useState25 = React.useState(null),
      floatingAnchorElem = _useState25[0],
      setFloatingAnchorElem = _useState25[1];

  var _useState26 = React.useState(false),
      isSmallWidthViewport = _useState26[0],
      setIsSmallWidthViewport = _useState26[1];

  function onChange(editorState) {
    setRealEditorState(editorState);
    editorState.read(function () {
      var rootNode = lexical.$getRoot();
      var plainText = rootNode.getTextContent();

      if (messageToEdit) ; else {
        setMessageText(plainText);
      }
    });

    if (typingTimout) {
      if (!inTypingStateTimout) {
        handleSendTypingState(true);
      }

      clearTimeout(typingTimout);
    } else {
      handleSendTypingState(true);
    }

    setTypingTimout(setTimeout(function () {
      setTypingTimout(0);
    }, 2000));
  }

  var onRef = function onRef(_floatingAnchorElem) {
    if (_floatingAnchorElem !== null) {
      setFloatingAnchorElem(_floatingAnchorElem);
    }
  };

  var initialConfig = {
    namespace: 'MyEditor',
    theme: EditorTheme,
    nodes: [MentionNode],
    onError: onError
  };
  React.useEffect(function () {
    var updateViewPortWidth = function updateViewPortWidth() {
      var isNextSmallWidthViewport = CAN_USE_DOM && window.matchMedia('(max-width: 1025px)').matches;

      if (isNextSmallWidthViewport !== isSmallWidthViewport) {
        setIsSmallWidthViewport(isNextSmallWidthViewport);
      }
    };

    updateViewPortWidth();
    window.addEventListener('resize', updateViewPortWidth);
    return function () {
      window.removeEventListener('resize', updateViewPortWidth);
    };
  }, [isSmallWidthViewport]);
  var mediaExtensions = '.jpg,.jpeg,.png,.gif,.mp4,.mov,.avi,.wmv,.flv,.webm,.jfif';

  var handleSendTypingState = function handleSendTypingState(typingState) {
    if (typingState) {
      setInTypingStateTimout(setTimeout(function () {
        setInTypingStateTimout(0);
      }, 3000));
    } else {
      clearTimeout(inTypingStateTimout);
    }

    setInTypingState(typingState);

    if (!activeChannel.isMockChannel) {
      dispatch(sendTypingAC(typingState));
    }
  };

  var handleCloseReply = function handleCloseReply() {
    dispatch(setMessageForReplyAC(null));
  };

  var handleSendEditMessage = function handleSendEditMessage(event) {
    var shiftKey = event.shiftKey,
        type = event.type,
        code = event.code;
    var isEnter = code === 'Enter' && shiftKey === false;
    var shouldSend = (isEnter || type === 'click') && (messageToEdit || messageText || attachments.length && attachments.length > 0);

    if (isEnter) {
      event.preventDefault();
    }

    if (shouldSend) {
      event.preventDefault();
      event.stopPropagation();

      if (messageToEdit) {
        handleEditMessage();
      } else if (messageText || attachments.length && attachments.length > 0) {
        var messageTexToSend = messageText.trim();
        var messageToSend = {
          body: messageTexToSend,
          bodyAttributes: messageBodyAttributes,
          mentionedMembers: [],
          attachments: [],
          type: 'text'
        };
        var mentionMembersToSend = [];

        if (messageBodyAttributes && messageBodyAttributes.length) {
          messageBodyAttributes.forEach(function (att) {
            if (att.type === 'mention') {
              var mentionsToFind = [].concat(mentionedMembers);
              var draftMessage = getDraftMessageFromMap(activeChannel.id);

              if (draftMessage) {
                mentionsToFind = [].concat(draftMessage.mentionedMembers, mentionedMembers);
              }

              var mentionToAdd = mentionsToFind.find(function (mention) {
                return mention.id === att.metadata;
              });
              mentionMembersToSend.push(mentionToAdd);
            }
          });
        }

        messageToSend.mentionedMembers = mentionMembersToSend;
        console.log('message to send ..........................................', messageToSend);

        if (messageForReply) {
          messageToSend.parentMessage = messageForReply;
        }

        var linkAttachment;

        if (messageTexToSend) {
          var linkify = new LinkifyIt();
          var match = linkify.match(messageTexToSend);

          if (match) {
            linkAttachment = {
              type: attachmentTypes.link,
              data: match[0].url,
              upload: false
            };
          }
        }

        if (messageTexToSend && !attachments.length) {
          if (linkAttachment) {
            messageToSend.attachments = [linkAttachment];
          }

          dispatch(sendTextMessageAC(messageToSend, activeChannel.id, connectionStatus));
        }

        if (attachments.length) {
          var sendAsSeparateMessage = getSendAttachmentsAsSeparateMessages();
          console.log('send as separate message ... ', sendAsSeparateMessage);
          messageToSend.attachments = attachments.map(function (attachment, index) {
            var attachmentToSend = {
              name: attachment.data.name,
              data: attachment.data,
              tid: attachment.tid,
              cachedUrl: attachment.cachedUrl,
              upload: attachment.upload,
              attachmentUrl: attachment.attachmentUrl,
              metadata: attachment.metadata,
              type: attachment.type,
              size: attachment.size
            };

            if (sendAsSeparateMessage) {
              if (index !== 0) {
                messageToSend.body = '';
                messageToSend.metadata = '';
                delete messageToSend.mentionedMembers;
              }

              var attachmentsToSent = [attachmentToSend];

              if (linkAttachment) {
                attachmentsToSent.push(linkAttachment);
              }

              dispatch(sendMessageAC(_extends({}, messageToSend, {
                attachments: attachmentsToSent
              }), activeChannel.id, connectionStatus, true));
            }

            return attachmentToSend;
          });

          if (!sendAsSeparateMessage) {
            var attachmentsToSent = [].concat(messageToSend.attachments);

            if (linkAttachment) {
              attachmentsToSent.push(linkAttachment);
            }

            dispatch(sendMessageAC(_extends({}, messageToSend, {
              attachments: attachmentsToSent
            }), activeChannel.id, connectionStatus, false));
          }
        }

        setMessageText('');
        fileUploader.current.value = '';

        if (inTypingState) {
          handleSendTypingState(false);
        }

        clearTimeout(typingTimout);
        setTypingTimout(undefined);
      }

      setAttachments([]);
      handleCloseReply();
      setShouldClearEditor({
        clear: true
      });
      setMentionedMembers([]);
      setMessageBodyAttributes([]);
      console.log('set mention typing false. . . . . .  >>>>>>>>>>>>>>>>>>>>>3 ');
      dispatch(setCloseSearchChannelsAC(true));
    }
  };

  var handleEditMessage = function handleEditMessage() {
    var messageTexToSend = editMessageText.trim();
    console.log('messageTexToSend . . . . .', messageTexToSend);
    console.log('messageToEdit . . . . .', messageToEdit);

    if (messageTexToSend && messageTexToSend !== messageToEdit.body) {
      var mentionedMembersPositions = [];
      var mentionMembersToSend = [];

      if (mentionedMembers && mentionedMembers.length) {
        if (messageBodyAttributes && messageBodyAttributes.length) {
          messageBodyAttributes.forEach(function (att) {
            if (att.type === 'mention') {
              var mentionsToFind = [].concat(mentionedMembers);
              var draftMessage = getDraftMessageFromMap(activeChannel.id);

              if (draftMessage) {
                mentionsToFind = [].concat(draftMessage.mentionedMembers, mentionedMembers);
              }

              var mentionToAdd = mentionsToFind.find(function (mention) {
                return mention.id === att.metadata;
              });
              mentionMembersToSend.push(mentionToAdd);
            }
          });
        }
      }

      var messageToSend = _extends({}, messageToEdit, {
        metadata: mentionedMembersPositions,
        bodyAttributes: messageBodyAttributes,
        mentionedUsers: mentionMembersToSend,
        body: messageTexToSend
      });

      messageToSend.type = /(https?:\/\/[^\s]+)/.test(messageToSend.body) ? 'link' : messageToSend.type;
      dispatch(editMessageAC(activeChannel.id, messageToSend));
    }

    handleCloseEditMode();
  };

  var handleCloseEditMode = function handleCloseEditMode() {
    setEditMessageText('');
    setMentionedMembers([]);
    console.log('set mention typing false. . . . . .  >>>>>>>>>>>>>>>>>>>>> 4');
    dispatch(setMessageToEditAC(null));
  };

  var removeUpload = function removeUpload(attachmentId) {
    if (attachmentId) {
      deleteVideoThumb(attachmentId);
      setAttachments(attachments.filter(function (item) {
        return item.tid !== attachmentId;
      }));
    } else {
      setAttachments([]);
    }
  };

  var handleFileUpload = function handleFileUpload(e) {
    var isMediaAttachment = e.target.accept === mediaExtensions;
    var fileList = Object.values(e.target.files);
    fileList.forEach(function (file) {
      handleAddAttachment(file, isMediaAttachment);
      return Promise.resolve();
    });
    fileUploader.current.value = '';
  };

  var onOpenFileUploader = function onOpenFileUploader(attachmentType) {
    setShowChooseAttachmentType(false);
    fileUploader.current.accept = attachmentType;
    fileUploader.current.click();
  };

  var handlePastAttachments = function handlePastAttachments(e) {
    console.log('handle past >>>>>>>>>>>>>>>>>>>>>>>>');
    var os = detectOS();
    console.log('os is >>> ', os);

    if (os === 'Windows' && browser === 'Firefox') ; else {
      if (e.clipboardData.files && e.clipboardData.files.length > 0) {
        e.preventDefault();
        var fileList = Object.values(e.clipboardData.files);
        fileList.forEach(function (file) {
          handleAddAttachment(file, true);
          return Promise.resolve();
        });
      } else {
        e.preventDefault();
      }
    }
  };

  var handleCut = function handleCut() {
    setMessageText('');
    console.log('set mention typing false. . . . . .  >>>>>>>>>>>>>>>>>>>>> 5');
    setMentionedMembers([]);
  };

  var handleEmojiPopupToggle = function handleEmojiPopupToggle(bool) {
    setIsEmojisOpened(bool);
  };

  var setVideoIsReadyToSend = function setVideoIsReadyToSend(attachmentId) {
    var _extends2;

    setReadyVideoAttachments(_extends({}, readyVideoAttachments, (_extends2 = {}, _extends2[attachmentId] = true, _extends2)));
  };

  var handleJoinToChannel = function handleJoinToChannel() {
    dispatch(joinChannelAC(activeChannel.id));
  };

  var handleClick = function handleClick(e) {
    var emojisContainer = document.getElementById('emojisContainer');

    if (emojisContainer && !emojisContainer.contains(e.target) && emojiBtnRef.current && !emojiBtnRef.current.contains(e.target)) {
      setIsEmojisOpened(false);
    }
  };

  var handleToggleForwardMessagePopup = function handleToggleForwardMessagePopup() {
    setForwardPopupOpen(!forwardPopupOpen);
  };

  var handleForwardMessage = function handleForwardMessage(channelIds) {
    var messagesArray = Array.from(selectedMessagesMap.values());
    messagesArray.sort(function (a, b) {
      return new Date(a.createdAt) - new Date(b.createdAt);
    });

    if (channelIds && channelIds.length) {
      channelIds.forEach(function (channelId) {
        messagesArray.forEach(function (message) {
          dispatch(forwardMessageAC(message, channelId, connectionStatus));
        });
      });
    }

    dispatch(clearSelectedMessagesAC());
  };

  var handleDeletePendingMessage = function handleDeletePendingMessage(message) {
    if (message.attachments && message.attachments.length) {
      var customUploader = getCustomUploader();
      message.attachments.forEach(function (att) {
        if (customUploader) {
          cancelUpload(att.tid);
          deletePendingAttachment(att.tid);
        }
      });
    }

    removeMessageFromMap(activeChannel.id, message.id || message.tid);
    removeMessageFromAllMessages(message.id || message.tid);
    dispatch(deleteMessageFromListAC(message.id || message.tid));
  };

  var handleToggleDeleteMessagePopup = function handleToggleDeleteMessagePopup() {
    if (!deletePopupOpen) {
      for (var _iterator = _createForOfIteratorHelperLoose(selectedMessagesMap.values()), _step; !(_step = _iterator()).done;) {
        var message = _step.value;

        if (message.incoming) {
          setIsIncomingMessage(true);
          break;
        } else {
          setIsIncomingMessage(false);
        }
      }
    }

    setDeletePopupOpen(!deletePopupOpen);
  };

  var handleDeleteMessage = function handleDeleteMessage(deleteOption) {
    for (var _iterator2 = _createForOfIteratorHelperLoose(selectedMessagesMap.values()), _step2; !(_step2 = _iterator2()).done;) {
      var message = _step2.value;

      if (!message.deliveryStatus || message.deliveryStatus === MESSAGE_DELIVERY_STATUS.PENDING) {
        handleDeletePendingMessage(message);
      } else {
        dispatch(deleteMessageAC(activeChannel.id, message.id, deleteOption));
      }
    }

    dispatch(clearSelectedMessagesAC());
  };

  var handleCloseSelectMessages = function handleCloseSelectMessages() {
    dispatch(clearSelectedMessagesAC());
  };

  var handleSetMentionMember = function handleSetMentionMember(mentionMember) {
    setMentionedMembers(function (prevState) {
      return [].concat(prevState, [mentionMember]);
    });
  };

  var handleAddAttachment = function handleAddAttachment(file, isMediaAttachment) {
    try {
      var customUploader = getCustomUploader();
      var fileType = file.type.split('/')[0];
      var tid = uuid.v4();
      var cachedUrl;
      var reader = new FileReader();
      console.log('file is opened. .. ', file);

      reader.onload = function () {
        try {
          var length = reader.result && reader.result.length;
          var fileChecksum;

          if (length > 3000) {
            var firstPart = reader.result && reader.result.slice(0, 1000);
            var middlePart = reader.result && reader.result.slice(length / 2 - 500, length / 2 + 500);
            var lastPart = reader.result && reader.result.slice(length - 1000, length);
            fileChecksum = "" + firstPart + middlePart + lastPart;
          } else {
            fileChecksum = "" + reader.result;
          }

          return Promise.resolve(hashString(fileChecksum || '')).then(function (checksumHash) {
            function _temp12() {
              if (dataFromDb) {
                cachedUrl = dataFromDb.url;
                setPendingAttachment(tid, {
                  file: cachedUrl
                });
              } else {
                setPendingAttachment(tid, {
                  file: file,
                  checksum: checksumHash
                });
              }

              var _temp10 = function () {
                if (customUploader) {
                  if (fileType === 'image') {
                    resizeImage(file).then(function (resizedFile) {
                      try {
                        setAttachments(function (prevState) {
                          return [].concat(prevState, [{
                            data: file,
                            cachedUrl: cachedUrl,
                            upload: false,
                            type: isMediaAttachment ? fileType : 'file',
                            attachmentUrl: URL.createObjectURL(resizedFile.blob),
                            tid: tid,
                            size: dataFromDb ? dataFromDb.size : file.size,
                            metadata: dataFromDb && dataFromDb.metadata
                          }]);
                        });
                        return Promise.resolve();
                      } catch (e) {
                        return Promise.reject(e);
                      }
                    });
                  } else if (fileType === 'video') {
                    console.log('handle set attachments ... .', {
                      data: file,
                      cachedUrl: cachedUrl,
                      upload: false,
                      type: isMediaAttachment ? fileType : 'file',
                      attachmentUrl: URL.createObjectURL(file),
                      tid: tid,
                      size: dataFromDb ? dataFromDb.size : file.size,
                      metadata: dataFromDb && dataFromDb.metadata
                    });
                    setAttachments(function (prevState) {
                      return [].concat(prevState, [{
                        data: file,
                        cachedUrl: cachedUrl,
                        upload: false,
                        type: isMediaAttachment ? fileType : 'file',
                        attachmentUrl: URL.createObjectURL(file),
                        tid: tid,
                        size: dataFromDb ? dataFromDb.size : file.size,
                        metadata: dataFromDb && dataFromDb.metadata
                      }]);
                    });
                  } else {
                    setAttachments(function (prevState) {
                      return [].concat(prevState, [{
                        data: file,
                        cachedUrl: cachedUrl,
                        upload: false,
                        type: 'file',
                        tid: tid,
                        size: dataFromDb ? dataFromDb.size : file.size,
                        metadata: dataFromDb && dataFromDb.metadata
                      }]);
                    });
                  }
                } else {
                  var _temp13 = function () {
                    if (fileType === 'image') {
                      var _temp14 = function () {
                        if (isMediaAttachment) {
                          var _temp15 = function _temp15() {
                            if (file.type === 'image/gif') {
                              setAttachments(function (prevState) {
                                return [].concat(prevState, [{
                                  data: file,
                                  cachedUrl: cachedUrl,
                                  upload: !cachedUrl,
                                  attachmentUrl: URL.createObjectURL(file),
                                  tid: tid,
                                  type: fileType,
                                  size: dataFromDb ? dataFromDb.size : file.size,
                                  metadata: dataFromDb ? _metas : JSON.stringify({
                                    tmb: _metas.thumbnail,
                                    szw: _metas.imageWidth,
                                    szh: _metas.imageHeight
                                  })
                                }]);
                              });
                            } else {
                              if (dataFromDb) {
                                console.log('data from db . . . . set metas. ... .. ', _metas);
                                setAttachments(function (prevState) {
                                  return [].concat(prevState, [{
                                    data: file,
                                    cachedUrl: cachedUrl,
                                    upload: false,
                                    attachmentUrl: URL.createObjectURL(file),
                                    tid: tid,
                                    type: fileType,
                                    size: dataFromDb.size,
                                    metadata: _metas
                                  }]);
                                });
                              } else {
                                resizeImage(file).then(function (resizedFileData) {
                                  try {
                                    var resizedFile = new File([resizedFileData.blob], resizedFileData.file.name);
                                    setAttachments(function (prevState) {
                                      return [].concat(prevState, [{
                                        data: resizedFile,
                                        upload: true,
                                        attachmentUrl: URL.createObjectURL(resizedFile),
                                        tid: tid,
                                        type: fileType,
                                        size: resizedFile.size,
                                        metadata: JSON.stringify({
                                          tmb: _metas.thumbnail,
                                          szw: resizedFileData.newWidth,
                                          szh: resizedFileData.newHeight
                                        })
                                      }]);
                                    });
                                    return Promise.resolve();
                                  } catch (e) {
                                    return Promise.reject(e);
                                  }
                                });
                              }
                            }
                          };

                          var _metas = {};

                          var _temp16 = function () {
                            if (dataFromDb) {
                              _metas = dataFromDb.metadata;
                            } else {
                              return Promise.resolve(createImageThumbnail(file)).then(function (_ref3) {
                                var thumbnail = _ref3.thumbnail,
                                    imageWidth = _ref3.imageWidth,
                                    imageHeight = _ref3.imageHeight;
                                _metas.imageHeight = imageHeight;
                                _metas.imageWidth = imageWidth;
                                _metas.thumbnail = thumbnail;
                              });
                            }
                          }();

                          return _temp16 && _temp16.then ? _temp16.then(_temp15) : _temp15(_temp16);
                        } else {
                          var _temp17 = function _temp17() {
                            setAttachments(function (prevState) {
                              return [].concat(prevState, [{
                                data: file,
                                type: 'file',
                                cachedUrl: cachedUrl,
                                upload: !cachedUrl,
                                attachmentUrl: URL.createObjectURL(file),
                                tid: tid,
                                size: dataFromDb ? dataFromDb.size : file.size,
                                metadata: dataFromDb ? _metas2 : JSON.stringify({
                                  tmb: _metas2.thumbnail
                                })
                              }]);
                            });
                          };

                          var _metas2 = {};

                          var _temp18 = function () {
                            if (dataFromDb) {
                              _metas2 = dataFromDb.metadata;
                            } else {
                              return Promise.resolve(createImageThumbnail(file, undefined, 50, 50)).then(function (_ref4) {
                                var thumbnail = _ref4.thumbnail;
                                _metas2.thumbnail = thumbnail;
                              });
                            }
                          }();

                          return _temp18 && _temp18.then ? _temp18.then(_temp17) : _temp17(_temp18);
                        }
                      }();

                      if (_temp14 && _temp14.then) return _temp14.then(function () {});
                    } else {
                      var _temp19 = function () {
                        if (fileType === 'video') {
                          var _temp20 = function _temp20() {
                            console.log('metas ...... ', _metas3);
                            setAttachments(function (prevState) {
                              return [].concat(prevState, [{
                                data: file,
                                type: 'video',
                                cachedUrl: cachedUrl,
                                upload: !cachedUrl,
                                size: dataFromDb ? dataFromDb.size : file.size,
                                attachmentUrl: URL.createObjectURL(file),
                                tid: tid,
                                metadata: _metas3
                              }]);
                            });
                          };

                          var _metas3 = {};

                          var _temp21 = function () {
                            if (dataFromDb) {
                              _metas3 = dataFromDb.metadata;
                            } else {
                              return Promise.resolve(getFrame(URL.createObjectURL(file), 0)).then(function (_ref5) {
                                var thumb = _ref5.thumb,
                                    width = _ref5.width,
                                    height = _ref5.height;
                                _metas3.thumb = thumb;
                                _metas3.width = width;
                                _metas3.height = height;
                                _metas3 = JSON.stringify(_metas3);
                              });
                            }
                          }();

                          return _temp21 && _temp21.then ? _temp21.then(_temp20) : _temp20(_temp21);
                        } else {
                          setAttachments(function (prevState) {
                            return [].concat(prevState, [{
                              data: file,
                              cachedUrl: cachedUrl,
                              upload: !cachedUrl,
                              type: 'file',
                              size: dataFromDb ? dataFromDb.size : file.size,
                              metadata: dataFromDb && dataFromDb.metadata,
                              tid: tid
                            }]);
                          });
                        }
                      }();

                      if (_temp19 && _temp19.then) return _temp19.then(function () {});
                    }
                  }();

                  if (_temp13 && _temp13.then) return _temp13.then(function () {});
                }
              }();

              if (_temp10 && _temp10.then) return _temp10.then(function () {});
            }

            var dataFromDb;

            var _temp11 = _catch(function () {
              return Promise.resolve(getDataFromDB(DB_NAMES.FILES_STORAGE, DB_STORE_NAMES.ATTACHMENTS, checksumHash, 'checksum')).then(function (_getDataFromDB) {
                dataFromDb = _getDataFromDB;
                console.log('data from db . . . . ', dataFromDb);
              });
            }, function (e) {
              console.log('error in get data from db . . . . ', e);
            });

            return _temp11 && _temp11.then ? _temp11.then(_temp12) : _temp12(_temp11);
          });
        } catch (e) {
          return Promise.reject(e);
        }
      };

      reader.onerror = function (e) {
        console.log(' error on read file onError', e);
      };

      reader.readAsBinaryString(file);
      return Promise.resolve();
    } catch (e) {
      return Promise.reject(e);
    }
  };

  React.useEffect(function () {
    if (typingTimout === 0) {
      handleSendTypingState(false);
    }
  }, [typingTimout]);
  useDidUpdate(function () {
    if (draggedAttachments.length > 0) {
      var attachmentsFiles = draggedAttachments.map(function (draggedData) {
        var arr = draggedData.data.split(',');
        var bstr = atob(arr[1]);
        var n = bstr.length;
        var u8arr = new Uint8Array(n);

        while (n--) {
          u8arr[n] = bstr.charCodeAt(n);
        }

        return new File([u8arr], draggedData.name, {
          type: draggedData.type
        });
      });
      attachmentsFiles.forEach(function (file) {
        try {
          handleAddAttachment(file, draggedAttachments[0].attachmentType === 'media');
          return Promise.resolve();
        } catch (e) {
          return Promise.reject(e);
        }
      });
      dispatch(setDraggedAttachments([], ''));
    }
  }, [draggedAttachments]);
  React.useEffect(function () {
    if (prevActiveChannelId && activeChannel.id && prevActiveChannelId !== activeChannel.id) {
      setMessageText('');
      handleCloseReply();
      setAttachments([]);
      handleCloseEditMode();
      clearTimeout(typingTimout);
      var draftMessage = getDraftMessageFromMap(activeChannel.id);

      if (draftMessage) {
        if (draftMessage.messageForReply) {
          dispatch(setMessageForReplyAC(draftMessage.messageForReply));
        }

        setMessageText(draftMessage.text);
        setMentionedMembers(draftMessage.mentionedMembers);
      }

      setShouldClearEditor({
        clear: true,
        draftMessage: draftMessage
      });
    }

    if (activeChannel.id) {
      prevActiveChannelId = activeChannel.id;
    }

    if (messageInputRef.current && inputAutofocus) {
      messageInputRef.current.focus();
    }

    dispatch(getMembersAC(activeChannel.id));
    setMentionedMembers([]);
  }, [activeChannel.id]);
  React.useEffect(function () {
    if (messageText.trim() || editMessageText.trim() && editMessageText && editMessageText.trim() !== messageToEdit.body || attachments.length) {
      if (attachments.length) {
        var videoAttachment = false;
        attachments.forEach(function (att) {
          if (att.type === 'video' || att.data.type.split('/')[0] === 'video') {
            videoAttachment = true;

            if (!readyVideoAttachments[att.tid]) {
              setSendMessageIsActive(false);
            } else {
              setSendMessageIsActive(true);
            }
          }
        });

        if (!videoAttachment) {
          setSendMessageIsActive(true);
        }
      } else {
        setSendMessageIsActive(true);
      }
    } else {
      setSendMessageIsActive(false);
    }

    if (messageText.trim()) {
      var draftMessage = getDraftMessageFromMap(activeChannel.id);

      if (draftMessage && draftMessage.mentionedMembers && draftMessage.mentionedMembers.length) {
        setDraftMessageToMap(activeChannel.id, {
          text: messageText,
          mentionedMembers: draftMessage.mentionedMembers,
          messageForReply: messageForReply,
          editorState: realEditorState
        });
      } else {
        setDraftMessageToMap(activeChannel.id, {
          text: messageText,
          mentionedMembers: mentionedMembers,
          messageForReply: messageForReply,
          editorState: realEditorState
        });
      }

      if (!listenerIsAdded) {
        setListenerIsAdded(true);
        document.body.setAttribute('onbeforeunload', "return () => 'reload?'");
      }
    } else if (getDraftMessageFromMap(activeChannel.id)) {
      removeDraftMessageFromMap(activeChannel.id);
      dispatch(setChannelDraftMessageIsRemovedAC(activeChannel.id));

      if (checkDraftMessagesIsEmpty() && listenerIsAdded) {
        setListenerIsAdded(false);
        document.body.removeAttribute('onbeforeunload');
      }
    }
  }, [messageText, attachments, editMessageText, readyVideoAttachments]);
  useDidUpdate(function () {
    if (mentionedMembers && mentionedMembers.length) {
      console.log('set draft message 2 ..>> ', {
        text: messageText,
        mentionedMembers: mentionedMembers,
        messageForReply: messageForReply
      });
      setDraftMessageToMap(activeChannel.id, {
        text: messageText,
        mentionedMembers: mentionedMembers,
        messageForReply: messageForReply
      });
    }
  }, [mentionedMembers]);
  React.useEffect(function () {
    if (emojiBtnRef && emojiBtnRef.current) {
      var _emojiBtnRef$current$ = emojiBtnRef.current.getBoundingClientRect(),
          left = _emojiBtnRef$current$.left,
          width = _emojiBtnRef$current$.width;

      setEmojisPopupLeftPosition(left - width / 2);
    }
  }, [emojiBtnRef.current]);
  React.useEffect(function () {
    if (connectionStatus === CONNECTION_STATUS.CONNECTED) {
      setTimeout(function () {
        var pendingMessagesMap = getPendingMessagesMap();
        Object.keys(pendingMessagesMap).forEach(function (key) {
          pendingMessagesMap[key].forEach(function (msg) {
            dispatch(resendMessageAC(msg, key, connectionStatus));
          });
        });
      }, 1000);
    }
  }, [connectionStatus]);
  useDidUpdate(function () {
    if (handleAttachmentSelected) {
      handleAttachmentSelected(!!attachments.length);
    }

    if (sendAttachmentSeparately && attachments && attachments.length) {
      handleSendEditMessage(new Event('click'));
    } else {
      if (messageContRef && messageContRef.current) {
        dispatch(setSendMessageInputHeightAC(messageContRef.current.getBoundingClientRect().height));
      }
    }
  }, [attachments]);
  React.useEffect(function () {
    if (emojiBtnRef.current && messageInputRef.current && emojiBtnRef.current.offsetLeft > messageInputRef.current.offsetWidth) {
      setEmojisInRightSide(true);
    }

    if (attachmentIcoOrder > inputOrder) {
      setAddAttachmentsInRightSide(true);
    }

    if (!inputContainerHeight && inputWrapperRef && inputWrapperRef.current) {
      setInputContainerHeight(inputWrapperRef.current.getBoundingClientRect().height);
    }
  });
  useDidUpdate(function () {
    if (draftMessagesMap[activeChannel.id]) {
      console.log('set draft 3 .>> >>', {
        text: messageText,
        mentionedMembers: mentionedMembers,
        messageForReply: messageForReply
      });
      setDraftMessageToMap(activeChannel.id, {
        text: messageText,
        mentionedMembers: mentionedMembers,
        messageForReply: messageForReply
      });
    }

    if (messageForReply && messageToEdit) {
      handleCloseEditMode();
    }

    if (messageContRef && messageContRef.current) {
      dispatch(setSendMessageInputHeightAC(messageContRef.current.getBoundingClientRect().height));
    }

    if (editorRef.current) {
      editorRef.current.focus();
    }
  }, [messageForReply]);
  useDidUpdate(function () {
    if (messageToEdit) {
      if (messageForReply) {
        handleCloseReply();
      }
    }

    if (messageContRef && messageContRef.current) {
      dispatch(setSendMessageInputHeightAC(messageContRef.current.getBoundingClientRect().height));
    }
  }, [messageToEdit]);
  React.useEffect(function () {
    setBrowser(detectBrowser());

    if (handleSendMessage) {
      setSendMessageHandler(handleSendMessage);
    }

    var inputHeightTimeout = null;

    if (messageContRef && messageContRef.current) {
      inputHeightTimeout = setTimeout(function () {
        var inputContHeight = messageContRef.current.getBoundingClientRect().height;
        setEmojisPopupBottomPosition(inputContHeight);
        dispatch(setSendMessageInputHeightAC(inputContHeight));
      }, 800);
    }

    messageContRef.current.addEventListener('paste', handlePastAttachments);
    messageContRef.current.addEventListener('cut', handleCut);
    document.addEventListener('mousedown', handleClick);
    return function () {
      if (inputHeightTimeout) {
        clearTimeout(inputHeightTimeout);
      }

      prevActiveChannelId = undefined;
      document.removeEventListener('mousedown', handleClick);

      if (messageContRef && messageContRef.current) {
        messageContRef.current.removeEventListener('paste', handlePastAttachments);
        messageContRef.current.removeEventListener('cut', handleCut);
      }
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$i, {
    margin: margin,
    border: border,
    ref: messageContRef,
    theme: theme,
    mentionColor: colors.primary,
    toolBarTop: selectedText && selectedText.current ? selectedText.current.top : '',
    toolBarLeft: selectedText && selectedText.current ? selectedText.current.left : '',
    selectionBackgroundColor: textSelectionBackgroundColor || colors.primaryLight
  }, selectedMessagesMap && selectedMessagesMap.size > 0 ? /*#__PURE__*/React__default.createElement(SelectedMessagesWrapper, null, selectedMessagesMap.size, " ", selectedMessagesMap.size > 1 ? ' messages selected' : ' message selected', /*#__PURE__*/React__default.createElement(CustomButton, {
    onClick: handleToggleForwardMessagePopup,
    backgroundColor: colors.primaryLight,
    marginLeft: '32px'
  }, /*#__PURE__*/React__default.createElement(SvgForward, null), "Forward"), /*#__PURE__*/React__default.createElement(CustomButton, {
    onClick: handleToggleDeleteMessagePopup,
    color: colors.red1,
    backgroundColor: colors.primaryLight,
    marginLeft: '16px'
  }, /*#__PURE__*/React__default.createElement(SvgDeleteIcon, null), "Delete"), /*#__PURE__*/React__default.createElement(CloseIconWrapper, {
    onClick: handleCloseSelectMessages
  }, /*#__PURE__*/React__default.createElement(SvgClose, null)), forwardPopupOpen && /*#__PURE__*/React__default.createElement(ForwardMessagePopup, {
    handleForward: handleForwardMessage,
    togglePopup: handleToggleForwardMessagePopup,
    buttonText: 'Forward',
    title: 'Forward message'
  }), deletePopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleDeleteMessage,
    togglePopup: handleToggleDeleteMessagePopup,
    buttonText: 'Delete',
    description: "Who do you want to remove " + (selectedMessagesMap.size > 1 ? 'these messages' : 'this message') + " for?",
    isDeleteMessage: true,
    isIncomingMessage: isIncomingMessage,
    myRole: activeChannel.userRole,
    allowDeleteIncoming: getAllowEditDeleteIncomingMessage(),
    isDirectChannel: activeChannel.type === CHANNEL_TYPE.DIRECT,
    title: "Delete message" + (selectedMessagesMap.size > 1 ? 's' : '')
  })) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, !activeChannel.id ? /*#__PURE__*/React__default.createElement(Loading, null) : isBlockedUserChat || isDeletedUserChat || disableInput ? /*#__PURE__*/React__default.createElement(BlockedUserInfo, null, /*#__PURE__*/React__default.createElement(SvgErrorCircle, null), ' ', isDeletedUserChat ? 'This user has been deleted.' : disableInput ? "Sender doesn't support replies" : 'You blocked this user.') : !activeChannel.userRole && activeChannel.type !== CHANNEL_TYPE.DIRECT ? /*#__PURE__*/React__default.createElement(JoinChannelCont, {
    onClick: handleJoinToChannel,
    color: colors.primary
  }, "Join") : (activeChannel.type === CHANNEL_TYPE.BROADCAST || activeChannel.type === CHANNEL_TYPE.PUBLIC ? !(activeChannel.userRole === 'admin' || activeChannel.userRole === 'owner') : activeChannel.type !== CHANNEL_TYPE.DIRECT && !checkActionPermission('sendMessage')) ? /*#__PURE__*/React__default.createElement(ReadOnlyCont, {
    color: colors.textColor1,
    iconColor: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgEye, null), " Read only") : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(TypingIndicator$1, null, typingIndicator && typingIndicator.typingState && (CustomTypingIndicator ? /*#__PURE__*/React__default.createElement(CustomTypingIndicator, {
    from: typingIndicator.from,
    typingState: typingIndicator.typingState
  }) : /*#__PURE__*/React__default.createElement(TypingIndicatorCont, null, /*#__PURE__*/React__default.createElement(TypingFrom, null, makeUsername(getFromContacts && typingIndicator.from && contactsMap[typingIndicator.from.id], typingIndicator.from, getFromContacts), ' ', "is typing"), /*#__PURE__*/React__default.createElement(TypingAnimation, null, /*#__PURE__*/React__default.createElement(DotOne, null), /*#__PURE__*/React__default.createElement(DotTwo, null), /*#__PURE__*/React__default.createElement(DotThree, null))))), messageToEdit && /*#__PURE__*/React__default.createElement(EditReplyMessageCont, null, /*#__PURE__*/React__default.createElement(CloseEditMode, {
    onClick: handleCloseEditMode
  }, /*#__PURE__*/React__default.createElement(SvgClose, null)), /*#__PURE__*/React__default.createElement(EditReplyMessageHeader, {
    color: colors.primary
  }, editMessageIcon || /*#__PURE__*/React__default.createElement(SvgEditIcon, null), "Edit Message"), /*#__PURE__*/React__default.createElement(EditMessageText, null, MessageTextFormat({
    text: messageToEdit.body,
    message: messageToEdit,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts,
    asSampleText: true
  }))), messageForReply && /*#__PURE__*/React__default.createElement(EditReplyMessageCont, null, /*#__PURE__*/React__default.createElement(CloseEditMode, {
    onClick: handleCloseReply
  }, /*#__PURE__*/React__default.createElement(SvgClose, null)), /*#__PURE__*/React__default.createElement(ReplyMessageCont, null, !!(messageForReply.attachments && messageForReply.attachments.length) && (messageForReply.attachments[0].type === attachmentTypes.image || messageForReply.attachments[0].type === attachmentTypes.video ? /*#__PURE__*/React__default.createElement(Attachment$1, {
    attachment: messageForReply.attachments[0],
    backgroundColor: selectedFileAttachmentsBoxBackground || '',
    isRepliedMessage: true
  }) : messageForReply.attachments[0].type === attachmentTypes.file && /*#__PURE__*/React__default.createElement(ReplyIconWrapper, {
    backgroundColor: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgChoseFile, null))), /*#__PURE__*/React__default.createElement("div", null, /*#__PURE__*/React__default.createElement(EditReplyMessageHeader, {
    color: colors.primary
  }, replyMessageIcon || /*#__PURE__*/React__default.createElement(SvgReplyIcon, null), " Reply to", /*#__PURE__*/React__default.createElement(UserName$1, null, user.id === messageForReply.user.id ? user.firstName ? user.firstName + " " + user.lastName : user.id : makeUsername(contactsMap[messageForReply.user.id], messageForReply.user, getFromContacts))), messageForReply.attachments && messageForReply.attachments.length ? messageForReply.attachments[0].type === attachmentTypes.voice ? 'Voice' : messageForReply.attachments[0].type === attachmentTypes.image ? /*#__PURE__*/React__default.createElement(TextInOneLine, null, messageForReply.body || 'Photo') : messageForReply.attachments[0].type === attachmentTypes.video ? /*#__PURE__*/React__default.createElement(TextInOneLine, null, messageForReply.body || 'Video') : /*#__PURE__*/React__default.createElement(TextInOneLine, null, messageForReply.body || 'File') : MessageTextFormat({
    text: messageForReply.body,
    message: messageForReply,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts
  })))), !!attachments.length && !sendAttachmentSeparately && /*#__PURE__*/React__default.createElement(ChosenAttachments, null, attachments.map(function (attachment) {
    return /*#__PURE__*/React__default.createElement(Attachment$1, {
      attachment: attachment,
      isPreview: true,
      removeSelected: removeUpload,
      key: attachment.tid,
      setVideoIsReadyToSend: setVideoIsReadyToSend,
      borderRadius: selectedAttachmentsBorderRadius,
      selectedFileAttachmentsIcon: selectedFileAttachmentsIcon,
      backgroundColor: selectedFileAttachmentsBoxBackground || colors.backgroundColor,
      selectedFileAttachmentsBoxBorder: selectedFileAttachmentsBoxBorder,
      selectedFileAttachmentsTitleColor: selectedFileAttachmentsTitleColor,
      selectedFileAttachmentsSizeColor: selectedFileAttachmentsSizeColor
    });
  })), /*#__PURE__*/React__default.createElement(SendMessageInputContainer, {
    iconColor: colors.primary,
    minHeight: minHeight
  }, /*#__PURE__*/React__default.createElement(UploadFile, {
    ref: fileUploader,
    onChange: handleFileUpload,
    multiple: true,
    type: 'file'
  }), /*#__PURE__*/React__default.createElement(MessageInputWrapper, {
    className: 'message_input_wrapper',
    borderRadius: borderRadius,
    ref: inputWrapperRef,
    backgroundColor: backgroundColor || colors.backgroundColor,
    channelDetailsIsOpen: channelDetailsIsOpen,
    messageInputOrder: inputOrder,
    messageInputPaddings: inputPaddings
  }, showAddEmojis && /*#__PURE__*/React__default.createElement(EmojiButton, {
    order: emojiIcoOrder,
    isEmojisOpened: isEmojisOpened,
    ref: emojiBtnRef,
    hoverColor: colors.primary,
    height: inputContainerHeight || minHeight,
    onClick: function onClick() {
      setIsEmojisOpened(!isEmojisOpened);
    }
  }, AddEmojisIcon || /*#__PURE__*/React__default.createElement(SvgEmojiSmileIcon, null)), showAddAttachments && /*#__PURE__*/React__default.createElement(DropDown, {
    theme: theme,
    forceClose: showChooseAttachmentType,
    position: addAttachmentsInRightSide ? 'top' : 'topRight',
    margin: 'auto 0 0',
    order: attachmentIcoOrder,
    trigger: /*#__PURE__*/React__default.createElement(AddAttachmentIcon, {
      ref: addAttachmentsBtnRef,
      color: colors.primary,
      height: inputContainerHeight || minHeight
    }, AddAttachmentsIcon || /*#__PURE__*/React__default.createElement(SvgAddAttachment, null))
  }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 1,
    textColor: colors.textColor1,
    hoverBackground: colors.hoverBackgroundColor,
    onClick: function onClick() {
      return onOpenFileUploader(mediaExtensions);
    },
    iconWidth: '20px',
    iconColor: colors.textColor2
  }, /*#__PURE__*/React__default.createElement(SvgChoseMedia, null), "Photo or video"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 2,
    textColor: colors.textColor1,
    hoverBackground: colors.hoverBackgroundColor,
    onClick: function onClick() {
      return onOpenFileUploader('');
    },
    iconWidth: '20px',
    iconColor: colors.textColor2
  }, /*#__PURE__*/React__default.createElement(SvgChoseFile, null), "File"))), /*#__PURE__*/React__default.createElement(LexicalWrapper, {
    ref: messageInputRef,
    order: inputOrder,
    backgroundColor: inputBackgroundColor,
    paddings: inputPaddings,
    mentionColor: colors.primary,
    className: inputCustomClassname,
    selectionBackgroundColor: textSelectionBackgroundColor || colors.primaryLight,
    borderRadius: inputBorderRadius
  }, /*#__PURE__*/React__default.createElement(LexicalComposer.LexicalComposer, {
    initialConfig: initialConfig
  }, /*#__PURE__*/React__default.createElement(MyCustomAutoFocusPlugin, null), /*#__PURE__*/React__default.createElement(ClearEditorPlugin, {
    shouldClearEditor: shouldClearEditor,
    setEditorCleared: function setEditorCleared() {
      return setShouldClearEditor({
        clear: false
      });
    }
  }), /*#__PURE__*/React__default.createElement(LexicalOnChangePlugin.OnChangePlugin, {
    onChange: onChange
  }), /*#__PURE__*/React__default.createElement(EditMessagePlugin, {
    editMessage: messageToEdit,
    contactsMap: contactsMap,
    getFromContacts: getFromContacts,
    setMentionedMember: setMentionedMembers
  }), /*#__PURE__*/React__default.createElement(FormatMessagePlugin, {
    editorState: realEditorState,
    setMessageBodyAttributes: setMessageBodyAttributes,
    messageText: messageToEdit ? editMessageText : messageText,
    setMessageText: messageToEdit ? setEditMessageText : setMessageText,
    messageToEdit: messageToEdit
  }), /*#__PURE__*/React__default.createElement(React__default.Fragment, null, isEmojisOpened && /*#__PURE__*/React__default.createElement(EmojisPopup$1, {
    handleEmojiPopupToggle: handleEmojiPopupToggle,
    rightSide: emojisInRightSide,
    bottomPosition: emojisPopupBottomPosition + "px",
    leftPosition: emojisPopupLeftPosition + "px"
  }), allowMentionUser && /*#__PURE__*/React__default.createElement(MentionsPlugin, {
    setMentionMember: handleSetMentionMember,
    contactsMap: contactsMap,
    userId: user.id,
    getFromContacts: getFromContacts
  }), /*#__PURE__*/React__default.createElement(LexicalRichTextPlugin.RichTextPlugin, {
    contentEditable: /*#__PURE__*/React__default.createElement("div", {
      onKeyDown: handleSendEditMessage,
      className: 'rich_text_editor',
      ref: onRef
    }, /*#__PURE__*/React__default.createElement(LexicalContentEditable.ContentEditable, {
      className: 'content_editable_input'
    })),
    placeholder: /*#__PURE__*/React__default.createElement(Placeholder, {
      paddings: inputPaddings
    }, "Type message here ..."),
    ErrorBoundary: LexicalErrorBoundary
  }), floatingAnchorElem && !isSmallWidthViewport && /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(FloatingTextFormatToolbarPlugin, {
    anchorElem: floatingAnchorElem
  })))))), /*#__PURE__*/React__default.createElement(SendMessageIcon, {
    isActive: sendMessageIsActive,
    order: sendIconOrder,
    color: colors.backgroundColor,
    height: inputContainerHeight || minHeight,
    onClick: sendMessageIsActive ? handleSendEditMessage : null
  }, /*#__PURE__*/React__default.createElement(SvgSend, null))))));
};

var Container$i = styled__default.div(_templateObject$B || (_templateObject$B = _taggedTemplateLiteralLoose(["\n  margin: ", ";\n  border: ", ";\n  border-radius: ", ";\n  position: relative;\n  padding: 0 12px;\n\n  & span.rdw-suggestion-dropdown {\n    position: absolute;\n    bottom: 100%;\n    height: 160px;\n    min-width: 150px;\n    display: flex;\n    flex-direction: column;\n    overflow: auto;\n    padding: 6px 12px;\n    border: 1px solid #ccc;\n    background: #fff;\n    z-index: 99;\n  }\n\n  & .text_formatting_toolbar {\n    display: ", ";\n    position: fixed;\n    top: ", ";\n    left: ", ";\n  }\n\n  & .rdw-suggestion-option-active {\n    background-color: rgb(243, 245, 248);\n  }\n  & .custom_editor {\n    cursor: text;\n\n    & .rdw-mention-link {\n      color: ", ";\n    }\n  }\n"])), function (props) {
  return props.margin || '30px 0 16px';
}, function (props) {
  return props.border || '';
}, function (props) {
  return props.borderRadius || '4px';
}, function (props) {
  return props.toolBarTop || props.toolBarLeft ? 'block' : 'none';
}, function (props) {
  return props.toolBarTop;
}, function (props) {
  return props.toolBarLeft;
}, function (props) {
  return props.mentionColor || colors.primary;
});
var MentionsPopup = styled__default.div(_templateObject2$x || (_templateObject2$x = _taggedTemplateLiteralLoose(["\n  width: 300px;\n  transition: all 0.2s;\n  overflow: auto;\n  max-height: 240px;\n  padding: 2px 0 0;\n  background: ", ";\n  border: ", ";\n  box-sizing: border-box;\n  box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);\n  border-radius: 6px;\n  visibility: ", ";\n"])), function (props) {
  return props.backgroundColor || colors.white;
}, function (props) {
  return props.withBorder && "1px solid " + colors.borderColor;
}, function (props) {
  return props.hidden ? 'hidden' : 'visible';
});
var EditReplyMessageCont = styled__default.div(_templateObject3$q || (_templateObject3$q = _taggedTemplateLiteralLoose(["\n  position: relative;\n  left: -12px;\n  width: calc(100% - 8px);\n  padding: 8px 16px;\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 20px;\n  letter-spacing: -0.2px;\n  color: ", ";\n  background-color: ", ";\n  z-index: 19;\n  border-bottom: 1px solid ", ";\n"])), colors.textColor1, colors.backgroundColor, colors.gray1);
var EditMessageText = styled__default.p(_templateObject4$m || (_templateObject4$m = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"])));
var CloseEditMode = styled__default.span(_templateObject5$k || (_templateObject5$k = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: 8px;\n  right: 12px;\n  width: 20px;\n  height: 20px;\n  text-align: center;\n  line-height: 22px;\n  cursor: pointer;\n\n  & > svg {\n    color: ", ";\n  }\n"])), colors.textColor2);
var UserName$1 = styled__default.span(_templateObject6$h || (_templateObject6$h = _taggedTemplateLiteralLoose(["\n  font-weight: 500;\n  margin-left: 4px;\n"])));
var EditReplyMessageHeader = styled__default.h4(_templateObject7$f || (_templateObject7$f = _taggedTemplateLiteralLoose(["\n  display: flex;\n  margin: 0 0 2px;\n  font-weight: 400;\n  font-size: 13px;\n  line-height: 16px;\n  color: ", ";\n\n  > svg {\n    margin-right: 4px;\n    width: 16px;\n    height: 16px;\n  }\n"])), function (props) {
  return props.color || colors.primary;
});
var AddAttachmentIcon = styled__default.span(_templateObject8$e || (_templateObject8$e = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: ", ";\n  align-items: center;\n  margin: 0 8px;\n  cursor: pointer;\n  line-height: 13px;\n  z-index: 2;\n  order: ", ";\n\n  > svg {\n    ", ";\n    width: 24px;\n  }\n\n  &:hover > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.height ? props.height + "px" : '36px';
}, function (props) {
  return props.order === 0 || props.order ? props.order : 1;
}, function (props) {
  return props.isActive ? "color: " + (props.color || colors.primary) + ";" : 'color: #898B99;';
}, function (props) {
  return props.color || colors.primary;
});
var SendMessageInputContainer = styled__default.div(_templateObject9$c || (_templateObject9$c = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: flex-end;\n  position: relative;\n  min-height: ", ";\n  box-sizing: border-box;\n  border-radius: ", ";\n\n  & .dropdown-trigger.open {\n    color: #ccc;\n\n    & ", " {\n      & > svg {\n        color: ", ";\n      }\n    ;\n    }\n  }\n}\n"])), function (props) {
  return props.minHeight || '36px';
}, function (props) {
  return props.messageForReply ? '0 0 4px 4px' : '4px';
}, AddAttachmentIcon, function (props) {
  return props.iconColor || colors.primary;
});
var MessageInputWrapper = styled__default.div(_templateObject10$b || (_templateObject10$b = _taggedTemplateLiteralLoose(["\n  display: flex;\n  width: 100%;\n  max-width: calc(100% - 50px);\n  //max-width: ", ";\n  //max-width: calc(100% - 110px);\n  background-color: ", ";\n  border-radius: ", ";\n  position: relative;\n"])), function (props) {
  return props.channelDetailsIsOpen ? "calc(100% - " + (props.channelDetailsIsOpen ? 362 : 0) + "px)" : '';
}, function (props) {
  return props.backgroundColor || colors.backgroundColor;
}, function (props) {
  return props.borderRadius || '18px';
});
var LexicalWrapper = styled__default.div(_templateObject11$8 || (_templateObject11$8 = _taggedTemplateLiteralLoose(["\n  position: relative;\n  width: 100%;\n\n  & .rich_text_editor {\n    margin: 8px 6px;\n    width: 100%;\n    max-height: 80px;\n    min-height: 20px;\n    display: block;\n    border: none;\n    color: ", ";\n    box-sizing: border-box;\n    outline: none !important;\n    font-size: 15px;\n    line-height: 20px;\n    overflow: auto;\n    border-radius: ", ";\n    background-color: ", ";\n    padding: ", ";\n    order: ", ";\n\n    &::selection {\n      background-color: ", ";\n    }\n    & span::selection {\n      background-color: ", ";\n    }\n\n    &:empty:before {\n      content: attr(data-placeholder);\n    }\n\n    & .content_editable_input {\n      border: none !important;\n      outline: none !important;\n    }\n    & span.mention {\n      color: ", ";\n      user-modify: ", ";\n      background-color: inherit !important;\n    }\n\n    & span.bold {\n      font-weight: bold;\n    }\n    & .editor_paragraph {\n      margin: 0;\n    }\n    & .text_bold {\n      font-weight: bold;\n    }\n    & .text_italic {\n      font-style: italic;\n    }\n    & .text_underline {\n      text-decoration: underline;\n    }\n    & .text_strikethrough {\n      text-decoration: line-through;\n    }\n    & .text_underlineStrikethrough {\n      text-decoration: underline line-through;\n    }\n    & code {\n      font-family: inherit;\n      letter-spacing: 4px;\n    }\n  }\n"])), function (props) {
  return props.color;
}, function (props) {
  return props.borderRadius;
}, function (props) {
  return props.backgroundColor;
}, function (props) {
  return props.paddings;
}, function (props) {
  return props.order === 0 || props.order ? props.order : 1;
}, function (props) {
  return props.selectionBackgroundColor || colors.primary;
}, function (props) {
  return props.selectionBackgroundColor || colors.primary;
}, function (props) {
  return props.mentionColor || colors.primary;
}, function (props) {
  return props.isChrome && 'read-only';
});
var Placeholder = styled__default.span(_templateObject12$5 || (_templateObject12$5 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  color: ", ";\n  margin: 8px 6px;\n\n  padding: ", ";\n"])), colors.placeholderTextColor, function (props) {
  return props.paddings;
});
var EmojiButton = styled__default.span(_templateObject13$5 || (_templateObject13$5 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: ", ";\n  align-items: center;\n  position: relative;\n  margin: auto 8px 0 8px;\n  cursor: pointer;\n  line-height: 13px;\n  z-index: 2;\n  order: ", ";\n  -webkit-tap-highlight-color: transparent;\n\n  > svg {\n    ", ";\n    width: 24px;\n    height: 24px;\n  }\n\n  &:hover > svg {\n    color: ", ";\n  }\n"])), function (props) {
  return props.height ? props.height + "px" : '36px';
}, function (props) {
  return props.order === 0 || props.order ? props.order : 2;
}, function (props) {
  return props.isEmojisOpened ? "color: " + (props.hoverColor || colors.primary) + ";" : 'color: #898B99;';
}, function (props) {
  return props.hoverColor || colors.primary;
});
var MentionsContainer$1 = styled__default.div(_templateObject14$4 || (_templateObject14$4 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  left: 0;\n  bottom: 100%;\n  z-index: 9998;\n  animation: fadeIn 0.2s ease-in-out;\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n"])));
var SendMessageIcon = styled__default.span(_templateObject15$4 || (_templateObject15$4 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  height: ", ";\n  align-items: center;\n  margin: 0 8px;\n  cursor: pointer;\n  line-height: 13px;\n  order: ", ";\n  -webkit-tap-highlight-color: transparent;\n\n  color: ", ";\n"])), function (props) {
  return props.height ? props.height + "px" : '36px';
}, function (props) {
  return props.order === 0 || props.order ? props.order : 4;
}, function (props) {
  return props.isActive ? colors.primary : props.color;
});
var ChosenAttachments = styled__default.div(_templateObject16$3 || (_templateObject16$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  padding: 16px 16px 14px;\n  overflow-x: auto;\n\n  & ", " {\n    width: 100%;\n    height: 100%;\n    border-radius: 4px;\n    object-fit: cover;\n  }\n\n  & ", " {\n    width: 240px;\n    padding: 5px 12px;\n    border-radius: 8px;\n    height: 50px;\n  }\n"])), AttachmentImg$1, AttachmentFile$1);
var TypingIndicator$1 = styled__default.div(_templateObject17$3 || (_templateObject17$3 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: 100%;\n  left: 16px;\n"])));
var TypingIndicatorCont = styled__default.div(_templateObject18$3 || (_templateObject18$3 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  margin-bottom: 12px;\n"])));
var TypingFrom = styled__default.h5(_templateObject19$3 || (_templateObject19$3 = _taggedTemplateLiteralLoose(["\n  margin: 0 4px 0 0;\n  font-weight: 400;\n  font-size: 13px;\n  line-height: 16px;\n  letter-spacing: -0.2px;\n  color: ", ";\n"])), colors.textColor2);
var sizeAnimation = styled.keyframes(_templateObject20$2 || (_templateObject20$2 = _taggedTemplateLiteralLoose(["\n  0% {\n    width: 2px;\n    height: 2px;\n    opacity: 0.4;\n  }\n  50% {\n    width: 2px;\n    height: 2px;\n    opacity: 0.4;\n  }\n  100% {\n    width: 6px;\n    height: 6px;\n    opacity: 1;\n  }\n"])));
var DotOne = styled__default.span(_templateObject21$2 || (_templateObject21$2 = _taggedTemplateLiteralLoose([""])));
var DotTwo = styled__default.span(_templateObject22$2 || (_templateObject22$2 = _taggedTemplateLiteralLoose([""])));
var DotThree = styled__default.span(_templateObject23$2 || (_templateObject23$2 = _taggedTemplateLiteralLoose([""])));
var TypingAnimation = styled__default.div(_templateObject24$2 || (_templateObject24$2 = _taggedTemplateLiteralLoose(["\n  display: flex;\n\n  & > span {\n    position: relative;\n    width: 6px;\n    height: 6px;\n    margin-right: 3px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation-timing-function: linear;\n\n    &:after {\n      content: '';\n      position: absolute;\n\n      width: 3.5px;\n      height: 3.5px;\n      border-radius: 50%;\n      background-color: ", "\n      animation-name: ", ";\n      animation-duration: 0.6s;\n      animation-iteration-count: infinite;\n    }\n  }\n\n  & ", " {\n    &:after {\n      animation-delay: 0s;\n    }\n  }\n\n  & ", " {\n    &:after {\n      animation-delay: 0.2s;\n    }\n  }\n\n  & ", " {\n    &:after {\n      animation-delay: 0.3s;\n    }\n  }\n"])), colors.borderColor2, sizeAnimation, DotOne, DotTwo, DotThree);
var Loading = styled__default.div(_templateObject25$2 || (_templateObject25$2 = _taggedTemplateLiteralLoose(["\n  height: 36px;\n"])));
var BlockedUserInfo = styled__default.div(_templateObject26$1 || (_templateObject26$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 12px;\n  font-weight: 400;\n  font-size: 15px;\n  line-height: 20px;\n  color: ", ";\n\n  & > svg {\n    margin-right: 12px;\n  }\n"])), colors.textColor1);
var JoinChannelCont = styled__default.div(_templateObject27$1 || (_templateObject27$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 -12px;\n  padding: 14px;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 20px;\n  letter-spacing: -0.2px;\n  color: ", ";\n  background-color: ", ";\n  cursor: pointer;\n"])), function (props) {
  return props.color || colors.primary;
}, colors.backgroundColor);
var ReadOnlyCont = styled__default.div(_templateObject28$1 || (_templateObject28$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 12px;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 20px;\n  letter-spacing: -0.2px;\n  color: ", ";\n\n  & > svg {\n    margin-right: 12px;\n    color: ", ";\n  }\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.iconColor || colors.primary;
});
var ReplyMessageCont = styled__default.div(_templateObject29$1 || (_templateObject29$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n"])));
var ReplyIconWrapper = styled__default.span(_templateObject30$1 || (_templateObject30$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n  width: 40px;\n  height: 40px;\n  background-color: ", ";\n  border-radius: 50%;\n\n  & > svg {\n    width: 20px;\n    height: 20px;\n    color: ", ";\n  }\n"])), function (props) {
  return props.backgroundColor || colors.primary;
}, colors.white);
var SelectedMessagesWrapper = styled__default.div(_templateObject31$1 || (_templateObject31$1 = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  padding: 12px 16px;\n"])));
var CustomButton = styled__default.span(_templateObject32$1 || (_templateObject32$1 = _taggedTemplateLiteralLoose(["\n  color: ", ";\n  padding: 8px 16px;\n  background-color: ", ";\n  margin-left: ", ";\n  border-radius: 8px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-family: Inter, sans-serif;\n  font-size: 15px;\n  font-weight: 500;\n  cursor: pointer;\n\n  > svg {\n    width: 20px;\n    height: 20px;\n    margin-right: 8px;\n  }\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.backgroundColor || colors.primaryLight;
}, function (props) {
  return props.marginLeft || '8px';
});
var CloseIconWrapper = styled__default.span(_templateObject33$1 || (_templateObject33$1 = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  cursor: pointer;\n  margin-left: auto;\n  padding: 10px;\n"])));

var _path$16;

function _extends$1a() {
  _extends$1a = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1a.apply(this, arguments);
}

function SvgBottom(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1a({
    width: 12,
    height: 7,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$16 || (_path$16 = /*#__PURE__*/React.createElement("path", {
    d: "M1.5 1.5l4.5 4 4.5-4",
    stroke: "#676A7C",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })));
}

var _path$17, _path2$6;

function _extends$1b() {
  _extends$1b = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1b.apply(this, arguments);
}

function SvgMarkAsUnRead(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1b({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$17 || (_path$17 = /*#__PURE__*/React.createElement("path", {
    d: "M18.25 7.189v3.843c0 .673 0 1.224-.037 1.671-.037.464-.118.882-.317 1.273a3.25 3.25 0 01-1.42 1.42c-.391.2-.81.28-1.273.318-.447.036-.998.036-1.671.036h-2.129c-.55 0-.72.004-.878.036a1.752 1.752 0 00-.444.156c-.143.073-.279.177-.708.52l-2.01 1.608c-.154.124-.307.246-.441.335-.129.085-.366.228-.67.228-.356 0-.692-.16-.914-.438-.19-.239-.226-.513-.24-.667-.015-.16-.015-.356-.015-.554v-1.228c-.358-.01-.655-.034-.924-.107a3.25 3.25 0 01-2.298-2.298c-.111-.415-.111-.896-.111-1.566V6.469c0-.674 0-1.224.037-1.672.037-.463.118-.881.317-1.272a3.25 3.25 0 011.42-1.42c.391-.2.81-.28 1.273-.318.448-.037.998-.037 1.672-.037h6.342c-.19.464-.3.97-.31 1.5h-6c-.713 0-1.203 0-1.582.032-.37.03-.57.086-.713.159a1.75 1.75 0 00-.765.765c-.074.144-.13.343-.16.713-.03.38-.03.869-.03 1.581v5.167c0 .823.006 1.088.059 1.286a1.75 1.75 0 001.237 1.238c.199.053.463.06 1.286.06a.75.75 0 01.75.75v1.772L8.49 15.25c.355-.284.614-.492.91-.643.26-.133.538-.23.825-.29.324-.066.657-.066 1.112-.066H13.5c.713 0 1.202 0 1.581-.031.37-.03.57-.086.713-.16a1.75 1.75 0 00.765-.764c.074-.144.13-.343.16-.714.03-.38.031-.868.031-1.58V7.498c.53-.01 1.036-.12 1.5-.31z",
    fill: "currentColor"
  })), _path2$6 || (_path2$6 = /*#__PURE__*/React.createElement("path", {
    d: "M5.833 6.334a.75.75 0 100 1.5H10a.75.75 0 000-1.5H5.833zM5.833 9.25a.75.75 0 100 1.5H12.5a.75.75 0 100-1.5H5.833zM19.167 3.333a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",
    fill: "currentColor"
  })));
}

var _path$18;

function _extends$1c() {
  _extends$1c = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1c.apply(this, arguments);
}

function SvgMarkAsRead(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1c({
    width: 20,
    height: 20,
    viewBox: "0 0 20.01 20.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$18 || (_path$18 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.469 1.75h7.062c.674 0 1.225 0 1.672.037.463.037.882.118 1.273.317a3.25 3.25 0 011.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672v4.562c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.273a3.25 3.25 0 01-1.42 1.42c-.391.199-.81.28-1.273.317-.447.037-.998.037-1.671.037h-2.129c-.55 0-.72.004-.878.036a1.752 1.752 0 00-.444.156c-.143.073-.279.177-.708.52l-2.01 1.608a6.553 6.553 0 01-.441.334c-.129.085-.366.229-.67.23-.356 0-.692-.162-.914-.44-.19-.238-.226-.513-.24-.666-.015-.16-.015-.356-.015-.554v-1.229c-.358-.008-.655-.034-.924-.106a3.25 3.25 0 01-2.298-2.298c-.111-.415-.111-.896-.111-1.566V6.469c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 011.42-1.42c.391-.2.81-.28 1.273-.318.448-.037.998-.037 1.672-.037zm-1.55 1.532c-.37.03-.57.085-.713.159a1.75 1.75 0 00-.765.765c-.074.144-.13.343-.16.713-.03.38-.03.869-.03 1.581v5.167c0 .823.006 1.087.059 1.286a1.75 1.75 0 001.237 1.237c.199.054.463.06 1.286.06a.75.75 0 01.75.75v1.773l1.853-1.482.053-.042c.355-.285.614-.492.91-.643.26-.133.538-.23.825-.29.324-.066.657-.066 1.112-.066H13.5c.713 0 1.202 0 1.581-.032.37-.03.57-.085.713-.159a1.75 1.75 0 00.765-.764c.074-.145.13-.344.16-.714.03-.38.031-.869.031-1.581V6.5c0-.712 0-1.202-.032-1.58-.03-.371-.085-.57-.159-.714a1.75 1.75 0 00-.765-.765c-.144-.074-.343-.13-.713-.16-.38-.03-.868-.031-1.58-.031h-7c-.713 0-1.203 0-1.582.032zm.164 3.801a.75.75 0 01.75-.75H10a.75.75 0 010 1.5H5.833a.75.75 0 01-.75-.75zm0 2.917a.75.75 0 01.75-.75H12.5a.75.75 0 010 1.5H5.833a.75.75 0 01-.75-.75z",
    fill: "currentColor"
  })));
}

var _path$19;

function _extends$1d() {
  _extends$1d = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1d.apply(this, arguments);
}

function SvgDeleteChannel(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1d({
    width: 20,
    height: 21,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$19 || (_path$19 = /*#__PURE__*/React.createElement("path", {
    d: "M5 16.333C5 17.25 5.75 18 6.667 18h6.666C14.25 18 15 17.25 15 16.333V8c0-.917-.75-1.667-1.667-1.667H6.667C5.75 6.333 5 7.083 5 8v8.333zm10-12.5h-2.083l-.592-.591A.84.84 0 0011.742 3H8.258a.84.84 0 00-.583.242l-.592.591H5a.836.836 0 00-.833.834c0 .458.375.833.833.833h10a.836.836 0 00.833-.833.836.836 0 00-.833-.834z",
    fill: "CurrentColor"
  })));
}

var _path$1a;

function _extends$1e() {
  _extends$1e = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1e.apply(this, arguments);
}

function SvgClear(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1e({
    width: 20,
    height: 21,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1a || (_path$1a = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 3.833a6.667 6.667 0 100 13.333 6.667 6.667 0 000-13.333zm-8.333 6.666a8.333 8.333 0 1116.667 0 8.333 8.333 0 01-16.667 0zM6.911 7.41a.833.833 0 011.179 0L10 9.32l1.911-1.91A.833.833 0 0113.09 8.59l-1.911 1.91 1.91 1.911a.833.833 0 01-1.178 1.179l-1.91-1.911-1.911 1.91A.833.833 0 016.91 12.41l1.91-1.91-1.91-1.911a.833.833 0 010-1.179z",
    fill: "#FA4C56"
  })));
}

var _path$1b;

function _extends$1f() {
  _extends$1f = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1f.apply(this, arguments);
}

function SvgBlockChannel(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1f({
    width: 20,
    height: 21,
    viewBox: "0 0 20.01 21.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1b || (_path$1b = /*#__PURE__*/React.createElement("path", {
    d: "M10 2.167A8.336 8.336 0 001.667 10.5c0 4.6 3.733 8.334 8.333 8.334s8.333-3.734 8.333-8.334S14.6 2.167 10 2.167zm0 15A6.665 6.665 0 013.333 10.5c0-1.541.525-2.958 1.409-4.083l9.341 9.342A6.586 6.586 0 0110 17.167zm5.258-2.583L5.917 5.242A6.585 6.585 0 0110 3.834a6.665 6.665 0 016.667 6.666 6.586 6.586 0 01-1.409 4.084z",
    fill: "CurrentColor"
  })));
}

var _path$1c, _path2$7;

function _extends$1g() {
  _extends$1g = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1g.apply(this, arguments);
}

function SvgReport(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1g({
    width: 20,
    height: 21,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1c || (_path$1c = /*#__PURE__*/React.createElement("path", {
    d: "M9.096 10.402a.882.882 0 011.765 0v3.627a.882.882 0 11-1.765 0v-3.627zM9.979 6.088a.98.98 0 100 1.96.98.98 0 000-1.96z",
    fill: "CurrentColor"
  })), _path2$7 || (_path2$7 = /*#__PURE__*/React.createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 17.27A6.77 6.77 0 1010 3.73a6.77 6.77 0 000 13.542zm0 1.563a8.333 8.333 0 100-16.667 8.333 8.333 0 000 16.667z",
    fill: "CurrentColor"
  })));
}

var _path$1d;

function _extends$1h() {
  _extends$1h = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1h.apply(this, arguments);
}

function SvgStar(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1h({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1d || (_path$1d = /*#__PURE__*/React.createElement("path", {
    d: "M12.888 7.002l3.823.367c1.33.128 1.739 1.43.711 2.285l-2.993 2.49 1.111 4.06c.365 1.332-.767 2.14-1.901 1.337l-3.637-2.573-3.637 2.573c-1.13.799-2.267-.005-1.902-1.338l1.111-4.058-2.993-2.491c-1.032-.86-.625-2.156.711-2.285l3.823-.367 1.684-3.889c.528-1.217 1.878-1.217 2.405 0l1.684 3.889z",
    fill: "#B2B6BE"
  })));
}

var _path$1e;

function _extends$1i() {
  _extends$1i = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1i.apply(this, arguments);
}

function SvgPin(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1i({
    width: 20,
    height: 20,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1e || (_path$1e = /*#__PURE__*/React.createElement("path", {
    d: "M12.253 2.663a.583.583 0 01.825 0l4.258 4.258a.583.583 0 01-.412.996h-1.509l-2.5 2.5v5.218a.6.6 0 01-1.024.424l-3.24-3.24-3.956 3.958a1.042 1.042 0 11-1.473-1.473l3.956-3.958L3.94 8.108a.6.6 0 01-.168-.33l-.007-.095a.6.6 0 01.6-.6h5.218l2.5-2.5V3.075c0-.155.061-.303.17-.412z",
    fill: "#B2B6BE"
  })));
}

var _templateObject$C, _templateObject2$y, _templateObject3$r, _templateObject4$n, _templateObject5$l, _templateObject6$i;

var Actions$1 = function Actions(_ref) {
  var channel = _ref.channel,
      actionMenuOpen = _ref.actionMenuOpen,
      theme = _ref.theme,
      menuIsOpen = _ref.menuIsOpen,
      toggleable = _ref.toggleable,
      _ref$showMuteUnmuteNo = _ref.showMuteUnmuteNotifications,
      showMuteUnmuteNotifications = _ref$showMuteUnmuteNo === void 0 ? true : _ref$showMuteUnmuteNo,
      muteUnmuteNotificationsOrder = _ref.muteUnmuteNotificationsOrder,
      muteNotificationIcon = _ref.muteNotificationIcon,
      unmuteNotificationIcon = _ref.unmuteNotificationIcon,
      muteNotificationIconColor = _ref.muteNotificationIconColor,
      unmuteNotificationIconColor = _ref.unmuteNotificationIconColor,
      muteUnmuteNotificationTextColor = _ref.muteUnmuteNotificationTextColor,
      timeOptionsToMuteNotifications = _ref.timeOptionsToMuteNotifications,
      _ref$showStarredMessa = _ref.showStarredMessages,
      showStarredMessages = _ref$showStarredMessa === void 0 ? false : _ref$showStarredMessa,
      starredMessagesOrder = _ref.starredMessagesOrder,
      staredMessagesIcon = _ref.staredMessagesIcon,
      staredMessagesIconColor = _ref.staredMessagesIconColor,
      staredMessagesTextColor = _ref.staredMessagesTextColor,
      _ref$showPinChannel = _ref.showPinChannel,
      showPinChannel = _ref$showPinChannel === void 0 ? false : _ref$showPinChannel,
      pinChannelOrder = _ref.pinChannelOrder,
      pinChannelIcon = _ref.pinChannelIcon,
      pinChannelIconColor = _ref.pinChannelIconColor,
      pinChannelTextColor = _ref.pinChannelTextColor,
      _ref$showMarkAsReadUn = _ref.showMarkAsReadUnread,
      showMarkAsReadUnread = _ref$showMarkAsReadUn === void 0 ? true : _ref$showMarkAsReadUn,
      markAsReadUnreadOrder = _ref.markAsReadUnreadOrder,
      markAsReadIcon = _ref.markAsReadIcon,
      markAsUnreadIcon = _ref.markAsUnreadIcon,
      markAsReadIconColor = _ref.markAsReadIconColor,
      markAsUnreadIconColor = _ref.markAsUnreadIconColor,
      markAsReadUnreadTextColor = _ref.markAsReadUnreadTextColor,
      _ref$showLeaveChannel = _ref.showLeaveChannel,
      showLeaveChannel = _ref$showLeaveChannel === void 0 ? true : _ref$showLeaveChannel,
      leaveChannelOrder = _ref.leaveChannelOrder,
      leaveChannelIcon = _ref.leaveChannelIcon,
      leaveChannelIconColor = _ref.leaveChannelIconColor,
      leaveChannelTextColor = _ref.leaveChannelTextColor,
      _ref$showReportChanne = _ref.showReportChannel,
      showReportChannel = _ref$showReportChanne === void 0 ? false : _ref$showReportChanne,
      reportChannelIcon = _ref.reportChannelIcon,
      reportChannelOrder = _ref.reportChannelOrder,
      reportChannelIconColor = _ref.reportChannelIconColor,
      reportChannelTextColor = _ref.reportChannelTextColor,
      showDeleteChannel = _ref.showDeleteChannel,
      deleteChannelIcon = _ref.deleteChannelIcon,
      deleteChannelIconColor = _ref.deleteChannelIconColor,
      deleteChannelTextColor = _ref.deleteChannelTextColor,
      deleteChannelOrder = _ref.deleteChannelOrder,
      _ref$showBlockAndLeav = _ref.showBlockAndLeaveChannel,
      showBlockAndLeaveChannel = _ref$showBlockAndLeav === void 0 ? true : _ref$showBlockAndLeav,
      _ref$showBlockUser = _ref.showBlockUser,
      showBlockUser = _ref$showBlockUser === void 0 ? true : _ref$showBlockUser,
      blockAndLeaveChannelIcon = _ref.blockAndLeaveChannelIcon,
      unblockUserIcon = _ref.unblockUserIcon,
      blockAndLeaveChannelIconColor = _ref.blockAndLeaveChannelIconColor,
      blockAndLeaveChannelTextColor = _ref.blockAndLeaveChannelTextColor,
      unblockUserTextColor = _ref.unblockUserTextColor,
      showClearHistory = _ref.showClearHistory,
      clearHistoryOrder = _ref.clearHistoryOrder,
      clearHistoryIcon = _ref.clearHistoryIcon,
      clearHistoryTextColor = _ref.clearHistoryTextColor,
      deleteAllMessagesOrder = _ref.deleteAllMessagesOrder,
      deleteAllMessagesIcon = _ref.deleteAllMessagesIcon,
      deleteAllMessagesTextColor = _ref.deleteAllMessagesTextColor;
  var ChatClient = getClient();
  var user = ChatClient.user;

  var _useState = React.useState(false),
      clearHistoryPopupOpen = _useState[0],
      setClearHistoryPopupOpen = _useState[1];

  var _useState2 = React.useState(false),
      deleteAllMessagesPopupOpen = _useState2[0],
      setDeleteAllMessagesPopupOpenPopupOpen = _useState2[1];

  var _useState3 = React.useState(false),
      leaveChannelPopupOpen = _useState3[0],
      setLeaveChannelPopupOpen = _useState3[1];

  var _useState4 = React.useState(false),
      deleteChannelPopupOpen = _useState4[0],
      setDeleteChannelPopupOpen = _useState4[1];

  var _useState5 = React.useState(false),
      blockChannelPopupOpen = _useState5[0],
      setBlockChannelPopupOpen = _useState5[1];

  var _useState6 = React.useState(false),
      blockUserPopupOpen = _useState6[0],
      setBlockUserPopupOpen = _useState6[1];

  var _useState7 = React.useState(false),
      unblockUserPopupOpen = _useState7[0],
      setUnblockUserPopupOpen = _useState7[1];

  var _useState8 = React.useState(false),
      reportUserPopupOpen = _useState8[0],
      setReportUserPopupOpen = _useState8[1];

  var _usePermissions = usePermissions(channel.userRole),
      checkActionPermission = _usePermissions[0];

  var _useState9 = React.useState(''),
      popupButtonText = _useState9[0],
      setPopupButtonText = _useState9[1];

  var _useState10 = React.useState(''),
      popupTitle = _useState10[0],
      setPopupTitle = _useState10[1];

  var dispatch = reactRedux.useDispatch();
  var oneHour = 60 * 60 * 1000;
  var twoHours = oneHour * 2;
  var oneDay = oneHour * 24;
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });
  var disableAction = directChannelUser && hideUserPresence && hideUserPresence(directChannelUser);
  var otherMembers = isDirectChannel && channel.members.filter(function (member) {
    return member.id && member.id !== user.id;
  }) || [];

  var handleToggleClearHistoryPopup = function handleToggleClearHistoryPopup() {
    setClearHistoryPopupOpen(!clearHistoryPopupOpen);
  };

  var handleToggleDeleteAllMessagesPopup = function handleToggleDeleteAllMessagesPopup() {
    setDeleteAllMessagesPopupOpenPopupOpen(!deleteAllMessagesPopupOpen);
  };

  var handleToggleLeaveChannelPopupOpen = function handleToggleLeaveChannelPopupOpen() {
    setLeaveChannelPopupOpen(!leaveChannelPopupOpen);
  };

  var handleToggleDeleteChannelPopupOpen = function handleToggleDeleteChannelPopupOpen() {
    setDeleteChannelPopupOpen(!deleteChannelPopupOpen);
  };

  var handleToggleBlockChannelPopupOpen = function handleToggleBlockChannelPopupOpen() {
    setBlockChannelPopupOpen(!blockChannelPopupOpen);
  };

  var handleToggleBlockUserPopupOpen = function handleToggleBlockUserPopupOpen() {
    setBlockUserPopupOpen(!blockUserPopupOpen);
  };

  var handleToggleUnblockUserPopupOpen = function handleToggleUnblockUserPopupOpen() {
    setUnblockUserPopupOpen(!unblockUserPopupOpen);
  };

  var toggleReportUserPopup = function toggleReportUserPopup() {
    setReportUserPopupOpen(!reportUserPopupOpen);
  };

  var handleActionsOpen = function handleActionsOpen() {
    if (toggleable && actionMenuOpen) {
      actionMenuOpen();
    }
  };

  var handleLeaveChannel = function handleLeaveChannel() {
    dispatch(leaveChannelAC(channel.id));
  };

  var handleDeleteChannel = function handleDeleteChannel() {
    dispatch(deleteChannelAC(channel.id));
  };

  var handleBlockChannel = function handleBlockChannel() {
    dispatch(blockChannelAC(channel.id));
  };

  var handleBlockUser = function handleBlockUser() {
    if (otherMembers.length === 1) {
      dispatch(blockUserAC([otherMembers[0].id]));
    }
  };

  var handleUnblockUser = function handleUnblockUser() {
    if (otherMembers.length === 1) {
      dispatch(unblockUserAC([otherMembers[0].id]));
    }
  };

  var handleClearHistory = function handleClearHistory() {
    dispatch(clearHistoryAC(channel.id));
  };

  var handleDeleteAllMessagesHistory = function handleDeleteAllMessagesHistory() {
    dispatch(deleteAllMessagesAC(channel.id));
  };

  var handleNotificationOnOff = function handleNotificationOnOff(expTime) {
    console.log('exp time ... ', expTime);

    if (channel.muted) {
      dispatch(turnOnNotificationsAC());
    } else {
      dispatch(turnOffNotificationsAC(expTime));
    }
  };

  var handleToggleChannelMarkAs = function handleToggleChannelMarkAs() {
    console.log('handle action mark read ', channel.unread);

    if (channel.unread) {
      dispatch(markChannelAsReadAC(channel.id));
    } else {
      dispatch(markChannelAsUnReadAC(channel.id));
    }
  };

  return /*#__PURE__*/React__default.createElement(Container$j, {
    isDirect: isDirectChannel,
    theme: theme,
    borderColor: colors.backgroundColor
  }, toggleable && /*#__PURE__*/React__default.createElement(ActionHeader, {
    onClick: handleActionsOpen
  }, /*#__PURE__*/React__default.createElement(SectionHeader, null, "ACTIONS"), /*#__PURE__*/React__default.createElement(MenuTriggerIcon, {
    isOpen: menuIsOpen
  }, /*#__PURE__*/React__default.createElement(SvgBottom, null))), /*#__PURE__*/React__default.createElement(ActionsMenu, {
    isOpen: menuIsOpen
  }, showMuteUnmuteNotifications && !channel.isMockChannel && (isDirectChannel && directChannelUser ? directChannelUser.state !== USER_STATE.DELETED : true) && (channel.muted ? /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 0,
    order: muteUnmuteNotificationsOrder,
    onClick: function onClick() {
      return handleNotificationOnOff();
    },
    iconColor: muteNotificationIconColor || colors.textColor2,
    color: muteUnmuteNotificationTextColor || colors.textColor1,
    hoverColor: muteUnmuteNotificationTextColor || colors.textColor1
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, muteNotificationIcon || /*#__PURE__*/React__default.createElement(DefaultMutedIcon, null), " Unmute notifications")) : /*#__PURE__*/React__default.createElement(DropDown, {
    isSelect: true,
    theme: theme,
    height: 'auto',
    position: 'left',
    order: muteUnmuteNotificationsOrder,
    trigger: /*#__PURE__*/React__default.createElement(ActionItem$1, {
      key: 0,
      disableEvent: true,
      iconColor: unmuteNotificationIconColor || colors.textColor2,
      color: muteUnmuteNotificationTextColor || colors.textColor1,
      hoverColor: muteUnmuteNotificationTextColor || colors.textColor1
    }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, unmuteNotificationIcon || /*#__PURE__*/React__default.createElement(SvgNotifications, null), " Mute notifications"))
  }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, timeOptionsToMuteNotifications && timeOptionsToMuteNotifications.length ? timeOptionsToMuteNotifications.map(function (value, index) {
    return /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      key: value + index,
      hoverBackground: colors.primaryLight,
      onClick: function onClick() {
        return handleNotificationOnOff(value * oneHour);
      }
    }, "Mute for ", value < 24 ? value + " " + (value > 1 ? 'hours' : 'hour') + " " : '1 day');
  }) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 1,
    hoverBackground: colors.primaryLight,
    onClick: function onClick() {
      return handleNotificationOnOff(oneHour);
    }
  }, "Mute for 1 hour"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 2,
    hoverBackground: colors.primaryLight,
    onClick: function onClick() {
      return handleNotificationOnOff(twoHours);
    }
  }, "Mute for 2 hours"), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 3,
    hoverBackground: colors.primaryLight,
    onClick: function onClick() {
      return handleNotificationOnOff(oneDay);
    }
  }, "Mute for 1 day")), /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 4,
    hoverBackground: colors.primaryLight,
    onClick: function onClick() {
      return handleNotificationOnOff();
    }
  }, "Mute forever")))), showStarredMessages && !channel.isMockChannel && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 1,
    onClick: function onClick() {
      return console.log('stared messages');
    },
    order: starredMessagesOrder,
    iconColor: staredMessagesIconColor || colors.textColor2,
    color: staredMessagesTextColor || colors.textColor1,
    hoverColor: staredMessagesTextColor || colors.textColor1
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, staredMessagesIcon || /*#__PURE__*/React__default.createElement(SvgStar, null), " Starred messages ")), showPinChannel && !channel.isMockChannel && (isDirectChannel && directChannelUser ? directChannelUser.state !== USER_STATE.DELETED : true) && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 2,
    onClick: function onClick() {
      return console.log('pin channel');
    },
    order: pinChannelOrder,
    iconColor: pinChannelIconColor || colors.textColor2,
    color: pinChannelTextColor || colors.textColor1,
    hoverColor: pinChannelTextColor || colors.textColor1
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, pinChannelIcon || /*#__PURE__*/React__default.createElement(SvgPin, null), " Pin")), showMarkAsReadUnread && !channel.isMockChannel && (isDirectChannel && directChannelUser ? directChannelUser.state !== USER_STATE.DELETED : true) && (channel.unread ? /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 3,
    onClick: handleToggleChannelMarkAs,
    order: markAsReadUnreadOrder,
    iconColor: markAsReadIconColor || colors.textColor2,
    color: markAsReadUnreadTextColor || colors.textColor1,
    hoverColor: markAsReadUnreadTextColor || colors.textColor1
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, markAsReadIcon || /*#__PURE__*/React__default.createElement(SvgMarkAsRead, null), " Mark as read")) : /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 3,
    order: markAsReadUnreadOrder,
    onClick: handleToggleChannelMarkAs,
    iconColor: markAsUnreadIconColor || colors.textColor2,
    color: markAsReadUnreadTextColor || colors.textColor1,
    hoverColor: markAsReadUnreadTextColor || colors.textColor1
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, markAsUnreadIcon || /*#__PURE__*/React__default.createElement(SvgMarkAsUnRead, null), " Mark as unread"))), !isDirectChannel && showLeaveChannel && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 4,
    order: leaveChannelOrder,
    color: leaveChannelTextColor || colors.red1,
    iconColor: leaveChannelIconColor || colors.red1,
    hoverColor: leaveChannelTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Leave');
      setPopupTitle("Leave " + (channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type));
      handleToggleLeaveChannelPopupOpen();
    }
  }, leaveChannelIcon || /*#__PURE__*/React__default.createElement(SvgLeave, null), " Leave " + (channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type)), isDirectChannel && otherMembers.length === 1 ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, showBlockUser && !disableAction && (isDirectChannel && directChannelUser ? directChannelUser.state !== USER_STATE.DELETED : true) && (directChannelUser && directChannelUser.blocked ? /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 5,
    color: unblockUserTextColor || colors.textColor1,
    hoverColor: unblockUserTextColor || colors.textColor1,
    onClick: function onClick() {
      handleUnblockUser();
    }
  }, unblockUserIcon || /*#__PURE__*/React__default.createElement(SvgBlockChannel, null), " Unblock user") : /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 6,
    color: deleteChannelTextColor || colors.red1,
    iconColor: deleteChannelIconColor || colors.red1,
    hoverColor: deleteChannelTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Block');
      setPopupTitle('Block user');
      handleToggleBlockUserPopupOpen();
    }
  }, blockAndLeaveChannelIcon || /*#__PURE__*/React__default.createElement(SvgBlockChannel, null), " Block user")), showReportChannel && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    color: deleteChannelTextColor || colors.red1,
    iconColor: deleteChannelIconColor || colors.red1,
    hoverColor: deleteChannelTextColor || colors.red1,
    key: 7,
    onClick: function onClick() {
      return toggleReportUserPopup();
    }
  }, /*#__PURE__*/React__default.createElement(SvgReport, null), "Report user")) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, showBlockAndLeaveChannel && !channel.isMockChannel && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 8,
    color: blockAndLeaveChannelTextColor || colors.red1,
    iconColor: blockAndLeaveChannelIconColor || colors.red1,
    hoverColor: blockAndLeaveChannelTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Block');
      setPopupTitle("Block and Leave " + (channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type === CHANNEL_TYPE.DIRECT ? 'chat' : channel.type));
      handleToggleBlockChannelPopupOpen();
    }
  }, blockAndLeaveChannelIcon || /*#__PURE__*/React__default.createElement(SvgBlockChannel, null), "Block and Leave " + (channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type === 'direct' ? 'chat' : channel.type) + "\n                "), showReportChannel && !channel.isMockChannel && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 9,
    order: reportChannelOrder,
    color: reportChannelTextColor || colors.red1,
    iconColor: reportChannelIconColor || colors.red1,
    hoverColor: reportChannelTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Report');
      setPopupTitle('Report channel');
      console.log('Report channel');
    }
  }, reportChannelIcon || /*#__PURE__*/React__default.createElement(SvgReport, null), " Report", ' ', channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'group' : 'chat')), showClearHistory && !channel.isMockChannel && (channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE || channel.type === CHANNEL_TYPE.DIRECT) && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 10,
    color: clearHistoryTextColor || colors.red1,
    iconColor: clearHistoryTextColor || colors.red1,
    order: clearHistoryOrder,
    hoverColor: clearHistoryTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Clear');
      setPopupTitle('Clear history');
      handleToggleClearHistoryPopup();
    }
  }, clearHistoryIcon || /*#__PURE__*/React__default.createElement(SvgClear, null), " Clear history"), showClearHistory && !channel.isMockChannel && (channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC) && checkActionPermission('clearAllMessages') && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 11,
    color: deleteAllMessagesTextColor || colors.red1,
    iconColor: deleteAllMessagesTextColor || colors.red1,
    order: deleteAllMessagesOrder,
    hoverColor: deleteAllMessagesTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Clear');
      setPopupTitle("Clear history");
      handleToggleDeleteAllMessagesPopup();
    }
  }, deleteAllMessagesIcon || /*#__PURE__*/React__default.createElement(SvgClear, null), " Clear history"), showDeleteChannel && !channel.isMockChannel && checkActionPermission('deleteChannel') && /*#__PURE__*/React__default.createElement(ActionItem$1, {
    key: 12,
    order: deleteChannelOrder,
    color: deleteChannelTextColor || colors.red1,
    iconColor: deleteChannelIconColor || colors.red1,
    hoverColor: deleteChannelTextColor || colors.red1,
    onClick: function onClick() {
      setPopupButtonText('Delete');
      setPopupTitle("Delete   " + (channel.type === CHANNEL_TYPE.PRIVATE || channel.type === CHANNEL_TYPE.GROUP ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type === CHANNEL_TYPE.DIRECT ? 'chat' : channel.type));
      handleToggleDeleteChannelPopupOpen();
    }
  }, deleteChannelIcon || /*#__PURE__*/React__default.createElement(SvgDeleteChannel, null), " Delete " + (channel.type === CHANNEL_TYPE.PRIVATE || channel.type === CHANNEL_TYPE.GROUP ? 'group' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : channel.type === CHANNEL_TYPE.DIRECT ? 'chat' : channel.type))), leaveChannelPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleLeaveChannel,
    togglePopup: handleToggleLeaveChannelPopupOpen,
    buttonText: popupButtonText,
    description: channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'Once you leave this group it will be removed for you along with its entire history.' : 'Once you leave this channel it will be removed for you along with its entire history.',
    title: popupTitle
  }), deleteChannelPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleDeleteChannel,
    togglePopup: handleToggleDeleteChannelPopupOpen,
    buttonText: popupButtonText,
    description: channel.type === CHANNEL_TYPE.DIRECT ? 'Once you delete this chat it will be removed from the chat list with its message history.' : channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'Once you delete this group it will be permanently removed along with its entire history for all the group members.' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'Once you delete this channel it will be permanently removed along with its entire history for all the channel subscribers.' : 'Once you delete this channel it will be permanently removed along with its entire history for all the channel members.',
    title: popupTitle
  }), blockChannelPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleBlockChannel,
    togglePopup: handleToggleBlockChannelPopupOpen,
    buttonText: popupButtonText,
    description: "Are you sure you want to block the " + (channel.subject || (channel.type === CHANNEL_TYPE.DIRECT ? channel.members && (channel.members[0].firstName || channel.members[0].id) : 'channel')),
    title: popupTitle
  }), blockUserPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleBlockUser,
    togglePopup: handleToggleBlockUserPopupOpen,
    buttonText: popupButtonText,
    description: 'Blocking a user will prevent them from sending you messages, calls, adding you to groups and channels.',
    title: popupTitle
  }), unblockUserPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleUnblockUser,
    togglePopup: handleToggleUnblockUserPopupOpen,
    buttonText: popupButtonText,
    description: 'Are you sure you want to unblock?',
    title: popupTitle
  }), clearHistoryPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleClearHistory,
    togglePopup: handleToggleClearHistoryPopup,
    buttonText: popupButtonText,
    description: channel.type === CHANNEL_TYPE.DIRECT ? 'Once you clear the history, the messages in this chat will be permanently removed for you.' : channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'Once you clear the history it will be permanently removed for you.' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'Once you clear the history, the messages in this channel will be permanently removed for all the subscribers.' : 'Are you sure you want to clear history? This action cannot be undone.',
    title: popupTitle
  }), deleteAllMessagesPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleDeleteAllMessagesHistory,
    togglePopup: handleToggleDeleteAllMessagesPopup,
    buttonText: popupButtonText,
    description: channel.type === CHANNEL_TYPE.DIRECT ? 'Once you clear the history, the messages in this chat will be permanently removed for you.' : channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'Once you clear the history it will be permanently removed for you.' : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'Once you clear the history, the messages in this channel will be permanently removed for all the subscribers.' : 'Are you sure you want to delete all messages? This action cannot be undone.',
    title: popupTitle
  }));
};
var Container$j = styled__default.div(_templateObject$C || (_templateObject$C = _taggedTemplateLiteralLoose(["\n  padding: 10px 16px;\n  border-bottom: 6px solid ", ";\n]"])), function (props) {
  return props.borderColor || colors.backgroundColor;
});
var ActionHeader = styled__default.div(_templateObject2$y || (_templateObject2$y = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin: 25px 0 22px;\n  cursor: pointer;\n"])));
var MenuTriggerIcon = styled__default.span(_templateObject3$r || (_templateObject3$r = _taggedTemplateLiteralLoose(["\n  transition: all 0.2s;\n  ", "\n"])), function (props) {
  return !props.isOpen && ' transform: rotate(-90deg);';
});
var ActionsMenu = styled__default.ul(_templateObject4$n || (_templateObject4$n = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: column;\n  margin: 0;\n  padding: 0;\n  list-style: none;\n  transition: all 0.2s;\n"])));
var DefaultMutedIcon = styled__default(SvgUnmuteNotifications)(_templateObject5$l || (_templateObject5$l = _taggedTemplateLiteralLoose([""])));
var ActionItem$1 = styled__default.li(_templateObject6$i || (_templateObject6$i = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  padding: 10px 0;\n  font-size: 15px;\n  color: ", ";\n  cursor: pointer;\n  order: ", ";\n  pointer-events: ", ";\n\n  & > div {\n    margin-left: auto;\n  }\n\n  & > svg {\n    margin-right: 16px;\n    color: ", ";\n  }\n\n  &:hover {\n    color: ", ";\n  }\n\n  &:last-child {\n    //margin-bottom: 0;\n  }\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.order;
}, function (props) {
  return props.disableEvent && 'none';
}, function (props) {
  return props.iconColor || colors.textColor2;
}, function (props) {
  return props.hoverColor || colors.blue;
});

var _rect$2, _rect2, _path$1f;

function _extends$1j() {
  _extends$1j = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1j.apply(this, arguments);
}

function SvgAddMember(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1j({
    width: 40,
    height: 40,
    viewBox: "0 0 40.01 40.01",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$2 || (_rect$2 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 20,
    fill: "#F3F5F7"
  })), _rect2 || (_rect2 = /*#__PURE__*/React.createElement("rect", {
    x: 0.25,
    y: 0.25,
    width: 39.5,
    height: 39.5,
    rx: 19.75,
    stroke: "#000",
    strokeOpacity: 0.08,
    strokeWidth: 0.5
  })), _path$1f || (_path$1f = /*#__PURE__*/React.createElement("path", {
    d: "M20 12a1 1 0 011 1v6h6a1 1 0 110 2h-6v6a1 1 0 11-2 0l-.001-6H13a1 1 0 110-2h5.999L19 13a1 1 0 011-1z",
    fill: "CurrentColor"
  })));
}

var _path$1g;

function _extends$1k() {
  _extends$1k = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1k.apply(this, arguments);
}

function SvgMoreVert(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1k({
    width: 4,
    height: 14,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1g || (_path$1g = /*#__PURE__*/React.createElement("path", {
    d: "M.532 11.012c.355-.355.764-.533 1.228-.533.464 0 .874.178 1.228.533.355.354.532.764.532 1.228 0 .464-.177.873-.532 1.228-.354.355-.764.532-1.228.532-.464 0-.873-.177-1.228-.532C.177 13.113 0 12.704 0 12.24c0-.464.177-.873.532-1.228zm0-5.24c.355-.355.764-.532 1.228-.532.464 0 .874.177 1.228.532.355.355.532.764.532 1.228 0 .464-.177.873-.532 1.228-.354.355-.764.532-1.228.532-.464 0-.873-.177-1.228-.532C.177 7.873 0 7.464 0 7c0-.464.177-.873.532-1.228zm2.456-2.784c-.354.355-.764.532-1.228.532-.464 0-.873-.177-1.228-.532C.177 2.634 0 2.224 0 1.76 0 1.296.177.887.532.532.887.177 1.296 0 1.76 0c.464 0 .874.177 1.228.532.355.355.532.764.532 1.228 0 .464-.177.874-.532 1.228z",
    fill: "#9B9DA8"
  })));
}

var _templateObject$D, _templateObject2$z, _templateObject3$s;

var ChangeMemberRole = function ChangeMemberRole(_ref) {
  var theme = _ref.theme,
      channelId = _ref.channelId,
      member = _ref.member,
      handleClosePopup = _ref.handleClosePopup;
  var dispatch = reactRedux.useDispatch();

  var _useState = React.useState(false),
      isChanged = _useState[0],
      setIsChanged = _useState[1];

  var _useState2 = React.useState(),
      selectedRole = _useState2[0],
      setSelectedRole = _useState2[1];

  var roles = reactRedux.useSelector(rolesSelector, reactRedux.shallowEqual) || [];
  React.useEffect(function () {
    dispatch(getRolesAC());
  }, []);

  var handleSave = function handleSave() {
    if (isChanged && selectedRole) {
      var updateMember = _extends({}, member, {
        role: selectedRole
      });

      dispatch(changeMemberRoleAC(channelId, [updateMember]));
    }

    handleClosePopup();
  };

  function onChangeFunction(roleName) {
    if (member.role !== roleName) {
      setIsChanged(true);
    }

    setSelectedRole(roleName);
  }

  return /*#__PURE__*/React__default.createElement(PopupContainer, null, /*#__PURE__*/React__default.createElement(Popup, {
    backgroundColor: colors.backgroundColor,
    maxWidth: '400px',
    padding: '0'
  }, /*#__PURE__*/React__default.createElement(PopupBody, {
    paddingH: '24px',
    paddingV: '24px'
  }, /*#__PURE__*/React__default.createElement(CloseIcon, {
    color: colors.textColor1,
    onClick: function onClick() {
      return handleClosePopup();
    }
  }), /*#__PURE__*/React__default.createElement(PopupName, {
    color: colors.textColor1
  }, "Change member role"), /*#__PURE__*/React__default.createElement(RolesSelect, null, /*#__PURE__*/React__default.createElement(RoleLabel, {
    color: colors.textColor1
  }, "Roles"), /*#__PURE__*/React__default.createElement(CustomSelect, {
    backgroundColor: colors.backgroundColor,
    color: colors.textColor1
  }, /*#__PURE__*/React__default.createElement(DropDown, {
    withIcon: true,
    theme: theme,
    isSelect: true,
    trigger: /*#__PURE__*/React__default.createElement(CustomSelectTrigger, {
      color: colors.textColor1
    }, selectedRole || member.role || 'Select')
  }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, {
    theme: theme
  }, !!roles.length && roles.map(function (role) {
    return /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      hoverBackground: colors.primaryLight,
      key: role.name,
      onClick: function onClick() {
        return onChangeFunction(role.name);
      },
      textColor: colors.textColor1
    }, /*#__PURE__*/React__default.createElement(RoleSpan, null, role.name));
  })))))), /*#__PURE__*/React__default.createElement(PopupFooter, {
    backgroundColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    color: colors.textColor1,
    backgroundColor: 'transparent',
    onClick: function onClick() {
      return handleClosePopup();
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    backgroundColor: colors.primary,
    borderRadius: '8px',
    onClick: handleSave
  }, "Save"))));
};

var RolesSelect = styled__default.div(_templateObject$D || (_templateObject$D = _taggedTemplateLiteralLoose(["\n  margin-bottom: 32px;\n"])));
var RoleLabel = styled__default.div(_templateObject2$z || (_templateObject2$z = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: 500;\n  font-size: 14px;\n  margin: 20px 0 8px;\n  color: ", ";\n"])), function (_ref2) {
  var color = _ref2.color;
  return color || colors.textColor1;
});
var RoleSpan = styled__default.span(_templateObject3$s || (_templateObject3$s = _taggedTemplateLiteralLoose(["\n  font-style: normal;\n  font-weight: normal;\n  font-size: 14px;\n  text-transform: capitalize;\n"])));

var _templateObject$E, _templateObject2$A, _templateObject3$t, _templateObject4$o, _templateObject5$m, _templateObject6$j, _templateObject7$g, _templateObject8$f, _templateObject9$d;

var Members = function Members(_ref) {
  var channel = _ref.channel,
      theme = _ref.theme,
      checkActionPermission = _ref.checkActionPermission,
      _ref$showChangeMember = _ref.showChangeMemberRole,
      showChangeMemberRole = _ref$showChangeMember === void 0 ? true : _ref$showChangeMember,
      _ref$showMakeMemberAd = _ref.showMakeMemberAdmin,
      showMakeMemberAdmin = _ref$showMakeMemberAd === void 0 ? true : _ref$showMakeMemberAd,
      _ref$showKickMember = _ref.showKickMember,
      showKickMember = _ref$showKickMember === void 0 ? true : _ref$showKickMember,
      _ref$showKickAndBlock = _ref.showKickAndBlockMember,
      showKickAndBlockMember = _ref$showKickAndBlock === void 0 ? true : _ref$showKickAndBlock;
  var dispatch = reactRedux.useDispatch();
  var getFromContacts = getShowOnlyContactUsers();

  var _useState = React.useState(null),
      selectedMember = _useState[0],
      setSelectedMember = _useState[1];

  var _useState2 = React.useState(false),
      kickMemberPopupOpen = _useState2[0],
      setKickMemberPopupOpen = _useState2[1];

  var _useState3 = React.useState(false),
      blockMemberPopupOpen = _useState3[0],
      setBlockMemberPopupOpen = _useState3[1];

  var _useState4 = React.useState(false),
      changeMemberRolePopup = _useState4[0],
      setChangeMemberRolePopup = _useState4[1];

  var _useState5 = React.useState(false),
      makeAdminPopup = _useState5[0],
      setMakeAdminPopup = _useState5[1];

  var _useState6 = React.useState(false),
      revokeAdminPopup = _useState6[0],
      setRevokeAdminPopup = _useState6[1];

  var _useState7 = React.useState(false),
      addMemberPopupOpen = _useState7[0],
      setAddMemberPopupOpen = _useState7[1];

  var _useState8 = React.useState(),
      closeMenu = _useState8[0],
      setCloseMenu = _useState8[1];

  var members = reactRedux.useSelector(activeChannelMembersSelector) || [];
  var contactsMap = reactRedux.useSelector(contactsMapSelector) || {};
  var membersLoading = reactRedux.useSelector(membersLoadingStateSelector) || {};
  var user = getClient().user;
  var memberDisplayText = getChannelTypesMemberDisplayTextMap();
  var channelTypeRoleMap = getDefaultRolesByChannelTypesMap();
  var displayMemberText = memberDisplayText && memberDisplayText[channel.type] ? memberDisplayText[channel.type] + "s" : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'subscribers' : 'members';
  var noMemberEditPermissions = !checkActionPermission('changeMemberRole') && !checkActionPermission('kickAndBlockMember') && !checkActionPermission('kickMember');

  var handleMembersListScroll = function handleMembersListScroll(event) {
    if (event.target.scrollTop >= event.target.scrollHeight - event.target.offsetHeight - 100) {
      if (membersLoading === LOADING_STATE.LOADED) {
        dispatch(loadMoreMembersAC(15));
      }
    }
  };

  var watchDropdownState = function watchDropdownState(state, memberId) {
    if (state) {
      setCloseMenu(memberId);
    }
  };

  var toggleKickMemberPopup = function toggleKickMemberPopup() {
    if (kickMemberPopupOpen) {
      setSelectedMember(null);
    }

    setKickMemberPopupOpen(!kickMemberPopupOpen);
  };

  var toggleBlockMemberPopup = function toggleBlockMemberPopup() {
    if (blockMemberPopupOpen) {
      setSelectedMember(null);
    }

    setBlockMemberPopupOpen(!blockMemberPopupOpen);
  };

  var toggleChangeRolePopup = function toggleChangeRolePopup() {
    if (changeMemberRolePopup) {
      setSelectedMember(null);
    }

    setChangeMemberRolePopup(!changeMemberRolePopup);
  };

  var toggleMakeAdminPopup = function toggleMakeAdminPopup(revoke) {
    if (revoke) {
      if (revokeAdminPopup) {
        setSelectedMember(null);
      }

      setRevokeAdminPopup(!revokeAdminPopup);
    } else {
      if (makeAdminPopup) {
        setSelectedMember(null);
      }

      setMakeAdminPopup(!makeAdminPopup);
    }
  };

  var handleKickMember = function handleKickMember() {
    selectedMember && dispatch(kickMemberAC(channel.id, selectedMember.id));
  };

  var handleBlockMember = function handleBlockMember() {
    selectedMember && dispatch(blockMemberAC(channel.id, selectedMember.id));
  };

  var handleMakeAdmin = function handleMakeAdmin() {
    if (selectedMember) {
      var updateMember = _extends({}, selectedMember, {
        role: 'admin'
      });

      dispatch(changeMemberRoleAC(channel.id, [updateMember]));
    }
  };

  var handleRevokeAdmin = function handleRevokeAdmin() {
    if (selectedMember) {
      var role = channelTypeRoleMap && channelTypeRoleMap[channel.type] ? channelTypeRoleMap[channel.type] : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'subscriber' : 'participant';

      var updateMember = _extends({}, selectedMember, {
        role: role
      });

      dispatch(changeMemberRoleAC(channel.id, [updateMember]));
    }
  };

  var handleAddMemberPopup = function handleAddMemberPopup() {
    setAddMemberPopupOpen(!addMemberPopupOpen);
  };

  var handleCreateChat = function handleCreateChat(user) {
    if (user) {
      dispatch(createChannelAC({
        metadata: '',
        type: CHANNEL_TYPE.DIRECT,
        members: [_extends({}, user, {
          role: 'owner'
        })]
      }, true));
    }
  };

  React.useEffect(function () {
    if (getFromContacts) {
      dispatch(getContactsAC());
    }

    dispatch(getMembersAC(channel.id));
  }, [channel]);
  return /*#__PURE__*/React__default.createElement(Container$k, {
    theme: theme
  }, /*#__PURE__*/React__default.createElement(ActionsMenu$1, null, /*#__PURE__*/React__default.createElement(MembersList, {
    onScroll: handleMembersListScroll
  }, checkActionPermission('addMember') && /*#__PURE__*/React__default.createElement(MemberItem$1, {
    key: 1,
    onClick: handleAddMemberPopup,
    color: colors.textColor1,
    hoverBackground: theme === THEME.DARK ? colors.hoverBackgroundColor : colors.primaryLight,
    addMemberIconColor: colors.primary
  }, /*#__PURE__*/React__default.createElement(SvgAddMember, null), "Add " + displayMemberText), !!members.length && members.map(function (member, index) {
    return /*#__PURE__*/React__default.createElement(MemberItem$1, {
      key: member.id + index,
      color: colors.textColor1,
      hoverBackground: colors.hoverBackgroundColor,
      onClick: function onClick() {
        return handleCreateChat(member);
      }
    }, /*#__PURE__*/React__default.createElement(Avatar, {
      name: member.firstName || member.id,
      image: member.avatarUrl,
      size: 40,
      textSize: 14,
      setDefaultAvatar: true
    }), /*#__PURE__*/React__default.createElement(MemberNamePresence, null, /*#__PURE__*/React__default.createElement(MemberNameWrapper, null, /*#__PURE__*/React__default.createElement(MemberName$3, null, member.id === user.id ? 'You' : makeUsername(member.id === user.id ? member : contactsMap[member.id], member, getFromContacts)), member.role === 'owner' ? /*#__PURE__*/React__default.createElement(RoleBadge, {
      color: colors.primary
    }, "Owner") : member.role === 'admin' ? /*#__PURE__*/React__default.createElement(RoleBadge, {
      color: colors.purple
    }, "Admin") : ''), /*#__PURE__*/React__default.createElement(SubTitle, {
      margin: '1px 0 0'
    }, member.presence && member.presence.state === USER_PRESENCE_STATUS.ONLINE ? 'Online' : member.presence && member.presence.lastActiveAt && userLastActiveDateFormat(member.presence.lastActiveAt))), !noMemberEditPermissions && member.role !== 'owner' && member.id !== user.id && /*#__PURE__*/React__default.createElement(DropDown, {
      theme: theme,
      isSelect: true,
      forceClose: !!(closeMenu && closeMenu !== member.id),
      watchToggleState: function watchToggleState(state) {
        return watchDropdownState(state, member.id);
      },
      trigger: /*#__PURE__*/React__default.createElement(EditMemberIcon, null, /*#__PURE__*/React__default.createElement(SvgMoreVert, null))
    }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, showChangeMemberRole && checkActionPermission('changeMemberRole') && /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      onClick: function onClick() {
        setSelectedMember(member);
        toggleChangeRolePopup();
      },
      key: 1,
      hoverBackground: colors.hoverBackgroundColor
    }, "Change role"), showMakeMemberAdmin && checkActionPermission('changeMemberRole') && member.role !== 'owner' && /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      onClick: function onClick() {
        setSelectedMember(member);
        toggleMakeAdminPopup(member.role === 'admin');
      },
      textColor: member.role === 'admin' ? colors.red1 : '',
      key: 2,
      hoverBackground: colors.hoverBackgroundColor
    }, member.role === 'admin' ? 'Revoke Admin' : 'Make Admin'), showKickMember && checkActionPermission('kickMember') && member.role !== 'owner' && /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      onClick: function onClick() {
        setSelectedMember(member);
        toggleKickMemberPopup();
      },
      textColor: colors.red1,
      key: 3,
      hoverBackground: colors.hoverBackgroundColor
    }, "Remove"), showKickAndBlockMember && checkActionPermission('kickAndBlockMember') && /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
      textColor: colors.red1,
      key: 4,
      hoverBackground: colors.hoverBackgroundColor,
      onClick: function onClick() {
        setSelectedMember(member);
        toggleBlockMemberPopup();
      }
    }, "Remove and Block member"))));
  }))), kickMemberPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    theme: theme,
    handleFunction: handleKickMember,
    togglePopup: toggleKickMemberPopup,
    buttonText: 'Remove',
    title: channel.type === CHANNEL_TYPE.GROUP || channel.type === CHANNEL_TYPE.PRIVATE ? 'Remove member' : 'Remove subscriber',
    description: /*#__PURE__*/React__default.createElement("span", null, "Are you sure to remove", !!selectedMember && /*#__PURE__*/React__default.createElement(BoltText, null, " ", makeUsername(contactsMap[selectedMember.id], selectedMember, getFromContacts), " "), "from this", ' ', channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'channel' : 'group', "?")
  }), blockMemberPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    theme: theme,
    handleFunction: handleBlockMember,
    togglePopup: toggleBlockMemberPopup,
    buttonText: 'Block',
    description: "Block and remove member - " + (selectedMember && (selectedMember.firstName || selectedMember.lastName || selectedMember.id)),
    title: 'Block and remove user'
  }), makeAdminPopup && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    theme: theme,
    handleFunction: handleMakeAdmin,
    togglePopup: function togglePopup() {
      return toggleMakeAdminPopup(false);
    },
    buttonText: 'Promote',
    buttonBackground: colors.primary,
    title: 'Promote admin',
    description: /*#__PURE__*/React__default.createElement("span", null, "Are you sure you want to promote", selectedMember && /*#__PURE__*/React__default.createElement(BoltText, null, " ", makeUsername(contactsMap[selectedMember.id], selectedMember, getFromContacts), " "), "to ", /*#__PURE__*/React__default.createElement(BoltText, null, "Admin?"))
  }), revokeAdminPopup && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleRevokeAdmin,
    togglePopup: function togglePopup() {
      return toggleMakeAdminPopup(true);
    },
    buttonText: 'Revoke',
    title: 'Revoke admin',
    theme: theme,
    description: /*#__PURE__*/React__default.createElement("span", null, "Are you sure you want to revoke", /*#__PURE__*/React__default.createElement(BoltText, null, " \u201CAdmin\u201D "), "rights from user:", selectedMember && /*#__PURE__*/React__default.createElement(BoltText, null, " ", makeUsername(contactsMap[selectedMember.id], selectedMember, getFromContacts), " "), "?")
  }), changeMemberRolePopup && /*#__PURE__*/React__default.createElement(ChangeMemberRole, {
    theme: theme,
    channelId: channel.id,
    member: selectedMember,
    handleClosePopup: toggleChangeRolePopup
  }), addMemberPopupOpen && /*#__PURE__*/React__default.createElement(UsersPopup, {
    popupHeight: '540px',
    popupWidth: '520px',
    actionType: 'addMembers',
    channel: channel,
    selectIsRequired: true,
    memberIds: members.map(function (mem) {
      return mem.id;
    }),
    toggleCreatePopup: handleAddMemberPopup
  }));
};
var Container$k = styled__default.div(_templateObject$E || (_templateObject$E = _taggedTemplateLiteralLoose([""])));
var ActionsMenu$1 = styled__default.div(_templateObject2$A || (_templateObject2$A = _taggedTemplateLiteralLoose(["\n  position: relative;\n  transition: all 0.2s;\n"])));
var MemberNamePresence = styled__default.div(_templateObject3$t || (_templateObject3$t = _taggedTemplateLiteralLoose(["\n  margin-left: 12px;\n  max-width: calc(100% - 54px);\n\n  & > ", " {\n    display: block;\n  }\n"])), SubTitle);
var MemberNameWrapper = styled__default.div(_templateObject4$o || (_templateObject4$o = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n"])));
var MemberName$3 = styled__default.h4(_templateObject5$m || (_templateObject5$m = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  font-weight: 400;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n"])));
var EditMemberIcon = styled__default.span(_templateObject6$j || (_templateObject6$j = _taggedTemplateLiteralLoose(["\n  margin-left: auto;\n  cursor: pointer;\n  padding: 2px;\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.2s;\n"])));
var MembersList = styled__default.ul(_templateObject7$g || (_templateObject7$g = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  padding: 0;\n  list-style: none;\n  transition: all 0.2s;\n"])));
var MemberItem$1 = styled__default.li(_templateObject8$f || (_templateObject8$f = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  font-size: 15px;\n  font-weight: 500;\n  padding: 6px 16px;\n  transition: all 0.2s;\n  color: ", ";\n  cursor: pointer;\n\n  &:first-child {\n    cursor: pointer;\n\n    > svg {\n      color: ", ";\n      margin-right: 12px;\n    }\n  }\n\n  &:hover {\n    background-color: ", ";\n  }\n\n  &:hover ", " {\n    opacity: 1;\n    visibility: visible;\n  }\n\n  & .dropdown-wrapper {\n    margin-left: auto;\n  }\n\n  & ", " {\n    width: 12px;\n    height: 12px;\n    right: -1px;\n    bottom: -1px;\n  }\n"])), function (props) {
  return props.color || colors.textColor1;
}, function (props) {
  return props.addMemberIconColor || colors.primary;
}, function (props) {
  return props.hoverBackground || colors.gray0;
}, EditMemberIcon, UserStatus);
var RoleBadge = styled__default.span(_templateObject9$d || (_templateObject9$d = _taggedTemplateLiteralLoose(["\n  position: relative;\n  padding: 2px 8px;\n  border-radius: 12px;\n  margin-left: 4px;\n  font-weight: 500;\n  font-size: 12px;\n  line-height: 16px;\n  color: ", ";\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    border-radius: 12px;\n    width: 100%;\n    height: 100%;\n    background-color: ", ";\n    opacity: 0.1;\n  }\n"])), function (props) {
  return props.color;
}, function (props) {
  return props.color || colors.primary;
});

var _templateObject$F, _templateObject2$B;

var Media = function Media(_ref) {
  var channelId = _ref.channelId;
  var attachments = reactRedux.useSelector(activeTabAttachmentsSelector, reactRedux.shallowEqual) || [];

  var _useState = React.useState(null),
      mediaFile = _useState[0],
      setMediaFile = _useState[1];

  var dispatch = reactRedux.useDispatch();

  var handleMediaItemClick = function handleMediaItemClick(file) {
    setMediaFile(file);
  };

  React.useEffect(function () {
    dispatch(setAttachmentsAC([]));
    dispatch(getAttachmentsAC(channelId, channelDetailsTabs.media));
  }, [channelId]);
  return /*#__PURE__*/React__default.createElement(Container$l, null, attachments.map(function (file) {
    return /*#__PURE__*/React__default.createElement(MediaItem, {
      key: file.id
    }, file.type === 'image' ? /*#__PURE__*/React__default.createElement(Attachment$1, {
      attachment: _extends({}, file, {
        metadata: isJSON(file.metadata) ? JSON.parse(file.metadata) : file.metadata
      }),
      handleMediaItemClick: handleMediaItemClick,
      backgroundColor: colors.white,
      borderRadius: '8px',
      isDetailsView: true
    }) :
    /*#__PURE__*/
    React__default.createElement(Attachment$1, {
      attachment: _extends({}, file, {
        metadata: isJSON(file.metadata) ? JSON.parse(file.metadata) : file.metadata
      }),
      handleMediaItemClick: handleMediaItemClick,
      backgroundColor: colors.white,
      borderRadius: '8px',
      isDetailsView: true
    }));
  }), mediaFile && /*#__PURE__*/React__default.createElement(SliderPopup, {
    channelId: channelId,
    setIsSliderOpen: setMediaFile,
    mediaFiles: attachments,
    currentMediaFile: mediaFile
  }));
};
var Container$l = styled__default.div(_templateObject$F || (_templateObject$F = _taggedTemplateLiteralLoose(["\n  padding: 6px 4px;\n  overflow-x: hidden;\n  overflow-y: auto;\n  list-style: none;\n  transition: all 0.2s;\n  align-items: flex-start;\n  display: flex;\n  flex-wrap: wrap;\n"])));
var MediaItem = styled__default.div(_templateObject2$B || (_templateObject2$B = _taggedTemplateLiteralLoose(["\n  width: calc(33.3333% - 4px);\n  height: 110px;\n  box-sizing: border-box;\n  //border: 1px solid #ccc;\n  border: 0.5px solid rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n  overflow: hidden;\n  margin: 2px;\n"])));

var _path$1h, _path2$8, _path3$3;

function _extends$1l() {
  _extends$1l = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1l.apply(this, arguments);
}

function SvgFileIcon$1(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1l({
    width: 28,
    height: 28,
    viewBox: "0 0 30 30",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1h || (_path$1h = /*#__PURE__*/React.createElement("path", {
    d: "M16.25 2.5H7.5A2.5 2.5 0 005 5v20a2.5 2.5 0 002.5 2.5h15A2.5 2.5 0 0025 25V11.25L16.25 2.5z",
    stroke: "#2F81FF",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })), _path2$8 || (_path2$8 = /*#__PURE__*/React.createElement("path", {
    d: "M16.25 2.5v8.75H25",
    stroke: "#2F81FF",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })), _path3$3 || (_path3$3 = /*#__PURE__*/React.createElement("path", {
    d: "M10 15.834h10M10 19.166h6.667",
    stroke: "#2F81FF",
    strokeWidth: 1.4,
    strokeLinecap: "round"
  })));
}

var _path$1i, _path2$9;

function _extends$1m() {
  _extends$1m = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1m.apply(this, arguments);
}

function SvgDownloadFile(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1m({
    width: 18,
    height: 18,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1i || (_path$1i = /*#__PURE__*/React.createElement("path", {
    d: "M16.5 11.5v3.333a1.666 1.666 0 01-1.667 1.667H3.167A1.667 1.667 0 011.5 14.833V11.5",
    stroke: "#2F81FF",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })), _path2$9 || (_path2$9 = /*#__PURE__*/React.createElement("path", {
    d: "M4.833 7.334L9 11.501l4.167-4.167M9 11.5v-10",
    stroke: "#2F81FF",
    strokeWidth: 1.4,
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })));
}

var _templateObject$G, _templateObject2$C, _templateObject3$u, _templateObject4$p, _templateObject5$n, _templateObject6$k, _templateObject7$h, _templateObject8$g;

var Files = function Files(_ref) {
  var channelId = _ref.channelId,
      theme = _ref.theme,
      filePreviewIcon = _ref.filePreviewIcon,
      filePreviewHoverIcon = _ref.filePreviewHoverIcon,
      filePreviewTitleColor = _ref.filePreviewTitleColor,
      filePreviewSizeColor = _ref.filePreviewSizeColor,
      filePreviewHoverBackgroundColor = _ref.filePreviewHoverBackgroundColor,
      filePreviewDownloadIcon = _ref.filePreviewDownloadIcon;
  var dispatch = reactRedux.useDispatch();

  var _useState = React.useState({}),
      downloadingFilesMap = _useState[0],
      setDownloadingFilesMap = _useState[1];

  var attachments = reactRedux.useSelector(activeTabAttachmentsSelector, reactRedux.shallowEqual) || [];

  var handleCompleteDownload = function handleCompleteDownload(attachmentId) {
    var stateCopy = _extends({}, downloadingFilesMap);

    delete stateCopy[attachmentId];
    setDownloadingFilesMap(stateCopy);
  };

  var handleDownloadFile = function handleDownloadFile(attachment) {
    if (attachment.id) {
      setDownloadingFilesMap(function (prevState) {
        var _extends2;

        return _extends({}, prevState, (_extends2 = {}, _extends2[attachment.id] = {
          uploadPercent: 1
        }, _extends2));
      });
    }

    downloadFile(attachment, true, handleCompleteDownload, function (progress) {
      var loadedRes = progress.loaded && progress.loaded / progress.total;
      var uploadPercent = loadedRes && loadedRes * 100;
      setDownloadingFilesMap(function (prevState) {
        var _extends3;

        return _extends({}, prevState, (_extends3 = {}, _extends3[attachment.id] = {
          uploadPercent: uploadPercent
        }, _extends3));
      });
    });
  };

  React.useEffect(function () {
    dispatch(getAttachmentsAC(channelId, channelDetailsTabs.file));
  }, [channelId]);
  console.log('attachments. .. . ', attachments);
  return /*#__PURE__*/React__default.createElement(Container$m, {
    theme: theme
  }, attachments.map(function (file) {
    var metas = file.metadata && isJSON(file.metadata) ? JSON.parse(file.metadata) : file.metadata;
    var withPrefix = true;
    var attachmentThumb = '';

    if (metas && metas.tmb) {
      if (metas.tmb.length < 70) {
        attachmentThumb = base64ToToDataURL(metas.tmb);
        withPrefix = false;
      } else {
        attachmentThumb = metas.tmb;
      }
    }

    return /*#__PURE__*/React__default.createElement(FileItem, {
      key: file.id,
      hoverBackgroundColor: filePreviewHoverBackgroundColor || colors.hoverBackgroundColor
    }, metas && metas.tmb ? /*#__PURE__*/React__default.createElement(FileThumb, {
      draggable: false,
      src: "" + (withPrefix ? 'data:image/jpeg;base64,' : '') + attachmentThumb
    }) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(FileIconCont, null, filePreviewIcon || /*#__PURE__*/React__default.createElement(SvgFileIcon$1, null)), /*#__PURE__*/React__default.createElement(FileHoverIconCont, null, filePreviewHoverIcon || /*#__PURE__*/React__default.createElement(SvgFileIcon$1, null))), /*#__PURE__*/React__default.createElement("div", null, /*#__PURE__*/React__default.createElement(AttachmentPreviewTitle, {
      color: filePreviewTitleColor
    }, formatLargeText(file.name, 32)), /*#__PURE__*/React__default.createElement(FileSizeAndDate, {
      color: filePreviewSizeColor
    }, file.size ? bytesToSize(file.size) : '')), /*#__PURE__*/React__default.createElement(DownloadWrapper, {
      visible: downloadingFilesMap[file.id],
      onClick: function onClick() {
        return handleDownloadFile(file);
      }
    }, downloadingFilesMap[file.id] ?
    /*#__PURE__*/
    React__default.createElement(ProgressWrapper$2, null, /*#__PURE__*/React__default.createElement(reactCircularProgressbar.CircularProgressbar, {
      minValue: 0,
      maxValue: 100,
      value: downloadingFilesMap[file.id].uploadPercent || 0,
      backgroundPadding: 6,
      background: true,
      text: '',
      styles: {
        background: {
          fill: 'transparent'
        },
        path: {
          stroke: colors.textColor2,
          strokeLinecap: 'butt',
          strokeWidth: '6px',
          transition: 'stroke-dashoffset 0.5s ease 0s',
          transform: 'rotate(0turn)',
          transformOrigin: 'center center'
        }
      }
    })) : filePreviewDownloadIcon || /*#__PURE__*/React__default.createElement(SvgDownloadFile, null)));
  }));
};
var Container$m = styled__default.ul(_templateObject$G || (_templateObject$G = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  padding: 0;\n  overflow-x: hidden;\n  overflow-y: auto;\n  list-style: none;\n  transition: all 0.2s;\n"])));
var DownloadWrapper = styled__default.a(_templateObject2$C || (_templateObject2$C = _taggedTemplateLiteralLoose(["\n  text-decoration: none;\n  visibility: ", ";\n  padding: 5px 6px;\n  position: absolute;\n  top: 25%;\n  right: 16px;\n  cursor: pointer;\n"])), function (props) {
  return props.visible ? 'visible' : 'hidden';
});
var ProgressWrapper$2 = styled__default.span(_templateObject3$u || (_templateObject3$u = _taggedTemplateLiteralLoose(["\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  animation: preloader 1.5s linear infinite;\n\n  @keyframes preloader {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n"])));
var FileIconCont = styled__default.span(_templateObject4$p || (_templateObject4$p = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n\n  & > svg {\n    width: 40px;\n    height: 40px;\n  }\n"])));
var FileHoverIconCont = styled__default.span(_templateObject5$n || (_templateObject5$n = _taggedTemplateLiteralLoose(["\n  display: none;\n  & > svg {\n    width: 40px;\n    height: 40px;\n  }\n"])));
var FileThumb = styled__default.img(_templateObject6$k || (_templateObject6$k = _taggedTemplateLiteralLoose(["\n  width: 40px;\n  height: 40px;\n  border: 0.5px solid rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n  object-fit: cover;\n"])));
var FileItem = styled__default.div(_templateObject7$h || (_templateObject7$h = _taggedTemplateLiteralLoose(["\n  position: relative;\n  padding: 11px 16px;\n  display: flex;\n  align-items: center;\n  font-size: 15px;\n  transition: all 0.2s;\n  div {\n    margin-left: 7px;\n    width: calc(100% - 48px);\n  }\n  &:hover {\n    background-color: ", ";\n    ", " {\n      visibility: visible;\n    }\n    & ", " {\n      display: none;\n    }\n    & ", " {\n      display: inline-flex;\n    }\n  }\n  /*&.isHover {\n\n  }*/\n"])), function (props) {
  return props.hoverBackgroundColor || colors.gray0;
}, DownloadWrapper, FileIconCont, FileHoverIconCont);
var FileSizeAndDate = styled__default.span(_templateObject8$g || (_templateObject8$g = _taggedTemplateLiteralLoose(["\n  display: block;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 13px;\n  line-height: 16px;\n  color: ", ";\n  margin-top: 2px;\n"])), function (props) {
  return props.color || colors.textColor1;
});

var _rect$3, _rect2$1, _g$3, _defs$2;

function _extends$1n() {
  _extends$1n = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1n.apply(this, arguments);
}

function SvgLinkIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1n({
    width: 42,
    height: 42,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$3 || (_rect$3 = /*#__PURE__*/React.createElement("rect", {
    width: 42,
    height: 42,
    rx: 6,
    fill: "CurrentColor"
  })), _rect2$1 || (_rect2$1 = /*#__PURE__*/React.createElement("rect", {
    x: 0.25,
    y: 0.25,
    width: 41.5,
    height: 41.5,
    rx: 5.75,
    stroke: "#000",
    strokeOpacity: 0.1,
    strokeWidth: 0.5
  })), _g$3 || (_g$3 = /*#__PURE__*/React.createElement("g", {
    clipPath: "url(#linkIcon_svg__clip0)"
  }, /*#__PURE__*/React.createElement("path", {
    d: "M20.314 20.973a.984.984 0 11-1.754.895 3.939 3.939 0 01.724-4.574l2.088-2.088a3.938 3.938 0 115.569 5.569.984.984 0 01-1.392-1.393 1.969 1.969 0 00-2.785-2.784l-2.088 2.088a1.97 1.97 0 00-.362 2.287zm1.522.198a.984.984 0 111.754-.895 3.939 3.939 0 01-.724 4.574l-2.089 2.088a3.938 3.938 0 01-5.568-5.569.984.984 0 011.392 1.392 1.969 1.969 0 002.784 2.785l2.088-2.089a1.97 1.97 0 00.363-2.286z",
    fill: "#95A6FF"
  }))), _defs$2 || (_defs$2 = /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("clipPath", {
    id: "linkIcon_svg__clip0"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "#fff",
    transform: "translate(13.125 13.125)",
    d: "M0 0h15.75v15.75H0z"
  })))));
}

var _templateObject$H, _templateObject2$D, _templateObject3$v, _templateObject4$q, _templateObject5$o;

var LinkItem = function LinkItem(_ref) {
  var link = _ref.link,
      linkPreviewIcon = _ref.linkPreviewIcon,
      linkPreviewHoverIcon = _ref.linkPreviewHoverIcon,
      linkPreviewColor = _ref.linkPreviewColor,
      linkPreviewHoverBackgroundColor = _ref.linkPreviewHoverBackgroundColor;
  React.useEffect(function () {}, []);
  return /*#__PURE__*/React__default.createElement(FileItem$1, {
    draggable: false,
    hoverBackgroundColor: linkPreviewHoverBackgroundColor || colors.hoverBackgroundColor
  }, /*#__PURE__*/React__default.createElement("a", {
    draggable: false,
    href: link.startsWith('http') ? link : "https://" + link,
    target: '_blank',
    rel: 'noreferrer'
  }, /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(LinkIconCont, {
    color: colors.primaryLight
  }, linkPreviewIcon || /*#__PURE__*/React__default.createElement(SvgLinkIcon, null)), /*#__PURE__*/React__default.createElement(LinkHoverIconCont, {
    color: colors.primaryLight
  }, linkPreviewHoverIcon || /*#__PURE__*/React__default.createElement(SvgLinkIcon, null))), /*#__PURE__*/React__default.createElement(LinkInfoCont, null, /*#__PURE__*/React__default.createElement(LinkUrl, {
    color: linkPreviewColor
  }, link))));
};
var LinkIconCont = styled__default.span(_templateObject$H || (_templateObject$H = _taggedTemplateLiteralLoose(["\n  display: inline-flex;\n  color: ", ";\n"])), function (props) {
  return props.color;
});
var LinkHoverIconCont = styled__default.span(_templateObject2$D || (_templateObject2$D = _taggedTemplateLiteralLoose(["\n  display: none;\n  color: ", ";\n"])), function (props) {
  return props.color;
});
var LinkInfoCont = styled__default.div(_templateObject3$v || (_templateObject3$v = _taggedTemplateLiteralLoose(["\n  margin-left: 12px;\n  width: calc(100% - 40px);\n"])));
var FileItem$1 = styled__default.li(_templateObject4$q || (_templateObject4$q = _taggedTemplateLiteralLoose(["\n  padding: 9px 16px;\n  a {\n    display: flex;\n    align-items: center;\n    text-decoration: none;\n  }\n  &:hover {\n    background-color: ", ";\n    & ", " {\n      display: none;\n    }\n    & ", " {\n      display: inline-flex;\n    }\n  }\n"])), function (props) {
  return props.hoverBackgroundColor || colors.gray0;
}, LinkIconCont, LinkHoverIconCont);
var LinkUrl = styled__default.span(_templateObject5$o || (_templateObject5$o = _taggedTemplateLiteralLoose(["\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 52px);\n  font-style: normal;\n  font-weight: normal;\n  font-size: 13px;\n  line-height: 16px;\n  text-decoration: underline;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});

var _templateObject$I;

var Links = function Links(_ref) {
  var channelId = _ref.channelId,
      linkPreviewIcon = _ref.linkPreviewIcon,
      linkPreviewHoverIcon = _ref.linkPreviewHoverIcon,
      linkPreviewTitleColor = _ref.linkPreviewTitleColor,
      linkPreviewColor = _ref.linkPreviewColor,
      linkPreviewHoverBackgroundColor = _ref.linkPreviewHoverBackgroundColor;
  var dispatch = reactRedux.useDispatch();
  var attachments = reactRedux.useSelector(activeTabAttachmentsSelector, reactRedux.shallowEqual) || [];
  React.useEffect(function () {
    dispatch(getAttachmentsAC(channelId, channelDetailsTabs.link));
  }, [channelId]);
  console.log('attachments. .. . . ', attachments);
  return /*#__PURE__*/React__default.createElement(Container$n, null, attachments.map(function (file) {
    return /*#__PURE__*/React__default.createElement(LinkItem, {
      key: file.id,
      link: file.url,
      linkPreviewColor: linkPreviewColor,
      linkPreviewHoverBackgroundColor: linkPreviewHoverBackgroundColor,
      linkPreviewHoverIcon: linkPreviewHoverIcon,
      linkPreviewTitleColor: linkPreviewTitleColor,
      linkPreviewIcon: linkPreviewIcon
    });
  }));
};
var Container$n = styled__default.ul(_templateObject$I || (_templateObject$I = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  padding: 11px 0 0;\n  overflow-x: hidden;\n  overflow-y: auto;\n  list-style: none;\n  transition: all 0.2s;\n"])));

var _rect$4, _circle$6, _path$1j;

function _extends$1o() {
  _extends$1o = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1o.apply(this, arguments);
}

function SvgVoicePreview(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1o({
    width: 40,
    height: 40,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$4 || (_rect$4 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 8,
    fill: "#F3F5F7"
  })), _circle$6 || (_circle$6 = /*#__PURE__*/React.createElement("circle", {
    cx: 20,
    cy: 20,
    r: 14,
    fill: "#0DBD8B"
  })), _path$1j || (_path$1j = /*#__PURE__*/React.createElement("path", {
    d: "M25.024 19.13c.635.385.635 1.354 0 1.738l-6.612 3.997c-.63.38-1.412-.1-1.412-.868v-7.995c0-.768.783-1.25 1.412-.869l6.612 3.998z",
    fill: "#fff"
  })));
}

var _rect$5, _circle$7, _path$1k;

function _extends$1p() {
  _extends$1p = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1p.apply(this, arguments);
}

function SvgVoicePreviewPause(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1p({
    width: 40,
    height: 40,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$5 || (_rect$5 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 8,
    fill: "#F3F5F7"
  })), _circle$7 || (_circle$7 = /*#__PURE__*/React.createElement("circle", {
    cx: 20,
    cy: 20,
    r: 14,
    fill: "#0DBD8B"
  })), _path$1k || (_path$1k = /*#__PURE__*/React.createElement("path", {
    d: "M17.974 15c.357 0 .486.037.617.107.13.07.232.172.302.302.07.13.107.26.107.617v7.948c0 .357-.037.486-.107.617a.726.726 0 01-.302.302c-.13.07-.26.107-.617.107h-.948c-.357 0-.486-.037-.617-.107a.726.726 0 01-.302-.302c-.07-.13-.107-.26-.107-.617v-7.948c0-.357.037-.486.107-.617a.726.726 0 01.302-.302c.13-.07.26-.107.617-.107h.948zm5 0c.357 0 .486.037.617.107.13.07.232.172.302.302.07.13.107.26.107.617v7.948c0 .357-.037.486-.107.617a.726.726 0 01-.302.302c-.13.07-.26.107-.617.107h-.948c-.357 0-.486-.037-.617-.107a.726.726 0 01-.302-.302c-.07-.13-.107-.26-.107-.617v-7.948c0-.357.037-.486.107-.617a.726.726 0 01.302-.302c.13-.07.26-.107.617-.107h.948z",
    fill: "#fff"
  })));
}

var _rect$6, _circle$8, _path$1l;

function _extends$1q() {
  _extends$1q = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1q.apply(this, arguments);
}

function SvgVoicePreviewHoverIcon(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1q({
    width: 40,
    height: 40,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$6 || (_rect$6 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 8,
    fill: "#fff"
  })), _circle$8 || (_circle$8 = /*#__PURE__*/React.createElement("circle", {
    cx: 20,
    cy: 20,
    r: 14,
    fill: "#0DBD8B"
  })), _path$1l || (_path$1l = /*#__PURE__*/React.createElement("path", {
    d: "M25.024 19.13c.635.385.635 1.354 0 1.738l-6.612 3.997c-.63.38-1.412-.1-1.412-.868v-7.995c0-.768.783-1.25 1.412-.869l6.612 3.998z",
    fill: "#fff"
  })));
}

var _rect$7, _circle$9, _path$1m;

function _extends$1r() {
  _extends$1r = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1r.apply(this, arguments);
}

function SvgVoicePreviewPauseHover(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1r({
    width: 40,
    height: 40,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _rect$7 || (_rect$7 = /*#__PURE__*/React.createElement("rect", {
    width: 40,
    height: 40,
    rx: 8,
    fill: "#fff"
  })), _circle$9 || (_circle$9 = /*#__PURE__*/React.createElement("circle", {
    cx: 20,
    cy: 20,
    r: 14,
    fill: "#0DBD8B"
  })), _path$1m || (_path$1m = /*#__PURE__*/React.createElement("path", {
    d: "M17.974 15c.357 0 .486.037.617.107.13.07.232.172.302.302.07.13.107.26.107.617v7.948c0 .357-.037.486-.107.617a.726.726 0 01-.302.302c-.13.07-.26.107-.617.107h-.948c-.357 0-.486-.037-.617-.107a.726.726 0 01-.302-.302c-.07-.13-.107-.26-.107-.617v-7.948c0-.357.037-.486.107-.617a.726.726 0 01.302-.302c.13-.07.26-.107.617-.107h.948zm5 0c.357 0 .486.037.617.107.13.07.232.172.302.302.07.13.107.26.107.617v7.948c0 .357-.037.486-.107.617a.726.726 0 01-.302.302c-.13.07-.26.107-.617.107h-.948c-.357 0-.486-.037-.617-.107a.726.726 0 01-.302-.302c-.07-.13-.107-.26-.107-.617v-7.948c0-.357.037-.486.107-.617a.726.726 0 01.302-.302c.13-.07.26-.107.617-.107h.948z",
    fill: "#fff"
  })));
}

var _templateObject$J, _templateObject2$E, _templateObject3$w, _templateObject4$r, _templateObject5$p, _templateObject6$l, _templateObject7$i, _templateObject8$h;

var VoiceItem = function VoiceItem(_ref) {
  var file = _ref.file,
      voicePreviewPlayIcon = _ref.voicePreviewPlayIcon,
      voicePreviewPlayHoverIcon = _ref.voicePreviewPlayHoverIcon,
      voicePreviewPauseIcon = _ref.voicePreviewPauseIcon,
      voicePreviewPauseHoverIcon = _ref.voicePreviewPauseHoverIcon,
      voicePreviewTitleColor = _ref.voicePreviewTitleColor,
      voicePreviewDateAndTimeColor = _ref.voicePreviewDateAndTimeColor,
      voicePreviewHoverBackgroundColor = _ref.voicePreviewHoverBackgroundColor;
  var dispatch = reactRedux.useDispatch();
  var playingAudioId = reactRedux.useSelector(playingAudioIdSelector);
  var getFromContacts = getShowOnlyContactUsers();

  var _useState = React.useState(''),
      fileUrl = _useState[0],
      setFileUrl = _useState[1];

  var _useState2 = React.useState(false),
      audioIsPlaying = _useState2[0],
      setAudioIsPlaying = _useState2[1];

  var _useState3 = React.useState(''),
      currentTime = _useState3[0],
      setCurrentTime = _useState3[1];

  var customDownloader = getCustomDownloader();
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var user = reactRedux.useSelector(userSelector);
  var audioRef = React.useRef();
  var intervalRef = React.useRef(null);

  var handlePlayPause = function handlePlayPause() {
    if (audioRef && audioRef.current) {
      if (audioRef.current.paused) {
        var _audioRef$current, _audioRef$current5;

        var audioDuration = (_audioRef$current = audioRef.current) === null || _audioRef$current === void 0 ? void 0 : _audioRef$current.duration;
        dispatch(setPlayingAudioIdAC("voice_" + file.id));
        intervalRef.current = setInterval(function () {
          var _audioRef$current2;

          var audioCurrentTime = (_audioRef$current2 = audioRef.current) === null || _audioRef$current2 === void 0 ? void 0 : _audioRef$current2.currentTime;

          if (audioDuration) {
            if ((audioCurrentTime || audioCurrentTime === 0) && audioDuration - audioCurrentTime > 0) {
              setCurrentTime(formatAudioVideoTime(audioCurrentTime));
            } else {
              var _audioRef$current3;

              setCurrentTime(formatAudioVideoTime(audioCurrentTime || 0));
              setAudioIsPlaying(false);
              (_audioRef$current3 = audioRef.current) === null || _audioRef$current3 === void 0 ? void 0 : _audioRef$current3.pause();
              audioRef.current && (audioRef.current.currentTime = 0);
              clearInterval(intervalRef.current);
            }
          } else {
            var _audioRef$current4;

            audioDuration = (_audioRef$current4 = audioRef.current) === null || _audioRef$current4 === void 0 ? void 0 : _audioRef$current4.duration;
          }
        }, 100);
        setAudioIsPlaying(true);
        (_audioRef$current5 = audioRef.current) === null || _audioRef$current5 === void 0 ? void 0 : _audioRef$current5.play();
      } else {
        var _audioRef$current6;

        clearInterval(intervalRef.current);
        dispatch(setPlayingAudioIdAC(null));
        setAudioIsPlaying(false);
        (_audioRef$current6 = audioRef.current) === null || _audioRef$current6 === void 0 ? void 0 : _audioRef$current6.pause();
      }
    }
  };

  useDidUpdate(function () {
    console.log('voice item payingAudioId. . . . .', playingAudioId);

    if (audioIsPlaying && playingAudioId && playingAudioId !== "voice_" + file.id && audioRef.current) {
      setAudioIsPlaying(false);
      audioRef.current.pause();
    }
  }, [playingAudioId]);
  React.useEffect(function () {
    if (customDownloader) {
      customDownloader(file.url, false).then(function (url) {
        setFileUrl(url);
      });
    } else {
      setFileUrl(file.url);
    }

    return function () {
      clearInterval(intervalRef.current);
    };
  }, []);
  return /*#__PURE__*/React__default.createElement(FileItem$2, {
    onMouseEnter: function onMouseEnter(e) {
      return e.currentTarget.classList.add('isHover');
    },
    onMouseLeave: function onMouseLeave(e) {
      return e.currentTarget.classList.remove('isHover');
    },
    hoverBackgroundColor: voicePreviewHoverBackgroundColor
  }, audioIsPlaying ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(FileIconCont$1, {
    onClick: handlePlayPause
  }, voicePreviewPauseIcon || /*#__PURE__*/React__default.createElement(SvgVoicePreviewPause, null)), /*#__PURE__*/React__default.createElement(FileHoverIconCont$1, {
    onClick: handlePlayPause
  }, voicePreviewPauseHoverIcon || /*#__PURE__*/React__default.createElement(SvgVoicePreviewPauseHover, null))) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(FileIconCont$1, {
    onClick: handlePlayPause
  }, voicePreviewPlayIcon || /*#__PURE__*/React__default.createElement(SvgVoicePreview, null)), /*#__PURE__*/React__default.createElement(FileHoverIconCont$1, {
    onClick: handlePlayPause
  }, voicePreviewPlayHoverIcon || /*#__PURE__*/React__default.createElement(SvgVoicePreviewHoverIcon, null))), /*#__PURE__*/React__default.createElement(AudioInfo, null, /*#__PURE__*/React__default.createElement(AudioTitle, {
    color: voicePreviewTitleColor
  }, file.user && (file.user.id === user.id ? 'You' : makeUsername(contactsMap[file.user.id], file.user, getFromContacts))), /*#__PURE__*/React__default.createElement(AudioDate, {
    color: voicePreviewDateAndTimeColor
  }, moment(file.createdAt).format('DD MMMM, YYYY')), /*#__PURE__*/React__default.createElement(AudioSendTime, null, currentTime || (file.metadata.dur ? formatAudioVideoTime(file.metadata.dur) : ''))), /*#__PURE__*/React__default.createElement(Audio, {
    controls: true,
    ref: audioRef,
    src: fileUrl
  }, /*#__PURE__*/React__default.createElement("source", {
    src: fileUrl,
    type: 'audio/ogg'
  }), /*#__PURE__*/React__default.createElement("source", {
    src: fileUrl,
    type: 'audio/mpeg'
  })));
};
var FileIconCont$1 = styled__default.span(_templateObject$J || (_templateObject$J = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  display: inline-flex;\n"])));
var FileHoverIconCont$1 = styled__default.span(_templateObject2$E || (_templateObject2$E = _taggedTemplateLiteralLoose(["\n  cursor: pointer;\n  display: none;\n"])));
var FileItem$2 = styled__default.li(_templateObject3$w || (_templateObject3$w = _taggedTemplateLiteralLoose(["\n  padding: 9px 16px;\n  display: flex;\n  align-items: center;\n  text-decoration: none;\n\n  &:hover {\n    background-color: ", ";\n  }\n  div {\n    margin-left: 12px;\n    width: 100%;\n  }\n  img {\n    width: 42px;\n    height: 42px;\n    border: 0.5px solid rgba(0, 0, 0, 0.1);\n    box-sizing: border-box;\n    border-radius: 6px;\n  }\n\n  &.isHover {\n    & ", " {\n      display: none;\n    }\n    & ", " {\n      display: inline-flex;\n    }\n  }\n"])), function (props) {
  return props.hoverBackgroundColor || colors.gray0;
}, FileIconCont$1, FileHoverIconCont$1);
var AudioInfo = styled__default.div(_templateObject4$r || (_templateObject4$r = _taggedTemplateLiteralLoose(["\n  position: relative;\n"])));
var AudioTitle = styled__default.span(_templateObject5$p || (_templateObject5$p = _taggedTemplateLiteralLoose(["\n  display: block;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 15px;\n  line-height: 20px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 72px);\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor1;
});
var AudioDate = styled__default.span(_templateObject6$l || (_templateObject6$l = _taggedTemplateLiteralLoose(["\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 72px);\n  font-style: normal;\n  font-weight: normal;\n  font-size: 12px;\n  line-height: 16px;\n  color: ", ";\n"])), function (props) {
  return props.color || colors.textColor2;
});
var AudioSendTime = styled__default.span(_templateObject7$i || (_templateObject7$i = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  right: 0;\n  top: 11px;\n  color: ", ";\n  font-size: 12px;\n  line-height: 16px;\n"])), function (props) {
  return props.color || colors.textColor2;
});
var Audio = styled__default.audio(_templateObject8$h || (_templateObject8$h = _taggedTemplateLiteralLoose(["\n  display: none;\n"])));

var _templateObject$K;

var Voices = function Voices(_ref) {
  var channelId = _ref.channelId,
      voicePreviewPlayIcon = _ref.voicePreviewPlayIcon,
      voicePreviewPlayHoverIcon = _ref.voicePreviewPlayHoverIcon,
      voicePreviewPauseIcon = _ref.voicePreviewPauseIcon,
      voicePreviewPauseHoverIcon = _ref.voicePreviewPauseHoverIcon,
      voicePreviewTitleColor = _ref.voicePreviewTitleColor,
      voicePreviewDateAndTimeColor = _ref.voicePreviewDateAndTimeColor,
      voicePreviewHoverBackgroundColor = _ref.voicePreviewHoverBackgroundColor;
  var dispatch = reactRedux.useDispatch();
  var attachments = reactRedux.useSelector(activeTabAttachmentsSelector, reactRedux.shallowEqual) || [];
  React.useEffect(function () {
    dispatch(getAttachmentsAC(channelId, channelDetailsTabs.voice));
  }, [channelId]);
  return /*#__PURE__*/React__default.createElement(Container$o, null, attachments.map(function (file) {
    return /*#__PURE__*/React__default.createElement(VoiceItem, {
      key: file.id,
      file: _extends({}, file, {
        metadata: isJSON(file.metadata) ? JSON.parse(file.metadata) : file.metadata
      }),
      voicePreviewDateAndTimeColor: voicePreviewDateAndTimeColor,
      voicePreviewHoverBackgroundColor: voicePreviewHoverBackgroundColor,
      voicePreviewPlayHoverIcon: voicePreviewPlayIcon,
      voicePreviewPlayIcon: voicePreviewPlayHoverIcon,
      voicePreviewPauseIcon: voicePreviewPauseIcon,
      voicePreviewPauseHoverIcon: voicePreviewPauseHoverIcon,
      voicePreviewTitleColor: voicePreviewTitleColor
    });
  }));
};
var Container$o = styled__default.ul(_templateObject$K || (_templateObject$K = _taggedTemplateLiteralLoose(["\n  margin: 0;\n  padding: 11px 0 0;\n  overflow-x: hidden;\n  overflow-y: auto;\n  list-style: none;\n  transition: all 0.2s;\n"])));

var _templateObject$L, _templateObject2$F;

var DetailsTab = function DetailsTab(_ref) {
  var channel = _ref.channel,
      theme = _ref.theme,
      activeTab = _ref.activeTab,
      checkActionPermission = _ref.checkActionPermission,
      setActiveTab = _ref.setActiveTab,
      linkPreviewIcon = _ref.linkPreviewIcon,
      linkPreviewHoverIcon = _ref.linkPreviewHoverIcon,
      linkPreviewTitleColor = _ref.linkPreviewTitleColor,
      linkPreviewColor = _ref.linkPreviewColor,
      linkPreviewHoverBackgroundColor = _ref.linkPreviewHoverBackgroundColor,
      voicePreviewPlayIcon = _ref.voicePreviewPlayIcon,
      voicePreviewPlayHoverIcon = _ref.voicePreviewPlayHoverIcon,
      voicePreviewPauseIcon = _ref.voicePreviewPauseIcon,
      voicePreviewPauseHoverIcon = _ref.voicePreviewPauseHoverIcon,
      voicePreviewTitleColor = _ref.voicePreviewTitleColor,
      voicePreviewDateAndTimeColor = _ref.voicePreviewDateAndTimeColor,
      voicePreviewHoverBackgroundColor = _ref.voicePreviewHoverBackgroundColor,
      filePreviewIcon = _ref.filePreviewIcon,
      filePreviewHoverIcon = _ref.filePreviewHoverIcon,
      filePreviewTitleColor = _ref.filePreviewTitleColor,
      filePreviewSizeColor = _ref.filePreviewSizeColor,
      filePreviewHoverBackgroundColor = _ref.filePreviewHoverBackgroundColor,
      filePreviewDownloadIcon = _ref.filePreviewDownloadIcon,
      showChangeMemberRole = _ref.showChangeMemberRole,
      showKickMember = _ref.showKickMember,
      showKickAndBlockMember = _ref.showKickAndBlockMember,
      showMakeMemberAdmin = _ref.showMakeMemberAdmin;
  var dispatch = reactRedux.useDispatch();
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var showMembers = !isDirectChannel && checkActionPermission('getMembers');
  var memberDisplayText = getChannelTypesMemberDisplayTextMap();
  var displayMemberText = memberDisplayText && memberDisplayText[channel.type] ? memberDisplayText[channel.type] + "s" : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? 'subscribers' : 'members';

  var handleTabClick = function handleTabClick(tabIndex) {
    if (activeTab !== tabIndex) {
      dispatch(emptyChannelAttachmentsAC());
      setActiveTab(tabIndex);
    }
  };

  React.useEffect(function () {
    if (!showMembers) {
      setActiveTab(channelDetailsTabs.media);
    } else {
      setActiveTab(channelDetailsTabs.member);
    }
  }, [showMembers]);
  return /*#__PURE__*/React__default.createElement(Container$p, {
    theme: theme
  }, /*#__PURE__*/React__default.createElement(DetailsTabHeader, {
    activeTabColor: colors.primary,
    backgroundColor: theme === THEME.DARK ? colors.dark : colors.white
  }, Object.keys(channelDetailsTabs).map(function (key) {
    if (key === 'member') {
      if (showMembers) {
        return /*#__PURE__*/React__default.createElement("button", {
          className: activeTab === channelDetailsTabs[key] ? 'active' : '',
          type: 'button',
          onClick: function onClick() {
            return handleTabClick(channelDetailsTabs[key]);
          },
          key: key
        }, channelDetailsTabs[key] === channelDetailsTabs.member ? displayMemberText : channelDetailsTabs[key]);
      } else {
        return null;
      }
    }

    return /*#__PURE__*/React__default.createElement("button", {
      className: activeTab === channelDetailsTabs[key] ? 'active' : '',
      type: 'button',
      onClick: function onClick() {
        return handleTabClick(channelDetailsTabs[key]);
      },
      key: key
    }, channelDetailsTabs[key]);
  })), showMembers && activeTab === channelDetailsTabs.member && /*#__PURE__*/React__default.createElement(Members, {
    theme: theme,
    channel: channel,
    checkActionPermission: checkActionPermission,
    showChangeMemberRole: showChangeMemberRole,
    showKickMember: showKickMember,
    showKickAndBlockMember: showKickAndBlockMember,
    showMakeMemberAdmin: showMakeMemberAdmin
  }), activeTab === channelDetailsTabs.media && /*#__PURE__*/React__default.createElement(Media, {
    channelId: channel.id
  }), activeTab === channelDetailsTabs.file && /*#__PURE__*/React__default.createElement(Files, {
    channelId: channel.id,
    theme: theme,
    filePreviewIcon: filePreviewIcon,
    filePreviewHoverIcon: filePreviewHoverIcon,
    filePreviewTitleColor: filePreviewTitleColor,
    filePreviewSizeColor: filePreviewSizeColor,
    filePreviewHoverBackgroundColor: filePreviewHoverBackgroundColor,
    filePreviewDownloadIcon: filePreviewDownloadIcon
  }), activeTab === channelDetailsTabs.link && /*#__PURE__*/React__default.createElement(Links, {
    channelId: channel.id,
    linkPreviewIcon: linkPreviewIcon,
    linkPreviewHoverIcon: linkPreviewHoverIcon,
    linkPreviewTitleColor: linkPreviewTitleColor,
    linkPreviewColor: linkPreviewColor,
    linkPreviewHoverBackgroundColor: linkPreviewHoverBackgroundColor
  }), activeTab === channelDetailsTabs.voice && /*#__PURE__*/React__default.createElement(Voices, {
    channelId: channel.id,
    voicePreviewPlayHoverIcon: voicePreviewPlayIcon,
    voicePreviewPlayIcon: voicePreviewPlayHoverIcon,
    voicePreviewPauseIcon: voicePreviewPauseIcon,
    voicePreviewPauseHoverIcon: voicePreviewPauseHoverIcon,
    voicePreviewTitleColor: voicePreviewTitleColor,
    voicePreviewDateAndTimeColor: voicePreviewDateAndTimeColor,
    voicePreviewHoverBackgroundColor: voicePreviewHoverBackgroundColor
  }));
};
var Container$p = styled__default.div(_templateObject$L || (_templateObject$L = _taggedTemplateLiteralLoose(["\n  //border-top: 1px solid ", ";\n"])), colors.gray1);
var DetailsTabHeader = styled__default.div(_templateObject2$F || (_templateObject2$F = _taggedTemplateLiteralLoose(["\n  overflow: auto;\n  padding: 0 20px;\n  border-bottom: 1px solid ", ";\n  background-color: ", ";\n  display: flex;\n  justify-content: space-between;\n  position: sticky;\n  top: 0;\n  z-index: 12;\n  /* width */\n  &::-webkit-scrollbar {\n    width: 0;\n    height: 0;\n  }\n\n  /* Track */\n  &::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  /* Handle */\n  &::-webkit-scrollbar-thumb {\n    background: transparent;\n  }\n\n  /* Handle on hover */\n  &::-webkit-scrollbar-thumb:hover {\n    background: transparent;\n  }\n  button {\n    position: relative;\n    border: none;\n    background: transparent;\n    outline: none;\n    padding: 13px 0 11px;\n    text-transform: capitalize;\n    font-style: normal;\n    font-weight: 500;\n    font-size: 15px;\n    line-height: 20px;\n    color: ", ";\n    min-width: 70px;\n    cursor: pointer;\n  }\n  & .active {\n    color: ", ";\n\n    &:after {\n      content: '';\n      width: 100%;\n      border-radius: 2px;\n      height: 2px;\n      background-color: ", ";\n      position: absolute;\n      top: calc(100% - 1px);\n      left: 0;\n    }\n  }\n"])), function (props) {
  return props.borderColor || colors.backgroundColor;
}, function (props) {
  return props.backgroundColor || colors.white;
}, colors.textColor2, function (props) {
  return props.activeTabColor || colors.primary;
}, function (props) {
  return props.activeTabColor || colors.primary;
});

var _templateObject$M, _templateObject2$G, _templateObject3$x, _templateObject4$s;
var Container$q = styled__default.div(_templateObject$M || (_templateObject$M = _taggedTemplateLiteralLoose(["\n  ", ";\n  height: ", ";\n  position: absolute;\n  padding: 24px 16px;\n  background-color: ", ";\n  z-index: 25;\n"])), function (props) {
  return props.active ? 'display: block' : 'display: none';
}, function (props) {
  return "calc(100vh - " + (props.heightOffset ? props.heightOffset + 48 : 48) + "px)";
}, function (props) {
  return props.backgroundColor || colors.white;
});
var AvatarCont = styled__default.div(_templateObject2$G || (_templateObject2$G = _taggedTemplateLiteralLoose(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  margin-bottom: 4px;\n\n  &::after {\n    content: '';\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    border-radius: 50%;\n    background-color: rgba(0, 0, 0, 0.4);\n  }\n  .dropdown-body {\n    top: inherit;\n    right: inherit;\n    bottom: -90px;\n  }\n"])));
var DropDownWrapper = styled__default.div(_templateObject3$x || (_templateObject3$x = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  z-index: 4;\n  width: 40px;\n  height: 40px;\n"])));
var EditChannelFooter = styled__default(ButtonBlock)(_templateObject4$s || (_templateObject4$s = _taggedTemplateLiteralLoose(["\n  margin-top: 24px;\n\n  & > button {\n    margin-left: 12px;\n  }\n"])));

var EditChannel = function EditChannel(_ref) {
  var channel = _ref.channel,
      theme = _ref.theme,
      handleToggleEditMode = _ref.handleToggleEditMode,
      editChannelSaveButtonBackgroundColor = _ref.editChannelSaveButtonBackgroundColor,
      editChannelSaveButtonTextColor = _ref.editChannelSaveButtonTextColor,
      editChannelCancelButtonBackgroundColor = _ref.editChannelCancelButtonBackgroundColor,
      editChannelCancelButtonTextColor = _ref.editChannelCancelButtonTextColor;
  var ChatClient = getClient();
  var user = ChatClient.user;
  var dispatch = reactRedux.useDispatch();
  var isEditMode = reactRedux.useSelector(channelEditModeSelector);

  var _useState = React.useState(false),
      cropPopup = _useState[0],
      setCropPopup = _useState[1];

  var _useState2 = React.useState(false),
      deleteAvatarPopupOpen = _useState2[0],
      setDeleteAvatarPopupOpen = _useState2[1];

  var _useState3 = React.useState(''),
      selectedImageUrl = _useState3[0],
      setSelectedImageUrl = _useState3[1];

  var _useState4 = React.useState(channel.subject),
      newSubject = _useState4[0],
      setNewSubject = _useState4[1];

  var _useState5 = React.useState(channel.metadata && channel.metadata.d),
      newDescription = _useState5[0],
      setNewDescription = _useState5[1];

  var _useState6 = React.useState(null),
      offsetTop = _useState6[0],
      setOffsetTop = _useState6[1];

  var _useStateComplex = useStateComplex({
    src: {},
    url: channel.avatarUrl
  }),
      newAvatar = _useStateComplex[0],
      setNewAvatar = _useStateComplex[1];

  var editContainer = React.useRef(null);
  var fileUploader = React.useRef(null);
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });

  var onOpenFileUploader = function onOpenFileUploader() {
    fileUploader.current.click();
  };

  function handleSelectImage(image) {
    setNewAvatar({
      name: image.name
    });
    setSelectedImageUrl(URL.createObjectURL(image));
    setCropPopup(true);
  }

  var handleUpdateChannel = function handleUpdateChannel(data) {
    dispatch(updateChannelAC(channel.id, data));
  };

  var handleImageCrop = function handleImageCrop(image) {
    try {
      return Promise.resolve(resizeImage(image, undefined, undefined, 0.9)).then(function (_ref2) {
        var blob = _ref2.blob;
        var file = new File([blob], image.name);
        setNewAvatar({
          src: {
            file: file
          },
          url: URL.createObjectURL(file)
        });
      });
    } catch (e) {
      return Promise.reject(e);
    }
  };

  var handleFileUpload = function handleFileUpload() {
    var file = fileUploader.current.files[0];
    handleSelectImage(file);
  };

  var handleRemoveAvatar = function handleRemoveAvatar() {
    setNewAvatar({
      src: {},
      url: ''
    });
    handleUpdateChannel({
      avatarUrl: ''
    });
  };

  var handleToggleDeleteAvatarPopup = function handleToggleDeleteAvatarPopup() {
    setDeleteAvatarPopupOpen(!deleteAvatarPopupOpen);
  };

  var handleSave = function handleSave() {
    if (newSubject !== channel.subject || newDescription !== (channel.metadata.d || channel.metadata) || newAvatar.url !== channel.avatarUrl) {
      handleUpdateChannel(_extends({}, newSubject !== channel.subject && {
        subject: newSubject
      }, newDescription !== (channel.metadata.d || channel.metadata) && {
        metadata: {
          d: newDescription
        }
      }, newAvatar.url !== channel.avatarUrl && {
        avatar: newAvatar.src.file
      }));
    }
  };

  useDidUpdate(function () {
    handleToggleEditMode(false);
    setSelectedImageUrl('');
    setNewSubject(channel.subject);
    setNewDescription(channel.metadata.d || channel.metadata);
    setNewAvatar({
      src: {},
      url: channel.avatarUrl
    });
  }, [channel]);
  React.useEffect(function () {
    setOffsetTop(editContainer && editContainer.current && editContainer.current.offsetTop);
  }, []);
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Container$q, {
    ref: editContainer,
    heightOffset: offsetTop,
    active: isEditMode,
    backgroundColor: theme === THEME.DARK ? colors.dark : colors.white
  }, /*#__PURE__*/React__default.createElement(AvatarCont, null, /*#__PURE__*/React__default.createElement(DropDownWrapper, null, !isDirectChannel && channel.userRole && /*#__PURE__*/React__default.createElement(DropDown, {
    theme: theme,
    position: 'center',
    iconColor: colors.white,
    trigger: getUploadImageIcon() || /*#__PURE__*/React__default.createElement(SvgCameraIcon, null)
  }, /*#__PURE__*/React__default.createElement(DropdownOptionsUl, null, /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 1,
    hoverBackground: colors.primaryLight,
    onClick: function onClick() {
      return onOpenFileUploader();
    },
    iconWidth: '20px'
  }, /*#__PURE__*/React__default.createElement(SvgPicture, null), /*#__PURE__*/React__default.createElement(UploadFileLabel, null, "Upload image"), /*#__PURE__*/React__default.createElement(UploadFile, {
    ref: fileUploader,
    accept: '.png,.jpeg,.jpg',
    onChange: handleFileUpload,
    type: 'file'
  })), newAvatar.url && /*#__PURE__*/React__default.createElement(DropdownOptionLi, {
    key: 2,
    hoverBackground: colors.primaryLight,
    textColor: colors.red1,
    onClick: handleToggleDeleteAvatarPopup,
    iconWidth: '20px'
  }, /*#__PURE__*/React__default.createElement(SvgDeleteChannel, null), "Delete")))), /*#__PURE__*/React__default.createElement(Avatar, {
    size: 120,
    image: newAvatar.url || (isDirectChannel && directChannelUser ? directChannelUser.avatarUrl : ''),
    name: isDirectChannel && directChannelUser ? directChannelUser.id : channel.subject || channel.id,
    textSize: 55
  })), /*#__PURE__*/React__default.createElement(Label, null, " Name "), /*#__PURE__*/React__default.createElement(CustomInput, {
    theme: theme,
    color: colors.textColor1,
    placeholder: 'Channel Subject',
    value: newSubject,
    onChange: function onChange(e) {
      return setNewSubject(e.target.value);
    }
  }), /*#__PURE__*/React__default.createElement(Label, null, " Description "), /*#__PURE__*/React__default.createElement(CustomInput, {
    theme: theme,
    color: colors.textColor1,
    placeholder: 'Channel description',
    value: newDescription,
    onChange: function onChange(e) {
      return setNewDescription(e.target.value);
    }
  }), /*#__PURE__*/React__default.createElement(EditChannelFooter, null, /*#__PURE__*/React__default.createElement(Button, {
    type: 'button',
    borderRadius: '8px',
    color: editChannelCancelButtonTextColor || colors.textColor1,
    backgroundColor: editChannelCancelButtonBackgroundColor || colors.backgroundColor,
    onClick: function onClick() {
      return handleToggleEditMode(false);
    }
  }, "Cancel"), /*#__PURE__*/React__default.createElement(Button, {
    borderRadius: '8px',
    color: editChannelSaveButtonTextColor,
    backgroundColor: editChannelSaveButtonBackgroundColor || colors.primary,
    onClick: handleSave
  }, "Save"))), cropPopup && /*#__PURE__*/React__default.createElement(ImageCrop, {
    theme: theme,
    image: {
      name: newAvatar.name,
      url: selectedImageUrl
    },
    onAccept: handleImageCrop,
    handleClosePopup: function handleClosePopup() {
      return setCropPopup(false);
    }
  }), deleteAvatarPopupOpen && /*#__PURE__*/React__default.createElement(ConfirmPopup, {
    handleFunction: handleRemoveAvatar,
    togglePopup: handleToggleDeleteAvatarPopup,
    title: 'Remove avatar?',
    description: 'Are you sure you want to remove your avatar?',
    buttonText: 'Remove'
  }));
};

var _templateObject$N, _templateObject2$H, _templateObject3$y, _templateObject4$t, _templateObject5$q, _templateObject6$m, _templateObject7$j, _templateObject8$i, _templateObject9$e, _templateObject10$c, _templateObject11$9;

var Details = function Details(_ref) {
  var size = _ref.size,
      showAboutChannel = _ref.showAboutChannel,
      avatarAndNameDirection = _ref.avatarAndNameDirection,
      channelEditIcon = _ref.channelEditIcon,
      editChannelSaveButtonBackgroundColor = _ref.editChannelSaveButtonBackgroundColor,
      editChannelSaveButtonTextColor = _ref.editChannelSaveButtonTextColor,
      editChannelCancelButtonBackgroundColor = _ref.editChannelCancelButtonBackgroundColor,
      editChannelCancelButtonTextColor = _ref.editChannelCancelButtonTextColor,
      showMuteUnmuteNotifications = _ref.showMuteUnmuteNotifications,
      muteUnmuteNotificationsOrder = _ref.muteUnmuteNotificationsOrder,
      muteNotificationIcon = _ref.muteNotificationIcon,
      unmuteNotificationIcon = _ref.unmuteNotificationIcon,
      muteNotificationIconColor = _ref.muteNotificationIconColor,
      unmuteNotificationIconColor = _ref.unmuteNotificationIconColor,
      muteUnmuteNotificationSwitcherColor = _ref.muteUnmuteNotificationSwitcherColor,
      muteUnmuteNotificationTextColor = _ref.muteUnmuteNotificationTextColor,
      timeOptionsToMuteNotifications = _ref.timeOptionsToMuteNotifications,
      showStarredMessages = _ref.showStarredMessages,
      starredMessagesOrder = _ref.starredMessagesOrder,
      staredMessagesIcon = _ref.staredMessagesIcon,
      staredMessagesIconColor = _ref.staredMessagesIconColor,
      staredMessagesTextColor = _ref.staredMessagesTextColor,
      showPinChannel = _ref.showPinChannel,
      pinChannelOrder = _ref.pinChannelOrder,
      pinChannelIcon = _ref.pinChannelIcon,
      pinChannelIconColor = _ref.pinChannelIconColor,
      pinChannelTextColor = _ref.pinChannelTextColor,
      showMarkAsReadUnread = _ref.showMarkAsReadUnread,
      markAsReadUnreadOrder = _ref.markAsReadUnreadOrder,
      markAsReadIcon = _ref.markAsReadIcon,
      markAsUnreadIcon = _ref.markAsUnreadIcon,
      markAsReadIconColor = _ref.markAsReadIconColor,
      markAsUnreadIconColor = _ref.markAsUnreadIconColor,
      markAsReadUnreadTextColor = _ref.markAsReadUnreadTextColor,
      showLeaveChannel = _ref.showLeaveChannel,
      leaveChannelOrder = _ref.leaveChannelOrder,
      leaveChannelIcon = _ref.leaveChannelIcon,
      leaveChannelIconColor = _ref.leaveChannelIconColor,
      leaveChannelTextColor = _ref.leaveChannelTextColor,
      showReportChannel = _ref.showReportChannel,
      reportChannelIcon = _ref.reportChannelIcon,
      reportChannelOrder = _ref.reportChannelOrder,
      reportChannelIconColor = _ref.reportChannelIconColor,
      reportChannelTextColor = _ref.reportChannelTextColor,
      deleteChannelIcon = _ref.deleteChannelIcon,
      showDeleteChannel = _ref.showDeleteChannel,
      deleteChannelIconColor = _ref.deleteChannelIconColor,
      deleteChannelTextColor = _ref.deleteChannelTextColor,
      deleteChannelOrder = _ref.deleteChannelOrder,
      showBlockAndLeaveChannel = _ref.showBlockAndLeaveChannel,
      showBlockUser = _ref.showBlockUser,
      blockAndLeaveChannelIcon = _ref.blockAndLeaveChannelIcon,
      blockAndLeaveChannelIconColor = _ref.blockAndLeaveChannelIconColor,
      blockAndLeaveChannelTextColor = _ref.blockAndLeaveChannelTextColor,
      unblockUserIcon = _ref.unblockUserIcon,
      linkPreviewIcon = _ref.linkPreviewIcon,
      linkPreviewHoverIcon = _ref.linkPreviewHoverIcon,
      linkPreviewTitleColor = _ref.linkPreviewTitleColor,
      linkPreviewColor = _ref.linkPreviewColor,
      linkPreviewHoverBackgroundColor = _ref.linkPreviewHoverBackgroundColor,
      voicePreviewPlayIcon = _ref.voicePreviewPlayIcon,
      voicePreviewPlayHoverIcon = _ref.voicePreviewPlayHoverIcon,
      voicePreviewPauseIcon = _ref.voicePreviewPauseIcon,
      voicePreviewPauseHoverIcon = _ref.voicePreviewPauseHoverIcon,
      voicePreviewTitleColor = _ref.voicePreviewTitleColor,
      voicePreviewDateAndTimeColor = _ref.voicePreviewDateAndTimeColor,
      voicePreviewHoverBackgroundColor = _ref.voicePreviewHoverBackgroundColor,
      filePreviewIcon = _ref.filePreviewIcon,
      filePreviewHoverIcon = _ref.filePreviewHoverIcon,
      filePreviewTitleColor = _ref.filePreviewTitleColor,
      filePreviewSizeColor = _ref.filePreviewSizeColor,
      filePreviewHoverBackgroundColor = _ref.filePreviewHoverBackgroundColor,
      filePreviewDownloadIcon = _ref.filePreviewDownloadIcon,
      showClearHistory = _ref.showClearHistory,
      clearHistoryOrder = _ref.clearHistoryOrder,
      clearHistoryIcon = _ref.clearHistoryIcon,
      clearHistoryTextColor = _ref.clearHistoryTextColor,
      showDeleteAllMessages = _ref.showDeleteAllMessages,
      deleteAllMessagesOrder = _ref.deleteAllMessagesOrder,
      deleteAllMessagesIcon = _ref.deleteAllMessagesIcon,
      deleteAllMessagesTextColor = _ref.deleteAllMessagesTextColor,
      showChangeMemberRole = _ref.showChangeMemberRole,
      showKickMember = _ref.showKickMember,
      showKickAndBlockMember = _ref.showKickAndBlockMember,
      showMakeMemberAdmin = _ref.showMakeMemberAdmin;
  var dispatch = reactRedux.useDispatch();
  var ChatClient = getClient();
  var user = ChatClient.user;
  var theme = reactRedux.useSelector(themeSelector);
  var getFromContacts = getShowOnlyContactUsers();

  var _useState = React.useState(false),
      mounted = _useState[0],
      setMounted = _useState[1];

  var _useState2 = React.useState(''),
      activeTab = _useState2[0],
      setActiveTab = _useState2[1];

  var _useState3 = React.useState(0),
      channelDetailsHeight = _useState3[0],
      setChannelDetailsHeight = _useState3[1];

  var editMode = reactRedux.useSelector(channelEditModeSelector);
  var channel = reactRedux.useSelector(activeChannelSelector, reactRedux.shallowEqual);

  var _usePermissions = usePermissions(channel.userRole),
      checkActionPermission = _usePermissions[0];

  var membersLoading = reactRedux.useSelector(membersLoadingStateSelector);
  var messagesLoading = reactRedux.useSelector(messagesLoadingState);
  var attachmentsHasNex = reactRedux.useSelector(activeTabAttachmentsHasNextSelector);
  var contactsMap = reactRedux.useSelector(contactsMapSelector);
  var detailsRef = React.useRef(null);
  var openTimeOut = React.useRef(null);
  var isDirectChannel = channel.type === CHANNEL_TYPE.DIRECT;
  var memberDisplayText = getChannelTypesMemberDisplayTextMap();
  var displayMemberText = memberDisplayText && memberDisplayText[channel.type] ? channel.memberCount > 1 ? memberDisplayText[channel.type] + "s" : memberDisplayText[channel.type] : channel.type === CHANNEL_TYPE.BROADCAST || channel.type === CHANNEL_TYPE.PUBLIC ? channel.memberCount > 1 ? 'subscribers' : 'subscriber' : channel.memberCount > 1 ? 'members' : 'member';
  var directChannelUser = isDirectChannel && channel.members.find(function (member) {
    return member.id !== user.id;
  });

  var handleMembersListScroll = function handleMembersListScroll(event) {
    if (event.target.scrollTop >= event.target.scrollHeight - event.target.offsetHeight - 100) {
      if (activeTab === channelDetailsTabs.member) {
        if (membersLoading === LOADING_STATE.LOADED) {
          dispatch(loadMoreMembersAC(15));
        }
      } else if (messagesLoading === LOADING_STATE.LOADED && attachmentsHasNex) {
        dispatch(loadMoreAttachmentsAC(20));
      }
    }
  };

  var setEditMode = function setEditMode(state) {
    dispatch(toggleEditChannelAC(state));
  };

  var handleDetailsClose = function handleDetailsClose() {
    clearTimeout(openTimeOut.current);
    setMounted(false);
    dispatch(switchChannelInfoAC(false));
  };

  React.useEffect(function () {
    setMounted(true);
    var detailsContainer = document.getElementById('channel_details_wrapper');

    if (detailsContainer) {
      setChannelDetailsHeight(detailsContainer.offsetHeight);
    }
  }, []);
  return /*#__PURE__*/React__default.createElement(Container$r, {
    mounted: mounted,
    size: size,
    theme: theme,
    borderColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(ChannelDetailsHeader, {
    borderColor: colors.backgroundColor
  }, editMode ? /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SvgArrowLeft, {
    onClick: function onClick() {
      return setEditMode(false);
    }
  }), /*#__PURE__*/React__default.createElement(SectionHeader, {
    margin: '0 0 0 12px',
    color: colors.textColor1
  }, "Edit details")) : /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(SectionHeader, {
    color: colors.textColor1
  }, "Details"), ' ', /*#__PURE__*/React__default.createElement(CloseIcon, {
    color: colors.textColor1,
    onClick: handleDetailsClose
  }))), editMode && /*#__PURE__*/React__default.createElement(EditChannel, {
    theme: theme,
    channel: channel,
    handleToggleEditMode: setEditMode,
    editChannelSaveButtonBackgroundColor: editChannelSaveButtonBackgroundColor,
    editChannelSaveButtonTextColor: editChannelSaveButtonTextColor,
    editChannelCancelButtonBackgroundColor: editChannelCancelButtonBackgroundColor,
    editChannelCancelButtonTextColor: editChannelCancelButtonTextColor
  }), /*#__PURE__*/React__default.createElement(ChatDetails, {
    size: size,
    onScroll: handleMembersListScroll,
    heightOffset: detailsRef && detailsRef.current && detailsRef.current.offsetTop,
    height: channelDetailsHeight,
    ref: detailsRef
  }, /*#__PURE__*/React__default.createElement(DetailsHeader, {
    borderColor: colors.backgroundColor
  }, /*#__PURE__*/React__default.createElement(ChannelAvatarAndName, {
    direction: avatarAndNameDirection
  }, /*#__PURE__*/React__default.createElement(Avatar, {
    image: channel.avatarUrl || directChannelUser && directChannelUser.avatarUrl,
    name: channel.subject || directChannelUser && (directChannelUser.firstName || directChannelUser.id),
    size: 72,
    textSize: 26,
    setDefaultAvatar: isDirectChannel
  }), /*#__PURE__*/React__default.createElement(ChannelInfo$4, {
    direction: avatarAndNameDirection
  }, /*#__PURE__*/React__default.createElement(ChannelName$1, {
    isDirect: isDirectChannel,
    uppercase: directChannelUser && hideUserPresence && hideUserPresence(directChannelUser)
  }, channel.subject || (isDirectChannel && directChannelUser ? makeUsername(contactsMap[directChannelUser.id], directChannelUser, getFromContacts) : '')), isDirectChannel ? /*#__PURE__*/React__default.createElement(SubTitle, null, hideUserPresence && directChannelUser && hideUserPresence(directChannelUser) ? '' : directChannelUser && directChannelUser.presence && (directChannelUser.presence.state === USER_PRESENCE_STATUS.ONLINE ? 'Online' : directChannelUser.presence.lastActiveAt && userLastActiveDateFormat(directChannelUser.presence.lastActiveAt))) : /*#__PURE__*/React__default.createElement(SubTitle, null, channel.memberCount, " ", displayMemberText), !isDirectChannel && checkActionPermission('editChannel') && /*#__PURE__*/React__default.createElement(EditButton, {
    onClick: function onClick() {
      return setEditMode(true);
    }
  }, channelEditIcon || /*#__PURE__*/React__default.createElement(SvgEditIcon, null)))), showAboutChannel && channel.metadata && channel.metadata.d && /*#__PURE__*/React__default.createElement(AboutChannel, null, /*#__PURE__*/React__default.createElement(AboutChannelTitle, null, "About"), /*#__PURE__*/React__default.createElement(AboutChannelText, {
    color: colors.textColor1
  }, channel.metadata && channel.metadata.d ? channel.metadata.d : ''))), channel.userRole && /*#__PURE__*/React__default.createElement(Actions$1, {
    theme: theme,
    showMuteUnmuteNotifications: showMuteUnmuteNotifications,
    muteUnmuteNotificationsOrder: muteUnmuteNotificationsOrder,
    unmuteNotificationIcon: unmuteNotificationIcon,
    muteNotificationIconColor: muteNotificationIconColor,
    unmuteNotificationIconColor: unmuteNotificationIconColor,
    muteUnmuteNotificationSwitcherColor: muteUnmuteNotificationSwitcherColor,
    muteUnmuteNotificationTextColor: muteUnmuteNotificationTextColor,
    showStarredMessages: showStarredMessages,
    starredMessagesOrder: starredMessagesOrder,
    staredMessagesIcon: staredMessagesIcon,
    staredMessagesIconColor: staredMessagesIconColor,
    staredMessagesTextColor: staredMessagesTextColor,
    showClearHistory: showClearHistory,
    clearHistoryOrder: clearHistoryOrder,
    clearHistoryIcon: clearHistoryIcon,
    clearHistoryTextColor: clearHistoryTextColor,
    showDeleteAllMessages: showDeleteAllMessages,
    deleteAllMessagesOrder: deleteAllMessagesOrder,
    deleteAllMessagesIcon: deleteAllMessagesIcon,
    deleteAllMessagesTextColor: deleteAllMessagesTextColor,
    showPinChannel: showPinChannel,
    pinChannelOrder: pinChannelOrder,
    pinChannelIcon: pinChannelIcon,
    pinChannelIconColor: pinChannelIconColor,
    pinChannelTextColor: pinChannelTextColor,
    showMarkAsReadUnread: showMarkAsReadUnread,
    markAsReadUnreadOrder: markAsReadUnreadOrder,
    markAsReadIcon: markAsReadIcon,
    markAsUnreadIcon: markAsUnreadIcon,
    markAsReadIconColor: markAsReadIconColor,
    markAsUnreadIconColor: markAsUnreadIconColor,
    markAsReadUnreadTextColor: markAsReadUnreadTextColor,
    showLeaveChannel: showLeaveChannel,
    leaveChannelOrder: leaveChannelOrder,
    leaveChannelIcon: leaveChannelIcon,
    leaveChannelIconColor: leaveChannelIconColor,
    leaveChannelTextColor: leaveChannelTextColor,
    showReportChannel: showReportChannel,
    reportChannelIcon: reportChannelIcon,
    reportChannelOrder: reportChannelOrder,
    reportChannelIconColor: reportChannelIconColor,
    reportChannelTextColor: reportChannelTextColor,
    showDeleteChannel: showDeleteChannel && checkActionPermission('deleteChannel'),
    deleteChannelIcon: deleteChannelIcon,
    deleteChannelIconColor: deleteChannelIconColor,
    deleteChannelTextColor: deleteChannelTextColor,
    deleteChannelOrder: deleteChannelOrder,
    showBlockAndLeaveChannel: showBlockAndLeaveChannel,
    showBlockUser: showBlockUser,
    blockAndLeaveChannelIcon: blockAndLeaveChannelIcon,
    blockAndLeaveChannelIconColor: blockAndLeaveChannelIconColor,
    blockAndLeaveChannelTextColor: blockAndLeaveChannelTextColor,
    unblockUserIcon: unblockUserIcon,
    muteNotificationIcon: muteNotificationIcon,
    channel: channel,
    toggleable: false,
    timeOptionsToMuteNotifications: timeOptionsToMuteNotifications
  }), !channel.isMockChannel && /*#__PURE__*/React__default.createElement(DetailsTab, {
    theme: theme,
    channel: channel,
    activeTab: activeTab,
    setActiveTab: setActiveTab,
    linkPreviewIcon: linkPreviewIcon,
    linkPreviewHoverIcon: linkPreviewHoverIcon,
    linkPreviewTitleColor: linkPreviewTitleColor,
    linkPreviewColor: linkPreviewColor,
    linkPreviewHoverBackgroundColor: linkPreviewHoverBackgroundColor,
    voicePreviewPlayHoverIcon: voicePreviewPlayIcon,
    voicePreviewPlayIcon: voicePreviewPlayHoverIcon,
    voicePreviewPauseIcon: voicePreviewPauseIcon,
    voicePreviewPauseHoverIcon: voicePreviewPauseHoverIcon,
    voicePreviewTitleColor: voicePreviewTitleColor,
    voicePreviewDateAndTimeColor: voicePreviewDateAndTimeColor,
    voicePreviewHoverBackgroundColor: voicePreviewHoverBackgroundColor,
    filePreviewIcon: filePreviewIcon,
    filePreviewHoverIcon: filePreviewHoverIcon,
    filePreviewTitleColor: filePreviewTitleColor,
    filePreviewSizeColor: filePreviewSizeColor,
    filePreviewHoverBackgroundColor: filePreviewHoverBackgroundColor,
    filePreviewDownloadIcon: filePreviewDownloadIcon,
    checkActionPermission: checkActionPermission,
    showChangeMemberRole: showChangeMemberRole,
    showKickMember: showKickMember,
    showKickAndBlockMember: showKickAndBlockMember,
    showMakeMemberAdmin: showMakeMemberAdmin
  })));
};
var Container$r = styled__default.div(_templateObject$N || (_templateObject$N = _taggedTemplateLiteralLoose(["\n  flex: 0 0 auto;\n  width: 0;\n  border-left: 1px solid ", ";\n  //transition: all 0.1s;\n  ", "\n}\n"])), function (props) {
  return props.borderColor || colors.backgroundColor;
}, function (props) {
  return props.mounted && " width: " + (props.size === 'small' ? '300px' : props.size === 'medium' ? '350px' : '400px') + ";";
});
var ChannelDetailsHeader = styled__default.div(_templateObject2$H || (_templateObject2$H = _taggedTemplateLiteralLoose(["\n  display: flex;\n  align-items: center;\n  padding: 16px;\n  position: relative;\n  height: 64px;\n  box-sizing: border-box;\n  border-bottom: 1px solid ", ";\n\n  & svg {\n    cursor: pointer;\n  }\n"])), function (props) {
  return props.borderColor || colors.backgroundColor;
});
var ChatDetails = styled__default.div(_templateObject3$y || (_templateObject3$y = _taggedTemplateLiteralLoose(["\n  //position: relative;\n  width: ", ";\n  //height: ", ";\n  height: ", ";\n  overflow-y: auto;\n"])), function (props) {
  return props.size === 'small' ? '300px' : props.size === 'medium' ? '350px' : '400px';
}, function (props) {
  return props.height ? "calc(100vh - " + props.heightOffset + "px)" : '100vh';
}, function (props) {
  return props.height && props.height - (props.heightOffset ? props.heightOffset + 2 : 0) + "px";
});
var AboutChannel = styled__default.div(_templateObject4$t || (_templateObject4$t = _taggedTemplateLiteralLoose(["\n  margin-top: 20px;\n"])));
var AboutChannelTitle = styled__default.h4(_templateObject5$q || (_templateObject5$q = _taggedTemplateLiteralLoose(["\n  font-size: 12px;\n  margin: 0;\n  line-height: 16px;\n  color: ", ";\n"])), colors.textColor3);
var AboutChannelText = styled__default.h3(_templateObject6$m || (_templateObject6$m = _taggedTemplateLiteralLoose(["\n  font-size: 16px;\n  margin: 0;\n  font-weight: 400;\n  line-height: 22px;\n  color: ", ";\n"])), function (props) {
  return props.color;
});
var ChannelInfo$4 = styled__default.div(_templateObject7$j || (_templateObject7$j = _taggedTemplateLiteralLoose(["\n  position: relative;\n  margin-left: ", ";\n  margin-top: ", ";\n  text-align: ", ";\n"])), function (props) {
  return (!props.direction || props.direction !== 'column') && '16px';
}, function (props) {
  return props.direction && props.direction === 'column' && '16px';
}, function (props) {
  return props.direction && props.direction === 'column' && 'center';
});
var DetailsHeader = styled__default.div(_templateObject8$i || (_templateObject8$i = _taggedTemplateLiteralLoose(["\n  border-bottom: 6px solid ", ";\n  align-items: center;\n  box-sizing: border-box;\n  padding: 20px 16px;\n"])), function (props) {
  return props.borderColor || colors.backgroundColor;
});
var ChannelAvatarAndName = styled__default.div(_templateObject9$e || (_templateObject9$e = _taggedTemplateLiteralLoose(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  flex-direction: ", ";\n"])), function (props) {
  return props.direction;
});
var ChannelName$1 = styled__default(SectionHeader)(_templateObject10$c || (_templateObject10$c = _taggedTemplateLiteralLoose(["\n  white-space: nowrap;\n  max-width: ", ";\n  text-overflow: ellipsis;\n  overflow: hidden;\n  text-transform: ", ";\n"])), function (props) {
  return props.isDirect ? '200px' : '168px';
}, function (props) {
  return props.uppercase && 'uppercase';
});
var EditButton = styled__default.span(_templateObject11$9 || (_templateObject11$9 = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  right: -28px;\n  top: 8px;\n  margin-left: 8px;\n  cursor: pointer;\n  color: #b2b6be;\n"])));

var _templateObject$O;

var ChannelDetailsContainer = function ChannelDetailsContainer(_ref) {
  var _ref$size = _ref.size,
      size = _ref$size === void 0 ? 'large' : _ref$size,
      channelEditIcon = _ref.channelEditIcon,
      showAboutChannel = _ref.showAboutChannel,
      _ref$avatarAndNameDir = _ref.avatarAndNameDirection,
      avatarAndNameDirection = _ref$avatarAndNameDir === void 0 ? 'row' : _ref$avatarAndNameDir,
      editChannelSaveButtonBackgroundColor = _ref.editChannelSaveButtonBackgroundColor,
      editChannelSaveButtonTextColor = _ref.editChannelSaveButtonTextColor,
      editChannelCancelButtonBackgroundColor = _ref.editChannelCancelButtonBackgroundColor,
      editChannelCancelButtonTextColor = _ref.editChannelCancelButtonTextColor,
      showMuteUnmuteNotifications = _ref.showMuteUnmuteNotifications,
      muteUnmuteNotificationsOrder = _ref.muteUnmuteNotificationsOrder,
      muteNotificationIcon = _ref.muteNotificationIcon,
      unmuteNotificationIcon = _ref.unmuteNotificationIcon,
      muteNotificationIconColor = _ref.muteNotificationIconColor,
      unmuteNotificationIconColor = _ref.unmuteNotificationIconColor,
      muteUnmuteNotificationSwitcherColor = _ref.muteUnmuteNotificationSwitcherColor,
      muteUnmuteNotificationTextColor = _ref.muteUnmuteNotificationTextColor,
      timeOptionsToMuteNotifications = _ref.timeOptionsToMuteNotifications,
      showStarredMessages = _ref.showStarredMessages,
      starredMessagesOrder = _ref.starredMessagesOrder,
      staredMessagesIcon = _ref.staredMessagesIcon,
      staredMessagesIconColor = _ref.staredMessagesIconColor,
      staredMessagesTextColor = _ref.staredMessagesTextColor,
      showPinChannel = _ref.showPinChannel,
      pinChannelOrder = _ref.pinChannelOrder,
      pinChannelIcon = _ref.pinChannelIcon,
      pinChannelIconColor = _ref.pinChannelIconColor,
      pinChannelTextColor = _ref.pinChannelTextColor,
      showMarkAsReadUnread = _ref.showMarkAsReadUnread,
      markAsReadUnreadOrder = _ref.markAsReadUnreadOrder,
      markAsReadIcon = _ref.markAsReadIcon,
      markAsUnreadIcon = _ref.markAsUnreadIcon,
      markAsReadIconColor = _ref.markAsReadIconColor,
      markAsUnreadIconColor = _ref.markAsUnreadIconColor,
      markAsReadUnreadTextColor = _ref.markAsReadUnreadTextColor,
      showLeaveChannel = _ref.showLeaveChannel,
      leaveChannelOrder = _ref.leaveChannelOrder,
      leaveChannelIcon = _ref.leaveChannelIcon,
      leaveChannelIconColor = _ref.leaveChannelIconColor,
      leaveChannelTextColor = _ref.leaveChannelTextColor,
      showReportChannel = _ref.showReportChannel,
      reportChannelIcon = _ref.reportChannelIcon,
      reportChannelOrder = _ref.reportChannelOrder,
      reportChannelIconColor = _ref.reportChannelIconColor,
      reportChannelTextColor = _ref.reportChannelTextColor,
      showDeleteChannel = _ref.showDeleteChannel,
      deleteChannelIcon = _ref.deleteChannelIcon,
      deleteChannelIconColor = _ref.deleteChannelIconColor,
      deleteChannelTextColor = _ref.deleteChannelTextColor,
      deleteChannelOrder = _ref.deleteChannelOrder,
      showBlockAndLeaveChannel = _ref.showBlockAndLeaveChannel,
      showBlockUser = _ref.showBlockUser,
      blockAndLeaveChannelIcon = _ref.blockAndLeaveChannelIcon,
      blockAndLeaveChannelIconColor = _ref.blockAndLeaveChannelIconColor,
      blockAndLeaveChannelTextColor = _ref.blockAndLeaveChannelTextColor,
      unblockUserIcon = _ref.unblockUserIcon,
      linkPreviewIcon = _ref.linkPreviewIcon,
      linkPreviewHoverIcon = _ref.linkPreviewHoverIcon,
      linkPreviewTitleColor = _ref.linkPreviewTitleColor,
      linkPreviewColor = _ref.linkPreviewColor,
      linkPreviewHoverBackgroundColor = _ref.linkPreviewHoverBackgroundColor,
      filePreviewIcon = _ref.filePreviewIcon,
      filePreviewHoverIcon = _ref.filePreviewHoverIcon,
      filePreviewTitleColor = _ref.filePreviewTitleColor,
      filePreviewSizeColor = _ref.filePreviewSizeColor,
      filePreviewHoverBackgroundColor = _ref.filePreviewHoverBackgroundColor,
      filePreviewDownloadIcon = _ref.filePreviewDownloadIcon,
      showClearHistory = _ref.showClearHistory,
      clearHistoryOrder = _ref.clearHistoryOrder,
      clearHistoryIcon = _ref.clearHistoryIcon,
      clearHistoryTextColor = _ref.clearHistoryTextColor,
      showDeleteAllMessages = _ref.showDeleteAllMessages,
      deleteAllMessagesOrder = _ref.deleteAllMessagesOrder,
      deleteAllMessagesIcon = _ref.deleteAllMessagesIcon,
      deleteAllMessagesTextColor = _ref.deleteAllMessagesTextColor,
      showChangeMemberRole = _ref.showChangeMemberRole,
      showKickMember = _ref.showKickMember,
      showKickAndBlockMember = _ref.showKickAndBlockMember;
  var channelDetailsIsOpen = reactRedux.useSelector(channelInfoIsOpenSelector, reactRedux.shallowEqual);
  return /*#__PURE__*/React__default.createElement(DetailsWrapper, {
    id: 'channel_details_wrapper'
  }, channelDetailsIsOpen && /*#__PURE__*/React__default.createElement(Details, {
    size: size,
    showAboutChannel: showAboutChannel,
    avatarAndNameDirection: avatarAndNameDirection,
    channelEditIcon: channelEditIcon,
    editChannelSaveButtonBackgroundColor: editChannelSaveButtonBackgroundColor,
    editChannelSaveButtonTextColor: editChannelSaveButtonTextColor,
    editChannelCancelButtonBackgroundColor: editChannelCancelButtonBackgroundColor,
    editChannelCancelButtonTextColor: editChannelCancelButtonTextColor,
    showMuteUnmuteNotifications: showMuteUnmuteNotifications,
    muteUnmuteNotificationsOrder: muteUnmuteNotificationsOrder,
    muteNotificationIcon: muteNotificationIcon,
    unmuteNotificationIcon: unmuteNotificationIcon,
    muteNotificationIconColor: muteNotificationIconColor,
    unmuteNotificationIconColor: unmuteNotificationIconColor,
    muteUnmuteNotificationSwitcherColor: muteUnmuteNotificationSwitcherColor,
    muteUnmuteNotificationTextColor: muteUnmuteNotificationTextColor,
    timeOptionsToMuteNotifications: timeOptionsToMuteNotifications,
    showStarredMessages: showStarredMessages,
    starredMessagesOrder: starredMessagesOrder,
    staredMessagesIcon: staredMessagesIcon,
    staredMessagesIconColor: staredMessagesIconColor,
    staredMessagesTextColor: staredMessagesTextColor,
    showPinChannel: showPinChannel,
    pinChannelOrder: pinChannelOrder,
    pinChannelIcon: pinChannelIcon,
    pinChannelIconColor: pinChannelIconColor,
    pinChannelTextColor: pinChannelTextColor,
    showMarkAsReadUnread: showMarkAsReadUnread,
    markAsReadUnreadOrder: markAsReadUnreadOrder,
    markAsReadIcon: markAsReadIcon,
    markAsUnreadIcon: markAsUnreadIcon,
    markAsReadIconColor: markAsReadIconColor,
    markAsUnreadIconColor: markAsUnreadIconColor,
    markAsReadUnreadTextColor: markAsReadUnreadTextColor,
    showLeaveChannel: showLeaveChannel,
    leaveChannelOrder: leaveChannelOrder,
    leaveChannelIcon: leaveChannelIcon,
    leaveChannelIconColor: leaveChannelIconColor,
    leaveChannelTextColor: leaveChannelTextColor,
    showReportChannel: showReportChannel,
    reportChannelIcon: reportChannelIcon,
    reportChannelOrder: reportChannelOrder,
    reportChannelIconColor: reportChannelIconColor,
    reportChannelTextColor: reportChannelTextColor,
    showDeleteChannel: showDeleteChannel,
    deleteChannelIcon: deleteChannelIcon,
    deleteChannelIconColor: deleteChannelIconColor,
    deleteChannelTextColor: deleteChannelTextColor,
    deleteChannelOrder: deleteChannelOrder,
    showBlockAndLeaveChannel: showBlockAndLeaveChannel,
    showBlockUser: showBlockUser,
    blockAndLeaveChannelIcon: blockAndLeaveChannelIcon,
    blockAndLeaveChannelIconColor: blockAndLeaveChannelIconColor,
    blockAndLeaveChannelTextColor: blockAndLeaveChannelTextColor,
    unblockUserIcon: unblockUserIcon,
    linkPreviewIcon: linkPreviewIcon,
    linkPreviewHoverIcon: linkPreviewHoverIcon,
    linkPreviewTitleColor: linkPreviewTitleColor,
    linkPreviewColor: linkPreviewColor,
    linkPreviewHoverBackgroundColor: linkPreviewHoverBackgroundColor,
    filePreviewIcon: filePreviewIcon,
    filePreviewHoverIcon: filePreviewHoverIcon,
    filePreviewTitleColor: filePreviewTitleColor,
    filePreviewSizeColor: filePreviewSizeColor,
    filePreviewHoverBackgroundColor: filePreviewHoverBackgroundColor,
    filePreviewDownloadIcon: filePreviewDownloadIcon,
    showClearHistory: showClearHistory,
    clearHistoryOrder: clearHistoryOrder,
    clearHistoryIcon: clearHistoryIcon,
    clearHistoryTextColor: clearHistoryTextColor,
    showDeleteAllMessages: showDeleteAllMessages,
    deleteAllMessagesOrder: deleteAllMessagesOrder,
    deleteAllMessagesIcon: deleteAllMessagesIcon,
    deleteAllMessagesTextColor: deleteAllMessagesTextColor,
    showChangeMemberRole: showChangeMemberRole,
    showKickMember: showKickMember,
    showKickAndBlockMember: showKickAndBlockMember
  }));
};

var DetailsWrapper = styled__default.div(_templateObject$O || (_templateObject$O = _taggedTemplateLiteralLoose([""])));

var _path$1n;

function _extends$1s() {
  _extends$1s = Object.assign ? Object.assign.bind() : function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };
  return _extends$1s.apply(this, arguments);
}

function SvgChevronDown(props) {
  return /*#__PURE__*/React.createElement("svg", _extends$1s({
    width: 32,
    height: 32,
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, props), _path$1n || (_path$1n = /*#__PURE__*/React.createElement("path", {
    d: "M9.298 12.937a1.056 1.056 0 10-1.374 1.603l7.39 6.333c.395.339.978.339 1.373 0l7.389-6.333a1.056 1.056 0 10-1.374-1.603L16 18.68l-6.702-5.744z",
    fill: "CurrentColor"
  })));
}

var _templateObject$P, _templateObject2$I;

var MessagesScrollToBottomButton = function MessagesScrollToBottomButton(_ref) {
  var buttonIcon = _ref.buttonIcon,
      buttonWidth = _ref.buttonWidth,
      buttonHeight = _ref.buttonHeight,
      bottomPosition = _ref.bottomPosition,
      rightPosition = _ref.rightPosition,
      buttonBorder = _ref.buttonBorder,
      buttonBackgroundColor = _ref.buttonBackgroundColor,
      buttonHoverBackgroundColor = _ref.buttonHoverBackgroundColor,
      buttonBorderRadius = _ref.buttonBorderRadius,
      buttonShadow = _ref.buttonShadow,
      unreadCountWidth = _ref.unreadCountWidth,
      unreadCountHeight = _ref.unreadCountHeight,
      unreadCountFontSize = _ref.unreadCountFontSize,
      unreadCountTextColor = _ref.unreadCountTextColor;
  var dispatch = reactRedux.useDispatch();
  var channel = reactRedux.useSelector(activeChannelSelector);
  var theme = reactRedux.useSelector(themeSelector);
  var sendMessageInputHeight = reactRedux.useSelector(sendMessageInputHeightSelector);
  var showScrollToNewMessageButton = reactRedux.useSelector(showScrollToNewMessageButtonSelector);

  var handleScrollToBottom = function handleScrollToBottom() {
    dispatch(scrollToNewMessageAC(true, true));
  };

  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, showScrollToNewMessageButton && /*#__PURE__*/React__default.createElement(BottomButton, {
    theme: theme,
    width: buttonWidth,
    height: buttonHeight,
    border: buttonBorder,
    borderRadius: buttonBorderRadius,
    backgroundColor: buttonBackgroundColor || colors.backgroundColor,
    hoverBackgroundColor: buttonHoverBackgroundColor,
    shadow: buttonShadow,
    onClick: handleScrollToBottom,
    bottomOffset: sendMessageInputHeight,
    bottomPosition: bottomPosition,
    rightPosition: rightPosition
  }, !!(channel.newMessageCount && channel.newMessageCount > 0) && /*#__PURE__*/React__default.createElement(UnreadCount$1, {
    width: unreadCountWidth,
    height: unreadCountHeight,
    textColor: unreadCountTextColor,
    fontSize: unreadCountFontSize,
    backgroundColor: colors.primary,
    isMuted: channel.muted
  }, channel.newMessageCount ? channel.newMessageCount > 99 ? '99+' : channel.newMessageCount : ''), buttonIcon || /*#__PURE__*/React__default.createElement(SvgChevronDown, null)));
};
var BottomButton = styled__default.div(_templateObject$P || (_templateObject$P = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: ", ";\n  right: ", ";\n  margin-right: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: ", ";\n  border: 0.5px solid rgba(0, 0, 0, 0.1);\n  border-radius: 50px;\n  width: 48px;\n  height: 48px;\n  cursor: pointer;\n  z-index: 14;\n\n  & > svg {\n    color: rgba(129, 140, 153, 1);\n  }\n\n  & > span {\n    bottom: 32px;\n    right: 0;\n  }\n"])), function (props) {
  return props.bottomOffset + (props.bottomPosition || 45) + "px";
}, function (props) {
  return (props.rightPosition || 16) + "px";
}, function (props) {
  return props.backgroundColor || colors.backgroundColor;
});
var UnreadCount$1 = styled__default.span(_templateObject2$I || (_templateObject2$I = _taggedTemplateLiteralLoose(["\n  position: absolute;\n  bottom: 11px;\n  right: 16px;\n  flex: 0 0 auto;\n  margin-left: auto;\n  background-color: ", ";\n  padding: 0 4px;\n  font-size: ", ";\n  line-height: 20px;\n  min-width: ", ";\n  height: ", ";\n  text-align: center;\n  font-weight: 500;\n  color: ", ";\n  border-radius: 10px;\n  box-sizing: border-box;\n\n  /*", "*/\n"])), function (props) {
  return props.backgroundColor || colors.primary;
}, function (props) {
  return props.fontSize || '13px';
}, function (props) {
  return props.width || '20px';
}, function (props) {
  return props.height || '20px';
}, function (props) {
  return props.textColor || '#fff';
}, function (props) {
  return props.isMuted && 'background-color: #BEBFC7;';
});

exports.Avatar = Avatar;
exports.ChannelDetails = ChannelDetailsContainer;
exports.ChannelList = ChannelList;
exports.ChannelSearch = ChannelSearch;
exports.Chat = Chat;
exports.ChatHeader = ChatHeader;
exports.CreateChannel = CreateChannel;
exports.DropDown = DropDown;
exports.MessageList = MessagesContainer;
exports.MessagesScrollToBottomButton = MessagesScrollToBottomButton;
exports.SceytChat = SceytChatContainer;
exports.SendMessage = SendMessageInput;
//# sourceMappingURL=index.js.map
